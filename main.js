/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var De=Object.defineProperty;var Hn=Object.getOwnPropertyDescriptor;var qn=Object.getOwnPropertyNames;var Xn=Object.prototype.hasOwnProperty;var Un=(i,a)=>{for(var t in a)De(i,t,{get:a[t],enumerable:!0})},zn=(i,a,t,e)=>{if(a&&typeof a=="object"||typeof a=="function")for(let n of qn(a))!Xn.call(i,n)&&n!==t&&De(i,n,{get:()=>a[n],enumerable:!(e=Hn(a,n))||e.enumerable});return i};var Jn=i=>zn(De({},"__esModule",{value:!0}),i);var Va={};Un(Va,{default:()=>Te});module.exports=Jn(Va);var E=require("obsidian");var g=require("obsidian");function on(i,a){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(i);a&&(e=e.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,e)}return t}function ut(i){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?on(Object(t),!0).forEach(function(e){Qn(i,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):on(Object(t)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(t,e))})}return i}function ee(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ee=function(a){return typeof a}:ee=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},ee(i)}function Qn(i,a,t){return a in i?Object.defineProperty(i,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[a]=t,i}function gt(){return gt=Object.assign||function(i){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e])}return i},gt.apply(this,arguments)}function Zn(i,a){if(i==null)return{};var t={},e=Object.keys(i),n,s;for(s=0;s<e.length;s++)n=e[s],!(a.indexOf(n)>=0)&&(t[n]=i[n]);return t}function ta(i,a){if(i==null)return{};var t=Zn(i,a),e,n;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);for(n=0;n<s.length;n++)e=s[n],!(a.indexOf(e)>=0)&&Object.prototype.propertyIsEnumerable.call(i,e)&&(t[e]=i[e])}return t}var ea="1.15.6";function pt(i){if(typeof window!="undefined"&&window.navigator)return!!navigator.userAgent.match(i)}var ft=pt(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Gt=pt(/Edge/i),ln=pt(/firefox/i),Kt=pt(/safari/i)&&!pt(/chrome/i)&&!pt(/android/i),Ke=pt(/iP(ad|od|hone)/i),mn=pt(/chrome/i)&&pt(/android/i),bn={capture:!1,passive:!1};function P(i,a,t){i.addEventListener(a,t,!ft&&bn)}function M(i,a,t){i.removeEventListener(a,t,!ft&&bn)}function re(i,a){if(a){if(a[0]===">"&&(a=a.substring(1)),i)try{if(i.matches)return i.matches(a);if(i.msMatchesSelector)return i.msMatchesSelector(a);if(i.webkitMatchesSelector)return i.webkitMatchesSelector(a)}catch(t){return!1}return!1}}function yn(i){return i.host&&i!==document&&i.host.nodeType?i.host:i.parentNode}function it(i,a,t,e){if(i){t=t||document;do{if(a!=null&&(a[0]===">"?i.parentNode===t&&re(i,a):re(i,a))||e&&i===t)return i;if(i===t)break}while(i=yn(i))}return null}var cn=/\s+/g;function z(i,a,t){if(i&&a)if(i.classList)i.classList[t?"add":"remove"](a);else{var e=(" "+i.className+" ").replace(cn," ").replace(" "+a+" "," ");i.className=(e+(t?" "+a:"")).replace(cn," ")}}function C(i,a,t){var e=i&&i.style;if(e){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(i,""):i.currentStyle&&(t=i.currentStyle),a===void 0?t:t[a];!(a in e)&&a.indexOf("webkit")===-1&&(a="-webkit-"+a),e[a]=t+(typeof t=="string"?"":"px")}}function Ft(i,a){var t="";if(typeof i=="string")t=i;else do{var e=C(i,"transform");e&&e!=="none"&&(t=e+" "+t)}while(!a&&(i=i.parentNode));var n=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return n&&new n(t)}function vn(i,a,t){if(i){var e=i.getElementsByTagName(a),n=0,s=e.length;if(t)for(;n<s;n++)t(e[n],n);return e}return[]}function dt(){var i=document.scrollingElement;return i||document.documentElement}function O(i,a,t,e,n){if(!(!i.getBoundingClientRect&&i!==window)){var s,r,o,c,l,d,u;if(i!==window&&i.parentNode&&i!==dt()?(s=i.getBoundingClientRect(),r=s.top,o=s.left,c=s.bottom,l=s.right,d=s.height,u=s.width):(r=0,o=0,c=window.innerHeight,l=window.innerWidth,d=window.innerHeight,u=window.innerWidth),(a||t)&&i!==window&&(n=n||i.parentNode,!ft))do if(n&&n.getBoundingClientRect&&(C(n,"transform")!=="none"||t&&C(n,"position")!=="static")){var h=n.getBoundingClientRect();r-=h.top+parseInt(C(n,"border-top-width")),o-=h.left+parseInt(C(n,"border-left-width")),c=r+s.height,l=o+s.width;break}while(n=n.parentNode);if(e&&i!==window){var b=Ft(n||i),y=b&&b.a,p=b&&b.d;b&&(r/=p,o/=y,u/=y,d/=p,c=r+d,l=o+u)}return{top:r,left:o,bottom:c,right:l,width:u,height:d}}}function dn(i,a,t){for(var e=wt(i,!0),n=O(i)[a];e;){var s=O(e)[t],r=void 0;if(t==="top"||t==="left"?r=n>=s:r=n<=s,!r)return e;if(e===dt())break;e=wt(e,!1)}return!1}function At(i,a,t,e){for(var n=0,s=0,r=i.children;s<r.length;){if(r[s].style.display!=="none"&&r[s]!==S.ghost&&(e||r[s]!==S.dragged)&&it(r[s],t.draggable,i,!1)){if(n===a)return r[s];n++}s++}return null}function je(i,a){for(var t=i.lastElementChild;t&&(t===S.ghost||C(t,"display")==="none"||a&&!re(t,a));)t=t.previousElementSibling;return t||null}function Z(i,a){var t=0;if(!i||!i.parentNode)return-1;for(;i=i.previousElementSibling;)i.nodeName.toUpperCase()!=="TEMPLATE"&&i!==S.clone&&(!a||re(i,a))&&t++;return t}function un(i){var a=0,t=0,e=dt();if(i)do{var n=Ft(i),s=n.a,r=n.d;a+=i.scrollLeft*s,t+=i.scrollTop*r}while(i!==e&&(i=i.parentNode));return[a,t]}function na(i,a){for(var t in i)if(i.hasOwnProperty(t)){for(var e in a)if(a.hasOwnProperty(e)&&a[e]===i[t][e])return Number(t)}return-1}function wt(i,a){if(!i||!i.getBoundingClientRect)return dt();var t=i,e=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var n=C(t);if(t.clientWidth<t.scrollWidth&&(n.overflowX=="auto"||n.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(n.overflowY=="auto"||n.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return dt();if(e||a)return t;e=!0}}while(t=t.parentNode);return dt()}function aa(i,a){if(i&&a)for(var t in a)a.hasOwnProperty(t)&&(i[t]=a[t]);return i}function Ee(i,a){return Math.round(i.top)===Math.round(a.top)&&Math.round(i.left)===Math.round(a.left)&&Math.round(i.height)===Math.round(a.height)&&Math.round(i.width)===Math.round(a.width)}var jt;function wn(i,a){return function(){if(!jt){var t=arguments,e=this;t.length===1?i.call(e,t[0]):i.apply(e,t),jt=setTimeout(function(){jt=void 0},a)}}}function sa(){clearTimeout(jt),jt=void 0}function kn(i,a,t){i.scrollLeft+=a,i.scrollTop+=t}function Cn(i){var a=window.Polymer,t=window.jQuery||window.Zepto;return a&&a.dom?a.dom(i).cloneNode(!0):t?t(i).clone(!0)[0]:i.cloneNode(!0)}function Sn(i,a,t){var e={};return Array.from(i.children).forEach(function(n){var s,r,o,c;if(!(!it(n,a.draggable,i,!1)||n.animated||n===t)){var l=O(n);e.left=Math.min((s=e.left)!==null&&s!==void 0?s:1/0,l.left),e.top=Math.min((r=e.top)!==null&&r!==void 0?r:1/0,l.top),e.right=Math.max((o=e.right)!==null&&o!==void 0?o:-1/0,l.right),e.bottom=Math.max((c=e.bottom)!==null&&c!==void 0?c:-1/0,l.bottom)}}),e.width=e.right-e.left,e.height=e.bottom-e.top,e.x=e.left,e.y=e.top,e}var X="Sortable"+new Date().getTime();function ia(){var i=[],a;return{captureAnimationState:function(){if(i=[],!!this.options.animation){var e=[].slice.call(this.el.children);e.forEach(function(n){if(!(C(n,"display")==="none"||n===S.ghost)){i.push({target:n,rect:O(n)});var s=ut({},i[i.length-1].rect);if(n.thisAnimationDuration){var r=Ft(n,!0);r&&(s.top-=r.f,s.left-=r.e)}n.fromRect=s}})}},addAnimationState:function(e){i.push(e)},removeAnimationState:function(e){i.splice(na(i,{target:e}),1)},animateAll:function(e){var n=this;if(!this.options.animation){clearTimeout(a),typeof e=="function"&&e();return}var s=!1,r=0;i.forEach(function(o){var c=0,l=o.target,d=l.fromRect,u=O(l),h=l.prevFromRect,b=l.prevToRect,y=o.rect,p=Ft(l,!0);p&&(u.top-=p.f,u.left-=p.e),l.toRect=u,l.thisAnimationDuration&&Ee(h,u)&&!Ee(d,u)&&(y.top-u.top)/(y.left-u.left)===(d.top-u.top)/(d.left-u.left)&&(c=oa(y,h,b,n.options)),Ee(u,d)||(l.prevFromRect=d,l.prevToRect=u,c||(c=n.options.animation),n.animate(l,y,u,c)),c&&(s=!0,r=Math.max(r,c),clearTimeout(l.animationResetTimer),l.animationResetTimer=setTimeout(function(){l.animationTime=0,l.prevFromRect=null,l.fromRect=null,l.prevToRect=null,l.thisAnimationDuration=null},c),l.thisAnimationDuration=c)}),clearTimeout(a),s?a=setTimeout(function(){typeof e=="function"&&e()},r):typeof e=="function"&&e(),i=[]},animate:function(e,n,s,r){if(r){C(e,"transition",""),C(e,"transform","");var o=Ft(this.el),c=o&&o.a,l=o&&o.d,d=(n.left-s.left)/(c||1),u=(n.top-s.top)/(l||1);e.animatingX=!!d,e.animatingY=!!u,C(e,"transform","translate3d("+d+"px,"+u+"px,0)"),this.forRepaintDummy=ra(e),C(e,"transition","transform "+r+"ms"+(this.options.easing?" "+this.options.easing:"")),C(e,"transform","translate3d(0,0,0)"),typeof e.animated=="number"&&clearTimeout(e.animated),e.animated=setTimeout(function(){C(e,"transition",""),C(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1},r)}}}}function ra(i){return i.offsetWidth}function oa(i,a,t,e){return Math.sqrt(Math.pow(a.top-i.top,2)+Math.pow(a.left-i.left,2))/Math.sqrt(Math.pow(a.top-t.top,2)+Math.pow(a.left-t.left,2))*e.animation}var Et=[],xe={initializeByDefault:!0},Wt={mount:function(a){for(var t in xe)xe.hasOwnProperty(t)&&!(t in a)&&(a[t]=xe[t]);Et.forEach(function(e){if(e.pluginName===a.pluginName)throw"Sortable: Cannot mount plugin ".concat(a.pluginName," more than once")}),Et.push(a)},pluginEvent:function(a,t,e){var n=this;this.eventCanceled=!1,e.cancel=function(){n.eventCanceled=!0};var s=a+"Global";Et.forEach(function(r){t[r.pluginName]&&(t[r.pluginName][s]&&t[r.pluginName][s](ut({sortable:t},e)),t.options[r.pluginName]&&t[r.pluginName][a]&&t[r.pluginName][a](ut({sortable:t},e)))})},initializePlugins:function(a,t,e,n){Et.forEach(function(o){var c=o.pluginName;if(!(!a.options[c]&&!o.initializeByDefault)){var l=new o(a,t,a.options);l.sortable=a,l.options=a.options,a[c]=l,gt(e,l.defaults)}});for(var s in a.options)if(a.options.hasOwnProperty(s)){var r=this.modifyOption(a,s,a.options[s]);typeof r!="undefined"&&(a.options[s]=r)}},getEventProperties:function(a,t){var e={};return Et.forEach(function(n){typeof n.eventProperties=="function"&&gt(e,n.eventProperties.call(t[n.pluginName],a))}),e},modifyOption:function(a,t,e){var n;return Et.forEach(function(s){a[s.pluginName]&&s.optionListeners&&typeof s.optionListeners[t]=="function"&&(n=s.optionListeners[t].call(a[s.pluginName],e))}),n}};function la(i){var a=i.sortable,t=i.rootEl,e=i.name,n=i.targetEl,s=i.cloneEl,r=i.toEl,o=i.fromEl,c=i.oldIndex,l=i.newIndex,d=i.oldDraggableIndex,u=i.newDraggableIndex,h=i.originalEvent,b=i.putSortable,y=i.extraEventProperties;if(a=a||t&&t[X],!!a){var p,w=a.options,m="on"+e.charAt(0).toUpperCase()+e.substr(1);window.CustomEvent&&!ft&&!Gt?p=new CustomEvent(e,{bubbles:!0,cancelable:!0}):(p=document.createEvent("Event"),p.initEvent(e,!0,!0)),p.to=r||t,p.from=o||t,p.item=n||t,p.clone=s,p.oldIndex=c,p.newIndex=l,p.oldDraggableIndex=d,p.newDraggableIndex=u,p.originalEvent=h,p.pullMode=b?b.lastPutMode:void 0;var v=ut(ut({},y),Wt.getEventProperties(e,a));for(var x in v)p[x]=v[x];t&&t.dispatchEvent(p),w[m]&&w[m].call(a,p)}}var ca=["evt"],q=function(a,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=e.evt,s=ta(e,ca);Wt.pluginEvent.bind(S)(a,t,ut({dragEl:f,parentEl:_,ghostEl:T,rootEl:N,nextEl:Tt,lastDownEl:ne,cloneEl:I,cloneHidden:vt,dragStarted:Bt,putSortable:K,activeSortable:S.active,originalEvent:n,oldIndex:Pt,oldDraggableIndex:Rt,newIndex:J,newDraggableIndex:yt,hideGhostForTarget:xn,unhideGhostForTarget:Mn,cloneNowHidden:function(){vt=!0},cloneNowShown:function(){vt=!1},dispatchSortableEvent:function(o){V({sortable:t,name:o,originalEvent:n})}},s))};function V(i){la(ut({putSortable:K,cloneEl:I,targetEl:f,rootEl:N,oldIndex:Pt,oldDraggableIndex:Rt,newIndex:J,newDraggableIndex:yt},i))}var f,_,T,N,Tt,ne,I,vt,Pt,J,Rt,yt,Jt,K,Mt=!1,oe=!1,le=[],Ct,st,Me,Pe,hn,pn,Bt,xt,Vt,Yt=!1,Qt=!1,ae,j,Fe=[],Le=!1,ce=[],ue=typeof document!="undefined",Zt=Ke,gn=Gt||ft?"cssFloat":"float",da=ue&&!mn&&!Ke&&"draggable"in document.createElement("div"),Tn=function(){if(ue){if(ft)return!1;var i=document.createElement("x");return i.style.cssText="pointer-events:auto",i.style.pointerEvents==="auto"}}(),Dn=function(a,t){var e=C(a),n=parseInt(e.width)-parseInt(e.paddingLeft)-parseInt(e.paddingRight)-parseInt(e.borderLeftWidth)-parseInt(e.borderRightWidth),s=At(a,0,t),r=At(a,1,t),o=s&&C(s),c=r&&C(r),l=o&&parseInt(o.marginLeft)+parseInt(o.marginRight)+O(s).width,d=c&&parseInt(c.marginLeft)+parseInt(c.marginRight)+O(r).width;if(e.display==="flex")return e.flexDirection==="column"||e.flexDirection==="column-reverse"?"vertical":"horizontal";if(e.display==="grid")return e.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(s&&o.float&&o.float!=="none"){var u=o.float==="left"?"left":"right";return r&&(c.clear==="both"||c.clear===u)?"vertical":"horizontal"}return s&&(o.display==="block"||o.display==="flex"||o.display==="table"||o.display==="grid"||l>=n&&e[gn]==="none"||r&&e[gn]==="none"&&l+d>n)?"vertical":"horizontal"},ua=function(a,t,e){var n=e?a.left:a.top,s=e?a.right:a.bottom,r=e?a.width:a.height,o=e?t.left:t.top,c=e?t.right:t.bottom,l=e?t.width:t.height;return n===o||s===c||n+r/2===o+l/2},ha=function(a,t){var e;return le.some(function(n){var s=n[X].options.emptyInsertThreshold;if(!(!s||je(n))){var r=O(n),o=a>=r.left-s&&a<=r.right+s,c=t>=r.top-s&&t<=r.bottom+s;if(o&&c)return e=n}}),e},En=function(a){function t(s,r){return function(o,c,l,d){var u=o.options.group.name&&c.options.group.name&&o.options.group.name===c.options.group.name;if(s==null&&(r||u))return!0;if(s==null||s===!1)return!1;if(r&&s==="clone")return s;if(typeof s=="function")return t(s(o,c,l,d),r)(o,c,l,d);var h=(r?o:c).options.group.name;return s===!0||typeof s=="string"&&s===h||s.join&&s.indexOf(h)>-1}}var e={},n=a.group;(!n||ee(n)!="object")&&(n={name:n}),e.name=n.name,e.checkPull=t(n.pull,!0),e.checkPut=t(n.put),e.revertClone=n.revertClone,a.group=e},xn=function(){!Tn&&T&&C(T,"display","none")},Mn=function(){!Tn&&T&&C(T,"display","")};ue&&!mn&&document.addEventListener("click",function(i){if(oe)return i.preventDefault(),i.stopPropagation&&i.stopPropagation(),i.stopImmediatePropagation&&i.stopImmediatePropagation(),oe=!1,!1},!0);var St=function(a){if(f){a=a.touches?a.touches[0]:a;var t=ha(a.clientX,a.clientY);if(t){var e={};for(var n in a)a.hasOwnProperty(n)&&(e[n]=a[n]);e.target=e.rootEl=t,e.preventDefault=void 0,e.stopPropagation=void 0,t[X]._onDragOver(e)}}},pa=function(a){f&&f.parentNode[X]._isOutsideThisEl(a.target)};function S(i,a){if(!(i&&i.nodeType&&i.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(i));this.el=i,this.options=a=gt({},a),i[X]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(i.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Dn(i,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(r,o){r.setData("Text",o.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:S.supportPointer!==!1&&"PointerEvent"in window&&(!Kt||Ke),emptyInsertThreshold:5};Wt.initializePlugins(this,i,t);for(var e in t)!(e in a)&&(a[e]=t[e]);En(a);for(var n in this)n.charAt(0)==="_"&&typeof this[n]=="function"&&(this[n]=this[n].bind(this));this.nativeDraggable=a.forceFallback?!1:da,this.nativeDraggable&&(this.options.touchStartThreshold=1),a.supportPointer?P(i,"pointerdown",this._onTapStart):(P(i,"mousedown",this._onTapStart),P(i,"touchstart",this._onTapStart)),this.nativeDraggable&&(P(i,"dragover",this),P(i,"dragenter",this)),le.push(this.el),a.store&&a.store.get&&this.sort(a.store.get(this)||[]),gt(this,ia())}S.prototype={constructor:S,_isOutsideThisEl:function(a){!this.el.contains(a)&&a!==this.el&&(xt=null)},_getDirection:function(a,t){return typeof this.options.direction=="function"?this.options.direction.call(this,a,t,f):this.options.direction},_onTapStart:function(a){if(a.cancelable){var t=this,e=this.el,n=this.options,s=n.preventOnFilter,r=a.type,o=a.touches&&a.touches[0]||a.pointerType&&a.pointerType==="touch"&&a,c=(o||a).target,l=a.target.shadowRoot&&(a.path&&a.path[0]||a.composedPath&&a.composedPath()[0])||c,d=n.filter;if(ka(e),!f&&!(/mousedown|pointerdown/.test(r)&&a.button!==0||n.disabled)&&!l.isContentEditable&&!(!this.nativeDraggable&&Kt&&c&&c.tagName.toUpperCase()==="SELECT")&&(c=it(c,n.draggable,e,!1),!(c&&c.animated)&&ne!==c)){if(Pt=Z(c),Rt=Z(c,n.draggable),typeof d=="function"){if(d.call(this,a,c,this)){V({sortable:t,rootEl:l,name:"filter",targetEl:c,toEl:e,fromEl:e}),q("filter",t,{evt:a}),s&&a.preventDefault();return}}else if(d&&(d=d.split(",").some(function(u){if(u=it(l,u.trim(),e,!1),u)return V({sortable:t,rootEl:u,name:"filter",targetEl:c,fromEl:e,toEl:e}),q("filter",t,{evt:a}),!0}),d)){s&&a.preventDefault();return}n.handle&&!it(l,n.handle,e,!1)||this._prepareDragStart(a,o,c)}}},_prepareDragStart:function(a,t,e){var n=this,s=n.el,r=n.options,o=s.ownerDocument,c;if(e&&!f&&e.parentNode===s){var l=O(e);if(N=s,f=e,_=f.parentNode,Tt=f.nextSibling,ne=e,Jt=r.group,S.dragged=f,Ct={target:f,clientX:(t||a).clientX,clientY:(t||a).clientY},hn=Ct.clientX-l.left,pn=Ct.clientY-l.top,this._lastX=(t||a).clientX,this._lastY=(t||a).clientY,f.style["will-change"]="all",c=function(){if(q("delayEnded",n,{evt:a}),S.eventCanceled){n._onDrop();return}n._disableDelayedDragEvents(),!ln&&n.nativeDraggable&&(f.draggable=!0),n._triggerDragStart(a,t),V({sortable:n,name:"choose",originalEvent:a}),z(f,r.chosenClass,!0)},r.ignore.split(",").forEach(function(d){vn(f,d.trim(),Ae)}),P(o,"dragover",St),P(o,"mousemove",St),P(o,"touchmove",St),r.supportPointer?(P(o,"pointerup",n._onDrop),!this.nativeDraggable&&P(o,"pointercancel",n._onDrop)):(P(o,"mouseup",n._onDrop),P(o,"touchend",n._onDrop),P(o,"touchcancel",n._onDrop)),ln&&this.nativeDraggable&&(this.options.touchStartThreshold=4,f.draggable=!0),q("delayStart",this,{evt:a}),r.delay&&(!r.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(Gt||ft))){if(S.eventCanceled){this._onDrop();return}r.supportPointer?(P(o,"pointerup",n._disableDelayedDrag),P(o,"pointercancel",n._disableDelayedDrag)):(P(o,"mouseup",n._disableDelayedDrag),P(o,"touchend",n._disableDelayedDrag),P(o,"touchcancel",n._disableDelayedDrag)),P(o,"mousemove",n._delayedDragTouchMoveHandler),P(o,"touchmove",n._delayedDragTouchMoveHandler),r.supportPointer&&P(o,"pointermove",n._delayedDragTouchMoveHandler),n._dragStartTimer=setTimeout(c,r.delay)}else c()}},_delayedDragTouchMoveHandler:function(a){var t=a.touches?a.touches[0]:a;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){f&&Ae(f),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var a=this.el.ownerDocument;M(a,"mouseup",this._disableDelayedDrag),M(a,"touchend",this._disableDelayedDrag),M(a,"touchcancel",this._disableDelayedDrag),M(a,"pointerup",this._disableDelayedDrag),M(a,"pointercancel",this._disableDelayedDrag),M(a,"mousemove",this._delayedDragTouchMoveHandler),M(a,"touchmove",this._delayedDragTouchMoveHandler),M(a,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(a,t){t=t||a.pointerType=="touch"&&a,!this.nativeDraggable||t?this.options.supportPointer?P(document,"pointermove",this._onTouchMove):t?P(document,"touchmove",this._onTouchMove):P(document,"mousemove",this._onTouchMove):(P(f,"dragend",this),P(N,"dragstart",this._onDragStart));try{document.selection?se(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(a,t){if(Mt=!1,N&&f){q("dragStarted",this,{evt:t}),this.nativeDraggable&&P(document,"dragover",pa);var e=this.options;!a&&z(f,e.dragClass,!1),z(f,e.ghostClass,!0),S.active=this,a&&this._appendGhost(),V({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(st){this._lastX=st.clientX,this._lastY=st.clientY,xn();for(var a=document.elementFromPoint(st.clientX,st.clientY),t=a;a&&a.shadowRoot&&(a=a.shadowRoot.elementFromPoint(st.clientX,st.clientY),a!==t);)t=a;if(f.parentNode[X]._isOutsideThisEl(a),t)do{if(t[X]){var e=void 0;if(e=t[X]._onDragOver({clientX:st.clientX,clientY:st.clientY,target:a,rootEl:t}),e&&!this.options.dragoverBubble)break}a=t}while(t=yn(t));Mn()}},_onTouchMove:function(a){if(Ct){var t=this.options,e=t.fallbackTolerance,n=t.fallbackOffset,s=a.touches?a.touches[0]:a,r=T&&Ft(T,!0),o=T&&r&&r.a,c=T&&r&&r.d,l=Zt&&j&&un(j),d=(s.clientX-Ct.clientX+n.x)/(o||1)+(l?l[0]-Fe[0]:0)/(o||1),u=(s.clientY-Ct.clientY+n.y)/(c||1)+(l?l[1]-Fe[1]:0)/(c||1);if(!S.active&&!Mt){if(e&&Math.max(Math.abs(s.clientX-this._lastX),Math.abs(s.clientY-this._lastY))<e)return;this._onDragStart(a,!0)}if(T){r?(r.e+=d-(Me||0),r.f+=u-(Pe||0)):r={a:1,b:0,c:0,d:1,e:d,f:u};var h="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");C(T,"webkitTransform",h),C(T,"mozTransform",h),C(T,"msTransform",h),C(T,"transform",h),Me=d,Pe=u,st=s}a.cancelable&&a.preventDefault()}},_appendGhost:function(){if(!T){var a=this.options.fallbackOnBody?document.body:N,t=O(f,!0,Zt,!0,a),e=this.options;if(Zt){for(j=a;C(j,"position")==="static"&&C(j,"transform")==="none"&&j!==document;)j=j.parentNode;j!==document.body&&j!==document.documentElement?(j===document&&(j=dt()),t.top+=j.scrollTop,t.left+=j.scrollLeft):j=dt(),Fe=un(j)}T=f.cloneNode(!0),z(T,e.ghostClass,!1),z(T,e.fallbackClass,!0),z(T,e.dragClass,!0),C(T,"transition",""),C(T,"transform",""),C(T,"box-sizing","border-box"),C(T,"margin",0),C(T,"top",t.top),C(T,"left",t.left),C(T,"width",t.width),C(T,"height",t.height),C(T,"opacity","0.8"),C(T,"position",Zt?"absolute":"fixed"),C(T,"zIndex","100000"),C(T,"pointerEvents","none"),S.ghost=T,a.appendChild(T),C(T,"transform-origin",hn/parseInt(T.style.width)*100+"% "+pn/parseInt(T.style.height)*100+"%")}},_onDragStart:function(a,t){var e=this,n=a.dataTransfer,s=e.options;if(q("dragStart",this,{evt:a}),S.eventCanceled){this._onDrop();return}q("setupClone",this),S.eventCanceled||(I=Cn(f),I.removeAttribute("id"),I.draggable=!1,I.style["will-change"]="",this._hideClone(),z(I,this.options.chosenClass,!1),S.clone=I),e.cloneId=se(function(){q("clone",e),!S.eventCanceled&&(e.options.removeCloneOnHide||N.insertBefore(I,f),e._hideClone(),V({sortable:e,name:"clone"}))}),!t&&z(f,s.dragClass,!0),t?(oe=!0,e._loopId=setInterval(e._emulateDragOver,50)):(M(document,"mouseup",e._onDrop),M(document,"touchend",e._onDrop),M(document,"touchcancel",e._onDrop),n&&(n.effectAllowed="move",s.setData&&s.setData.call(e,n,f)),P(document,"drop",e),C(f,"transform","translateZ(0)")),Mt=!0,e._dragStartId=se(e._dragStarted.bind(e,t,a)),P(document,"selectstart",e),Bt=!0,window.getSelection().removeAllRanges(),Kt&&C(document.body,"user-select","none")},_onDragOver:function(a){var t=this.el,e=a.target,n,s,r,o=this.options,c=o.group,l=S.active,d=Jt===c,u=o.sort,h=K||l,b,y=this,p=!1;if(Le)return;function w(Lt,Gn){q(Lt,y,ut({evt:a,isOwner:d,axis:b?"vertical":"horizontal",revert:r,dragRect:n,targetRect:s,canSort:u,fromSortable:h,target:e,completed:v,onMove:function(rn,Wn){return te(N,t,f,n,rn,O(rn),a,Wn)},changed:x},Gn))}function m(){w("dragOverAnimationCapture"),y.captureAnimationState(),y!==h&&h.captureAnimationState()}function v(Lt){return w("dragOverCompleted",{insertion:Lt}),Lt&&(d?l._hideClone():l._showClone(y),y!==h&&(z(f,K?K.options.ghostClass:l.options.ghostClass,!1),z(f,o.ghostClass,!0)),K!==y&&y!==S.active?K=y:y===S.active&&K&&(K=null),h===y&&(y._ignoreWhileAnimating=e),y.animateAll(function(){w("dragOverAnimationComplete"),y._ignoreWhileAnimating=null}),y!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(e===f&&!f.animated||e===t&&!e.animated)&&(xt=null),!o.dragoverBubble&&!a.rootEl&&e!==document&&(f.parentNode[X]._isOutsideThisEl(a.target),!Lt&&St(a)),!o.dragoverBubble&&a.stopPropagation&&a.stopPropagation(),p=!0}function x(){J=Z(f),yt=Z(f,o.draggable),V({sortable:y,name:"change",toEl:t,newIndex:J,newDraggableIndex:yt,originalEvent:a})}if(a.preventDefault!==void 0&&a.cancelable&&a.preventDefault(),e=it(e,o.draggable,t,!0),w("dragOver"),S.eventCanceled)return p;if(f.contains(a.target)||e.animated&&e.animatingX&&e.animatingY||y._ignoreWhileAnimating===e)return v(!1);if(oe=!1,l&&!o.disabled&&(d?u||(r=_!==N):K===this||(this.lastPutMode=Jt.checkPull(this,l,f,a))&&c.checkPut(this,l,f,a))){if(b=this._getDirection(a,e)==="vertical",n=O(f),w("dragOverValid"),S.eventCanceled)return p;if(r)return _=N,m(),this._hideClone(),w("revert"),S.eventCanceled||(Tt?N.insertBefore(f,Tt):N.appendChild(f)),v(!0);var D=je(t,o.draggable);if(!D||ba(a,b,this)&&!D.animated){if(D===f)return v(!1);if(D&&t===a.target&&(e=D),e&&(s=O(e)),te(N,t,f,n,e,s,a,!!e)!==!1)return m(),D&&D.nextSibling?t.insertBefore(f,D.nextSibling):t.appendChild(f),_=t,x(),v(!0)}else if(D&&ma(a,b,this)){var F=At(t,0,o,!0);if(F===f)return v(!1);if(e=F,s=O(e),te(N,t,f,n,e,s,a,!1)!==!1)return m(),t.insertBefore(f,F),_=t,x(),v(!0)}else if(e.parentNode===t){s=O(e);var A=0,lt,W=f.parentNode!==t,L=!ua(f.animated&&f.toRect||n,e.animated&&e.toRect||s,b),mt=b?"top":"left",ct=dn(e,"top","top")||dn(f,"top","top"),bt=ct?ct.scrollTop:void 0;xt!==e&&(lt=s[mt],Yt=!1,Qt=!L&&o.invertSwap||W),A=ya(a,e,s,b,L?1:o.swapThreshold,o.invertedSwapThreshold==null?o.swapThreshold:o.invertedSwapThreshold,Qt,xt===e);var H;if(A!==0){var Q=Z(f);do Q-=A,H=_.children[Q];while(H&&(C(H,"display")==="none"||H===T))}if(A===0||H===e)return v(!1);xt=e,Vt=A;var at=e.nextElementSibling,R=!1;R=A===1;var _t=te(N,t,f,n,e,s,a,R);if(_t!==!1)return(_t===1||_t===-1)&&(R=_t===1),Le=!0,setTimeout(fa,30),m(),R&&!at?t.appendChild(f):e.parentNode.insertBefore(f,R?at:e),ct&&kn(ct,0,bt-ct.scrollTop),_=f.parentNode,lt!==void 0&&!Qt&&(ae=Math.abs(lt-O(e)[mt])),x(),v(!0)}if(t.contains(f))return v(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){M(document,"mousemove",this._onTouchMove),M(document,"touchmove",this._onTouchMove),M(document,"pointermove",this._onTouchMove),M(document,"dragover",St),M(document,"mousemove",St),M(document,"touchmove",St)},_offUpEvents:function(){var a=this.el.ownerDocument;M(a,"mouseup",this._onDrop),M(a,"touchend",this._onDrop),M(a,"pointerup",this._onDrop),M(a,"pointercancel",this._onDrop),M(a,"touchcancel",this._onDrop),M(document,"selectstart",this)},_onDrop:function(a){var t=this.el,e=this.options;if(J=Z(f),yt=Z(f,e.draggable),q("drop",this,{evt:a}),_=f&&f.parentNode,J=Z(f),yt=Z(f,e.draggable),S.eventCanceled){this._nulling();return}Mt=!1,Qt=!1,Yt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Be(this.cloneId),Be(this._dragStartId),this.nativeDraggable&&(M(document,"drop",this),M(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Kt&&C(document.body,"user-select",""),C(f,"transform",""),a&&(Bt&&(a.cancelable&&a.preventDefault(),!e.dropBubble&&a.stopPropagation()),T&&T.parentNode&&T.parentNode.removeChild(T),(N===_||K&&K.lastPutMode!=="clone")&&I&&I.parentNode&&I.parentNode.removeChild(I),f&&(this.nativeDraggable&&M(f,"dragend",this),Ae(f),f.style["will-change"]="",Bt&&!Mt&&z(f,K?K.options.ghostClass:this.options.ghostClass,!1),z(f,this.options.chosenClass,!1),V({sortable:this,name:"unchoose",toEl:_,newIndex:null,newDraggableIndex:null,originalEvent:a}),N!==_?(J>=0&&(V({rootEl:_,name:"add",toEl:_,fromEl:N,originalEvent:a}),V({sortable:this,name:"remove",toEl:_,originalEvent:a}),V({rootEl:_,name:"sort",toEl:_,fromEl:N,originalEvent:a}),V({sortable:this,name:"sort",toEl:_,originalEvent:a})),K&&K.save()):J!==Pt&&J>=0&&(V({sortable:this,name:"update",toEl:_,originalEvent:a}),V({sortable:this,name:"sort",toEl:_,originalEvent:a})),S.active&&((J==null||J===-1)&&(J=Pt,yt=Rt),V({sortable:this,name:"end",toEl:_,originalEvent:a}),this.save()))),this._nulling()},_nulling:function(){q("nulling",this),N=f=_=T=Tt=I=ne=vt=Ct=st=Bt=J=yt=Pt=Rt=xt=Vt=K=Jt=S.dragged=S.ghost=S.clone=S.active=null,ce.forEach(function(a){a.checked=!0}),ce.length=Me=Pe=0},handleEvent:function(a){switch(a.type){case"drop":case"dragend":this._onDrop(a);break;case"dragenter":case"dragover":f&&(this._onDragOver(a),ga(a));break;case"selectstart":a.preventDefault();break}},toArray:function(){for(var a=[],t,e=this.el.children,n=0,s=e.length,r=this.options;n<s;n++)t=e[n],it(t,r.draggable,this.el,!1)&&a.push(t.getAttribute(r.dataIdAttr)||wa(t));return a},sort:function(a,t){var e={},n=this.el;this.toArray().forEach(function(s,r){var o=n.children[r];it(o,this.options.draggable,n,!1)&&(e[s]=o)},this),t&&this.captureAnimationState(),a.forEach(function(s){e[s]&&(n.removeChild(e[s]),n.appendChild(e[s]))}),t&&this.animateAll()},save:function(){var a=this.options.store;a&&a.set&&a.set(this)},closest:function(a,t){return it(a,t||this.options.draggable,this.el,!1)},option:function(a,t){var e=this.options;if(t===void 0)return e[a];var n=Wt.modifyOption(this,a,t);typeof n!="undefined"?e[a]=n:e[a]=t,a==="group"&&En(e)},destroy:function(){q("destroy",this);var a=this.el;a[X]=null,M(a,"mousedown",this._onTapStart),M(a,"touchstart",this._onTapStart),M(a,"pointerdown",this._onTapStart),this.nativeDraggable&&(M(a,"dragover",this),M(a,"dragenter",this)),Array.prototype.forEach.call(a.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),le.splice(le.indexOf(this.el),1),this.el=a=null},_hideClone:function(){if(!vt){if(q("hideClone",this),S.eventCanceled)return;C(I,"display","none"),this.options.removeCloneOnHide&&I.parentNode&&I.parentNode.removeChild(I),vt=!0}},_showClone:function(a){if(a.lastPutMode!=="clone"){this._hideClone();return}if(vt){if(q("showClone",this),S.eventCanceled)return;f.parentNode==N&&!this.options.group.revertClone?N.insertBefore(I,f):Tt?N.insertBefore(I,Tt):N.appendChild(I),this.options.group.revertClone&&this.animate(f,I),C(I,"display",""),vt=!1}}};function ga(i){i.dataTransfer&&(i.dataTransfer.dropEffect="move"),i.cancelable&&i.preventDefault()}function te(i,a,t,e,n,s,r,o){var c,l=i[X],d=l.options.onMove,u;return window.CustomEvent&&!ft&&!Gt?c=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(c=document.createEvent("Event"),c.initEvent("move",!0,!0)),c.to=a,c.from=i,c.dragged=t,c.draggedRect=e,c.related=n||a,c.relatedRect=s||O(a),c.willInsertAfter=o,c.originalEvent=r,i.dispatchEvent(c),d&&(u=d.call(l,c,r)),u}function Ae(i){i.draggable=!1}function fa(){Le=!1}function ma(i,a,t){var e=O(At(t.el,0,t.options,!0)),n=Sn(t.el,t.options,T),s=10;return a?i.clientX<n.left-s||i.clientY<e.top&&i.clientX<e.right:i.clientY<n.top-s||i.clientY<e.bottom&&i.clientX<e.left}function ba(i,a,t){var e=O(je(t.el,t.options.draggable)),n=Sn(t.el,t.options,T),s=10;return a?i.clientX>n.right+s||i.clientY>e.bottom&&i.clientX>e.left:i.clientY>n.bottom+s||i.clientX>e.right&&i.clientY>e.top}function ya(i,a,t,e,n,s,r,o){var c=e?i.clientY:i.clientX,l=e?t.height:t.width,d=e?t.top:t.left,u=e?t.bottom:t.right,h=!1;if(!r){if(o&&ae<l*n){if(!Yt&&(Vt===1?c>d+l*s/2:c<u-l*s/2)&&(Yt=!0),Yt)h=!0;else if(Vt===1?c<d+ae:c>u-ae)return-Vt}else if(c>d+l*(1-n)/2&&c<u-l*(1-n)/2)return va(a)}return h=h||r,h&&(c<d+l*s/2||c>u-l*s/2)?c>d+l/2?1:-1:0}function va(i){return Z(f)<Z(i)?1:-1}function wa(i){for(var a=i.tagName+i.className+i.src+i.href+i.textContent,t=a.length,e=0;t--;)e+=a.charCodeAt(t);return e.toString(36)}function ka(i){ce.length=0;for(var a=i.getElementsByTagName("input"),t=a.length;t--;){var e=a[t];e.checked&&ce.push(e)}}function se(i){return setTimeout(i,0)}function Be(i){return clearTimeout(i)}ue&&P(document,"touchmove",function(i){(S.active||Mt)&&i.cancelable&&i.preventDefault()});S.utils={on:P,off:M,css:C,find:vn,is:function(a,t){return!!it(a,t,a,!1)},extend:aa,throttle:wn,closest:it,toggleClass:z,clone:Cn,index:Z,nextTick:se,cancelNextTick:Be,detectDirection:Dn,getChild:At,expando:X};S.get=function(i){return i[X]};S.mount=function(){for(var i=arguments.length,a=new Array(i),t=0;t<i;t++)a[t]=arguments[t];a[0].constructor===Array&&(a=a[0]),a.forEach(function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(S.utils=ut(ut({},S.utils),e.utils)),Wt.mount(e)})};S.create=function(i,a){return new S(i,a)};S.version=ea;var B=[],Ot,Oe,$e=!1,Ne,Ie,de,$t;function Ca(){function i(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var a in this)a.charAt(0)==="_"&&typeof this[a]=="function"&&(this[a]=this[a].bind(this))}return i.prototype={dragStarted:function(t){var e=t.originalEvent;this.sortable.nativeDraggable?P(document,"dragover",this._handleAutoScroll):this.options.supportPointer?P(document,"pointermove",this._handleFallbackAutoScroll):e.touches?P(document,"touchmove",this._handleFallbackAutoScroll):P(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var e=t.originalEvent;!this.options.dragOverBubble&&!e.rootEl&&this._handleAutoScroll(e)},drop:function(){this.sortable.nativeDraggable?M(document,"dragover",this._handleAutoScroll):(M(document,"pointermove",this._handleFallbackAutoScroll),M(document,"touchmove",this._handleFallbackAutoScroll),M(document,"mousemove",this._handleFallbackAutoScroll)),fn(),ie(),sa()},nulling:function(){de=Oe=Ot=$e=$t=Ne=Ie=null,B.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,e){var n=this,s=(t.touches?t.touches[0]:t).clientX,r=(t.touches?t.touches[0]:t).clientY,o=document.elementFromPoint(s,r);if(de=t,e||this.options.forceAutoScrollFallback||Gt||ft||Kt){_e(t,this.options,o,e);var c=wt(o,!0);$e&&(!$t||s!==Ne||r!==Ie)&&($t&&fn(),$t=setInterval(function(){var l=wt(document.elementFromPoint(s,r),!0);l!==c&&(c=l,ie()),_e(t,n.options,l,e)},10),Ne=s,Ie=r)}else{if(!this.options.bubbleScroll||wt(o,!0)===dt()){ie();return}_e(t,this.options,wt(o,!1),!1)}}},gt(i,{pluginName:"scroll",initializeByDefault:!0})}function ie(){B.forEach(function(i){clearInterval(i.pid)}),B=[]}function fn(){clearInterval($t)}var _e=wn(function(i,a,t,e){if(a.scroll){var n=(i.touches?i.touches[0]:i).clientX,s=(i.touches?i.touches[0]:i).clientY,r=a.scrollSensitivity,o=a.scrollSpeed,c=dt(),l=!1,d;Oe!==t&&(Oe=t,ie(),Ot=a.scroll,d=a.scrollFn,Ot===!0&&(Ot=wt(t,!0)));var u=0,h=Ot;do{var b=h,y=O(b),p=y.top,w=y.bottom,m=y.left,v=y.right,x=y.width,D=y.height,F=void 0,A=void 0,lt=b.scrollWidth,W=b.scrollHeight,L=C(b),mt=b.scrollLeft,ct=b.scrollTop;b===c?(F=x<lt&&(L.overflowX==="auto"||L.overflowX==="scroll"||L.overflowX==="visible"),A=D<W&&(L.overflowY==="auto"||L.overflowY==="scroll"||L.overflowY==="visible")):(F=x<lt&&(L.overflowX==="auto"||L.overflowX==="scroll"),A=D<W&&(L.overflowY==="auto"||L.overflowY==="scroll"));var bt=F&&(Math.abs(v-n)<=r&&mt+x<lt)-(Math.abs(m-n)<=r&&!!mt),H=A&&(Math.abs(w-s)<=r&&ct+D<W)-(Math.abs(p-s)<=r&&!!ct);if(!B[u])for(var Q=0;Q<=u;Q++)B[Q]||(B[Q]={});(B[u].vx!=bt||B[u].vy!=H||B[u].el!==b)&&(B[u].el=b,B[u].vx=bt,B[u].vy=H,clearInterval(B[u].pid),(bt!=0||H!=0)&&(l=!0,B[u].pid=setInterval(function(){e&&this.layer===0&&S.active._onTouchMove(de);var at=B[this.layer].vy?B[this.layer].vy*o:0,R=B[this.layer].vx?B[this.layer].vx*o:0;typeof d=="function"&&d.call(S.dragged.parentNode[X],R,at,i,de,B[this.layer].el)!=="continue"||kn(B[this.layer].el,R,at)}.bind({layer:u}),24))),u++}while(a.bubbleScroll&&h!==c&&(h=wt(h,!1)));$e=l}},30),Pn=function(a){var t=a.originalEvent,e=a.putSortable,n=a.dragEl,s=a.activeSortable,r=a.dispatchSortableEvent,o=a.hideGhostForTarget,c=a.unhideGhostForTarget;if(t){var l=e||s;o();var d=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,u=document.elementFromPoint(d.clientX,d.clientY);c(),l&&!l.el.contains(u)&&(r("spill"),this.onSpill({dragEl:n,putSortable:e}))}};function Re(){}Re.prototype={startIndex:null,dragStart:function(a){var t=a.oldDraggableIndex;this.startIndex=t},onSpill:function(a){var t=a.dragEl,e=a.putSortable;this.sortable.captureAnimationState(),e&&e.captureAnimationState();var n=At(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(t,n):this.sortable.el.appendChild(t),this.sortable.animateAll(),e&&e.animateAll()},drop:Pn};gt(Re,{pluginName:"revertOnSpill"});function Ve(){}Ve.prototype={onSpill:function(a){var t=a.dragEl,e=a.putSortable,n=e||this.sortable;n.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),n.animateAll()},drop:Pn};gt(Ve,{pluginName:"removeOnSpill"});S.mount(new Ca);S.mount(Ve,Re);var Ye=S;var he={text:"",tags:[],projects:[],dueState:"all",showCompleted:!0},Ht={enabled:!1,tasksFolder:"Tasks",query:"",statusField:"status",progressField:"progress",projectField:"project",laneMapping:{},conflictResolution:"prompt",syncInterval:0,createMissingTasks:!1,archiveCompletedTasks:!1},Nt={enabled:!1,tasksFolder:"500 Plan & Reflect/520 Tasks",epicsFolder:"500 Plan & Reflect/510 Epics",projectsFolder:"400 Projects",goalsFolder:"300 Goals & Milestone/Goals",typeField:"Type",areaField:"Area",goalField:"Goal",projectField:"Project",epicField:"Epic",statusField:"Status",priorityField:"Priority",statusValues:{backlog:"backlog",todo:"todo",inProgress:"in-progress",done:"done"},priorityValues:{low:"low",medium:"medium",high:"high",critical:"critical"},syncChecklistToBoard:!0,updateStatusOnMove:!0,createBoardForEpic:!1},pe={Backlog:"backlog","To Do":"todo","In Progress":"in-progress",Done:"done"},tt={"new-card-insertion-method":"append","prepend-archive-date":!1,"prepend-archive-format":"YYYY-MM-DD","date-format":"YYYY-MM-DD","time-format":"HH:mm","date-trigger":"@","time-trigger":"@@","link-date-to-daily-note":!1,"show-relative-date":!1,"hide-tags-in-title":!1,"hide-date-in-title":!1,"hide-metadata-in-title":!1,"default-lane-width":"272px","show-checkboxes":!0,"show-card-menu":!0,"show-progress":!0,"show-project":!0,"default-project":"","template-path":"","card-note-template":"","card-note-folder":"","parse-natural-dates":!0,"parse-recurrence":!0,"enable-reminders":!1,"reminder-time":"1h","reminder-type":"notice","date-serialization-format":"iso","show-card-composer":!0,"composer-position":"bottom","show-subtasks":!0,"base-sync":{...Ht},"show-filter-toolbar":!0,"default-wip-limit":0,"wip-block-exceeded":!1,"auto-create-note":!1,"gpt-task-manager":{...Nt}},U="kanban",et="kanban-plugin";var Y={TODAY:/\btoday\b/i,TOMORROW:/\btomorrow\b/i,YESTERDAY:/\byesterday\b/i,NEXT_DAY:/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\b/i,THIS_DAY:/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\b/i,LAST_DAY:/\blast\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\b/i,IN_X_DAYS:/\bin\s+(\d+)\s+days?\b/i,IN_X_WEEKS:/\bin\s+(\d+)\s+weeks?\b/i,IN_X_MONTHS:/\bin\s+(\d+)\s+months?\b/i,X_DAYS_AGO:/\b(\d+)\s+days?\s+ago\b/i,NEXT_WEEK:/\bnext\s+week\b/i,NEXT_MONTH:/\bnext\s+month\b/i,END_OF_WEEK:/\bend\s+of\s+week\b/i,END_OF_MONTH:/\bend\s+of\s+month\b/i},rt={DAILY:/\b(?:every\s+day|daily)\b/i,WEEKLY:/\b(?:every\s+week|weekly)\b/i,MONTHLY:/\b(?:every\s+month|monthly)\b/i,YEARLY:/\b(?:every\s+year|yearly|annually)\b/i,EVERY_X_DAYS:/\bevery\s+(\d+)\s+days?\b/i,EVERY_X_WEEKS:/\bevery\s+(\d+)\s+weeks?\b/i,EVERY_X_MONTHS:/\bevery\s+(\d+)\s+months?\b/i,EVERY_DAY_OF_WEEK:/\bevery\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday)(?:\s*,\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday))*\b/i,WEEKDAYS:/\b(?:every\s+weekday|weekdays)\b/i,WEEKENDS:/\b(?:every\s+weekend|weekends)\b/i},qt={sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6},Fn={0:"sunday",1:"monday",2:"tuesday",3:"wednesday",4:"thursday",5:"friday",6:"saturday"},An=["progress","project","priority","status","assignee","estimate","spent"];function Dt(){return Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4)}function Ge(i={}){let a=new Date,t=Dt(),e;return i.tags&&(e=Array.isArray(i.tags)?i.tags.join(", "):i.tags),{title:i.title||"",date:G(a),time:a.toTimeString().slice(0,5),datetime:a.toISOString(),project:i.project,lane:i.lane,board:i.board,dueDate:i.dueDate,priority:i.priority,tags:e,id:t,...i.customVars}}function We(i,a){return i.replace(/\{\{([^}]+)\}\}/g,(t,e)=>{let n=e.trim();if(n.startsWith("date:")){let r=n.slice(5);return Sa(new Date,r)}if(n.includes("|")){let[r,o]=n.split("|").map(l=>l.trim()),c=a[r];return c!==void 0&&c!==""?String(c):o}let s=a[n];return s!==void 0?String(s):t})}function Sa(i,a){let t=i.getFullYear(),e=String(i.getMonth()+1).padStart(2,"0"),n=String(i.getDate()).padStart(2,"0"),s=String(i.getHours()).padStart(2,"0"),r=String(i.getMinutes()).padStart(2,"0"),o=String(i.getSeconds()).padStart(2,"0"),c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],d=["January","February","March","April","May","June","July","August","September","October","November","December"],u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return a.replace(/YYYY/g,String(t)).replace(/YY/g,String(t).slice(-2)).replace(/MMMM/g,d[i.getMonth()]).replace(/MMM/g,u[i.getMonth()]).replace(/MM/g,e).replace(/M/g,String(i.getMonth()+1)).replace(/DDDD/g,c[i.getDay()]).replace(/DDD/g,l[i.getDay()]).replace(/DD/g,n).replace(/D/g,String(i.getDate())).replace(/HH/g,s).replace(/H/g,String(i.getHours())).replace(/mm/g,r).replace(/m/g,String(i.getMinutes())).replace(/ss/g,o).replace(/s/g,String(i.getSeconds()))}function Nn(i,a=new Date){let t=new Date(a);t.setHours(0,0,0,0);let e=i.match(Y.TODAY);if(e)return{date:G(t),matched:e[0]};let n=i.match(Y.TOMORROW);if(n){let m=new Date(t);return m.setDate(m.getDate()+1),{date:G(m),matched:n[0]}}let s=i.match(Y.YESTERDAY);if(s){let m=new Date(t);return m.setDate(m.getDate()-1),{date:G(m),matched:s[0]}}let r=i.match(Y.NEXT_DAY);if(r){let m=r[1].toLowerCase(),v=qt[m];if(v!==void 0){let x=ge(t,v,!0);return{date:G(x),matched:r[0]}}}let o=i.match(Y.THIS_DAY);if(o){let m=o[1].toLowerCase(),v=qt[m];if(v!==void 0){let x=ge(t,v,!1);return{date:G(x),matched:o[0]}}}let c=i.match(Y.LAST_DAY);if(c){let m=c[1].toLowerCase(),v=qt[m];if(v!==void 0){let x=Ta(t,v);return{date:G(x),matched:c[0]}}}let l=i.match(Y.IN_X_DAYS);if(l){let m=parseInt(l[1],10),v=new Date(t);return v.setDate(v.getDate()+m),{date:G(v),matched:l[0]}}let d=i.match(Y.IN_X_WEEKS);if(d){let m=parseInt(d[1],10),v=new Date(t);return v.setDate(v.getDate()+m*7),{date:G(v),matched:d[0]}}let u=i.match(Y.IN_X_MONTHS);if(u){let m=parseInt(u[1],10),v=new Date(t);return v.setMonth(v.getMonth()+m),{date:G(v),matched:u[0]}}let h=i.match(Y.X_DAYS_AGO);if(h){let m=parseInt(h[1],10),v=new Date(t);return v.setDate(v.getDate()-m),{date:G(v),matched:h[0]}}let b=i.match(Y.NEXT_WEEK);if(b){let m=ge(t,1,!0);return{date:G(m),matched:b[0]}}let y=i.match(Y.NEXT_MONTH);if(y){let m=new Date(t);return m.setMonth(m.getMonth()+1),m.setDate(1),{date:G(m),matched:y[0]}}let p=i.match(Y.END_OF_WEEK);if(p){let m=ge(t,0,!1);return m.getTime()===t.getTime()&&t.getDay()!==0&&m.setDate(m.getDate()+7),{date:G(m),matched:p[0]}}let w=i.match(Y.END_OF_MONTH);if(w){let m=new Date(t.getFullYear(),t.getMonth()+1,0);return{date:G(m),matched:w[0]}}return{date:null,matched:null}}function ge(i,a,t){let e=new Date(i),n=e.getDay(),s=a-n;return(s<=0||t&&s<7)&&(s+=7),e.setDate(e.getDate()+s),e}function Ta(i,a){let t=new Date(i),n=t.getDay()-a;return n<=0&&(n+=7),t.setDate(t.getDate()-n),t}function G(i){let a=i.getFullYear(),t=String(i.getMonth()+1).padStart(2,"0"),e=String(i.getDate()).padStart(2,"0");return`${a}-${t}-${e}`}function In(i){let a=i.match(rt.DAILY);if(a)return{pattern:{frequency:"daily",_rawPattern:a[0]},matched:a[0]};let t=i.match(rt.WEEKLY);if(t)return{pattern:{frequency:"weekly",_rawPattern:t[0]},matched:t[0]};let e=i.match(rt.MONTHLY);if(e)return{pattern:{frequency:"monthly",_rawPattern:e[0]},matched:e[0]};let n=i.match(rt.YEARLY);if(n)return{pattern:{frequency:"yearly",_rawPattern:n[0]},matched:n[0]};let s=i.match(rt.EVERY_X_DAYS);if(s)return{pattern:{frequency:"daily",interval:parseInt(s[1],10),_rawPattern:s[0]},matched:s[0]};let r=i.match(rt.EVERY_X_WEEKS);if(r)return{pattern:{frequency:"weekly",interval:parseInt(r[1],10),_rawPattern:r[0]},matched:r[0]};let o=i.match(rt.EVERY_X_MONTHS);if(o)return{pattern:{frequency:"monthly",interval:parseInt(o[1],10),_rawPattern:o[0]},matched:o[0]};let c=i.match(rt.EVERY_DAY_OF_WEEK);if(c)return{pattern:{frequency:"weekly",daysOfWeek:(c[0].toLowerCase().match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\b/g)||[]).map(b=>b),_rawPattern:c[0]},matched:c[0]};let l=i.match(rt.WEEKDAYS);if(l)return{pattern:{frequency:"weekly",daysOfWeek:["monday","tuesday","wednesday","thursday","friday"],_rawPattern:l[0]},matched:l[0]};let d=i.match(rt.WEEKENDS);return d?{pattern:{frequency:"weekly",daysOfWeek:["saturday","sunday"],_rawPattern:d[0]},matched:d[0]}:{pattern:null,matched:null}}function He(i){if(i._rawPattern)return i._rawPattern;if(i.daysOfWeek&&i.daysOfWeek.length>0)return i.daysOfWeek.length===5&&["monday","tuesday","wednesday","thursday","friday"].every(t=>i.daysOfWeek.includes(t))?"weekdays":i.daysOfWeek.length===2&&i.daysOfWeek.includes("saturday")&&i.daysOfWeek.includes("sunday")?"weekends":`every ${i.daysOfWeek.join(", ")}`;let a=i.interval||1;switch(i.frequency){case"daily":return a===1?"daily":`every ${a} days`;case"weekly":return a===1?"weekly":`every ${a} weeks`;case"monthly":return a===1?"monthly":`every ${a} months`;case"yearly":return a===1?"yearly":`every ${a} years`;default:return"daily"}}function Bn(i,a=new Date){let t=new Date(a);t.setHours(0,0,0,0);let e=i.interval||1;switch(i.frequency){case"daily":t.setDate(t.getDate()+e);break;case"weekly":if(i.daysOfWeek&&i.daysOfWeek.length>0){let n=t.getDay(),s=i.daysOfWeek.map(o=>qt[o]).sort((o,c)=>o-c),r=s.find(o=>o>n);r===void 0?(r=s[0],t.setDate(t.getDate()+(7-n+r))):t.setDate(t.getDate()+(r-n))}else t.setDate(t.getDate()+7*e);break;case"monthly":t.setMonth(t.getMonth()+e),i.dayOfMonth&&t.setDate(Math.min(i.dayOfMonth,Da(t)));break;case"yearly":t.setFullYear(t.getFullYear()+e);break}return t}function Da(i){return new Date(i.getFullYear(),i.getMonth()+1,0).getDate()}function On(i,a=new Date){if(!i)return"";let t=new Date(i),e=new Date(a);e.setHours(0,0,0,0),t.setHours(0,0,0,0);let n=t.getTime()-e.getTime(),s=Math.round(n/(1e3*60*60*24));if(s===0)return"Today";if(s===1)return"Tomorrow";if(s===-1)return"Yesterday";if(s>1&&s<7)return`In ${s} days`;if(s===7)return"In 1 week";if(s>7&&s<14)return`In ${s} days`;if(s>=14&&s<30)return`In ${Math.floor(s/7)} weeks`;if(s<-1&&s>-7)return`${Math.abs(s)} days ago`;if(s===-7)return"1 week ago";if(s<-7&&s>-30)return`${Math.floor(Math.abs(s)/7)} weeks ago`;let r=Fn[t.getDay()];return s>0&&s<=7?r.charAt(0).toUpperCase()+r.slice(1):i}function $n(i){let a=i.match(/\s*\^([\w-]+)\s*$/);return a?{content:i.replace(/\s*\^[\w-]+\s*$/,""),id:a[1]}:{content:i,id:null}}function Ea(i){let a={},t=i,e=/\[(\w+)::([^\]]+)\]/g,n;for(;(n=e.exec(i))!==null;){let o=n[1].toLowerCase(),c=n[2].trim();if(o==="progress"){let l=parseInt(c.replace("%",""),10);a[o]=isNaN(l)?0:l}else a[o]=c;t=t.replace(n[0],"").trim()}let s=t.match(/progress::(\d+)%?/i);s&&a.progress===void 0&&(a.progress=parseInt(s[1],10),t=t.replace(s[0],"").trim());let r=t.match(/project::([^\s\]]+)/i);return r&&!a.project&&(a.project=r[1],t=t.replace(r[0],"").trim()),{cleanText:t,metadata:a}}function xa(i){let t=(i.match(/#[\w-/]+/g)||[]).map(e=>e.substring(1));return{cleanText:i,tags:t}}function Ma(i,a=!0){let t=i,e,n,s,r,o=i.match(/@(\d{4}-\d{2}-\d{2})(?:T(\d{2}:\d{2}))?/);o&&(e=o[1],n=o[2],t=t.replace(o[0],"").trim());let c=i.match(/@@(\d{2}:\d{2})/);if(c&&!n&&(n=c[1],t=t.replace(c[0],"").trim()),a&&!e){let b=i.match(/@(today|tomorrow|yesterday|next\s+\w+|this\s+\w+|last\s+\w+|in\s+\d+\s+\w+|\d+\s+\w+\s+ago|end\s+of\s+\w+)/i);if(b){let{date:y,matched:p}=Nn(b[1]);y&&p&&(e=y,t=t.replace(`@${b[1]}`,"").trim())}else{let{date:y,matched:p}=Nn(i);y&&p&&(e=y,t=t.replace(p,"").trim())}}let{pattern:l,matched:d}=In(t);l&&d&&(s=l,t=t.replace(d,"").trim());let u=t.match(/\[recur::([^\]]+)\]/);if(u&&!s){let{pattern:b}=In(u[1]);b?s={...b,_rawPattern:u[1]}:s={frequency:"daily",_rawPattern:u[1]},t=t.replace(u[0],"").trim()}let h=t.match(/\[remind::([^\]]+)\]/);return h&&(r=h[1],t=t.replace(h[0],"").trim()),{cleanText:t,dueDate:e,dueTime:n,recurrence:s,reminderTime:r}}function Pa(i,a,t=!0){let e=i[a],n=e.match(/^(\s*)-\s*\[([ xX])\]\s*(.*)$/);if(!n)return{card:null,endIndex:a};let s=n[1].length,r=n[2].toLowerCase()==="x",o=n[3].trim(),{content:c,id:l}=$n(o);o=c;let{cleanText:d,metadata:u}=Ea(o),h;u.note&&(h=u.note,delete u.note);let{tags:b}=xa(d),{cleanText:y,dueDate:p,dueTime:w,recurrence:m,reminderTime:v}=Ma(d,t),x=[],D=[],F=[],A=a;for(let W=a+1;W<i.length;W++){let L=i[W],mt=L.match(/^(\s*)/),ct=mt?mt[1].length:0;if(L.trim()===""){let Q=!1;for(let at=W+1;at<i.length;at++){let R=i[at];if(R.trim()==="")continue;((R.match(/^(\s*)/)||["",""])[1].length>s||R.match(/^\s*>/)||R.match(/^\s+-\s*\[/))&&(Q=!0);break}if(Q){D.push(""),A=W;continue}else break}let bt=L.match(/^\s*>\s?(.*)$/);if(bt){x.push(bt[1]),D.push(L),A=W;continue}let H=L.match(/^(\s+)-\s*\[([ xX])\]\s*(.*)$/);if(H&&H[1].length>s){let Q=H[2].toLowerCase()==="x",at=H[3].trim(),R=Dt();F.push({id:R,text:at,completed:Q}),D.push(L),A=W;continue}if(ct>s){D.push(L),A=W;continue}break}return{card:{id:l||Dt(),title:d,completed:r,tags:b,dueDate:p,dueTime:w,recurrence:m,reminderTime:v,notes:x.length>0?x.join(`
`):void 0,notePath:h,content:D.length>0?D.join(`
`):void 0,subtasks:F.length>0?F:void 0,metadata:u,_rawLine:e},endIndex:A}}function _n(i){let a=i.split(`
`),t=a[0],e=t.match(/^##\s+(.+)$/);if(!e)return null;let{content:n,id:s}=$n(e[1].trim()),r={id:s||Dt(),title:n,cards:[],_rawHeader:t},o=1;for(;o<a.length;){if(a[o].trim().startsWith("- [")){let{card:l,endIndex:d}=Pa(a,o);if(l){r.cards.push(l),o=d+1;continue}}o++}return r}function Fa(i){let a=i.match(/%% kanban:settings\s*```(?:json)?\s*([\s\S]*?)\s*```\s*%%/);if(a)try{return JSON.parse(a[1])}catch(t){return console.warn("Failed to parse kanban settings JSON"),{}}return{}}function Aa(i){let a=i.match(/^(---\s*\n[\s\S]*?\n---\s*\n?)/);return a?{frontmatter:a[1],body:i.slice(a[1].length)}:{frontmatter:"",body:i}}function Na(i){return i?i.includes(et)?i:i.replace(/^(---\s*\n)/,`$1${et}: basic
`):`---
${et}: basic
---

`}function Ln(i){let a=i.split(`
`),t=0;for(let n=0;n<a.length;n++){let s=a[n];if(s.match(/^##\s/)||s.match(/^\s*-\s*\[/)||s.match(/^\s*>/))t=n;else if(s.trim()===""){let r=!1;for(let o=n+1;o<a.length;o++)if(a[o].match(/^\s*-\s*\[/)||a[o].match(/^\s*>/)){r=!0;break}else if(a[o].trim()!=="")break;r&&(t=n)}}let e=0;for(let n=0;n<=t;n++)e+=a[n].length+1;return e}function fe(i){let{frontmatter:a,body:t}=Aa(i),e=/^## .+$/gm,n=[],s;for(;(s=e.exec(t))!==null;)n.push({index:s.index,match:s[0]});let r=t.match(/%% kanban:settings[\s\S]*?%%/),o=r?t.indexOf(r[0]):-1,c=r?o+r[0].length:-1,l="";n.length>0?l=t.slice(0,n[0].index).trim():o>0?l=t.slice(0,o).trim():l=t.trim();let d=[],u=[],h="";for(let p=0;p<n.length;p++){let w=n[p].index,m,v=p===n.length-1;p+1<n.length?m=n[p+1].index:o>w?m=o:m=t.length;let x=t.slice(w,m),D=n[p].match;if(v&&o>w){let F=Ln(x),A=x.slice(F).trim();A&&(h=A)}if(D.match(/^##\s+Archive\s*$/i)){let F=_n(x);F&&(u=F.cards)}else{let F=_n(x);F&&d.push(F)}}let b="";if(c>0)b=t.slice(c).trim();else if(n.length>0){let p=n[n.length-1].index,w=t.slice(p),m=Ln(w),v=w.slice(m).trim();v&&(b=v)}let y=Fa(t);return{lanes:d,archive:u,settings:y,_frontmatter:a,_headerContent:l,_footerContent:b,_preSettingsContent:h}}function Kn(i,a=!0,t="iso"){let e=i.completed?"[x]":"[ ]",n=i.title,s=[];if(i.metadata.progress!==void 0&&!n.includes("progress::")&&s.push(`[progress::${i.metadata.progress}%]`),i.metadata.project&&!n.includes("project::")&&!n.includes("[project::")&&s.push(`[project::${i.metadata.project}]`),i.notePath&&!n.includes("note::")&&s.push(`[note::${i.notePath}]`),i.recurrence&&!n.includes("recur::")&&!n.match(/\b(daily|weekly|monthly|yearly|every\s)/i)){let o=He(i.recurrence);s.push(`[recur::${o}]`)}i.reminderTime&&!n.includes("remind::")&&s.push(`[remind::${i.reminderTime}]`);for(let[o,c]of Object.entries(i.metadata))o!=="progress"&&o!=="project"&&c!==void 0&&(n.includes(`${o}::`)||s.push(`[${o}::${c}]`));s.length>0&&(n=`${n} ${s.join(" ")}`),n.includes("@")||(i.dueDate&&i.dueTime?n=`${n} @${i.dueDate}T${i.dueTime}`:i.dueDate?n=`${n} @${i.dueDate}`:i.dueTime&&(n=`${n} @@${i.dueTime}`)),a&&(n=`${n} ^${i.id}`);let r=`- ${e} ${n}`;if(i.content&&!i.notePath)r+=`
`+i.content;else{let o=[];if(i.subtasks&&i.subtasks.length>0)for(let c of i.subtasks){let l=c.completed?"[x]":"[ ]";o.push(`	- ${l} ${c.text}`)}if(i.notes&&!i.notePath){let c=i.notes.split(`
`).map(l=>`	> ${l}`);o.push(...c)}o.length>0&&(r+=`
`+o.join(`
`))}return r}function jn(i,a,t){let e=i.split(`
`),n=0;for(let s=0;s<e.length;s++){let r=e[s].match(/^(\s*-\s*\[)([ xX])(\]\s*.*)$/);if(r){if(n===a){e[s]=`${r[1]}${t?"x":" "}${r[3]}`;break}n++}}return e.join(`
`)}function Ia(i,a=!0){let t=a?` ^${i.id}`:"",e=[`## ${i.title}${t}`,""];for(let n of i.cards)e.push(Kn(n,a));return e.push(""),e.join(`
`)}function _a(i){return Object.keys(i).length===0?"":`
%% kanban:settings
\`\`\`json
${JSON.stringify(i,null,2)}
\`\`\`
%%
`}function La(i,a=!0){if(i.length===0)return"";let t=["## Archive",""];for(let e of i)t.push(Kn(e,a));return t.push(""),t.join(`
`)}function me(i){let a=[],t=Na(i._frontmatter||"");a.push(t),i._headerContent&&(a.push(i._headerContent),a.push(""));for(let n of i.lanes)a.push(Ia(n));i.archive.length>0&&a.push(La(i.archive)),i._preSettingsContent&&(a.push(i._preSettingsContent),a.push(""));let e=_a(i.settings);return e&&a.push(e),i._footerContent&&a.push(i._footerContent),a.join(`
`)}function be(){return{lanes:[{id:Dt(),title:"To Do",cards:[]},{id:Dt(),title:"In Progress",cards:[]},{id:Dt(),title:"Done",cards:[]}],archive:[],settings:{}}}var ye=`---
${et}: basic
---

`;function qe(i,a,t=!1){if(!i)return"";if(t){let o=new Date(i),c=new Date,l=Math.floor((o.getTime()-c.getTime())/(1e3*60*60*24));if(l===0)return"Today";if(l===1)return"Tomorrow";if(l===-1)return"Yesterday";if(l>1&&l<7)return`In ${l} days`;if(l<-1&&l>-7)return`${Math.abs(l)} days ago`}let e=new Date(i),n=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return a.replace("YYYY",String(n)).replace("MM",s).replace("DD",r)}function Xt(i,a){let t=new Date,e=qe(t.toISOString().split("T")[0],a);return{...i,title:`${e} ${i.title}`}}function Rn(i,a={},t){let e=Ge({project:a.project,...t}),n=We(i,e),s=n.match(/^#\s+(.+)$/m),r=s?s[1]:n.split(`
`)[0].trim()||"New card",o=n.match(/^---\s*\n([\s\S]*?)\n---/),c={...a};if(o){let p=o[1].split(`
`);for(let w of p){let m=w.match(/^(\w+):\s*(.+)$/);if(m){let v=m[1].toLowerCase(),x=m[2].trim();An.includes(v)&&(v==="progress"?c.progress=parseInt(x.replace("%",""),10):c[v]=x)}}}let d=(r.match(/#[\w-/]+/g)||[]).map(y=>y.substring(1)),u=r.match(/@(\d{4}-\d{2}-\d{2})(?:T(\d{2}:\d{2}))?/),h=u?u[1]:void 0,b=u?u[2]:void 0;return{id:e.id,title:r,completed:!1,tags:d,dueDate:h,dueTime:b,metadata:c,notes:n}}var $=require("obsidian");var ve=class{constructor(a,t){this.syncInProgress=!1;this.app=a,this.config=t||{...Ht}}setConfig(a){this.config=a}getConfig(){return this.config}isEnabled(){return this.config.enabled}async readBaseTask(a){try{let t=await this.app.vault.read(a),e=this.parseFrontmatter(t);return e?{path:a.path,title:e.title||a.basename,status:e[this.config.statusField],progress:e[this.config.progressField],project:e[this.config.projectField],priority:e.priority,dueDate:e.due||e.dueDate,tags:e.tags,completed:e.completed===!0||e.status==="done",modified:a.stat.mtime,...e}:null}catch(t){return console.error(`Error reading Base task ${a.path}:`,t),null}}async queryBaseTasks(){let a=[],t=this.app.vault.getAbstractFileByPath(this.config.tasksFolder);if(!(t instanceof $.TFolder))return console.warn(`Tasks folder not found: ${this.config.tasksFolder}`),a;let e=this.getMarkdownFiles(t);for(let n of e){let s=await this.readBaseTask(n);s&&this.matchesQuery(s)&&a.push(s)}return a}getMarkdownFiles(a){let t=[];for(let e of a.children)e instanceof $.TFile&&e.extension==="md"?t.push(e):e instanceof $.TFolder&&t.push(...this.getMarkdownFiles(e));return t}matchesQuery(a){var n,s,r,o;if(!this.config.query||this.config.query.trim()==="")return!0;let e=this.config.query.toLowerCase().split(/\s+and\s+/i);for(let c of e){let l=c.trim(),d=l.match(/^status:\s*(.+)$/i);if(d){let p=d[1].toLowerCase();if(((n=a.status)==null?void 0:n.toLowerCase())!==p)return!1;continue}let u=l.match(/^project:\s*(.+)$/i);if(u){let p=u[1].toLowerCase();if(((s=a.project)==null?void 0:s.toLowerCase())!==p)return!1;continue}let h=l.match(/^tag:\s*(.+)$/i);if(h){let p=h[1].toLowerCase();if(!((r=a.tags)!=null&&r.some(w=>w.toLowerCase()===p)))return!1;continue}let b=l.match(/^priority:\s*(.+)$/i);if(b){let p=b[1].toLowerCase();if(((o=a.priority)==null?void 0:o.toLowerCase())!==p)return!1;continue}let y=l.match(/^completed:\s*(true|false)$/i);if(y){let p=y[1].toLowerCase()==="true";if(a.completed!==p)return!1;continue}}return!0}async updateTaskField(a,t,e){try{let n=this.app.vault.getAbstractFileByPath(a);if(!(n instanceof $.TFile))return console.warn(`Task file not found: ${a}`),!1;let s=await this.app.vault.read(n),r=this.updateFrontmatterField(s,t,e);return r!==s?(await this.app.vault.modify(n,r),!0):!1}catch(n){return console.error(`Error updating task ${a}:`,n),!1}}async updateTaskFields(a,t){try{let e=this.app.vault.getAbstractFileByPath(a);if(!(e instanceof $.TFile))return console.warn(`Task file not found: ${a}`),!1;let n=await this.app.vault.read(e);for(let[s,r]of Object.entries(t))n=this.updateFrontmatterField(n,s,r);return await this.app.vault.modify(e,n),!0}catch(e){return console.error(`Error updating task ${a}:`,e),!1}}async createBaseTask(a,t,e){try{if(!(this.app.vault.getAbstractFileByPath(this.config.tasksFolder)instanceof $.TFolder))try{await this.app.vault.createFolder(this.config.tasksFolder)}catch(u){if(!(this.app.vault.getAbstractFileByPath(this.config.tasksFolder)instanceof $.TFolder))return console.error("Cannot create tasks folder:",this.config.tasksFolder,u),null}let s=(a||"Untitled Task").replace(/[\\/:*?"<>|]/g,"-").replace(/\s+/g," ").trim().substring(0,100)||"task",r=Date.now(),o=`${s}-${r}.md`,c=`${this.config.tasksFolder}/${o}`,l={title:a||"Untitled Task",created:new Date().toISOString()};e&&this.config.laneMapping[e.title]&&(l[this.config.statusField]=this.config.laneMapping[e.title]),t.progress!==void 0&&(l[this.config.progressField]=t.progress),t.project&&(l[this.config.projectField]=t.project),t.priority&&(l.priority=t.priority);let d=this.createFileWithFrontmatter(l,`# ${a||"Untitled Task"}
`);return await this.app.vault.create(c,d),c}catch(n){return console.error("Error creating Base task:",n),null}}async onCardMoveToLane(a,t){if(!this.config.enabled||!a.baseTaskPath)return!1;let e=this.config.laneMapping[t.title];return e?await this.updateTaskField(a.baseTaskPath,this.config.statusField,e):!1}async syncProgress(a,t){return!this.config.enabled||!a.baseTaskPath?!1:await this.updateTaskField(a.baseTaskPath,this.config.progressField,t)}async syncProject(a,t){return!this.config.enabled||!a.baseTaskPath?!1:await this.updateTaskField(a.baseTaskPath,this.config.projectField,t||"")}async syncFromBase(a,t){if(this.syncInProgress)return{created:0,updated:0,conflicts:[],errors:["Sync already in progress"]};if(!a.lanes||a.lanes.length===0)return{created:0,updated:0,conflicts:[],errors:["Board has no lanes - add at least one lane before syncing"]};this.syncInProgress=!0;let e={created:0,updated:0,conflicts:[],errors:[]};try{let n=await this.queryBaseTasks(),s=new Map;for(let r of a.lanes)for(let o of r.cards)o.baseTaskPath&&s.set(o.baseTaskPath,{card:o,lane:r});for(let r of n){let o=s.get(r.path);if(o){let c=await this.updateCardFromTask(o.card,r,a,t);c.length>0&&e.conflicts.push(...c),e.updated++}else{let c=this.findLaneForTask(r,a);if(c){let l=this.createCardFromTask(r);c.cards.push(l),e.created++}else console.warn(`No lane found for task: ${r.path}`)}}}catch(n){e.errors.push(`Sync error: ${n}`)}finally{this.syncInProgress=!1}return e}findLaneForTask(a,t){if(!a.status)return t.lanes[0]||null;for(let[e,n]of Object.entries(this.config.laneMapping))if(n.toLowerCase()===a.status.toLowerCase()){let s=t.lanes.find(r=>r.title.toLowerCase()===e.toLowerCase());if(s)return s}return t.lanes[0]||null}createCardFromTask(a){return{id:this.generateId(),title:a.title,completed:a.completed||!1,tags:a.tags||[],dueDate:a.dueDate,metadata:{progress:a.progress,project:a.project,priority:a.priority,status:a.status},baseTaskPath:a.path,baseSyncTime:Date.now()}}async updateCardFromTask(a,t,e,n){let s=[],r=[{field:"title",local:a.title,remote:t.title},{field:"progress",local:a.metadata.progress,remote:t.progress},{field:"project",local:a.metadata.project,remote:t.project}];for(let{field:l,local:d,remote:u}of r)if(d!==u&&d!==void 0&&u!==void 0){let h={cardId:a.id,cardTitle:a.title,taskPath:t.path,localValue:String(d),remoteValue:String(u),field:l},b=this.config.conflictResolution==="remote";if(this.config.conflictResolution==="last-write"){let y=a.baseSyncTime||0;b=(t.modified||0)>y}else if(this.config.conflictResolution==="prompt"&&n){let y=await n(h);if(y==="skip")continue;b=y==="remote"}b&&(l==="title"&&(a.title=u),l==="progress"&&(a.metadata.progress=u),l==="project"&&(a.metadata.project=u)),s.push(h)}else u!==void 0&&d===void 0&&(l==="title"&&(a.title=u),l==="progress"&&(a.metadata.progress=u),l==="project"&&(a.metadata.project=u));let o=this.findLaneForTask(t,e),c=e.lanes.find(l=>l.cards.some(d=>d.id===a.id));if(o&&c&&o.id!==c.id){let l=c.cards.findIndex(d=>d.id===a.id);l>=0&&(c.cards.splice(l,1),o.cards.push(a))}return a.baseSyncTime=Date.now(),s}generateId(){return Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4)}parseFrontmatter(a){let t=a.match(/^---\n([\s\S]*?)\n---/);if(!t)return null;let e={},n=t[1].split(`
`);for(let s of n){let r=s.indexOf(":");if(r>0){let o=s.substring(0,r).trim(),c=s.substring(r+1).trim();c==="true"?c=!0:c==="false"?c=!1:!isNaN(Number(c))&&c!==""?c=Number(c):c.startsWith("[")&&c.endsWith("]")?c=c.slice(1,-1).split(",").map(l=>l.trim().replace(/['"]/g,"")):c=c.replace(/^['"]|['"]$/g,""),e[o]=c}}return e}updateFrontmatterField(a,t,e){let n=a.match(/^---\n([\s\S]*?)\n---/);if(!n){let l=this.formatFrontmatterValue(e);return`---
${t}: ${l}
---

${a}`}let r=n[1].split(`
`),o=!1,c=r.map(l=>{let d=l.indexOf(":");return d>0&&l.substring(0,d).trim()===t?(o=!0,e===void 0||e===""?null:`${t}: ${this.formatFrontmatterValue(e)}`):l}).filter(l=>l!==null);return!o&&e!==void 0&&e!==""&&c.push(`${t}: ${this.formatFrontmatterValue(e)}`),a.replace(n[0],`---
${c.join(`
`)}
---`)}formatFrontmatterValue(a){return a===void 0?"":typeof a=="boolean"||typeof a=="number"?a.toString():a.includes(":")||a.includes("#")?`"${a}"`:a}createFileWithFrontmatter(a,t){let e=["---"];for(let[n,s]of Object.entries(a))s!==void 0&&s!==""&&e.push(`${n}: ${this.formatFrontmatterValue(s)}`);return e.push("---","",t),e.join(`
`)}},we=class extends $.Modal{constructor(t,e,n){super(t);this.conflict=e,this.onResolve=n}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("kanban-sync-conflict-modal"),t.createEl("h2",{text:"Sync Conflict"}),t.createEl("p",{text:`Conflict detected for "${this.conflict.cardTitle}" in field "${this.conflict.field}":`});let e=t.createDiv({cls:"conflict-comparison"}),n=e.createDiv({cls:"conflict-value local"});n.createEl("strong",{text:"Local (Kanban):"}),n.createEl("span",{text:this.conflict.localValue||"(empty)"});let s=e.createDiv({cls:"conflict-value remote"});s.createEl("strong",{text:"Remote (Base):"}),s.createEl("span",{text:this.conflict.remoteValue||"(empty)"}),new $.Setting(t).addButton(r=>r.setButtonText("Keep Local").onClick(()=>{this.onResolve("local"),this.close()})).addButton(r=>r.setButtonText("Use Remote").setCta().onClick(()=>{this.onResolve("remote"),this.close()})).addButton(r=>r.setButtonText("Skip").onClick(()=>{this.onResolve("skip"),this.close()}))}onClose(){let{contentEl:t}=this;t.empty()}},ke=class extends $.Modal{constructor(t,e,n){super(t);this.tasks=[];this.tasksFolder=e,this.onSelect=n}async onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("kanban-task-picker-modal"),t.createEl("h2",{text:"Link to Base Task"}),this.filterEl=t.createEl("input",{type:"text",cls:"task-picker-filter",attr:{placeholder:"Filter tasks..."}}),this.filterEl.addEventListener("input",()=>this.filterTasks()),this.listEl=t.createDiv({cls:"task-picker-list"}),await this.loadTasks(),this.renderTasks(),this.filterEl.focus(),new $.Setting(t).addButton(e=>e.setButtonText("Cancel").onClick(()=>{this.onSelect(null),this.close()}))}async loadTasks(){let t=this.app.vault.getAbstractFileByPath(this.tasksFolder);if(!(t instanceof $.TFolder))return;let e=this.getMarkdownFiles(t);for(let n of e){let r=(await this.app.vault.read(n)).match(/^---[\s\S]*?title:\s*(.+?)[\r\n]/m),o=r?r[1].replace(/['"]/g,""):n.basename;this.tasks.push({path:n.path,title:o})}this.tasks.sort((n,s)=>n.title.localeCompare(s.title))}getMarkdownFiles(t){let e=[];for(let n of t.children)n instanceof $.TFile&&n.extension==="md"?e.push(n):n instanceof $.TFolder&&e.push(...this.getMarkdownFiles(n));return e}filterTasks(){this.renderTasks()}renderTasks(){this.listEl.empty();let t=this.filterEl.value.toLowerCase(),e=this.tasks.filter(n=>n.title.toLowerCase().includes(t)||n.path.toLowerCase().includes(t));if(e.length===0){this.listEl.createEl("p",{text:"No tasks found",cls:"task-picker-empty"});return}for(let n of e){let s=this.listEl.createDiv({cls:"task-picker-item"});s.createEl("strong",{text:n.title}),s.createEl("span",{text:n.path,cls:"task-path"}),s.addEventListener("click",()=>{this.onSelect(n.path),this.close()})}}onClose(){let{contentEl:t}=this;t.empty()}};function Vn(){let i=document.createElement("div");return i.className="kanban-sync-status",i.style.display="none",i}function ht(i,a,t){i.className=`kanban-sync-status ${a}`,i.style.display=a==="idle"?"none":"flex",a==="syncing"?i.innerHTML='<span class="sync-spinner"></span><span>Syncing...</span>':a==="success"?(i.innerHTML=`<span>\u2713</span><span>${t||"Synced"}</span>`,setTimeout(()=>ht(i,"idle"),2e3)):a==="error"&&(i.innerHTML=`<span>\u26A0</span><span>${t||"Sync failed"}</span>`)}var nt=class extends g.TextFileView{constructor(t,e){super(t);this.sortableInstances=[];this.syncIntervalId=null;this.filterState={...he};this.filterToolbarEl=null;this.pendingAutoCreateNote=null;this.plugin=e,this.board=be(),this.baseSyncService=new ve(this.app),this.syncStatusEl=Vn(),this.filterState={...he}}getViewType(){return U}getDisplayText(){var t;return((t=this.file)==null?void 0:t.basename)||"Kanban Board"}getIcon(){return"columns"}getViewData(){return me(this.board)}setViewData(t,e){e&&(this.board=be()),t.trim()&&(this.board=fe(t)),this.render()}clear(){this.board=be(),this.render()}async onOpen(){let t=this.containerEl.children[1];t.empty(),t.addClass("kanban-plugin"),this.boardContainer=t.createDiv({cls:"kanban-board-wrapper"}),this.render()}async onClose(){this.destroySortables(),this.stopBackgroundSync()}onPaneMenu(t,e){super.onPaneMenu(t,e),t.addItem(n=>{n.setTitle("Add a list").setIcon("plus-circle").onClick(()=>this.addLane())}),t.addItem(n=>{n.setTitle("Archive completed cards").setIcon("archive").onClick(()=>this.archiveCompletedCards())}),t.addSeparator(),t.addItem(n=>{n.setTitle("Board settings").setIcon("settings").onClick(()=>this.openBoardSettings())})}getSetting(t){if(this.board.settings[t]!==void 0)return this.board.settings[t];let e=t;return e in this.plugin.settings?this.plugin.settings[e]:tt[e]}getBaseSyncConfig(){return this.board.settings["base-sync"]?{...Ht,...this.board.settings["base-sync"]}:{...this.plugin.settings["base-sync"]}}startBackgroundSync(){this.stopBackgroundSync();let t=this.getBaseSyncConfig();if(!t.enabled||t.syncInterval<=0)return;let e=t.syncInterval*60*1e3;this.syncIntervalId=window.setInterval(()=>{this.performBackgroundSync()},e)}stopBackgroundSync(){this.syncIntervalId!==null&&(window.clearInterval(this.syncIntervalId),this.syncIntervalId=null)}async performBackgroundSync(){let t=this.getBaseSyncConfig();if(t.enabled){this.baseSyncService.setConfig(t),ht(this.syncStatusEl,"syncing");try{let e=await this.baseSyncService.syncFromBase(this.board,async n=>t.conflictResolution==="prompt"?await this.promptConflictResolution(n):t.conflictResolution);if(e.errors.length>0)ht(this.syncStatusEl,"error",e.errors[0]),new g.Notice(`Sync error: ${e.errors[0]}`);else{let n=`Synced: ${e.created} created, ${e.updated} updated`;ht(this.syncStatusEl,"success",n),(e.created>0||e.updated>0)&&(this.requestSave(),this.render())}}catch(e){ht(this.syncStatusEl,"error","Sync failed"),console.error("Base sync error:",e)}}}async promptConflictResolution(t){return new Promise(e=>{new we(this.app,t,s=>{e(s)}).open()})}async manualSync(){await this.performBackgroundSync()}async linkCardToBaseTask(t){let e=this.getBaseSyncConfig();if(!e.enabled){new g.Notice("Base sync is not enabled. Enable it in settings first.");return}new ke(this.app,e.tasksFolder,async s=>{s&&(t.baseTaskPath=s,t.baseSyncTime=Date.now(),this.requestSave(),this.render(),new g.Notice(`Card linked to: ${s}`))}).open()}async createBaseTaskForCard(t,e){let n=this.getBaseSyncConfig();if(!n.enabled){new g.Notice("Base sync is not enabled. Enable it in settings first.");return}this.baseSyncService.setConfig(n);let s=await this.baseSyncService.createBaseTask(t.title,t.metadata,e);s?(t.baseTaskPath=s,t.baseSyncTime=Date.now(),this.requestSave(),this.render(),new g.Notice(`Created Base task: ${s}`)):new g.Notice("Failed to create Base task")}destroySortables(){for(let t of this.sortableInstances)t.destroy();this.sortableInstances=[]}render(){if(!this.boardContainer)return;this.destroySortables(),this.boardContainer.empty();let t=this.getSetting("lane-width")||this.plugin.settings["default-lane-width"];this.boardContainer.style.setProperty("--kanban-lane-width",t),this.getBaseSyncConfig().enabled&&this.renderSyncToolbar(),this.getSetting("show-filter-toolbar")!==!1&&this.renderFilterToolbar();let s=this.boardContainer.createDiv({cls:"kanban-board"});for(let o of this.board.lanes)this.renderLane(s,o);if(this.getSetting("show-add-list")!==!1){let o=s.createDiv({cls:"kanban-add-lane-btn"});o.createSpan({text:"+ Add list"}),o.addEventListener("click",()=>this.addLane())}this.setupLaneSortable(s),this.startBackgroundSync()}renderSyncToolbar(){let t=this.boardContainer.createDiv({cls:"kanban-sync-toolbar"});t.appendChild(this.syncStatusEl);let e=t.createDiv({cls:"kanban-sync-btn"});(0,g.setIcon)(e,"refresh-cw"),e.title="Sync with Base",e.addEventListener("click",()=>this.manualSync());let n=t.createDiv({cls:"kanban-base-indicator"});(0,g.setIcon)(n,"database"),n.createSpan({text:"Base sync enabled"})}renderFilterToolbar(){this.filterToolbarEl=this.boardContainer.createDiv({cls:"kanban-filter-toolbar"});let t=this.filterToolbarEl.createDiv({cls:"filter-search-container"}),e=t.createSpan({cls:"filter-search-icon"});(0,g.setIcon)(e,"search");let n=t.createEl("input",{type:"text",cls:"filter-search-input",attr:{placeholder:"Search cards..."}});n.value=this.filterState.text,n.addEventListener("input",()=>{this.filterState.text=n.value,this.applyFilters()});let s=this.filterToolbarEl.createDiv({cls:"filter-buttons"}),r=s.createDiv({cls:"filter-btn"});(0,g.setIcon)(r,"tag"),r.createSpan({text:"Tags"}),this.filterState.tags.length>0&&(r.addClass("has-filter"),r.createSpan({cls:"filter-badge",text:String(this.filterState.tags.length)})),r.addEventListener("click",h=>this.showTagFilterMenu(h));let o=s.createDiv({cls:"filter-btn"});(0,g.setIcon)(o,"folder"),o.createSpan({text:"Project"}),this.filterState.projects.length>0&&(o.addClass("has-filter"),o.createSpan({cls:"filter-badge",text:String(this.filterState.projects.length)})),o.addEventListener("click",h=>this.showProjectFilterMenu(h));let c=s.createDiv({cls:"filter-btn"});(0,g.setIcon)(c,"calendar"),c.createSpan({text:"Due"}),this.filterState.dueState!=="all"&&c.addClass("has-filter"),c.addEventListener("click",h=>this.showDueFilterMenu(h));let l=s.createDiv({cls:`filter-btn ${this.filterState.showCompleted?"":"has-filter"}`});if((0,g.setIcon)(l,this.filterState.showCompleted?"check-circle":"circle"),l.createSpan({text:this.filterState.showCompleted?"Showing completed":"Hiding completed"}),l.addEventListener("click",()=>{this.filterState.showCompleted=!this.filterState.showCompleted,this.applyFilters()}),this.hasActiveFilters()){let h=s.createDiv({cls:"filter-btn filter-clear-btn"});(0,g.setIcon)(h,"x"),h.createSpan({text:"Clear filters"}),h.addEventListener("click",()=>this.clearFilters())}let d=this.getFilteredCardCount(),u=this.getTotalCardCount();if(this.hasActiveFilters()){let h=this.filterToolbarEl.createDiv({cls:"filter-count"});h.textContent=`Showing ${d} of ${u} cards`}}showTagFilterMenu(t){let e=new g.Menu,n=this.getAllTags();if(n.length===0)e.addItem(s=>{s.setTitle("No tags found").setDisabled(!0)});else{for(let s of n){let r=this.filterState.tags.includes(s);e.addItem(o=>{o.setTitle(`${r?"\u2713 ":""}#${s}`).onClick(()=>{r?this.filterState.tags=this.filterState.tags.filter(c=>c!==s):this.filterState.tags.push(s),this.applyFilters()})})}this.filterState.tags.length>0&&(e.addSeparator(),e.addItem(s=>{s.setTitle("Clear tag filter").onClick(()=>{this.filterState.tags=[],this.applyFilters()})}))}e.showAtMouseEvent(t)}showProjectFilterMenu(t){let e=new g.Menu,n=this.getAllProjects();if(n.length===0)e.addItem(s=>{s.setTitle("No projects found").setDisabled(!0)});else{for(let s of n){let r=this.filterState.projects.includes(s);e.addItem(o=>{o.setTitle(`${r?"\u2713 ":""}${s}`).onClick(()=>{r?this.filterState.projects=this.filterState.projects.filter(c=>c!==s):this.filterState.projects.push(s),this.applyFilters()})})}this.filterState.projects.length>0&&(e.addSeparator(),e.addItem(s=>{s.setTitle("Clear project filter").onClick(()=>{this.filterState.projects=[],this.applyFilters()})}))}e.showAtMouseEvent(t)}showDueFilterMenu(t){let e=new g.Menu,n=[{value:"all",label:"All cards"},{value:"overdue",label:"Overdue"},{value:"due-today",label:"Due today"},{value:"due-week",label:"Due this week"},{value:"has-date",label:"Has due date"},{value:"no-date",label:"No due date"}];for(let s of n){let r=this.filterState.dueState===s.value;e.addItem(o=>{o.setTitle(`${r?"\u2713 ":""}${s.label}`).onClick(()=>{this.filterState.dueState=s.value,this.applyFilters()})})}e.showAtMouseEvent(t)}getAllTags(){let t=new Set;for(let e of this.board.lanes)for(let n of e.cards)for(let s of n.tags)t.add(s);return Array.from(t).sort()}getAllProjects(){let t=new Set;for(let e of this.board.lanes)for(let n of e.cards)n.metadata.project&&t.add(n.metadata.project);return Array.from(t).sort()}hasActiveFilters(){return this.filterState.text!==""||this.filterState.tags.length>0||this.filterState.projects.length>0||this.filterState.dueState!=="all"||!this.filterState.showCompleted}clearFilters(){this.filterState={...he},this.applyFilters()}applyFilters(){this.render()}cardMatchesFilter(t){var e,n;if(this.filterState.text){let s=this.filterState.text.toLowerCase(),r=t.title.toLowerCase().includes(s),o=((e=t.notes)==null?void 0:e.toLowerCase().includes(s))||!1,c=((n=t.content)==null?void 0:n.toLowerCase().includes(s))||!1;if(!r&&!o&&!c)return!1}if(this.filterState.tags.length>0&&!this.filterState.tags.some(r=>t.tags.includes(r))||this.filterState.projects.length>0&&(!t.metadata.project||!this.filterState.projects.includes(t.metadata.project))||!this.filterState.showCompleted&&t.completed)return!1;if(this.filterState.dueState!=="all"){let s=new Date;s.setHours(0,0,0,0);let r=t.dueDate?new Date(t.dueDate):null;switch(r&&r.setHours(0,0,0,0),this.filterState.dueState){case"overdue":if(!r||r>=s)return!1;break;case"due-today":if(!r||r.getTime()!==s.getTime())return!1;break;case"due-week":{let o=new Date(s);if(o.setDate(o.getDate()+7),!r||r<s||r>o)return!1;break}case"has-date":if(!t.dueDate)return!1;break;case"no-date":if(t.dueDate)return!1;break}}return!(this.filterState.priority&&t.metadata.priority!==this.filterState.priority)}getFilteredCards(t){return this.hasActiveFilters()?t.cards.filter(e=>this.cardMatchesFilter(e)):t.cards}getFilteredCardCount(){let t=0;for(let e of this.board.lanes)t+=this.getFilteredCards(e).length;return t}getTotalCardCount(){let t=0;for(let e of this.board.lanes)t+=e.cards.length;return t}renderLane(t,e){let n=this.getLaneWipConfig(e),s=e.cards.length,r=n.limit>0&&s>n.limit,o=n.limit>0&&n.warnAt&&s>=n.warnAt,c=["kanban-lane"];r?c.push("wip-exceeded"):o&&c.push("wip-warning");let l=t.createDiv({cls:c.join(" "),attr:{"data-lane-id":e.id}}),d=l.createDiv({cls:"kanban-lane-header"}),u=d.createDiv({cls:"kanban-lane-title-container"}),h=u.createSpan({cls:"kanban-lane-title",text:e.title});if(h.contentEditable="true",h.addEventListener("blur",()=>{e.title=h.textContent||"Untitled",this.requestSave()}),h.addEventListener("keydown",D=>{D.key==="Enter"&&(D.preventDefault(),h.blur())}),!this.getSetting("hide-card-count")){let D=this.getFilteredCards(e),F=n.limit>0?`${s}/${n.limit}`:`${s}`,A=["kanban-lane-count"];r?A.push("over-limit"):o&&A.push("at-warning");let lt=u.createSpan({cls:A.join(" "),text:F});this.hasActiveFilters()&&D.length!==e.cards.length&&(lt.title=`${D.length} visible, ${e.cards.length} total`)}let y=d.createDiv({cls:"kanban-lane-menu-btn"});(0,g.setIcon)(y,"more-vertical"),y.addEventListener("click",D=>{D.stopPropagation(),this.showLaneMenu(D,e)});let p=this.getSetting("show-card-composer")!==!1,w=this.getSetting("composer-position")||this.plugin.settings["composer-position"]||"bottom",m=!n.blockExceeded||!r;p&&w==="top"&&this.renderCardComposer(l,e,m);let v=l.createDiv({cls:"kanban-lane-cards",attr:{"data-lane-id":e.id}}),x=this.getFilteredCards(e);for(let D of x)this.renderCard(v,D,e);if(this.hasActiveFilters()&&x.length<e.cards.length){let D=e.cards.length-x.length,F=v.createDiv({cls:"kanban-hidden-cards-indicator"});F.textContent=`${D} card${D>1?"s":""} hidden by filter`}if(p&&w==="bottom"&&this.renderCardComposer(l,e,m),!p){let D=l.createDiv({cls:`kanban-add-card-btn ${m?"":"disabled"}`});D.createSpan({text:"+ Add card"}),m?D.addEventListener("click",()=>this.addCard(e)):D.title="WIP limit exceeded"}this.setupCardSortable(v,e)}getLaneWipConfig(t){let e=this.board.settings["lane-configs"]||{},n=e[t.title]||e[t.id];if(n!=null&&n.wipLimit)return{limit:n.wipLimit.limit,warnAt:n.wipLimit.warnAt||n.wipLimit.limit,blockExceeded:n.wipLimit.blockExceeded};let s=this.plugin.settings["default-wip-limit"]||0,r=this.plugin.settings["wip-block-exceeded"]||!1;return{limit:s,warnAt:s,blockExceeded:r}}renderCardComposer(t,e,n=!0){let s=t.createDiv({cls:`kanban-card-composer ${n?"":"disabled"}`}),r=s.createEl("textarea",{cls:"kanban-composer-input",attr:{placeholder:n?"Add a card... (Enter to add, Shift+Enter for newline)":"WIP limit exceeded",rows:"1",disabled:n?void 0:"disabled"}});if(!n){s.title="WIP limit exceeded - cannot add more cards";return}let o=()=>{r.style.height="auto",r.style.height=Math.min(r.scrollHeight,150)+"px"};r.addEventListener("input",o),r.addEventListener("keydown",l=>{if(l.key==="Enter"){if(l.shiftKey)return;{l.preventDefault();let d=r.value.trim();d&&(this.addCardFromComposer(e,d),r.value="",o())}}else l.key==="Escape"&&(r.value="",r.blur(),o())});let c=s.createDiv({cls:"kanban-composer-add-btn"});(0,g.setIcon)(c,"plus"),c.addEventListener("click",()=>{let l=r.value.trim();l&&(this.addCardFromComposer(e,l),r.value="",o())})}async addCardFromComposer(t,e){let n=e.split(`
`),s=n[0].trim(),r=n.slice(1),o=[],c=[];for(let p of r){let w=p.match(/^\s*-\s*\[([ xX])\]\s*(.*)$/);w?o.push({id:Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4),text:w[2].trim(),completed:w[1].toLowerCase()==="x"}):p.trim()&&c.push(p)}let l=this.getSetting("default-project"),d={id:Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4),title:s||"New card",completed:!1,tags:[],metadata:l?{project:l}:{},subtasks:o.length>0?o:void 0,content:r.length>0?r.map(p=>"	"+p).join(`
`):void 0},u=s.match(/#[\w-/]+/g)||[];d.tags=u.map(p=>p.substring(1));let h=s.match(/@(\d{4}-\d{2}-\d{2})(?:T(\d{2}:\d{2}))?/);h&&(d.dueDate=h[1],d.dueTime=h[2]),(this.getSetting("new-card-insertion-method")||this.plugin.settings["new-card-insertion-method"])==="prepend"?t.cards.unshift(d):t.cards.push(d),this.requestSave(),this.render(),(this.getSetting("auto-create-note")||this.plugin.settings["auto-create-note"])&&s&&await this.createCardNote(d)}renderSubtasks(t,e,n){if(!e.subtasks||e.subtasks.length===0)return;let s=t.createDiv({cls:"kanban-card-subtasks"}),r=e.subtasks.filter(h=>h.completed).length,o=e.subtasks.length,c=s.createDiv({cls:"kanban-subtasks-progress"});c.createSpan({cls:"subtask-count",text:`${r}/${o}`});let d=c.createDiv({cls:"subtask-progress-bar"}).createDiv({cls:"subtask-progress-fill"});d.style.width=`${r/o*100}%`,r===o&&c.addClass("all-complete");let u=s.createDiv({cls:"kanban-subtasks-list"});e.subtasks.forEach((h,b)=>{let y=u.createDiv({cls:`kanban-subtask ${h.completed?"is-completed":""}`}),p=y.createEl("input",{type:"checkbox"});p.checked=h.completed,p.addEventListener("change",w=>{w.stopPropagation(),h.completed=p.checked,y.toggleClass("is-completed",h.completed),e.content&&(e.content=jn(e.content,b,h.completed));let m=e.subtasks.filter(x=>x.completed).length,v=c.querySelector(".subtask-count");v&&(v.textContent=`${m}/${o}`),d.style.width=`${m/o*100}%`,c.toggleClass("all-complete",m===o),this.requestSave()}),y.createSpan({cls:"subtask-text",text:h.text})})}renderCard(t,e,n){let s=["kanban-card"];e.completed&&s.push("is-completed"),e.baseTaskPath&&s.push("has-base-task");let r=t.createDiv({cls:s.join(" "),attr:{"data-card-id":e.id}});if(e.baseTaskPath){let p=r.createDiv({cls:"kanban-base-link-indicator"});p.title=`Linked to: ${e.baseTaskPath}`}if(this.getSetting("show-checkboxes")!==!1){let w=r.createDiv({cls:"kanban-card-checkbox"}).createEl("input",{type:"checkbox"});w.checked=e.completed,w.addEventListener("change",()=>{e.completed=w.checked,r.toggleClass("is-completed",e.completed),this.requestSave()})}let c=r.createDiv({cls:"kanban-card-content"}),l=this.getDisplayTitle(e),d=c.createDiv({cls:"kanban-card-title"});d.innerHTML=this.renderCardTitleHTML(l,e);let u=d.querySelector(".kanban-card-title-text");if(u&&(u.contentEditable="true",u.addEventListener("blur",async()=>{let p=u.textContent||"";if(e.title=this.reconstructCardTitle(p,e),this.requestSave(),this.pendingAutoCreateNote&&this.pendingAutoCreateNote.card.id===e.id){let w=this.pendingAutoCreateNote;this.pendingAutoCreateNote=null,e.title&&e.title!=="New card"&&await this.createCardNote(w.card)}}),u.addEventListener("keydown",p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),u.blur())})),this.renderMetadataPills(c,e),!this.getSetting("hide-tags-in-title")&&e.tags.length>0){let p=c.createDiv({cls:"kanban-card-tags"});for(let w of e.tags)p.createSpan({cls:"kanban-card-tag",text:`#${w}`}).addEventListener("click",v=>{var x,D,F,A;v.stopPropagation(),(A=(F=(D=(x=this.app.internalPlugins)==null?void 0:x.plugins)==null?void 0:D["global-search"])==null?void 0:F.instance)==null||A.openGlobalSearch(`tag:#${w}`)})}if(this.getSetting("show-subtasks")!==!1&&e.subtasks&&e.subtasks.length>0&&this.renderSubtasks(c,e,n),e.notePath){let p=c.createDiv({cls:"kanban-card-notes-indicator has-dedicated-note"});(0,g.setIcon)(p,"file-symlink"),p.title=`Open note: ${e.notePath}`,p.addEventListener("click",w=>{w.stopPropagation(),this.openCardNote(e)})}else if(e.notes||e.content){let p=c.createDiv({cls:"kanban-card-notes-indicator"});(0,g.setIcon)(p,e.content?"file-edit":"file-text"),p.title=e.content?"Edit card content":"Has inline notes",p.addEventListener("click",w=>{w.stopPropagation(),this.openCardContentModal(e)})}if(this.getSetting("show-card-menu")!==!1){let p=r.createDiv({cls:"kanban-card-menu-btn"});(0,g.setIcon)(p,"more-horizontal"),p.addEventListener("click",w=>{w.stopPropagation(),this.showCardMenu(w,e,n)})}r.addEventListener("click",p=>{var v;let w=p.target;if(w.contentEditable==="true"||w.tagName==="INPUT"||w.closest(".kanban-card-menu-btn")||w.closest(".kanban-card-tag")||w.closest(".kanban-card-notes-indicator")||w.closest(".kanban-subtask-checkbox"))return;if(e.notePath){this.openCardNote(e);return}let m=e.title.match(/\[\[([^\]|]+)(?:\|[^\]]+)?\]\]/);m&&this.app.workspace.openLinkText(m[1],((v=this.file)==null?void 0:v.path)||"")})}getDisplayTitle(t){let e=t.title;return this.getSetting("hide-tags-in-title")&&(e=e.replace(/#[\w-/]+/g,"").trim()),this.getSetting("hide-date-in-title")&&(e=e.replace(/@\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2})?/g,"").trim(),e=e.replace(/@@\d{2}:\d{2}/g,"").trim()),this.getSetting("hide-metadata-in-title")&&(e=e.replace(/\[\w+::[^\]]+\]/g,"").trim(),e=e.replace(/\w+::\S+/g,"").trim()),e.replace(/\s+/g," ").trim()}escapeHtml(t){let e=document.createElement("div");return e.textContent=t,e.innerHTML}renderCardTitleHTML(t,e){return`<span class="kanban-card-title-text">${this.escapeHtml(t).replace(/\[\[([^\]|]+)(?:\|([^\]]+))?\]\]/g,(r,o,c)=>`<a class="internal-link" data-href="${o.replace(/"/g,"&quot;")}">${c||o}</a>`)}</span>`}reconstructCardTitle(t,e){let n=t;if(this.getSetting("hide-tags-in-title")&&e.tags.length>0){let s=n.match(/#[\w-/]+/g)||[];for(let r of e.tags)s.includes(`#${r}`)||(n+=` #${r}`)}if(this.getSetting("hide-date-in-title")&&e.dueDate&&!n.includes("@")){let s=e.dueTime?`@${e.dueDate}T${e.dueTime}`:`@${e.dueDate}`;n+=` ${s}`}return n}renderMetadataPills(t,e){let n=t.createDiv({cls:"kanban-card-metadata-pills"}),s=!1;if(this.getSetting("show-progress")&&e.metadata.progress!==void 0){s=!0;let r=n.createDiv({cls:"kanban-metadata-pill kanban-progress-pill"});(0,g.setIcon)(r.createSpan(),"activity");let o=r.createSpan({cls:"pill-value",text:`${e.metadata.progress}%`}),l=r.createDiv({cls:"progress-bar-container"}).createDiv({cls:"progress-bar-fill"});l.style.width=`${e.metadata.progress}%`,e.metadata.progress>=100?r.addClass("complete"):e.metadata.progress>=50&&r.addClass("in-progress")}if(this.getSetting("show-project")&&e.metadata.project){s=!0;let r=n.createDiv({cls:"kanban-metadata-pill kanban-project-pill"});(0,g.setIcon)(r.createSpan(),"folder"),r.createSpan({cls:"pill-value",text:e.metadata.project})}if(e.dueDate||e.dueTime){s=!0;let r=n.createDiv({cls:"kanban-metadata-pill kanban-date-pill"});(0,g.setIcon)(r.createSpan(),e.dueDate?"calendar":"clock");let o="";if(e.dueDate){let l=this.getSetting("show-relative-date"),d=this.getSetting("date-format")||this.plugin.settings["date-format"];l?o=On(e.dueDate):o=qe(e.dueDate,d,!1),e.dueTime&&(o+=` ${e.dueTime}`)}else e.dueTime&&(o=e.dueTime);let c=r.createSpan({cls:"pill-value",text:o});if(e.dueDate&&(r.title=e.dueDate+(e.dueTime?`T${e.dueTime}`:"")),e.dueDate&&this.getSetting("link-date-to-daily-note")&&(c.addClass("clickable"),c.addEventListener("click",l=>{var d;l.stopPropagation(),this.app.workspace.openLinkText(e.dueDate,((d=this.file)==null?void 0:d.path)||"")})),e.dueDate){let l=new Date().toISOString().split("T")[0];e.dueDate<l?r.addClass("overdue"):e.dueDate===l&&r.addClass("due-today")}}if(e.recurrence){s=!0;let r=n.createDiv({cls:"kanban-metadata-pill kanban-recurrence-pill"});(0,g.setIcon)(r.createSpan(),"repeat");let o=this.formatRecurrenceDisplay(e.recurrence);if(r.createSpan({cls:"pill-value",text:o}),e.dueDate){let c=Bn(e.recurrence,new Date(e.dueDate));r.title=`Next: ${c.toISOString().split("T")[0]}`}}if(e.metadata.priority){s=!0;let r=n.createDiv({cls:`kanban-metadata-pill kanban-priority-pill priority-${e.metadata.priority}`});(0,g.setIcon)(r.createSpan(),"flag"),r.createSpan({cls:"pill-value",text:e.metadata.priority})}if(e.reminderTime&&this.plugin.settings["enable-reminders"]){s=!0;let r=n.createDiv({cls:"kanban-metadata-pill kanban-reminder-pill"});(0,g.setIcon)(r.createSpan(),"bell"),r.createSpan({cls:"pill-value",text:e.reminderTime}),r.title=`Reminder ${e.reminderTime} before due`}s||n.remove()}formatRecurrenceDisplay(t){if(t._rawPattern){let e=t._rawPattern.toLowerCase();return e==="daily"||e==="every day"?"Daily":e==="weekly"||e==="every week"?"Weekly":e==="monthly"||e==="every month"?"Monthly":e==="yearly"||e==="every year"||e==="annually"?"Yearly":e==="weekdays"||e==="every weekday"?"Weekdays":e==="weekends"||e==="every weekend"?"Weekends":t._rawPattern.replace(/^every\s+/i,"")}return He(t)}setupCardSortable(t,e){let n=Ye.create(t,{group:"cards",animation:150,ghostClass:"kanban-card-ghost",chosenClass:"kanban-card-chosen",dragClass:"kanban-card-drag",handle:".kanban-card",filter:'.kanban-card-menu-btn, input, [contenteditable="true"], .kanban-card-tag, .kanban-metadata-pill',preventOnFilter:!1,onEnd:s=>{let r=s.item.getAttribute("data-card-id"),o=s.from.getAttribute("data-lane-id"),c=s.to.getAttribute("data-lane-id");if(!r||!o||!c)return;let l=this.board.lanes.find(b=>b.id===o),d=this.board.lanes.find(b=>b.id===c);if(!l||!d)return;let u=l.cards.findIndex(b=>b.id===r);if(u===-1)return;let[h]=l.cards.splice(u,1);d.cards.splice(s.newIndex||0,0,h),o!==c&&this.plugin.onCardMovedToLane(h,d.title,l.title),this.requestSave(),this.render()}});this.sortableInstances.push(n)}setupLaneSortable(t){let e=Ye.create(t,{animation:150,ghostClass:"kanban-lane-ghost",chosenClass:"kanban-lane-chosen",dragClass:"kanban-lane-drag",handle:".kanban-lane-header",filter:'.kanban-add-lane-btn, [contenteditable="true"]',preventOnFilter:!1,onEnd:n=>{let s=n.oldIndex,r=n.newIndex;if(s===void 0||r===void 0||s===r||r>=this.board.lanes.length)return;let[o]=this.board.lanes.splice(s,1);this.board.lanes.splice(r,0,o),this.requestSave(),this.render()}});this.sortableInstances.push(e)}showLaneMenu(t,e){let n=new g.Menu;n.addItem(o=>{o.setTitle("Add card").setIcon("plus").onClick(()=>this.addCard(e))}),this.getSetting("template-path")&&n.addItem(o=>{o.setTitle("Add card from template").setIcon("file-plus").onClick(()=>this.addCardFromTemplate(e))}),n.addSeparator(),n.addItem(o=>{o.setTitle("Move left").setIcon("arrow-left").onClick(()=>this.moveLane(e,-1))}),n.addItem(o=>{o.setTitle("Move right").setIcon("arrow-right").onClick(()=>this.moveLane(e,1))}),n.addSeparator(),n.addItem(o=>{o.setTitle("Archive all cards").setIcon("archive").onClick(()=>this.archiveLaneCards(e))}),n.addItem(o=>{o.setTitle("Archive completed").setIcon("check-square").onClick(()=>this.archiveCompletedInLane(e))}),n.addSeparator();let r=this.getLaneWipConfig(e);n.addItem(o=>{o.setTitle(`Set WIP limit${r.limit>0?` (currently ${r.limit})`:""}`).setIcon("gauge").onClick(()=>this.showWipLimitModal(e))}),n.addSeparator(),n.addItem(o=>{o.setTitle("Delete list").setIcon("trash").onClick(()=>this.deleteLane(e))}),n.showAtMouseEvent(t)}showWipLimitModal(t){new Qe(this.app,t,this.getLaneWipConfig(t),n=>{this.board.settings["lane-configs"]||(this.board.settings["lane-configs"]={}),this.board.settings["lane-configs"][t.title]||(this.board.settings["lane-configs"][t.title]={}),this.board.settings["lane-configs"][t.title].wipLimit=n,this.requestSave(),this.render()}).open()}showCardMenu(t,e,n){let s=new g.Menu;s.addItem(c=>{c.setTitle("Edit card").setIcon("pencil").onClick(()=>this.openCardEditModal(e))}),e.notePath?(s.addItem(c=>{c.setTitle("Open note").setIcon("file-symlink").onClick(()=>this.openCardNote(e))}),s.addItem(c=>{c.setTitle("Sync to note").setIcon("refresh-cw").onClick(()=>this.syncCardToNote(e))}),s.addItem(c=>{c.setTitle("Unlink note").setIcon("unlink").onClick(()=>this.unlinkCardNote(e))})):(s.addItem(c=>{c.setTitle("Create note").setIcon("file-plus").onClick(()=>this.createCardNote(e))}),s.addItem(c=>{c.setTitle("Link to existing note").setIcon("link").onClick(()=>this.linkToExistingNote(e))})),s.addItem(c=>{c.setTitle("Edit content").setIcon("file-edit").onClick(()=>this.openCardContentModal(e))}),!e.notePath&&!e.content&&s.addItem(c=>{c.setTitle("Edit inline notes").setIcon("file-text").onClick(()=>this.openCardNotesModal(e))}),s.addSeparator();let r=this.board.lanes.filter(c=>c.id!==n.id);r.length>0&&s.addItem(c=>{c.setTitle("Move to..."),c.setIcon("arrow-right");let l=c.setSubmenu();for(let d of r)l.addItem(u=>{u.setTitle(d.title).onClick(()=>this.moveCard(e,n,d))})}),s.addSeparator(),s.addItem(c=>{c.setTitle("Set progress...").setIcon("activity").onClick(()=>this.setCardProgress(e))}),s.addItem(c=>{c.setTitle("Set project...").setIcon("folder").onClick(()=>this.setCardProject(e))}),s.addItem(c=>{c.setTitle("Set due date...").setIcon("calendar").onClick(()=>this.setCardDueDate(e))}),s.addSeparator(),this.getBaseSyncConfig().enabled&&(e.baseTaskPath?(s.addItem(c=>{c.setTitle("Open Base task").setIcon("external-link").onClick(()=>{e.baseTaskPath&&this.app.workspace.openLinkText(e.baseTaskPath,"")})}),s.addItem(c=>{c.setTitle("Unlink from Base").setIcon("unlink").onClick(()=>{e.baseTaskPath=void 0,e.baseSyncTime=void 0,this.requestSave(),this.render(),new g.Notice("Card unlinked from Base task")})})):(s.addItem(c=>{c.setTitle("Link to Base task").setIcon("link").onClick(()=>this.linkCardToBaseTask(e))}),s.addItem(c=>{c.setTitle("Create Base task").setIcon("file-plus-2").onClick(()=>this.createBaseTaskForCard(e,n))})),s.addSeparator()),s.addItem(c=>{c.setTitle("Archive").setIcon("archive").onClick(()=>this.archiveCard(e,n))}),s.addItem(c=>{c.setTitle("Delete").setIcon("trash").onClick(()=>this.deleteCard(e,n))}),s.showAtMouseEvent(t)}addLane(){let t={id:Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4),title:"New List",cards:[]};this.board.lanes.push(t),this.requestSave(),this.render(),setTimeout(()=>{let e=this.boardContainer.querySelector(`[data-lane-id="${t.id}"] .kanban-lane-title`);if(e instanceof HTMLElement){e.focus();let n=document.createRange();n.selectNodeContents(e);let s=window.getSelection();s==null||s.removeAllRanges(),s==null||s.addRange(n)}},50)}moveLane(t,e){let n=this.board.lanes.indexOf(t),s=n+e;s<0||s>=this.board.lanes.length||(this.board.lanes.splice(n,1),this.board.lanes.splice(s,0,t),this.requestSave(),this.render())}deleteLane(t){let e=this.board.lanes.indexOf(t);e!==-1&&(this.board.lanes.splice(e,1),this.requestSave(),this.render())}addCard(t){let e=this.getSetting("default-project"),n={id:Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4),title:"New card",completed:!1,tags:[],metadata:e?{project:e}:{}};(this.getSetting("new-card-insertion-method")||this.plugin.settings["new-card-insertion-method"])==="prepend"?t.cards.unshift(n):t.cards.push(n),this.requestSave(),this.render(),setTimeout(()=>{let o=this.boardContainer.querySelector(`[data-card-id="${n.id}"] .kanban-card-title-text`);if(o instanceof HTMLElement){o.focus();let c=document.createRange();c.selectNodeContents(o);let l=window.getSelection();l==null||l.removeAllRanges(),l==null||l.addRange(c)}},50),(this.getSetting("auto-create-note")||this.plugin.settings["auto-create-note"])&&(this.pendingAutoCreateNote={card:n,lane:t})}async addCardFromTemplate(t){let e=this.getSetting("template-path");if(!e)return;let n=this.app.vault.getAbstractFileByPath(e);if(!(n instanceof g.TFile)){console.warn("Template file not found:",e);return}try{let s=await this.app.vault.read(n),r=this.getSetting("default-project"),o=Rn(s,r?{project:r}:{});(this.getSetting("new-card-insertion-method")||this.plugin.settings["new-card-insertion-method"])==="prepend"?t.cards.unshift(o):t.cards.push(o),this.requestSave(),this.render()}catch(s){console.error("Error reading template:",s)}}moveCard(t,e,n){let s=e.cards.indexOf(t);s!==-1&&(e.cards.splice(s,1),n.cards.push(t),this.syncCardStatusToBase(t,n),this.requestSave(),this.render())}async syncCardStatusToBase(t,e){let n=this.getBaseSyncConfig();if(n.enabled){if(this.baseSyncService.setConfig(n),t.baseTaskPath)await this.baseSyncService.onCardMoveToLane(t,e)&&ht(this.syncStatusEl,"success","Status synced");else if(n.createMissingTasks){let s=await this.baseSyncService.createBaseTask(t.title,t.metadata,e);s&&(t.baseTaskPath=s,t.baseSyncTime=Date.now(),ht(this.syncStatusEl,"success","Task created"))}}}deleteCard(t,e){let n=e.cards.indexOf(t);n!==-1&&(e.cards.splice(n,1),this.requestSave(),this.render())}archiveCard(t,e){let n=e.cards.indexOf(t);if(n===-1)return;e.cards.splice(n,1);let s=t;this.plugin.settings["prepend-archive-date"]&&(s=Xt(t,this.plugin.settings["prepend-archive-format"])),this.board.archive.push(s),this.requestSave(),this.render()}archiveLaneCards(t){for(let e of t.cards){let n=e;this.plugin.settings["prepend-archive-date"]&&(n=Xt(e,this.plugin.settings["prepend-archive-format"])),this.board.archive.push(n)}t.cards=[],this.requestSave(),this.render()}archiveCompletedInLane(t){let e=t.cards.filter(s=>s.completed),n=t.cards.filter(s=>!s.completed);for(let s of e){let r=s;this.plugin.settings["prepend-archive-date"]&&(r=Xt(s,this.plugin.settings["prepend-archive-format"])),this.board.archive.push(r)}t.cards=n,this.requestSave(),this.render()}archiveCompletedCards(){for(let t of this.board.lanes){let e=t.cards.filter(s=>s.completed),n=t.cards.filter(s=>!s.completed);for(let s of e){let r=s;this.plugin.settings["prepend-archive-date"]&&(r=Xt(s,this.plugin.settings["prepend-archive-format"])),this.board.archive.push(r)}t.cards=n}this.requestSave(),this.render()}openCardEditModal(t){new Xe(this.app,t,n=>{Object.assign(t,n),this.requestSave(),this.render()}).open()}openCardNotesModal(t){new Ue(this.app,t,n=>{t.notes=n||void 0,this.requestSave(),this.render()}).open()}openCardContentModal(t){new ze(this.app,t,(n,s)=>{if(t.content=n||void 0,t.subtasks=s&&s.length>0?s:void 0,!(!n&&t.notes)){if(n){let r=[];for(let o of n.split(`
`)){let c=o.match(/^\s*>\s?(.*)$/);c&&r.push(c[1])}t.notes=r.length>0?r.join(`
`):void 0}}this.requestSave(),this.render()}).open()}setCardProgress(t){var n;new Ut(this.app,"Set Progress","Enter progress (0-100%)",((n=t.metadata.progress)==null?void 0:n.toString())||"0",async s=>{let r=parseInt(s.replace("%",""),10);if(!isNaN(r)){let o=Math.min(100,Math.max(0,r));t.metadata.progress=o,await this.syncCardProgressToBase(t,o),this.requestSave(),this.render()}}).open()}async syncCardProgressToBase(t,e){let n=this.getBaseSyncConfig();if(!n.enabled||!t.baseTaskPath)return;this.baseSyncService.setConfig(n),await this.baseSyncService.syncProgress(t,e)&&ht(this.syncStatusEl,"success","Progress synced")}setCardProject(t){new Ut(this.app,"Set Project","Enter project name",t.metadata.project||"",async n=>{t.metadata.project=n||void 0,await this.syncCardProjectToBase(t,n),this.requestSave(),this.render()}).open()}async syncCardProjectToBase(t,e){let n=this.getBaseSyncConfig();if(!n.enabled||!t.baseTaskPath)return;this.baseSyncService.setConfig(n),await this.baseSyncService.syncProject(t,e)&&ht(this.syncStatusEl,"success","Project synced")}setCardDueDate(t){new Ut(this.app,"Set Due Date","Enter date (YYYY-MM-DD)",t.dueDate||"",n=>{n.match(/^\d{4}-\d{2}-\d{2}$/)?t.dueDate=n:n||(t.dueDate=void 0),this.requestSave(),this.render()}).open()}openBoardSettings(){new Je(this.app,this.board.settings,e=>{this.board.settings=e,this.requestSave(),this.render()}).open()}async openCardNote(t){var n;if(!t.notePath)return;let e=this.app.vault.getAbstractFileByPath(t.notePath);e instanceof g.TFile?(await this.syncCardFromNote(t,e),await this.app.workspace.openLinkText(t.notePath,((n=this.file)==null?void 0:n.path)||"")):new Ce(this.app,"Note not found",`The note "${t.notePath}" no longer exists. Would you like to create it?`,async()=>{await this.createCardNote(t)}).open()}async createCardNote(t){var l,d,u;let e=this.getSetting("card-note-template")||this.plugin.settings["card-note-template"],n=this.getSetting("card-note-folder")||this.plugin.settings["card-note-folder"],r=this.sanitizeFilename(t.title)||`card-${t.id}`,o="";if(n)this.app.vault.getAbstractFileByPath(n)||await this.app.vault.createFolder(n),o=`${n}/${r}.md`;else{let h=((d=(l=this.file)==null?void 0:l.parent)==null?void 0:d.path)||"";o=h?`${h}/${r}.md`:`${r}.md`}o=await this.ensureUniqueFilename(o);let c=await this.generateCardNoteContent(t,e);try{let h=await this.app.vault.create(o,c);if(t.notePath=h.path,t.notes){let b=await this.app.vault.read(h);b.includes(t.notes)||await this.app.vault.modify(h,b+`

## Notes

`+t.notes),t.notes=void 0}this.requestSave(),this.render(),await this.app.workspace.openLinkText(h.path,((u=this.file)==null?void 0:u.path)||"")}catch(h){console.error("Error creating card note:",h)}}async unlinkCardNote(t){if(!t.notePath)return;new Ce(this.app,"Unlink note",`Unlink "${t.notePath}" from this card? The note file will be kept.`,()=>{t.notePath=void 0,this.requestSave(),this.render(),new g.Notice("Note unlinked from card")}).open()}async linkToExistingNote(t){new Ze(this.app,async n=>{if(n){t.notePath=n;let s=this.app.vault.getAbstractFileByPath(n);s instanceof g.TFile&&await this.syncCardFromNote(t,s),this.requestSave(),this.render(),new g.Notice(`Card linked to: ${n}`)}}).open()}sanitizeFilename(t){let e=t.replace(/\[\[([^\]|]+)(?:\|[^\]]+)?\]\]/g,"$1");return e=e.replace(/\[\w+::[^\]]+\]/g,""),e=e.replace(/\w+::\S+/g,""),e=e.replace(/#[\w-/]+/g,""),e=e.replace(/@\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2})?/g,""),e=e.replace(/@@\d{2}:\d{2}/g,""),e=e.replace(/[\\/:*?"<>|]/g,""),e=e.replace(/\s+/g," ").trim(),e.length>100&&(e=e.substring(0,100).trim()),e}async ensureUniqueFilename(t){let e=t.endsWith(".md")?"":".md",n=t.endsWith(".md")?t:t+e,s=1;for(;this.app.vault.getAbstractFileByPath(n);)n=`${t.replace(/\.md$/,"")} ${s}.md`,s++;return n}async generateCardNoteContent(t,e){let n="";if(e){let s=this.app.vault.getAbstractFileByPath(e);if(s instanceof g.TFile)try{n=await this.app.vault.read(s),n=this.processCardNoteTemplate(n,t)}catch(r){console.warn("Error reading template:",r)}}return n||(n=this.generateDefaultCardNoteContent(t)),n}processCardNoteTemplate(t,e){var s,r,o;let n=Ge({title:e.title,project:e.metadata.project,dueDate:e.dueDate,priority:e.metadata.priority,tags:e.tags,customVars:{dueTime:e.dueTime||"",progress:((s=e.metadata.progress)==null?void 0:s.toString())||"",completed:e.completed?"true":"false",board:((r=this.file)==null?void 0:r.basename)||"",boardPath:((o=this.file)==null?void 0:o.path)||"",cardId:e.id,notes:e.notes||""}});return We(t,n)}generateDefaultCardNoteContent(t){var s;let e=[];e.push("---"),e.push(`kanban-card: ${t.id}`),e.push(`kanban-board: "[[${((s=this.file)==null?void 0:s.basename)||"Kanban"}]]"`),t.dueDate&&e.push(`due: ${t.dueDate}${t.dueTime?"T"+t.dueTime:""}`),t.metadata.progress!==void 0&&e.push(`progress: ${t.metadata.progress}`),t.metadata.project&&e.push(`project: "${t.metadata.project}"`),t.metadata.priority&&e.push(`priority: ${t.metadata.priority}`),t.tags.length>0&&e.push(`tags: [${t.tags.map(r=>`"${r}"`).join(", ")}]`),e.push(`completed: ${t.completed}`),e.push(`created: ${new Date().toISOString().split("T")[0]}`),e.push("---"),e.push("");let n=this.getDisplayTitle(t);if(e.push(`# ${n||"Card"}`),e.push(""),t.notes&&(e.push("## Notes"),e.push(""),e.push(t.notes),e.push("")),t.subtasks&&t.subtasks.length>0){e.push("## Tasks"),e.push("");for(let r of t.subtasks)e.push(`- [${r.completed?"x":" "}] ${r.text}`);e.push("")}return e.join(`
`)}async syncCardToNote(t){if(!t.notePath)return;let e=this.app.vault.getAbstractFileByPath(t.notePath);if(e instanceof g.TFile)try{let n=await this.app.vault.read(e),s=n.match(/^---\n([\s\S]*?)\n---/);if(s){let o=s[1];o=this.updateFrontmatterField(o,"due",t.dueDate?t.dueTime?`${t.dueDate}T${t.dueTime}`:t.dueDate:void 0),o=this.updateFrontmatterField(o,"progress",t.metadata.progress!==void 0?String(t.metadata.progress):void 0),o=this.updateFrontmatterField(o,"project",t.metadata.project),o=this.updateFrontmatterField(o,"priority",t.metadata.priority),o=this.updateFrontmatterField(o,"completed",String(t.completed)),t.tags.length>0&&(o=this.updateFrontmatterField(o,"tags",`[${t.tags.map(c=>`"${c}"`).join(", ")}]`)),n=n.replace(s[0],`---
${o}
---`)}else n=this.generateCardFrontmatter(t)+`
`+n;let r=n.match(/^# .+$/m);if(r){let o=this.getDisplayTitle(t);n=n.replace(r[0],`# ${o}`)}await this.app.vault.modify(e,n)}catch(n){console.warn("Error syncing card to note:",n)}}updateFrontmatterField(t,e,n){let s=t.split(`
`),r=new RegExp(`^${e}:\\s*.*$`,"m");if(n!==void 0&&n!==""){let o=s.findIndex(d=>d.startsWith(`${e}:`)),l=(n.includes(":")||n.includes("#")||n.includes('"'))&&!n.startsWith("[")?`"${n}"`:n;o>=0?s[o]=`${e}: ${l}`:s.push(`${e}: ${l}`)}else{let o=s.findIndex(c=>c.startsWith(`${e}:`));o>=0&&s.splice(o,1)}return s.filter(o=>o.trim()!==""||o==="").join(`
`)}generateCardFrontmatter(t){var n;let e=["---"];return e.push(`kanban-card: ${t.id}`),e.push(`kanban-board: "[[${((n=this.file)==null?void 0:n.basename)||"Kanban"}]]"`),t.dueDate&&e.push(`due: ${t.dueDate}${t.dueTime?"T"+t.dueTime:""}`),t.metadata.progress!==void 0&&e.push(`progress: ${t.metadata.progress}`),t.metadata.project&&e.push(`project: "${t.metadata.project}"`),t.metadata.priority&&e.push(`priority: ${t.metadata.priority}`),t.tags.length>0&&e.push(`tags: [${t.tags.map(s=>`"${s}"`).join(", ")}]`),e.push(`completed: ${t.completed}`),e.push("---"),e.join(`
`)}async syncCardFromNote(t,e){try{let n=await this.app.vault.read(e),s=this.app.metadataCache.getFileCache(e);if(s!=null&&s.frontmatter){let r=s.frontmatter;if(s.headings&&s.headings.length>0){let o=s.headings[0];if(o.level===1){let c=o.heading;c&&c!==t.title&&(t.title=c)}}r.due&&typeof r.due=="string"&&(t.dueDate=r.due),r.progress!==void 0&&(t.metadata.progress=typeof r.progress=="number"?r.progress:parseInt(r.progress,10)),r.project&&(t.metadata.project=r.project),r.priority&&(t.metadata.priority=r.priority),r.completed!==void 0&&(t.completed=r.completed===!0||r.completed==="true"),Array.isArray(r.tags)&&(t.tags=r.tags.map(o=>o.replace(/^#/,""))),this.requestSave(),this.render()}}catch(n){console.warn("Error syncing card from note:",n)}}async createOrOpenCardNote(){let t=this.findFocusedCard();t&&(t.card.notePath?await this.openCardNote(t.card):await this.createCardNote(t.card))}findFocusedCard(){let t=document.activeElement;if(t){let e=t.closest("[data-card-id]");if(e){let n=e.getAttribute("data-card-id");for(let s of this.board.lanes){let r=s.cards.find(o=>o.id===n);if(r)return{card:r,lane:s}}}}return null}},Xe=class extends g.Modal{constructor(t,e,n){super(t);this.card={...e,metadata:{...e.metadata}},this.onSave=n}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("kanban-card-edit-modal"),t.createEl("h2",{text:"Edit Card"}),new g.Setting(t).setName("Title").addText(e=>e.setValue(this.card.title).onChange(n=>this.card.title=n)),new g.Setting(t).setName("Due Date").setDesc("YYYY-MM-DD format").addText(e=>e.setValue(this.card.dueDate||"").onChange(n=>this.card.dueDate=n||void 0)),new g.Setting(t).setName("Progress").setDesc("0-100").addSlider(e=>e.setLimits(0,100,5).setValue(this.card.metadata.progress||0).setDynamicTooltip().onChange(n=>this.card.metadata.progress=n)),new g.Setting(t).setName("Project").addText(e=>e.setValue(this.card.metadata.project||"").onChange(n=>this.card.metadata.project=n||void 0)),new g.Setting(t).setName("Priority").addDropdown(e=>e.addOption("","None").addOption("low","Low").addOption("medium","Medium").addOption("high","High").addOption("urgent","Urgent").setValue(this.card.metadata.priority||"").onChange(n=>this.card.metadata.priority=n||void 0)),new g.Setting(t).addButton(e=>e.setButtonText("Save").setCta().onClick(()=>{this.onSave(this.card),this.close()})).addButton(e=>e.setButtonText("Cancel").onClick(()=>this.close()))}onClose(){let{contentEl:t}=this;t.empty()}},Ue=class extends g.Modal{constructor(t,e,n){super(t);this.card=e,this.notesValue=e.notes||"",this.onSave=n}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("kanban-card-notes-modal"),t.createEl("h2",{text:"Card Notes"}),t.createEl("p",{text:this.card.title,cls:"kanban-notes-card-title"});let e=t.createEl("textarea",{cls:"kanban-notes-textarea",attr:{rows:"10"}});e.value=this.notesValue,e.addEventListener("input",()=>{this.notesValue=e.value}),new g.Setting(t).addButton(n=>n.setButtonText("Save").setCta().onClick(()=>{this.onSave(this.notesValue),this.close()})).addButton(n=>n.setButtonText("Cancel").onClick(()=>this.close()))}onClose(){let{contentEl:t}=this;t.empty()}},ze=class extends g.Modal{constructor(t,e,n){super(t);this.card=e,this.contentValue=e.content||"",this.subtasks=e.subtasks?[...e.subtasks]:[],this.onSave=n}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("kanban-card-content-modal"),t.createEl("h2",{text:"Edit Card Content"}),t.createEl("p",{text:this.card.title,cls:"kanban-content-card-title"}),t.createEl("p",{text:'Add subtasks with "- [ ] task" format. Content is saved in markdown under the card.',cls:"kanban-content-info"});let e=t.createEl("textarea",{cls:"kanban-content-textarea",attr:{rows:"12",placeholder:`Add content, notes, or subtasks...

- [ ] Subtask 1
- [ ] Subtask 2

> Notes can use > prefix`}});if(this.subtasks.length>0&&!this.contentValue){let l=this.subtasks.map(d=>`	- [${d.completed?"x":" "}] ${d.text}`);this.contentValue=l.join(`
`)}if(this.card.notes&&!this.contentValue){let l=this.card.notes.split(`
`).map(d=>`	> ${d}`);this.contentValue=l.join(`
`)}e.value=this.contentValue,e.addEventListener("input",()=>{this.contentValue=e.value,this.parseSubtasksFromContent(),this.updateSubtaskPreview()});let n=t.createDiv({cls:"kanban-content-preview"});n.createEl("h4",{text:"Subtasks Preview"}),this.subtaskPreviewEl=n.createDiv({cls:"kanban-subtask-preview-list"}),this.updateSubtaskPreview();let s=t.createDiv({cls:"kanban-quick-add-subtask"}),r=s.createEl("input",{type:"text",cls:"kanban-subtask-input",attr:{placeholder:"Quick add subtask..."}}),o=s.createEl("button",{text:"Add"}),c=()=>{let l=r.value.trim();if(l){let d=`	- [ ] ${l}`;this.contentValue?this.contentValue+=`
`+d:this.contentValue=d,e.value=this.contentValue,this.parseSubtasksFromContent(),this.updateSubtaskPreview(),r.value=""}};o.addEventListener("click",c),r.addEventListener("keydown",l=>{l.key==="Enter"&&(l.preventDefault(),c())}),new g.Setting(t).addButton(l=>l.setButtonText("Save").setCta().onClick(()=>{this.parseSubtasksFromContent(),this.onSave(this.contentValue,this.subtasks),this.close()})).addButton(l=>l.setButtonText("Cancel").onClick(()=>this.close()))}parseSubtasksFromContent(){this.subtasks=[];let t=this.contentValue.split(`
`);for(let e of t){let n=e.match(/^\s*-\s*\[([ xX])\]\s*(.*)$/);n&&this.subtasks.push({id:Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4),text:n[2].trim(),completed:n[1].toLowerCase()==="x"})}}updateSubtaskPreview(){if(this.subtaskPreviewEl.empty(),this.subtasks.length===0){this.subtaskPreviewEl.createEl("p",{text:'No subtasks found. Add subtasks with "- [ ] task" format.',cls:"kanban-subtask-empty"});return}let t=this.subtasks.filter(e=>e.completed).length;this.subtaskPreviewEl.createEl("p",{text:`${t}/${this.subtasks.length} completed`,cls:"kanban-subtask-summary"});for(let e of this.subtasks){let n=this.subtaskPreviewEl.createDiv({cls:`kanban-subtask-preview-item ${e.completed?"is-completed":""}`});n.createSpan({text:e.completed?"\u2611":"\u2610"}),n.createSpan({text:e.text})}}onClose(){let{contentEl:t}=this;t.empty()}},Ut=class extends g.Modal{constructor(t,e,n,s,r){super(t);this.title=e,this.placeholder=n,this.initialValue=s,this.onSave=r}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h3",{text:this.title});let e=this.initialValue;new g.Setting(t).setName(this.placeholder).addText(n=>n.setValue(this.initialValue).onChange(s=>e=s).inputEl.addEventListener("keydown",s=>{s.key==="Enter"&&(this.onSave(e),this.close())})),new g.Setting(t).addButton(n=>n.setButtonText("OK").setCta().onClick(()=>{this.onSave(e),this.close()})).addButton(n=>n.setButtonText("Cancel").onClick(()=>this.close()))}onClose(){let{contentEl:t}=this;t.empty()}},Je=class extends g.Modal{constructor(t,e,n){super(t);this.settings={...e},this.onSave=n}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("kanban-board-settings-modal"),t.createEl("h2",{text:"Board Settings"}),t.createEl("p",{text:"These settings override global plugin settings for this board.",cls:"setting-item-description"}),t.createEl("h3",{text:"Display"}),new g.Setting(t).setName("Lane width").setDesc("Width of lanes (e.g., 272px, 300px)").addText(n=>n.setValue(this.settings["lane-width"]||"").setPlaceholder("272px").onChange(s=>this.settings["lane-width"]=s||void 0)),new g.Setting(t).setName("Show checkboxes").addToggle(n=>n.setValue(this.settings["show-checkboxes"]!==!1).onChange(s=>this.settings["show-checkboxes"]=s)),new g.Setting(t).setName("Show card count").addToggle(n=>n.setValue(this.settings["hide-card-count"]!==!0).onChange(s=>this.settings["hide-card-count"]=!s)),new g.Setting(t).setName("Hide tags in title").addToggle(n=>n.setValue(this.settings["hide-tags-in-title"]||!1).onChange(s=>this.settings["hide-tags-in-title"]=s)),new g.Setting(t).setName("Hide dates in title").addToggle(n=>n.setValue(this.settings["hide-date-in-title"]||!1).onChange(s=>this.settings["hide-date-in-title"]=s)),t.createEl("h3",{text:"Metadata"}),new g.Setting(t).setName("Show progress").addToggle(n=>n.setValue(this.settings["show-progress"]!==!1).onChange(s=>this.settings["show-progress"]=s)),new g.Setting(t).setName("Show project").addToggle(n=>n.setValue(this.settings["show-project"]!==!1).onChange(s=>this.settings["show-project"]=s)),new g.Setting(t).setName("Default project").setDesc("Default project for new cards").addText(n=>n.setValue(this.settings["default-project"]||"").onChange(s=>this.settings["default-project"]=s||void 0)),t.createEl("h3",{text:"Dates"}),new g.Setting(t).setName("Date format").addText(n=>n.setValue(this.settings["date-format"]||"").setPlaceholder("YYYY-MM-DD").onChange(s=>this.settings["date-format"]=s||void 0)),new g.Setting(t).setName("Show relative dates").addToggle(n=>n.setValue(this.settings["show-relative-date"]||!1).onChange(s=>this.settings["show-relative-date"]=s)),new g.Setting(t).setName("Link dates to daily notes").addToggle(n=>n.setValue(this.settings["link-date-to-daily-note"]||!1).onChange(s=>this.settings["link-date-to-daily-note"]=s)),t.createEl("h3",{text:"Cards"}),new g.Setting(t).setName("New card position").addDropdown(n=>n.addOption("","Use global setting").addOption("prepend","Top of list").addOption("append","Bottom of list").setValue(this.settings["new-card-insertion-method"]||"").onChange(s=>this.settings["new-card-insertion-method"]=s||void 0)),new g.Setting(t).setName("Template path").setDesc("Path to template file for new cards").addText(n=>n.setValue(this.settings["template-path"]||"").setPlaceholder("templates/card.md").onChange(s=>this.settings["template-path"]=s||void 0)),t.createEl("h3",{text:"Card Composer"}),new g.Setting(t).setName("Show card composer").setDesc("Show quick-add composer in lanes").addToggle(n=>n.setValue(this.settings["show-card-composer"]!==!1).onChange(s=>this.settings["show-card-composer"]=s)),new g.Setting(t).setName("Composer position").setDesc("Where to show the quick-add composer").addDropdown(n=>n.addOption("bottom","Bottom of lane").addOption("top","Top of lane").setValue(this.settings["composer-position"]||"bottom").onChange(s=>this.settings["composer-position"]=s)),new g.Setting(t).setName("Show subtasks").setDesc("Display subtask checkboxes in cards").addToggle(n=>n.setValue(this.settings["show-subtasks"]!==!1).onChange(s=>this.settings["show-subtasks"]=s)),t.createEl("h3",{text:"Card Notes"});let e=t.createDiv({cls:"kanban-settings-info"});e.createEl("span",{text:"Template variables: ",cls:"setting-item-name"}),e.createEl("span",{text:"{{title}}, {{date}}, {{time}}, {{project}}, {{lane}}, {{board}}, {{dueDate}}, {{tags}}, {{id}}",cls:"kanban-template-var"}),new g.Setting(t).setName("Card note template").setDesc("Template file for dedicated card notes").addText(n=>n.setValue(this.settings["card-note-template"]||"").setPlaceholder("templates/card-note.md").onChange(s=>this.settings["card-note-template"]=s||void 0)),new g.Setting(t).setName("Card note folder").setDesc("Folder for dedicated card notes").addText(n=>n.setValue(this.settings["card-note-folder"]||"").setPlaceholder("cards/").onChange(s=>this.settings["card-note-folder"]=s||void 0)),new g.Setting(t).setName("Auto-create note for new cards").setDesc("Automatically create a dedicated note when adding new cards").addToggle(n=>n.setValue(this.settings["auto-create-note"]||!1).onChange(s=>this.settings["auto-create-note"]=s)),new g.Setting(t).addButton(n=>n.setButtonText("Save").setCta().onClick(()=>{let s={};for(let[r,o]of Object.entries(this.settings))o!==void 0&&o!==""&&(s[r]=o);this.onSave(s),this.close()})).addButton(n=>n.setButtonText("Cancel").onClick(()=>this.close()))}onClose(){let{contentEl:t}=this;t.empty()}},Ce=class extends g.Modal{constructor(t,e,n,s){super(t);this.title=e,this.message=n,this.onConfirm=s}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h3",{text:this.title}),t.createEl("p",{text:this.message}),new g.Setting(t).addButton(e=>e.setButtonText("Yes").setCta().onClick(()=>{this.onConfirm(),this.close()})).addButton(e=>e.setButtonText("No").onClick(()=>this.close()))}onClose(){let{contentEl:t}=this;t.empty()}},Qe=class extends g.Modal{constructor(t,e,n,s){super(t);this.lane=e,this.currentConfig={...n},this.onSave=s}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("kanban-wip-limit-modal"),t.createEl("h2",{text:`WIP Limit: ${this.lane.title}`}),t.createEl("p",{text:"Set a Work In Progress limit for this lane. Cards exceeding the limit will show a warning.",cls:"setting-item-description"}),new g.Setting(t).setName("WIP limit").setDesc("Maximum cards allowed (0 = no limit)").addText(e=>e.setPlaceholder("0").setValue(String(this.currentConfig.limit)).onChange(n=>{let s=parseInt(n,10);this.currentConfig.limit=isNaN(s)?0:Math.max(0,s)})),new g.Setting(t).setName("Warning threshold").setDesc("Show warning when this many cards (leave empty to use limit)").addText(e=>e.setPlaceholder("Same as limit").setValue(this.currentConfig.warnAt?String(this.currentConfig.warnAt):"").onChange(n=>{let s=parseInt(n,10);this.currentConfig.warnAt=isNaN(s)?void 0:Math.max(0,s)})),new g.Setting(t).setName("Block when exceeded").setDesc("Prevent adding new cards when limit is exceeded").addToggle(e=>e.setValue(this.currentConfig.blockExceeded).onChange(n=>this.currentConfig.blockExceeded=n)),new g.Setting(t).addButton(e=>e.setButtonText("Save").setCta().onClick(()=>{this.onSave(this.currentConfig),this.close()})).addButton(e=>e.setButtonText("Remove limit").onClick(()=>{this.onSave({limit:0,blockExceeded:!1}),this.close()})).addButton(e=>e.setButtonText("Cancel").onClick(()=>this.close()))}onClose(){let{contentEl:t}=this;t.empty()}},Ze=class extends g.Modal{constructor(t,e){super(t);this.allNotes=[];this.onSelect=e}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("kanban-note-link-modal"),t.createEl("h2",{text:"Link to Note"}),t.createEl("p",{text:"Search for an existing note to link to this card.",cls:"setting-item-description"}),this.searchInput=t.createEl("input",{type:"text",cls:"note-link-search",attr:{placeholder:"Search notes..."}}),this.searchInput.addEventListener("input",()=>this.updateResults()),this.resultsEl=t.createDiv({cls:"note-link-results"}),this.loadNotes(),this.searchInput.focus(),new g.Setting(t).addButton(e=>e.setButtonText("Cancel").onClick(()=>{this.onSelect(null),this.close()}))}loadNotes(){this.allNotes=this.app.vault.getMarkdownFiles().sort((t,e)=>e.stat.mtime-t.stat.mtime),this.updateResults()}updateResults(){this.resultsEl.empty();let t=this.searchInput.value.toLowerCase(),e=this.allNotes.filter(n=>n.basename.toLowerCase().includes(t)||n.path.toLowerCase().includes(t)).slice(0,20);if(e.length===0){this.resultsEl.createEl("p",{text:t?"No matching notes found":"Start typing to search notes",cls:"note-link-empty"});return}for(let n of e){let s=this.resultsEl.createDiv({cls:"note-link-item"});s.createEl("strong",{text:n.basename}),s.createEl("span",{text:n.path,cls:"note-link-path"}),s.addEventListener("click",()=>{this.onSelect(n.path),this.close()})}}onClose(){let{contentEl:t}=this;t.empty()}};var k=require("obsidian");var Se=class extends k.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h1",{text:"Kanban Settings"}),t.createEl("h2",{text:"Display"}),new k.Setting(t).setName("Default lane width").setDesc("Default width for lanes (e.g., 272px, 300px, 20rem)").addText(l=>l.setPlaceholder("272px").setValue(this.plugin.settings["default-lane-width"]).onChange(async d=>{this.plugin.settings["default-lane-width"]=d||tt["default-lane-width"],await this.plugin.saveSettings()})),new k.Setting(t).setName("Show checkboxes").setDesc("Show completion checkboxes on cards").addToggle(l=>l.setValue(this.plugin.settings["show-checkboxes"]).onChange(async d=>{this.plugin.settings["show-checkboxes"]=d,await this.plugin.saveSettings()})),new k.Setting(t).setName("Show card menu").setDesc("Show the menu button on cards").addToggle(l=>l.setValue(this.plugin.settings["show-card-menu"]).onChange(async d=>{this.plugin.settings["show-card-menu"]=d,await this.plugin.saveSettings()})),new k.Setting(t).setName("Hide tags in card titles").setDesc("Hide #tags from displaying inline in card titles (still shown as pills)").addToggle(l=>l.setValue(this.plugin.settings["hide-tags-in-title"]).onChange(async d=>{this.plugin.settings["hide-tags-in-title"]=d,await this.plugin.saveSettings()})),new k.Setting(t).setName("Hide dates in card titles").setDesc("Hide @dates from displaying inline in card titles (still shown as pills)").addToggle(l=>l.setValue(this.plugin.settings["hide-date-in-title"]).onChange(async d=>{this.plugin.settings["hide-date-in-title"]=d,await this.plugin.saveSettings()})),new k.Setting(t).setName("Hide metadata in card titles").setDesc("Hide [key::value] metadata from displaying inline (still shown as pills)").addToggle(l=>l.setValue(this.plugin.settings["hide-metadata-in-title"]).onChange(async d=>{this.plugin.settings["hide-metadata-in-title"]=d,await this.plugin.saveSettings()})),t.createEl("h2",{text:"Metadata (Base Integration)"}),new k.Setting(t).setName("Show progress").setDesc("Display progress percentage on cards").addToggle(l=>l.setValue(this.plugin.settings["show-progress"]).onChange(async d=>{this.plugin.settings["show-progress"]=d,await this.plugin.saveSettings()})),new k.Setting(t).setName("Show project").setDesc("Display project name on cards").addToggle(l=>l.setValue(this.plugin.settings["show-project"]).onChange(async d=>{this.plugin.settings["show-project"]=d,await this.plugin.saveSettings()})),new k.Setting(t).setName("Default project").setDesc("Default project name for new cards (leave empty for none)").addText(l=>l.setPlaceholder("").setValue(this.plugin.settings["default-project"]).onChange(async d=>{this.plugin.settings["default-project"]=d,await this.plugin.saveSettings()})),t.createEl("h2",{text:"Cards"}),new k.Setting(t).setName("New card insertion method").setDesc("Where to insert new cards in a lane").addDropdown(l=>l.addOption("prepend","At the top").addOption("append","At the bottom").setValue(this.plugin.settings["new-card-insertion-method"]).onChange(async d=>{this.plugin.settings["new-card-insertion-method"]=d,await this.plugin.saveSettings()})),new k.Setting(t).setName("Template path").setDesc("Path to a template file for creating new cards (e.g., templates/card-template.md)").addText(l=>l.setPlaceholder("templates/card-template.md").setValue(this.plugin.settings["template-path"]).onChange(async d=>{this.plugin.settings["template-path"]=d,await this.plugin.saveSettings()})),t.createEl("h2",{text:"Card Composer"}),new k.Setting(t).setName("Show card composer").setDesc("Show quick-add composer in lanes for rapid card creation").addToggle(l=>l.setValue(this.plugin.settings["show-card-composer"]).onChange(async d=>{this.plugin.settings["show-card-composer"]=d,await this.plugin.saveSettings()})),new k.Setting(t).setName("Composer position").setDesc("Where to show the quick-add composer in lanes").addDropdown(l=>l.addOption("bottom","Bottom of lane").addOption("top","Top of lane").setValue(this.plugin.settings["composer-position"]).onChange(async d=>{this.plugin.settings["composer-position"]=d,await this.plugin.saveSettings()})),new k.Setting(t).setName("Show subtasks").setDesc("Display subtask checkboxes in card view").addToggle(l=>l.setValue(this.plugin.settings["show-subtasks"]).onChange(async d=>{this.plugin.settings["show-subtasks"]=d,await this.plugin.saveSettings()})),t.createEl("h2",{text:"Filtering"}),new k.Setting(t).setName("Show filter toolbar").setDesc("Display filter toolbar at the top of boards for searching and filtering cards").addToggle(l=>l.setValue(this.plugin.settings["show-filter-toolbar"]).onChange(async d=>{this.plugin.settings["show-filter-toolbar"]=d,await this.plugin.saveSettings()})),t.createEl("h2",{text:"WIP Limits"}),t.createEl("p",{text:"Work In Progress limits help manage workflow by limiting cards per lane. Configure per-lane limits in board settings.",cls:"setting-item-description"}),new k.Setting(t).setName("Default WIP limit").setDesc("Default maximum cards per lane (0 = no limit). Can be overridden per-lane.").addText(l=>l.setPlaceholder("0").setValue(String(this.plugin.settings["default-wip-limit"])).onChange(async d=>{let u=parseInt(d,10);this.plugin.settings["default-wip-limit"]=isNaN(u)?0:Math.max(0,u),await this.plugin.saveSettings()})),new k.Setting(t).setName("Block when exceeded").setDesc("Prevent adding new cards when a lane exceeds its WIP limit").addToggle(l=>l.setValue(this.plugin.settings["wip-block-exceeded"]).onChange(async d=>{this.plugin.settings["wip-block-exceeded"]=d,await this.plugin.saveSettings()})),t.createEl("h2",{text:"Card Notes"});let e=t.createDiv({cls:"kanban-settings-info"});e.createEl("p",{text:"Available template variables:",cls:"setting-item-name"});let n=e.createEl("ul",{cls:"kanban-template-vars-list"}),s=["{{title}} - Card title","{{id}} - Unique card ID","{{date}} - Current date (YYYY-MM-DD)","{{time}} - Current time (HH:mm)","{{datetime}} - Full ISO datetime","{{dueDate}} - Card due date","{{project}} - Project name","{{priority}} - Priority level","{{tags}} - Card tags (comma-separated)","{{board}} - Board name","{{lane}} - Lane name","{{date:FORMAT}} - Custom date format (e.g., {{date:MMMM DD, YYYY}})","{{variable|default}} - Variable with default value"];for(let l of s)n.createEl("li",{text:l,cls:"kanban-template-var"});new k.Setting(t).setName("Card note template").setDesc("Template file for dedicated card notes").addText(l=>l.setPlaceholder("templates/card-note.md").setValue(this.plugin.settings["card-note-template"]).onChange(async d=>{this.plugin.settings["card-note-template"]=d,await this.plugin.saveSettings()})),new k.Setting(t).setName("Card note folder").setDesc("Default folder for dedicated card notes. Leave empty to use the same folder as the board.").addText(l=>l.setPlaceholder("cards/").setValue(this.plugin.settings["card-note-folder"]).onChange(async d=>{this.plugin.settings["card-note-folder"]=d,await this.plugin.saveSettings()})),new k.Setting(t).setName("Auto-create note for new cards").setDesc("Automatically create a dedicated note file when adding new cards").addToggle(l=>l.setValue(this.plugin.settings["auto-create-note"]).onChange(async d=>{this.plugin.settings["auto-create-note"]=d,await this.plugin.saveSettings()})),t.createEl("h2",{text:"Dates"}),new k.Setting(t).setName("Date format").setDesc("Format for displaying dates (YYYY-MM-DD, DD/MM/YYYY, etc.)").addText(l=>l.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings["date-format"]).onChange(async d=>{this.plugin.settings["date-format"]=d||tt["date-format"],await this.plugin.saveSettings()})),new k.Setting(t).setName("Time format").setDesc("Format for displaying times (HH:mm, hh:mm A, etc.)").addText(l=>l.setPlaceholder("HH:mm").setValue(this.plugin.settings["time-format"]).onChange(async d=>{this.plugin.settings["time-format"]=d||tt["time-format"],await this.plugin.saveSettings()})),new k.Setting(t).setName("Date trigger").setDesc("Character to trigger date input (e.g., @)").addText(l=>l.setPlaceholder("@").setValue(this.plugin.settings["date-trigger"]).onChange(async d=>{this.plugin.settings["date-trigger"]=d||tt["date-trigger"],await this.plugin.saveSettings()})),new k.Setting(t).setName("Time trigger").setDesc("Character to trigger time input (e.g., @@)").addText(l=>l.setPlaceholder("@@").setValue(this.plugin.settings["time-trigger"]).onChange(async d=>{this.plugin.settings["time-trigger"]=d||tt["time-trigger"],await this.plugin.saveSettings()})),new k.Setting(t).setName("Link dates to daily notes").setDesc("Make dates clickable to open corresponding daily notes").addToggle(l=>l.setValue(this.plugin.settings["link-date-to-daily-note"]).onChange(async d=>{this.plugin.settings["link-date-to-daily-note"]=d,await this.plugin.saveSettings()})),new k.Setting(t).setName("Show relative dates").setDesc('Display dates as "Today", "Tomorrow", "In 3 days", etc.').addToggle(l=>l.setValue(this.plugin.settings["show-relative-date"]).onChange(async d=>{this.plugin.settings["show-relative-date"]=d,await this.plugin.saveSettings()})),t.createEl("h2",{text:"Natural Language Dates"}),new k.Setting(t).setName("Parse natural language dates").setDesc('Automatically convert phrases like "today", "tomorrow", "next Monday", "in 3 days" to dates').addToggle(l=>l.setValue(this.plugin.settings["parse-natural-dates"]).onChange(async d=>{this.plugin.settings["parse-natural-dates"]=d,await this.plugin.saveSettings()})),new k.Setting(t).setName("Parse recurrence patterns").setDesc('Recognize patterns like "daily", "every Monday", "weekly", "every 2 weeks"').addToggle(l=>l.setValue(this.plugin.settings["parse-recurrence"]).onChange(async d=>{this.plugin.settings["parse-recurrence"]=d,await this.plugin.saveSettings()})),new k.Setting(t).setName("Date serialization format").setDesc("How dates are saved in markdown (ISO format recommended for compatibility)").addDropdown(l=>l.addOption("iso","ISO format (2024-01-15)").addOption("natural","Natural language (tomorrow)").setValue(this.plugin.settings["date-serialization-format"]).onChange(async d=>{this.plugin.settings["date-serialization-format"]=d,await this.plugin.saveSettings()})),t.createEl("h2",{text:"Reminders"}),new k.Setting(t).setName("Enable reminders").setDesc("Show notifications when cards are approaching their due dates").addToggle(l=>l.setValue(this.plugin.settings["enable-reminders"]).onChange(async d=>{this.plugin.settings["enable-reminders"]=d,await this.plugin.saveSettings(),this.plugin.restartReminders()})),new k.Setting(t).setName("Default reminder time").setDesc("How long before due date to show reminder (e.g., 30m, 1h, 2h, 1d)").addText(l=>l.setPlaceholder("1h").setValue(this.plugin.settings["reminder-time"]).onChange(async d=>{this.plugin.settings["reminder-time"]=d||tt["reminder-time"],await this.plugin.saveSettings()})),new k.Setting(t).setName("Reminder type").setDesc("How to show reminders").addDropdown(l=>l.addOption("notice","Obsidian notice (in-app)").addOption("system","System notification (desktop)").setValue(this.plugin.settings["reminder-type"]).onChange(async d=>{this.plugin.settings["reminder-type"]=d,await this.plugin.saveSettings()})),t.createEl("h2",{text:"Archive"}),new k.Setting(t).setName("Prepend archive date").setDesc("Add the archive date to the beginning of archived card titles").addToggle(l=>l.setValue(this.plugin.settings["prepend-archive-date"]).onChange(async d=>{this.plugin.settings["prepend-archive-date"]=d,await this.plugin.saveSettings()})),new k.Setting(t).setName("Archive date format").setDesc("Format for prepended archive dates").addText(l=>l.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings["prepend-archive-format"]).onChange(async d=>{this.plugin.settings["prepend-archive-format"]=d||tt["prepend-archive-format"],await this.plugin.saveSettings()})),t.createEl("h2",{text:"Base Task Sync"});let r=this.plugin.settings["base-sync"];if(new k.Setting(t).setName("Enable Base sync").setDesc("Sync cards with Base task files. When enabled, moving cards updates task status fields.").addToggle(l=>l.setValue(r.enabled).onChange(async d=>{this.plugin.settings["base-sync"].enabled=d,await this.plugin.saveSettings(),this.display()})),r.enabled){new k.Setting(t).setName("Tasks folder").setDesc("Folder containing Base task files").addText(d=>d.setPlaceholder("Tasks").setValue(r.tasksFolder).onChange(async u=>{this.plugin.settings["base-sync"].tasksFolder=u||"Tasks",await this.plugin.saveSettings()})),new k.Setting(t).setName("Task query").setDesc('Filter tasks to sync (e.g., "project:MyProject", "status:todo", "tag:work")').addText(d=>d.setPlaceholder("Leave empty for all tasks").setValue(r.query).onChange(async u=>{this.plugin.settings["base-sync"].query=u,await this.plugin.saveSettings()})),new k.Setting(t).setName("Status field").setDesc("Frontmatter field name for task status").addText(d=>d.setPlaceholder("status").setValue(r.statusField).onChange(async u=>{this.plugin.settings["base-sync"].statusField=u||"status",await this.plugin.saveSettings()})),new k.Setting(t).setName("Progress field").setDesc("Frontmatter field name for task progress").addText(d=>d.setPlaceholder("progress").setValue(r.progressField).onChange(async u=>{this.plugin.settings["base-sync"].progressField=u||"progress",await this.plugin.saveSettings()})),new k.Setting(t).setName("Project field").setDesc("Frontmatter field name for task project").addText(d=>d.setPlaceholder("project").setValue(r.projectField).onChange(async u=>{this.plugin.settings["base-sync"].projectField=u||"project",await this.plugin.saveSettings()})),new k.Setting(t).setName("Conflict resolution").setDesc("How to handle conflicts between local cards and remote tasks").addDropdown(d=>d.addOption("local","Keep local (card) values").addOption("remote","Use remote (Base) values").addOption("last-write","Last write wins (most recent modification)").addOption("prompt","Ask me each time").setValue(r.conflictResolution).onChange(async u=>{this.plugin.settings["base-sync"].conflictResolution=u,await this.plugin.saveSettings()})),new k.Setting(t).setName("Auto-sync interval").setDesc("Minutes between auto-syncs (0 = manual only)").addText(d=>d.setPlaceholder("0").setValue(r.syncInterval.toString()).onChange(async u=>{let h=parseInt(u,10);this.plugin.settings["base-sync"].syncInterval=isNaN(h)?0:Math.max(0,h),await this.plugin.saveSettings()})),new k.Setting(t).setName("Create missing tasks").setDesc("Automatically create Base task files for cards without a linked task").addToggle(d=>d.setValue(r.createMissingTasks).onChange(async u=>{this.plugin.settings["base-sync"].createMissingTasks=u,await this.plugin.saveSettings()})),t.createEl("h3",{text:"Lane \u2192 Status Mapping"}),t.createEl("p",{text:"Map lane titles to Base status values. When a card moves to a lane, its status will be updated.",cls:"setting-item-description"});let l=t.createDiv({cls:"kanban-lane-mapping"});for(let[d,u]of Object.entries(r.laneMapping))this.createMappingRow(l,d,u);new k.Setting(t).setName("Add mapping").setDesc("Add a new lane \u2192 status mapping").addButton(d=>d.setButtonText("+ Add mapping").onClick(()=>{this.createMappingRow(l,"","")}))}t.createEl("h2",{text:"GPT Task Manager Integration"});let o=this.plugin.settings["gpt-task-manager"];t.createEl("p",{text:"Integrate with GPT Task Manager plugin to view and manage tasks in Kanban format. When enabled, tasks created by GPT Task Manager can be displayed as Kanban cards.",cls:"setting-item-description"}),new k.Setting(t).setName("Enable GPT Task Manager integration").setDesc("Sync cards with GPT Task Manager task files. Moving cards will update task status.").addToggle(l=>l.setValue(o.enabled).onChange(async d=>{if(this.plugin.settings["gpt-task-manager"].enabled=d,d){let u=this.plugin.settings["base-sync"];u.enabled=!0,u.tasksFolder=o.tasksFolder,u.statusField=o.statusField,u.projectField=o.projectField,u.laneMapping={...pe}}await this.plugin.saveSettings(),this.display()})),o.enabled&&(new k.Setting(t).setName("Tasks folder").setDesc("Folder containing GPT Task Manager task files").addText(l=>l.setPlaceholder("500 Plan & Reflect/520 Tasks").setValue(o.tasksFolder).onChange(async d=>{this.plugin.settings["gpt-task-manager"].tasksFolder=d||Nt.tasksFolder,this.plugin.settings["base-sync"].tasksFolder=d||Nt.tasksFolder,await this.plugin.saveSettings()})),new k.Setting(t).setName("Epics folder").setDesc("Folder containing GPT Task Manager epic files").addText(l=>l.setPlaceholder("500 Plan & Reflect/510 Epics").setValue(o.epicsFolder).onChange(async d=>{this.plugin.settings["gpt-task-manager"].epicsFolder=d||Nt.epicsFolder,await this.plugin.saveSettings()})),new k.Setting(t).setName("Projects folder").setDesc("Folder containing GPT Task Manager project files").addText(l=>l.setPlaceholder("400 Projects").setValue(o.projectsFolder).onChange(async d=>{this.plugin.settings["gpt-task-manager"].projectsFolder=d||Nt.projectsFolder,await this.plugin.saveSettings()})),new k.Setting(t).setName("Status field").setDesc("Frontmatter field name for task status (case-sensitive)").addText(l=>l.setPlaceholder("Status").setValue(o.statusField).onChange(async d=>{this.plugin.settings["gpt-task-manager"].statusField=d||"Status",this.plugin.settings["base-sync"].statusField=d||"Status",await this.plugin.saveSettings()})),new k.Setting(t).setName("Update status on card move").setDesc("Automatically update task status when a card is moved between lanes").addToggle(l=>l.setValue(o.updateStatusOnMove).onChange(async d=>{this.plugin.settings["gpt-task-manager"].updateStatusOnMove=d,await this.plugin.saveSettings()})),new k.Setting(t).setName("Sync checklist items").setDesc("Display the task's ## \u{1F504} Sync checklist item as the card title").addToggle(l=>l.setValue(o.syncChecklistToBoard).onChange(async d=>{this.plugin.settings["gpt-task-manager"].syncChecklistToBoard=d,await this.plugin.saveSettings()})),t.createEl("h3",{text:"Status Values"}),t.createEl("p",{text:"Configure the status values used by GPT Task Manager. These should match the Status field values in your task files.",cls:"setting-item-description"}),new k.Setting(t).setName("Backlog status value").setDesc("Status value for tasks in the Backlog lane").addText(l=>l.setPlaceholder("backlog").setValue(o.statusValues.backlog).onChange(async d=>{this.plugin.settings["gpt-task-manager"].statusValues.backlog=d||"backlog",await this.plugin.saveSettings()})),new k.Setting(t).setName("To Do status value").setDesc("Status value for tasks in the To Do lane").addText(l=>l.setPlaceholder("todo").setValue(o.statusValues.todo).onChange(async d=>{this.plugin.settings["gpt-task-manager"].statusValues.todo=d||"todo",await this.plugin.saveSettings()})),new k.Setting(t).setName("In Progress status value").setDesc("Status value for tasks in the In Progress lane").addText(l=>l.setPlaceholder("in-progress").setValue(o.statusValues.inProgress).onChange(async d=>{this.plugin.settings["gpt-task-manager"].statusValues.inProgress=d||"in-progress",await this.plugin.saveSettings()})),new k.Setting(t).setName("Done status value").setDesc("Status value for tasks in the Done lane").addText(l=>l.setPlaceholder("done").setValue(o.statusValues.done).onChange(async d=>{this.plugin.settings["gpt-task-manager"].statusValues.done=d||"done",await this.plugin.saveSettings()}))),t.createEl("h2",{text:"About"});let c=t.createDiv({cls:"kanban-settings-about"});c.createEl("p",{text:"Base Kanban is a markdown-backed Kanban board plugin with support for Obsidian Base task metadata."}),c.createEl("p",{text:"Per-board settings can override these global settings. Access board settings from the board menu (three dots in the header) or via the command palette."}),c.createEl("p",{text:"GPT Task Manager integration allows viewing tasks created by GPT Task Manager in Kanban format. Use the command palette to create boards from Epics or Projects."})}createMappingRow(t,e,n){let s=t.createDiv({cls:"kanban-mapping-row"}),r=s.createEl("input",{type:"text",cls:"kanban-mapping-lane",attr:{placeholder:"Lane title"}});r.value=e,s.createSpan({text:"\u2192",cls:"kanban-mapping-arrow"});let o=s.createEl("input",{type:"text",cls:"kanban-mapping-status",attr:{placeholder:"Status value"}});o.value=n;let c=s.createEl("button",{cls:"kanban-mapping-delete"});c.textContent="\xD7";let l=async()=>{let d=r.value.trim(),u=o.value.trim();e&&e!==d&&delete this.plugin.settings["base-sync"].laneMapping[e],d&&u&&(this.plugin.settings["base-sync"].laneMapping[d]=u),await this.plugin.saveSettings()};r.addEventListener("change",l),o.addEventListener("change",l),c.addEventListener("click",async()=>{let d=r.value.trim();d&&this.plugin.settings["base-sync"].laneMapping[d]&&(delete this.plugin.settings["base-sync"].laneMapping[d],await this.plugin.saveSettings()),s.remove()})}};var ot=require("obsidian");function Ba(i){let a={},t=i.match(/^---\s*\n([\s\S]*?)\n---/);if(!t)return a;let n=t[1].split(`
`);for(let s of n){let r=s.match(/^(\w+):\s*(.+)$/);if(r){let o=r[1],c=r[2].trim();switch(c=c.replace(/^["']|["']$/g,""),c=c.replace(/^\[\[|\]\]$/g,""),o.toLowerCase()){case"type":a.type=c;break;case"area":a.area=c;break;case"goal":a.goal=c;break;case"project":a.project=c;break;case"epic":a.epic=c;break;case"status":a.status=c;break;case"priority":a.priority=c;break;case"due":a.due=c;break;case"created":a.created=c;break;case"updated":a.updated=c;break;case"parent":a.parent=c;break;case"description":a.description=c;break;case"tags":c.startsWith("[")&&(a.tags=c.replace(/[\[\]]/g,"").split(",").map(l=>l.trim()));break}}if(s.trim().startsWith("- ")&&a.tags===void 0){let o=s.trim().replace(/^-\s*/,"");a.tags||(a.tags=[]),a.tags.push(o)}}return a}function Oa(i){let a=i.match(/##  Sync\s*\n([\s\S]*?)(?=\n## |$)/);if(!a)return null;let e=a[1].match(/-\s*\[([ xX])\]\s*(.+)/);return e?{completed:e[1].toLowerCase()==="x",text:e[2].trim()}:null}async function $a(i,a){try{let t=await i.vault.read(a),e=Ba(t);if(!e.type||!e.type.includes("Tasks"))return null;let n=Oa(t),s=(n==null?void 0:n.text)||a.basename;return{file:a,title:s,metadata:e,syncChecklistItem:n==null?void 0:n.text,completed:(n==null?void 0:n.completed)||!1,content:t}}catch(t){return console.error(`Failed to parse GPT task file: ${a.path}`,t),null}}async function zt(i,a,t){let e=[],n=i.vault.getAbstractFileByPath(a.tasksFolder);if(!(n instanceof ot.TFolder))return console.warn(`GPT Task Manager tasks folder not found: ${a.tasksFolder}`),e;let s=o=>{let c=[];for(let l of o.children)l instanceof ot.TFile&&l.extension==="md"?c.push(l):l instanceof ot.TFolder&&c.push(...s(l));return c},r=s(n);for(let o of r){let c=await $a(i,o);c&&(t&&(t.epic&&c.metadata.epic!==t.epic||t.project&&c.metadata.project!==t.project||t.status&&t.status.length>0&&c.metadata.status&&!t.status.includes(c.metadata.status)||!t.includeCompleted&&c.completed)||e.push(c))}return e}function Ka(i,a){if(!i)return"Backlog";let t=i.toLowerCase(),{statusValues:e}=a;return t===e.backlog?"Backlog":t===e.todo?"To Do":t===e.inProgress?"In Progress":t===e.done?"Done":"Backlog"}function Yn(i,a){let t=i.toLowerCase(),{statusValues:e}=a;return t==="backlog"||t.includes("backlog")?e.backlog:t==="to do"||t==="todo"||t.includes("todo")?e.todo:t==="in progress"||t.includes("progress")||t.includes("doing")?e.inProgress:t==="done"||t.includes("done")||t.includes("complete")?e.done:e.backlog}function ja(i){return{id:(()=>Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4))(),title:i.title,completed:i.completed,tags:i.metadata.tags||[],dueDate:i.metadata.due,metadata:{project:i.metadata.project,priority:i.metadata.priority,status:i.metadata.status},baseTaskPath:i.file.path,baseSyncTime:Date.now()}}function It(i,a,t){let e=()=>Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4),n=[{id:e(),title:"Backlog",cards:[]},{id:e(),title:"To Do",cards:[]},{id:e(),title:"In Progress",cards:[]},{id:e(),title:"Done",cards:[]}];for(let r of i){let o=ja(r),c=Ka(r.metadata.status,a),l=n.find(d=>d.title===c);l?l.cards.push(o):n[0].cards.push(o)}let s={critical:0,high:1,medium:2,low:3};for(let r of n)r.cards.sort((o,c)=>{var u,h;let l=(u=s[o.metadata.priority||"medium"])!=null?u:2,d=(h=s[c.metadata.priority||"medium"])!=null?h:2;return l-d});return{lanes:n,archive:[],settings:{"lane-width":"300px","show-checkboxes":!0,"show-progress":!0,"show-project":!0,"base-sync":{enabled:!0,tasksFolder:a.tasksFolder,query:"",statusField:a.statusField,progressField:"progress",projectField:a.projectField,laneMapping:{...pe},conflictResolution:"prompt",syncInterval:0,createMissingTasks:!1,archiveCompletedTasks:!1}},_frontmatter:`---
kanban-plugin: basic
title: ${t||"Task Board"}
---

`}}async function tn(i,a,t,e){try{let n=i.vault.getAbstractFileByPath(a);if(!(n instanceof ot.TFile))return console.warn(`Task file not found: ${a}`),!1;let s=await i.vault.read(n),r=new RegExp(`^(${e.statusField}:)\\s*.+$`,"mi");if(r.test(s))s=s.replace(r,`$1 ${t}`);else{let d=s.match(/^---\s*\n([\s\S]*?)\n---/);if(d){let h=d[1]+`
${e.statusField}: ${t}`;s=s.replace(d[1],h)}}let o=/^(Updated:)\s*.+$/mi,c=new Date,l=`"${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")} ${String(c.getHours()).padStart(2,"0")}:${String(c.getMinutes()).padStart(2,"0")}"`;return o.test(s)&&(s=s.replace(o,`$1 ${l}`)),await i.vault.modify(n,s),!0}catch(n){return console.error(`Failed to update GPT task status: ${a}`,n),!1}}async function en(i,a){let t=[],e=i.vault.getAbstractFileByPath(a.epicsFolder);if(!(e instanceof ot.TFolder))return t;for(let n of e.children)n instanceof ot.TFile&&n.extension==="md"&&t.push(n.basename);return t.sort()}async function nn(i,a){let t=[],e=i.vault.getAbstractFileByPath(a.projectsFolder);if(!(e instanceof ot.TFolder))return t;let n=s=>{let r=[];for(let o of s.children)o instanceof ot.TFolder?(r.push(o.name),r.push(...n(o))):o instanceof ot.TFile&&o.extension==="md"&&r.push(o.basename);return r};return n(e).sort()}function kt(i){return i.enabled&&!!i.tasksFolder}var Te=class extends E.Plugin{constructor(){super(...arguments);this.kanbanFileModes={};this.reminderIntervalId=null;this.notifiedCards=new Set;this.cardMoveCallbacks=new Set}async onload(){var t,e;await this.loadSettings(),this.initializePublicAPI(),this.registerView(U,n=>new nt(n,this)),this.registerExtensions(["kanban"],U),this.settingsTab=new Se(this.app,this),this.addSettingTab(this.settingsTab),this.addRibbonIcon("columns","Create new Kanban board",()=>{this.createNewKanban()}),this.registerCommands(),this.registerFileMenu(),this.registerMonkeyPatch(),(e=(t=this.app.workspace).registerHoverLinkSource)==null||e.call(t,et,{display:"Kanban",defaultMod:!0}),this.settings["enable-reminders"]&&this.startReminderCheck(),this.registerEvent(this.app.vault.on("rename",(n,s)=>{this.kanbanFileModes[s]&&(this.kanbanFileModes[n.path]=this.kanbanFileModes[s],delete this.kanbanFileModes[s])})),this.registerEvent(this.app.vault.on("delete",n=>{this.kanbanFileModes[n.path]&&delete this.kanbanFileModes[n.path]}))}onunload(){var t,e;(e=(t=this.app.workspace).unregisterHoverLinkSource)==null||e.call(t,et),this.stopReminderCheck()}async loadSettings(){this.settings=Object.assign({},tt,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}initializePublicAPI(){let t=this;this.api={isReady(){return!0},getGptConfig(){return t.settings["gpt-task-manager"]},async queryTasks(e){let n=t.settings["gpt-task-manager"];return kt(n)?zt(t.app,n,e):[]},createBoardFromTasks(e,n){let s=t.settings["gpt-task-manager"];return It(e,s,n)},async createAndOpenBoard(e,n){let s=t.settings["gpt-task-manager"],r=It(e,s,n);return await t.createBoardFile(r,n)},async getEpics(){let e=t.settings["gpt-task-manager"];return kt(e)?en(t.app,e):[]},async getProjects(){let e=t.settings["gpt-task-manager"];return kt(e)?nn(t.app,e):[]},async updateTaskStatus(e,n){let s=t.settings["gpt-task-manager"];return tn(t.app,e,n,s)},onCardMove(e){return t.cardMoveCallbacks.add(e),()=>{t.cardMoveCallbacks.delete(e)}},async openInKanbanView(e){t.kanbanFileModes[e.path]=U,await t.app.workspace.getLeaf(!1).setViewState({type:U,state:{file:e.path}})}}}notifyCardMove(t,e,n){for(let s of this.cardMoveCallbacks)try{s(t,e,n)}catch(r){console.error("Error in card move callback:",r)}}registerCommands(){this.addCommand({id:"create-new-kanban-board",name:"Create new board",callback:()=>this.createNewKanban()}),this.addCommand({id:"toggle-kanban-view",name:"Toggle between Kanban and markdown mode",checkCallback:t=>{var o;let e=this.app.workspace.getActiveFile();if(!e)return!1;let n=this.app.metadataCache.getFileCache(e),s=(o=n==null?void 0:n.frontmatter)==null?void 0:o[et];if(t)return!!s;let r=this.app.workspace.getActiveViewOfType(nt);if(r)this.kanbanFileModes[e.path]="markdown",this.setMarkdownView(r.leaf);else{let c=this.app.workspace.getActiveViewOfType(E.MarkdownView);c&&(this.kanbanFileModes[e.path]=U,this.setKanbanView(c.leaf))}}}),this.addCommand({id:"archive-completed-cards",name:"Archive completed cards in active board",checkCallback:t=>{let e=this.app.workspace.getActiveViewOfType(nt);if(!e)return!1;if(t)return!0;e.archiveCompletedCards()}}),this.addCommand({id:"convert-to-kanban",name:"Convert empty note to Kanban",checkCallback:t=>{var s;let e=this.app.workspace.getActiveViewOfType(E.MarkdownView);if(!e)return!1;let n=((s=e.file)==null?void 0:s.stat.size)===0;if(t)return!!n;n&&e.file&&this.app.vault.modify(e.file,ye).then(()=>{this.setKanbanView(e.leaf)}).catch(r=>console.error("Error converting to kanban:",r))}}),this.addCommand({id:"add-kanban-lane",name:"Add a list",checkCallback:t=>{let e=this.app.workspace.getActiveViewOfType(nt);if(!e)return!1;if(t)return!0;e.addLane()}}),this.addCommand({id:"open-board-settings",name:"Open board settings",checkCallback:t=>{var n;let e=this.app.workspace.getActiveViewOfType(nt);if(!e)return!1;if(t)return!0;(n=e.openBoardSettings)==null||n.call(e)}}),this.addCommand({id:"create-or-open-card-note",name:"Create or open card note",checkCallback:t=>{let e=this.app.workspace.getActiveViewOfType(nt);if(!e)return!1;if(t)return!0;e.createOrOpenCardNote()}}),this.addCommand({id:"sync-with-base",name:"Sync with Base",checkCallback:t=>{let e=this.app.workspace.getActiveViewOfType(nt);if(!e)return!1;if(!this.settings["base-sync"].enabled)return t||new E.Notice("Base sync is not enabled. Enable it in plugin settings first."),!1;if(t)return!0;e.manualSync()}}),this.addCommand({id:"gpt-create-board-from-epic",name:"GPT: Create Kanban board from Epic",callback:async()=>{let t=this.settings["gpt-task-manager"];if(!kt(t)){new E.Notice("GPT Task Manager integration is not enabled. Enable it in plugin settings.");return}let e=await en(this.app,t);if(e.length===0){new E.Notice(`No epics found in ${t.epicsFolder}`);return}new an(this.app,e,async n=>{await this.createGptBoardFromEpic(n)}).open()}}),this.addCommand({id:"gpt-create-board-from-project",name:"GPT: Create Kanban board from Project",callback:async()=>{let t=this.settings["gpt-task-manager"];if(!kt(t)){new E.Notice("GPT Task Manager integration is not enabled. Enable it in plugin settings.");return}let e=await nn(this.app,t);if(e.length===0){new E.Notice(`No projects found in ${t.projectsFolder}`);return}new sn(this.app,e,async n=>{await this.createGptBoardFromProject(n)}).open()}}),this.addCommand({id:"gpt-create-board-all-tasks",name:"GPT: Create Kanban board from all tasks",callback:async()=>{let t=this.settings["gpt-task-manager"];if(!kt(t)){new E.Notice("GPT Task Manager integration is not enabled. Enable it in plugin settings.");return}await this.createGptBoardFromAllTasks()}}),this.addCommand({id:"gpt-refresh-board",name:"GPT: Refresh board with latest tasks",checkCallback:t=>{let e=this.app.workspace.getActiveViewOfType(nt);if(!e)return!1;let n=this.settings["gpt-task-manager"];if(!kt(n))return!1;if(t)return!0;e.manualSync(),new E.Notice("Board refreshed with latest GPT tasks")}})}registerFileMenu(){this.registerEvent(this.app.workspace.on("file-menu",(t,e,n,s)=>{var r;if(n!=="link-context-menu"){if(e instanceof E.TFolder){t.addItem(o=>{o.setSection("action-primary").setTitle("New kanban board").setIcon("columns").onClick(()=>this.createNewKanban(e))});return}if(e instanceof E.TFile&&s){let o=s.view instanceof E.MarkdownView,c=s.view instanceof nt,l=this.app.metadataCache.getFileCache(e),d=(r=l==null?void 0:l.frontmatter)==null?void 0:r[et];o&&d&&t.addItem(u=>{u.setTitle("Open as kanban board").setIcon("columns").setSection("pane").onClick(()=>{this.kanbanFileModes[e.path]=U,this.setKanbanView(s)})}),c&&t.addItem(u=>{u.setTitle("Open as markdown").setIcon("file-text").setSection("pane").onClick(()=>{this.kanbanFileModes[e.path]="markdown",this.setMarkdownView(s)})})}}}))}registerMonkeyPatch(){let t=this;this.register(Ra(E.WorkspaceLeaf.prototype,{detach(e){return function(){var r;let n=(r=this.view)==null?void 0:r.getState(),s=n==null?void 0:n.file;return s&&t.kanbanFileModes[s]&&delete t.kanbanFileModes[s],e.apply(this)}},setViewState(e){return function(n,...s){var o,c;let r=(o=n.state)==null?void 0:o.file;if(n.type==="markdown"&&r&&t.kanbanFileModes[r]!=="markdown"){let l=t.app.metadataCache.getCache(r);if((c=l==null?void 0:l.frontmatter)!=null&&c[et]){let d={...n,type:U};return t.kanbanFileModes[r]=U,e.apply(this,[d,...s])}}return e.apply(this,[n,...s])}}}))}async setMarkdownView(t,e=!0){await t.setViewState({type:"markdown",state:t.view.getState(),popstate:!0},{focus:e})}async setKanbanView(t){await t.setViewState({type:U,state:t.view.getState(),popstate:!0})}async createNewKanban(t){var s;let e=t||this.app.fileManager.getNewFileParent(((s=this.app.workspace.getActiveFile())==null?void 0:s.path)||""),n=null;try{n=await this.app.fileManager.createNewMarkdownFile(e,"Untitled Kanban")}catch(r){console.warn("Primary file creation failed, using fallback:",r);try{let o=e.path?`${e.path}/`:"",c=`${o}Untitled Kanban.md`,l=1;for(;this.app.vault.getAbstractFileByPath(c);)c=`${o}Untitled Kanban ${l}.md`,l++;n=await this.app.vault.create(c,ye)}catch(o){console.error("Error creating kanban board:",o),new E.Notice("Error creating Kanban board");return}}if(!n){new E.Notice("Error creating Kanban board");return}try{await this.app.vault.modify(n,ye),await this.app.workspace.getLeaf().setViewState({type:U,state:{file:n.path}}),new E.Notice("Created new Kanban board")}catch(r){console.error("Error setting up kanban board:",r),new E.Notice("Error creating Kanban board")}}async createGptBoardFromEpic(t){let e=this.settings["gpt-task-manager"];new E.Notice(`Loading tasks for Epic: ${t}...`);let n=await zt(this.app,e,{epic:t,includeCompleted:!0});if(n.length===0){new E.Notice(`No tasks found for Epic: ${t}`);return}let s=It(n,e,`${t} Board`);await this.createBoardFile(s,`${t} Board`),new E.Notice(`Created Kanban board with ${n.length} tasks from Epic: ${t}`)}async createGptBoardFromProject(t){let e=this.settings["gpt-task-manager"];new E.Notice(`Loading tasks for Project: ${t}...`);let n=await zt(this.app,e,{project:t,includeCompleted:!0});if(n.length===0){new E.Notice(`No tasks found for Project: ${t}`);return}let s=It(n,e,`${t} Board`);await this.createBoardFile(s,`${t} Board`),new E.Notice(`Created Kanban board with ${n.length} tasks from Project: ${t}`)}async createGptBoardFromAllTasks(){let t=this.settings["gpt-task-manager"];new E.Notice("Loading all GPT tasks...");let e=await zt(this.app,t,{includeCompleted:!1});if(e.length===0){new E.Notice("No active tasks found");return}let n=It(e,t,"All Tasks Board");await this.createBoardFile(n,"All Tasks Board"),new E.Notice(`Created Kanban board with ${e.length} active tasks`)}async createBoardFile(t,e){var d;let n=this.app.fileManager.getNewFileParent(((d=this.app.workspace.getActiveFile())==null?void 0:d.path)||""),s=n.path?`${n.path}/`:"",r=`${s}${e}.md`,o=1;for(;this.app.vault.getAbstractFileByPath(r);)r=`${s}${e} ${o}.md`,o++;let c=me(t),l=await this.app.vault.create(r,c);return await this.app.workspace.getLeaf().setViewState({type:U,state:{file:l.path}}),l}async onCardMovedToLane(t,e,n){let s=this.settings["gpt-task-manager"];if(this.notifyCardMove(t,n||"",e),!s.enabled||!s.updateStatusOnMove||!t.baseTaskPath)return;let r=Yn(e,s);await tn(this.app,t.baseTaskPath,r,s)&&new E.Notice(`Updated task status to: ${r}`)}startReminderCheck(){this.reminderIntervalId===null&&(this.reminderIntervalId=window.setInterval(()=>{this.checkReminders()},60*1e3),this.checkReminders())}stopReminderCheck(){this.reminderIntervalId!==null&&(window.clearInterval(this.reminderIntervalId),this.reminderIntervalId=null)}async checkReminders(){if(!this.settings["enable-reminders"])return;let t=new Date,e=this.app.vault.getMarkdownFiles().filter(n=>{var r;let s=this.app.metadataCache.getFileCache(n);return(r=s==null?void 0:s.frontmatter)==null?void 0:r[et]});for(let n of e)try{let s=await this.app.vault.read(n),r=fe(s);for(let o of r.lanes)for(let c of o.cards)this.shouldRemind(c,t)&&this.showReminder(c,n.basename,o.title)}catch(s){}}shouldRemind(t,e){if(t.completed||!t.dueDate)return!1;let n=`${t.id}-${t.dueDate}`;if(this.notifiedCards.has(n))return!1;let s=this.parseDueDateTime(t);if(!s)return!1;let r=t.reminderTime||this.settings["reminder-time"]||"1h",o=this.parseReminderOffset(r),c=new Date(s.getTime()-o),l=e>=c&&e<=s;return l&&this.notifiedCards.add(n),l}parseDueDateTime(t){if(!t.dueDate)return null;try{let e=t.dueDate,n=t.dueTime||"09:00",[s,r,o]=e.split("-").map(Number),[c,l]=n.split(":").map(Number);return new Date(s,r-1,o,c,l)}catch(e){return null}}parseReminderOffset(t){let e=t.match(/^(\d+)\s*(m|min|h|hr|d|day)s?$/i);if(!e)return 60*60*1e3;let n=parseInt(e[1],10);switch(e[2].toLowerCase()){case"m":case"min":return n*60*1e3;case"h":case"hr":return n*60*60*1e3;case"d":case"day":return n*24*60*60*1e3;default:return 60*60*1e3}}showReminder(t,e,n){let s=t.title.replace(/\[\[([^\]|]+)(?:\|[^\]]+)?\]\]/g,"$1"),r=t.dueTime?`${t.dueDate} ${t.dueTime}`:t.dueDate,o=`\u{1F4CB} ${e} / ${n}
"${s}"
Due: ${r}`;this.settings["reminder-type"]==="system"&&"Notification"in window?Notification.permission==="granted"?new Notification("Kanban Reminder",{body:o,icon:"columns"}):Notification.permission!=="denied"?Notification.requestPermission().then(c=>{c==="granted"?new Notification("Kanban Reminder",{body:o}):new E.Notice(o,1e4)}):new E.Notice(o,1e4):new E.Notice(o,1e4)}clearNotificationHistory(){this.notifiedCards.clear()}restartReminders(){this.stopReminderCheck(),this.settings["enable-reminders"]&&(this.clearNotificationHistory(),this.startReminderCheck())}};function Ra(i,a){let t=[];for(let e in a){let n=i[e],s=a[e];if(s&&typeof n=="function"){let r=s(n);i[e]=r,t.push(()=>{i[e]=n})}}return()=>{for(let e of t)e()}}var an=class extends E.FuzzySuggestModal{constructor(t,e,n){super(t);this.epics=e,this.onChoose=n,this.setPlaceholder("Select an Epic to create a Kanban board from...")}getItems(){return this.epics}getItemText(t){return t}onChooseItem(t,e){this.onChoose(t)}},sn=class extends E.FuzzySuggestModal{constructor(t,e,n){super(t);this.projects=e,this.onChoose=n,this.setPlaceholder("Select a Project to create a Kanban board from...")}getItems(){return this.projects}getItemText(t){return t}onChooseItem(t,e){this.onChoose(t)}};
/*! Bundled license information:

sortablejs/modular/sortable.esm.js:
  (**!
   * Sortable 1.15.6
   * @author	RubaXa   <trash@rubaxa.org>
   * @author	owenm    <owen23355@gmail.com>
   * @license MIT
   *)
*/
