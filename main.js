/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Dt=Object.defineProperty;var Hn=Object.getOwnPropertyDescriptor;var qn=Object.getOwnPropertyNames;var Xn=Object.prototype.hasOwnProperty;var Un=(i,a)=>{for(var e in a)Dt(i,e,{get:a[e],enumerable:!0})},zn=(i,a,e,t)=>{if(a&&typeof a=="object"||typeof a=="function")for(let n of qn(a))!Xn.call(i,n)&&n!==e&&Dt(i,n,{get:()=>a[n],enumerable:!(t=Hn(a,n))||t.enumerable});return i};var Jn=i=>zn(Dt({},"__esModule",{value:!0}),i);var Va={};Un(Va,{default:()=>Tt});module.exports=Jn(Va);var E=require("obsidian");var g=require("obsidian");function an(i,a){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(i);a&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),e.push.apply(e,t)}return e}function ue(i){for(var a=1;a<arguments.length;a++){var e=arguments[a]!=null?arguments[a]:{};a%2?an(Object(e),!0).forEach(function(t){Qn(i,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):an(Object(e)).forEach(function(t){Object.defineProperty(i,t,Object.getOwnPropertyDescriptor(e,t))})}return i}function Ze(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ze=function(a){return typeof a}:Ze=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Ze(i)}function Qn(i,a,e){return a in i?Object.defineProperty(i,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[a]=e,i}function ge(){return ge=Object.assign||function(i){for(var a=1;a<arguments.length;a++){var e=arguments[a];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i[t]=e[t])}return i},ge.apply(this,arguments)}function Zn(i,a){if(i==null)return{};var e={},t=Object.keys(i),n,s;for(s=0;s<t.length;s++)n=t[s],!(a.indexOf(n)>=0)&&(e[n]=i[n]);return e}function ea(i,a){if(i==null)return{};var e=Zn(i,a),t,n;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);for(n=0;n<s.length;n++)t=s[n],!(a.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(i,t)&&(e[t]=i[t])}return e}var ta="1.15.6";function pe(i){if(typeof window!="undefined"&&window.navigator)return!!navigator.userAgent.match(i)}var fe=pe(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Ve=pe(/Edge/i),sn=pe(/firefox/i),Oe=pe(/safari/i)&&!pe(/chrome/i)&&!pe(/android/i),Kt=pe(/iP(ad|od|hone)/i),pn=pe(/chrome/i)&&pe(/android/i),gn={capture:!1,passive:!1};function F(i,a,e){i.addEventListener(a,e,!fe&&gn)}function M(i,a,e){i.removeEventListener(a,e,!fe&&gn)}function st(i,a){if(a){if(a[0]===">"&&(a=a.substring(1)),i)try{if(i.matches)return i.matches(a);if(i.msMatchesSelector)return i.msMatchesSelector(a);if(i.webkitMatchesSelector)return i.webkitMatchesSelector(a)}catch(e){return!1}return!1}}function fn(i){return i.host&&i!==document&&i.host.nodeType?i.host:i.parentNode}function ie(i,a,e,t){if(i){e=e||document;do{if(a!=null&&(a[0]===">"?i.parentNode===e&&st(i,a):st(i,a))||t&&i===e)return i;if(i===e)break}while(i=fn(i))}return null}var rn=/\s+/g;function U(i,a,e){if(i&&a)if(i.classList)i.classList[e?"add":"remove"](a);else{var t=(" "+i.className+" ").replace(rn," ").replace(" "+a+" "," ");i.className=(t+(e?" "+a:"")).replace(rn," ")}}function S(i,a,e){var t=i&&i.style;if(t){if(e===void 0)return document.defaultView&&document.defaultView.getComputedStyle?e=document.defaultView.getComputedStyle(i,""):i.currentStyle&&(e=i.currentStyle),a===void 0?e:e[a];!(a in t)&&a.indexOf("webkit")===-1&&(a="-webkit-"+a),t[a]=e+(typeof e=="string"?"":"px")}}function Fe(i,a){var e="";if(typeof i=="string")e=i;else do{var t=S(i,"transform");t&&t!=="none"&&(e=t+" "+e)}while(!a&&(i=i.parentNode));var n=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return n&&new n(e)}function mn(i,a,e){if(i){var t=i.getElementsByTagName(a),n=0,s=t.length;if(e)for(;n<s;n++)e(t[n],n);return t}return[]}function de(){var i=document.scrollingElement;return i||document.documentElement}function O(i,a,e,t,n){if(!(!i.getBoundingClientRect&&i!==window)){var s,r,o,c,l,d,u;if(i!==window&&i.parentNode&&i!==de()?(s=i.getBoundingClientRect(),r=s.top,o=s.left,c=s.bottom,l=s.right,d=s.height,u=s.width):(r=0,o=0,c=window.innerHeight,l=window.innerWidth,d=window.innerHeight,u=window.innerWidth),(a||e)&&i!==window&&(n=n||i.parentNode,!fe))do if(n&&n.getBoundingClientRect&&(S(n,"transform")!=="none"||e&&S(n,"position")!=="static")){var h=n.getBoundingClientRect();r-=h.top+parseInt(S(n,"border-top-width")),o-=h.left+parseInt(S(n,"border-left-width")),c=r+s.height,l=o+s.width;break}while(n=n.parentNode);if(t&&i!==window){var b=Fe(n||i),y=b&&b.a,p=b&&b.d;b&&(r/=p,o/=y,u/=y,d/=p,c=r+d,l=o+u)}return{top:r,left:o,bottom:c,right:l,width:u,height:d}}}function on(i,a,e){for(var t=we(i,!0),n=O(i)[a];t;){var s=O(t)[e],r=void 0;if(e==="top"||e==="left"?r=n>=s:r=n<=s,!r)return t;if(t===de())break;t=we(t,!1)}return!1}function Pe(i,a,e,t){for(var n=0,s=0,r=i.children;s<r.length;){if(r[s].style.display!=="none"&&r[s]!==C.ghost&&(t||r[s]!==C.dragged)&&ie(r[s],e.draggable,i,!1)){if(n===a)return r[s];n++}s++}return null}function jt(i,a){for(var e=i.lastElementChild;e&&(e===C.ghost||S(e,"display")==="none"||a&&!st(e,a));)e=e.previousElementSibling;return e||null}function Q(i,a){var e=0;if(!i||!i.parentNode)return-1;for(;i=i.previousElementSibling;)i.nodeName.toUpperCase()!=="TEMPLATE"&&i!==C.clone&&(!a||st(i,a))&&e++;return e}function ln(i){var a=0,e=0,t=de();if(i)do{var n=Fe(i),s=n.a,r=n.d;a+=i.scrollLeft*s,e+=i.scrollTop*r}while(i!==t&&(i=i.parentNode));return[a,e]}function na(i,a){for(var e in i)if(i.hasOwnProperty(e)){for(var t in a)if(a.hasOwnProperty(t)&&a[t]===i[e][t])return Number(e)}return-1}function we(i,a){if(!i||!i.getBoundingClientRect)return de();var e=i,t=!1;do if(e.clientWidth<e.scrollWidth||e.clientHeight<e.scrollHeight){var n=S(e);if(e.clientWidth<e.scrollWidth&&(n.overflowX=="auto"||n.overflowX=="scroll")||e.clientHeight<e.scrollHeight&&(n.overflowY=="auto"||n.overflowY=="scroll")){if(!e.getBoundingClientRect||e===document.body)return de();if(t||a)return e;t=!0}}while(e=e.parentNode);return de()}function aa(i,a){if(i&&a)for(var e in a)a.hasOwnProperty(e)&&(i[e]=a[e]);return i}function Et(i,a){return Math.round(i.top)===Math.round(a.top)&&Math.round(i.left)===Math.round(a.left)&&Math.round(i.height)===Math.round(a.height)&&Math.round(i.width)===Math.round(a.width)}var $e;function bn(i,a){return function(){if(!$e){var e=arguments,t=this;e.length===1?i.call(t,e[0]):i.apply(t,e),$e=setTimeout(function(){$e=void 0},a)}}}function sa(){clearTimeout($e),$e=void 0}function yn(i,a,e){i.scrollLeft+=a,i.scrollTop+=e}function vn(i){var a=window.Polymer,e=window.jQuery||window.Zepto;return a&&a.dom?a.dom(i).cloneNode(!0):e?e(i).clone(!0)[0]:i.cloneNode(!0)}function wn(i,a,e){var t={};return Array.from(i.children).forEach(function(n){var s,r,o,c;if(!(!ie(n,a.draggable,i,!1)||n.animated||n===e)){var l=O(n);t.left=Math.min((s=t.left)!==null&&s!==void 0?s:1/0,l.left),t.top=Math.min((r=t.top)!==null&&r!==void 0?r:1/0,l.top),t.right=Math.max((o=t.right)!==null&&o!==void 0?o:-1/0,l.right),t.bottom=Math.max((c=t.bottom)!==null&&c!==void 0?c:-1/0,l.bottom)}}),t.width=t.right-t.left,t.height=t.bottom-t.top,t.x=t.left,t.y=t.top,t}var X="Sortable"+new Date().getTime();function ia(){var i=[],a;return{captureAnimationState:function(){if(i=[],!!this.options.animation){var t=[].slice.call(this.el.children);t.forEach(function(n){if(!(S(n,"display")==="none"||n===C.ghost)){i.push({target:n,rect:O(n)});var s=ue({},i[i.length-1].rect);if(n.thisAnimationDuration){var r=Fe(n,!0);r&&(s.top-=r.f,s.left-=r.e)}n.fromRect=s}})}},addAnimationState:function(t){i.push(t)},removeAnimationState:function(t){i.splice(na(i,{target:t}),1)},animateAll:function(t){var n=this;if(!this.options.animation){clearTimeout(a),typeof t=="function"&&t();return}var s=!1,r=0;i.forEach(function(o){var c=0,l=o.target,d=l.fromRect,u=O(l),h=l.prevFromRect,b=l.prevToRect,y=o.rect,p=Fe(l,!0);p&&(u.top-=p.f,u.left-=p.e),l.toRect=u,l.thisAnimationDuration&&Et(h,u)&&!Et(d,u)&&(y.top-u.top)/(y.left-u.left)===(d.top-u.top)/(d.left-u.left)&&(c=oa(y,h,b,n.options)),Et(u,d)||(l.prevFromRect=d,l.prevToRect=u,c||(c=n.options.animation),n.animate(l,y,u,c)),c&&(s=!0,r=Math.max(r,c),clearTimeout(l.animationResetTimer),l.animationResetTimer=setTimeout(function(){l.animationTime=0,l.prevFromRect=null,l.fromRect=null,l.prevToRect=null,l.thisAnimationDuration=null},c),l.thisAnimationDuration=c)}),clearTimeout(a),s?a=setTimeout(function(){typeof t=="function"&&t()},r):typeof t=="function"&&t(),i=[]},animate:function(t,n,s,r){if(r){S(t,"transition",""),S(t,"transform","");var o=Fe(this.el),c=o&&o.a,l=o&&o.d,d=(n.left-s.left)/(c||1),u=(n.top-s.top)/(l||1);t.animatingX=!!d,t.animatingY=!!u,S(t,"transform","translate3d("+d+"px,"+u+"px,0)"),this.forRepaintDummy=ra(t),S(t,"transition","transform "+r+"ms"+(this.options.easing?" "+this.options.easing:"")),S(t,"transform","translate3d(0,0,0)"),typeof t.animated=="number"&&clearTimeout(t.animated),t.animated=setTimeout(function(){S(t,"transition",""),S(t,"transform",""),t.animated=!1,t.animatingX=!1,t.animatingY=!1},r)}}}}function ra(i){return i.offsetWidth}function oa(i,a,e,t){return Math.sqrt(Math.pow(a.top-i.top,2)+Math.pow(a.left-i.left,2))/Math.sqrt(Math.pow(a.top-e.top,2)+Math.pow(a.left-e.left,2))*t.animation}var De=[],xt={initializeByDefault:!0},Ye={mount:function(a){for(var e in xt)xt.hasOwnProperty(e)&&!(e in a)&&(a[e]=xt[e]);De.forEach(function(t){if(t.pluginName===a.pluginName)throw"Sortable: Cannot mount plugin ".concat(a.pluginName," more than once")}),De.push(a)},pluginEvent:function(a,e,t){var n=this;this.eventCanceled=!1,t.cancel=function(){n.eventCanceled=!0};var s=a+"Global";De.forEach(function(r){e[r.pluginName]&&(e[r.pluginName][s]&&e[r.pluginName][s](ue({sortable:e},t)),e.options[r.pluginName]&&e[r.pluginName][a]&&e[r.pluginName][a](ue({sortable:e},t)))})},initializePlugins:function(a,e,t,n){De.forEach(function(o){var c=o.pluginName;if(!(!a.options[c]&&!o.initializeByDefault)){var l=new o(a,e,a.options);l.sortable=a,l.options=a.options,a[c]=l,ge(t,l.defaults)}});for(var s in a.options)if(a.options.hasOwnProperty(s)){var r=this.modifyOption(a,s,a.options[s]);typeof r!="undefined"&&(a.options[s]=r)}},getEventProperties:function(a,e){var t={};return De.forEach(function(n){typeof n.eventProperties=="function"&&ge(t,n.eventProperties.call(e[n.pluginName],a))}),t},modifyOption:function(a,e,t){var n;return De.forEach(function(s){a[s.pluginName]&&s.optionListeners&&typeof s.optionListeners[e]=="function"&&(n=s.optionListeners[e].call(a[s.pluginName],t))}),n}};function la(i){var a=i.sortable,e=i.rootEl,t=i.name,n=i.targetEl,s=i.cloneEl,r=i.toEl,o=i.fromEl,c=i.oldIndex,l=i.newIndex,d=i.oldDraggableIndex,u=i.newDraggableIndex,h=i.originalEvent,b=i.putSortable,y=i.extraEventProperties;if(a=a||e&&e[X],!!a){var p,w=a.options,m="on"+t.charAt(0).toUpperCase()+t.substr(1);window.CustomEvent&&!fe&&!Ve?p=new CustomEvent(t,{bubbles:!0,cancelable:!0}):(p=document.createEvent("Event"),p.initEvent(t,!0,!0)),p.to=r||e,p.from=o||e,p.item=n||e,p.clone=s,p.oldIndex=c,p.newIndex=l,p.oldDraggableIndex=d,p.newDraggableIndex=u,p.originalEvent=h,p.pullMode=b?b.lastPutMode:void 0;var v=ue(ue({},y),Ye.getEventProperties(t,a));for(var x in v)p[x]=v[x];e&&e.dispatchEvent(p),w[m]&&w[m].call(a,p)}}var ca=["evt"],q=function(a,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=t.evt,s=ea(t,ca);Ye.pluginEvent.bind(C)(a,e,ue({dragEl:f,parentEl:_,ghostEl:T,rootEl:A,nextEl:Ce,lastDownEl:et,cloneEl:I,cloneHidden:ve,dragStarted:_e,putSortable:K,activeSortable:C.active,originalEvent:n,oldIndex:Me,oldDraggableIndex:Ke,newIndex:z,newDraggableIndex:ye,hideGhostForTarget:Tn,unhideGhostForTarget:Dn,cloneNowHidden:function(){ve=!0},cloneNowShown:function(){ve=!1},dispatchSortableEvent:function(o){V({sortable:e,name:o,originalEvent:n})}},s))};function V(i){la(ue({putSortable:K,cloneEl:I,targetEl:f,rootEl:A,oldIndex:Me,oldDraggableIndex:Ke,newIndex:z,newDraggableIndex:ye},i))}var f,_,T,A,Ce,et,I,ve,Me,z,Ke,ye,Ue,K,xe=!1,it=!1,rt=[],ke,se,Mt,Ft,cn,dn,_e,Ee,je,Re=!1,ze=!1,tt,j,Pt=[],Lt=!1,ot=[],ct=typeof document!="undefined",Je=Kt,un=Ve||fe?"cssFloat":"float",da=ct&&!pn&&!Kt&&"draggable"in document.createElement("div"),kn=function(){if(ct){if(fe)return!1;var i=document.createElement("x");return i.style.cssText="pointer-events:auto",i.style.pointerEvents==="auto"}}(),Sn=function(a,e){var t=S(a),n=parseInt(t.width)-parseInt(t.paddingLeft)-parseInt(t.paddingRight)-parseInt(t.borderLeftWidth)-parseInt(t.borderRightWidth),s=Pe(a,0,e),r=Pe(a,1,e),o=s&&S(s),c=r&&S(r),l=o&&parseInt(o.marginLeft)+parseInt(o.marginRight)+O(s).width,d=c&&parseInt(c.marginLeft)+parseInt(c.marginRight)+O(r).width;if(t.display==="flex")return t.flexDirection==="column"||t.flexDirection==="column-reverse"?"vertical":"horizontal";if(t.display==="grid")return t.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(s&&o.float&&o.float!=="none"){var u=o.float==="left"?"left":"right";return r&&(c.clear==="both"||c.clear===u)?"vertical":"horizontal"}return s&&(o.display==="block"||o.display==="flex"||o.display==="table"||o.display==="grid"||l>=n&&t[un]==="none"||r&&t[un]==="none"&&l+d>n)?"vertical":"horizontal"},ua=function(a,e,t){var n=t?a.left:a.top,s=t?a.right:a.bottom,r=t?a.width:a.height,o=t?e.left:e.top,c=t?e.right:e.bottom,l=t?e.width:e.height;return n===o||s===c||n+r/2===o+l/2},ha=function(a,e){var t;return rt.some(function(n){var s=n[X].options.emptyInsertThreshold;if(!(!s||jt(n))){var r=O(n),o=a>=r.left-s&&a<=r.right+s,c=e>=r.top-s&&e<=r.bottom+s;if(o&&c)return t=n}}),t},Cn=function(a){function e(s,r){return function(o,c,l,d){var u=o.options.group.name&&c.options.group.name&&o.options.group.name===c.options.group.name;if(s==null&&(r||u))return!0;if(s==null||s===!1)return!1;if(r&&s==="clone")return s;if(typeof s=="function")return e(s(o,c,l,d),r)(o,c,l,d);var h=(r?o:c).options.group.name;return s===!0||typeof s=="string"&&s===h||s.join&&s.indexOf(h)>-1}}var t={},n=a.group;(!n||Ze(n)!="object")&&(n={name:n}),t.name=n.name,t.checkPull=e(n.pull,!0),t.checkPut=e(n.put),t.revertClone=n.revertClone,a.group=t},Tn=function(){!kn&&T&&S(T,"display","none")},Dn=function(){!kn&&T&&S(T,"display","")};ct&&!pn&&document.addEventListener("click",function(i){if(it)return i.preventDefault(),i.stopPropagation&&i.stopPropagation(),i.stopImmediatePropagation&&i.stopImmediatePropagation(),it=!1,!1},!0);var Se=function(a){if(f){a=a.touches?a.touches[0]:a;var e=ha(a.clientX,a.clientY);if(e){var t={};for(var n in a)a.hasOwnProperty(n)&&(t[n]=a[n]);t.target=t.rootEl=e,t.preventDefault=void 0,t.stopPropagation=void 0,e[X]._onDragOver(t)}}},pa=function(a){f&&f.parentNode[X]._isOutsideThisEl(a.target)};function C(i,a){if(!(i&&i.nodeType&&i.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(i));this.el=i,this.options=a=ge({},a),i[X]=this;var e={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(i.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Sn(i,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(r,o){r.setData("Text",o.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:C.supportPointer!==!1&&"PointerEvent"in window&&(!Oe||Kt),emptyInsertThreshold:5};Ye.initializePlugins(this,i,e);for(var t in e)!(t in a)&&(a[t]=e[t]);Cn(a);for(var n in this)n.charAt(0)==="_"&&typeof this[n]=="function"&&(this[n]=this[n].bind(this));this.nativeDraggable=a.forceFallback?!1:da,this.nativeDraggable&&(this.options.touchStartThreshold=1),a.supportPointer?F(i,"pointerdown",this._onTapStart):(F(i,"mousedown",this._onTapStart),F(i,"touchstart",this._onTapStart)),this.nativeDraggable&&(F(i,"dragover",this),F(i,"dragenter",this)),rt.push(this.el),a.store&&a.store.get&&this.sort(a.store.get(this)||[]),ge(this,ia())}C.prototype={constructor:C,_isOutsideThisEl:function(a){!this.el.contains(a)&&a!==this.el&&(Ee=null)},_getDirection:function(a,e){return typeof this.options.direction=="function"?this.options.direction.call(this,a,e,f):this.options.direction},_onTapStart:function(a){if(a.cancelable){var e=this,t=this.el,n=this.options,s=n.preventOnFilter,r=a.type,o=a.touches&&a.touches[0]||a.pointerType&&a.pointerType==="touch"&&a,c=(o||a).target,l=a.target.shadowRoot&&(a.path&&a.path[0]||a.composedPath&&a.composedPath()[0])||c,d=n.filter;if(ka(t),!f&&!(/mousedown|pointerdown/.test(r)&&a.button!==0||n.disabled)&&!l.isContentEditable&&!(!this.nativeDraggable&&Oe&&c&&c.tagName.toUpperCase()==="SELECT")&&(c=ie(c,n.draggable,t,!1),!(c&&c.animated)&&et!==c)){if(Me=Q(c),Ke=Q(c,n.draggable),typeof d=="function"){if(d.call(this,a,c,this)){V({sortable:e,rootEl:l,name:"filter",targetEl:c,toEl:t,fromEl:t}),q("filter",e,{evt:a}),s&&a.preventDefault();return}}else if(d&&(d=d.split(",").some(function(u){if(u=ie(l,u.trim(),t,!1),u)return V({sortable:e,rootEl:u,name:"filter",targetEl:c,fromEl:t,toEl:t}),q("filter",e,{evt:a}),!0}),d)){s&&a.preventDefault();return}n.handle&&!ie(l,n.handle,t,!1)||this._prepareDragStart(a,o,c)}}},_prepareDragStart:function(a,e,t){var n=this,s=n.el,r=n.options,o=s.ownerDocument,c;if(t&&!f&&t.parentNode===s){var l=O(t);if(A=s,f=t,_=f.parentNode,Ce=f.nextSibling,et=t,Ue=r.group,C.dragged=f,ke={target:f,clientX:(e||a).clientX,clientY:(e||a).clientY},cn=ke.clientX-l.left,dn=ke.clientY-l.top,this._lastX=(e||a).clientX,this._lastY=(e||a).clientY,f.style["will-change"]="all",c=function(){if(q("delayEnded",n,{evt:a}),C.eventCanceled){n._onDrop();return}n._disableDelayedDragEvents(),!sn&&n.nativeDraggable&&(f.draggable=!0),n._triggerDragStart(a,e),V({sortable:n,name:"choose",originalEvent:a}),U(f,r.chosenClass,!0)},r.ignore.split(",").forEach(function(d){mn(f,d.trim(),Nt)}),F(o,"dragover",Se),F(o,"mousemove",Se),F(o,"touchmove",Se),r.supportPointer?(F(o,"pointerup",n._onDrop),!this.nativeDraggable&&F(o,"pointercancel",n._onDrop)):(F(o,"mouseup",n._onDrop),F(o,"touchend",n._onDrop),F(o,"touchcancel",n._onDrop)),sn&&this.nativeDraggable&&(this.options.touchStartThreshold=4,f.draggable=!0),q("delayStart",this,{evt:a}),r.delay&&(!r.delayOnTouchOnly||e)&&(!this.nativeDraggable||!(Ve||fe))){if(C.eventCanceled){this._onDrop();return}r.supportPointer?(F(o,"pointerup",n._disableDelayedDrag),F(o,"pointercancel",n._disableDelayedDrag)):(F(o,"mouseup",n._disableDelayedDrag),F(o,"touchend",n._disableDelayedDrag),F(o,"touchcancel",n._disableDelayedDrag)),F(o,"mousemove",n._delayedDragTouchMoveHandler),F(o,"touchmove",n._delayedDragTouchMoveHandler),r.supportPointer&&F(o,"pointermove",n._delayedDragTouchMoveHandler),n._dragStartTimer=setTimeout(c,r.delay)}else c()}},_delayedDragTouchMoveHandler:function(a){var e=a.touches?a.touches[0]:a;Math.max(Math.abs(e.clientX-this._lastX),Math.abs(e.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){f&&Nt(f),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var a=this.el.ownerDocument;M(a,"mouseup",this._disableDelayedDrag),M(a,"touchend",this._disableDelayedDrag),M(a,"touchcancel",this._disableDelayedDrag),M(a,"pointerup",this._disableDelayedDrag),M(a,"pointercancel",this._disableDelayedDrag),M(a,"mousemove",this._delayedDragTouchMoveHandler),M(a,"touchmove",this._delayedDragTouchMoveHandler),M(a,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(a,e){e=e||a.pointerType=="touch"&&a,!this.nativeDraggable||e?this.options.supportPointer?F(document,"pointermove",this._onTouchMove):e?F(document,"touchmove",this._onTouchMove):F(document,"mousemove",this._onTouchMove):(F(f,"dragend",this),F(A,"dragstart",this._onDragStart));try{document.selection?nt(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(t){}},_dragStarted:function(a,e){if(xe=!1,A&&f){q("dragStarted",this,{evt:e}),this.nativeDraggable&&F(document,"dragover",pa);var t=this.options;!a&&U(f,t.dragClass,!1),U(f,t.ghostClass,!0),C.active=this,a&&this._appendGhost(),V({sortable:this,name:"start",originalEvent:e})}else this._nulling()},_emulateDragOver:function(){if(se){this._lastX=se.clientX,this._lastY=se.clientY,Tn();for(var a=document.elementFromPoint(se.clientX,se.clientY),e=a;a&&a.shadowRoot&&(a=a.shadowRoot.elementFromPoint(se.clientX,se.clientY),a!==e);)e=a;if(f.parentNode[X]._isOutsideThisEl(a),e)do{if(e[X]){var t=void 0;if(t=e[X]._onDragOver({clientX:se.clientX,clientY:se.clientY,target:a,rootEl:e}),t&&!this.options.dragoverBubble)break}a=e}while(e=fn(e));Dn()}},_onTouchMove:function(a){if(ke){var e=this.options,t=e.fallbackTolerance,n=e.fallbackOffset,s=a.touches?a.touches[0]:a,r=T&&Fe(T,!0),o=T&&r&&r.a,c=T&&r&&r.d,l=Je&&j&&ln(j),d=(s.clientX-ke.clientX+n.x)/(o||1)+(l?l[0]-Pt[0]:0)/(o||1),u=(s.clientY-ke.clientY+n.y)/(c||1)+(l?l[1]-Pt[1]:0)/(c||1);if(!C.active&&!xe){if(t&&Math.max(Math.abs(s.clientX-this._lastX),Math.abs(s.clientY-this._lastY))<t)return;this._onDragStart(a,!0)}if(T){r?(r.e+=d-(Mt||0),r.f+=u-(Ft||0)):r={a:1,b:0,c:0,d:1,e:d,f:u};var h="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");S(T,"webkitTransform",h),S(T,"mozTransform",h),S(T,"msTransform",h),S(T,"transform",h),Mt=d,Ft=u,se=s}a.cancelable&&a.preventDefault()}},_appendGhost:function(){if(!T){var a=this.options.fallbackOnBody?document.body:A,e=O(f,!0,Je,!0,a),t=this.options;if(Je){for(j=a;S(j,"position")==="static"&&S(j,"transform")==="none"&&j!==document;)j=j.parentNode;j!==document.body&&j!==document.documentElement?(j===document&&(j=de()),e.top+=j.scrollTop,e.left+=j.scrollLeft):j=de(),Pt=ln(j)}T=f.cloneNode(!0),U(T,t.ghostClass,!1),U(T,t.fallbackClass,!0),U(T,t.dragClass,!0),S(T,"transition",""),S(T,"transform",""),S(T,"box-sizing","border-box"),S(T,"margin",0),S(T,"top",e.top),S(T,"left",e.left),S(T,"width",e.width),S(T,"height",e.height),S(T,"opacity","0.8"),S(T,"position",Je?"absolute":"fixed"),S(T,"zIndex","100000"),S(T,"pointerEvents","none"),C.ghost=T,a.appendChild(T),S(T,"transform-origin",cn/parseInt(T.style.width)*100+"% "+dn/parseInt(T.style.height)*100+"%")}},_onDragStart:function(a,e){var t=this,n=a.dataTransfer,s=t.options;if(q("dragStart",this,{evt:a}),C.eventCanceled){this._onDrop();return}q("setupClone",this),C.eventCanceled||(I=vn(f),I.removeAttribute("id"),I.draggable=!1,I.style["will-change"]="",this._hideClone(),U(I,this.options.chosenClass,!1),C.clone=I),t.cloneId=nt(function(){q("clone",t),!C.eventCanceled&&(t.options.removeCloneOnHide||A.insertBefore(I,f),t._hideClone(),V({sortable:t,name:"clone"}))}),!e&&U(f,s.dragClass,!0),e?(it=!0,t._loopId=setInterval(t._emulateDragOver,50)):(M(document,"mouseup",t._onDrop),M(document,"touchend",t._onDrop),M(document,"touchcancel",t._onDrop),n&&(n.effectAllowed="move",s.setData&&s.setData.call(t,n,f)),F(document,"drop",t),S(f,"transform","translateZ(0)")),xe=!0,t._dragStartId=nt(t._dragStarted.bind(t,e,a)),F(document,"selectstart",t),_e=!0,window.getSelection().removeAllRanges(),Oe&&S(document.body,"user-select","none")},_onDragOver:function(a){var e=this.el,t=a.target,n,s,r,o=this.options,c=o.group,l=C.active,d=Ue===c,u=o.sort,h=K||l,b,y=this,p=!1;if(Lt)return;function w(Ie,Gn){q(Ie,y,ue({evt:a,isOwner:d,axis:b?"vertical":"horizontal",revert:r,dragRect:n,targetRect:s,canSort:u,fromSortable:h,target:t,completed:v,onMove:function(nn,Wn){return Qe(A,e,f,n,nn,O(nn),a,Wn)},changed:x},Gn))}function m(){w("dragOverAnimationCapture"),y.captureAnimationState(),y!==h&&h.captureAnimationState()}function v(Ie){return w("dragOverCompleted",{insertion:Ie}),Ie&&(d?l._hideClone():l._showClone(y),y!==h&&(U(f,K?K.options.ghostClass:l.options.ghostClass,!1),U(f,o.ghostClass,!0)),K!==y&&y!==C.active?K=y:y===C.active&&K&&(K=null),h===y&&(y._ignoreWhileAnimating=t),y.animateAll(function(){w("dragOverAnimationComplete"),y._ignoreWhileAnimating=null}),y!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(t===f&&!f.animated||t===e&&!t.animated)&&(Ee=null),!o.dragoverBubble&&!a.rootEl&&t!==document&&(f.parentNode[X]._isOutsideThisEl(a.target),!Ie&&Se(a)),!o.dragoverBubble&&a.stopPropagation&&a.stopPropagation(),p=!0}function x(){z=Q(f),ye=Q(f,o.draggable),V({sortable:y,name:"change",toEl:e,newIndex:z,newDraggableIndex:ye,originalEvent:a})}if(a.preventDefault!==void 0&&a.cancelable&&a.preventDefault(),t=ie(t,o.draggable,e,!0),w("dragOver"),C.eventCanceled)return p;if(f.contains(a.target)||t.animated&&t.animatingX&&t.animatingY||y._ignoreWhileAnimating===t)return v(!1);if(it=!1,l&&!o.disabled&&(d?u||(r=_!==A):K===this||(this.lastPutMode=Ue.checkPull(this,l,f,a))&&c.checkPut(this,l,f,a))){if(b=this._getDirection(a,t)==="vertical",n=O(f),w("dragOverValid"),C.eventCanceled)return p;if(r)return _=A,m(),this._hideClone(),w("revert"),C.eventCanceled||(Ce?A.insertBefore(f,Ce):A.appendChild(f)),v(!0);var D=jt(e,o.draggable);if(!D||ba(a,b,this)&&!D.animated){if(D===f)return v(!1);if(D&&e===a.target&&(t=D),t&&(s=O(t)),Qe(A,e,f,n,t,s,a,!!t)!==!1)return m(),D&&D.nextSibling?e.insertBefore(f,D.nextSibling):e.appendChild(f),_=e,x(),v(!0)}else if(D&&ma(a,b,this)){var P=Pe(e,0,o,!0);if(P===f)return v(!1);if(t=P,s=O(t),Qe(A,e,f,n,t,s,a,!1)!==!1)return m(),e.insertBefore(f,P),_=e,x(),v(!0)}else if(t.parentNode===e){s=O(t);var N=0,le,W=f.parentNode!==e,L=!ua(f.animated&&f.toRect||n,t.animated&&t.toRect||s,b),me=b?"top":"left",ce=on(t,"top","top")||on(f,"top","top"),be=ce?ce.scrollTop:void 0;Ee!==t&&(le=s[me],Re=!1,ze=!L&&o.invertSwap||W),N=ya(a,t,s,b,L?1:o.swapThreshold,o.invertedSwapThreshold==null?o.swapThreshold:o.invertedSwapThreshold,ze,Ee===t);var H;if(N!==0){var J=Q(f);do J-=N,H=_.children[J];while(H&&(S(H,"display")==="none"||H===T))}if(N===0||H===t)return v(!1);Ee=t,je=N;var ae=t.nextElementSibling,R=!1;R=N===1;var Ae=Qe(A,e,f,n,t,s,a,R);if(Ae!==!1)return(Ae===1||Ae===-1)&&(R=Ae===1),Lt=!0,setTimeout(fa,30),m(),R&&!ae?e.appendChild(f):t.parentNode.insertBefore(f,R?ae:t),ce&&yn(ce,0,be-ce.scrollTop),_=f.parentNode,le!==void 0&&!ze&&(tt=Math.abs(le-O(t)[me])),x(),v(!0)}if(e.contains(f))return v(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){M(document,"mousemove",this._onTouchMove),M(document,"touchmove",this._onTouchMove),M(document,"pointermove",this._onTouchMove),M(document,"dragover",Se),M(document,"mousemove",Se),M(document,"touchmove",Se)},_offUpEvents:function(){var a=this.el.ownerDocument;M(a,"mouseup",this._onDrop),M(a,"touchend",this._onDrop),M(a,"pointerup",this._onDrop),M(a,"pointercancel",this._onDrop),M(a,"touchcancel",this._onDrop),M(document,"selectstart",this)},_onDrop:function(a){var e=this.el,t=this.options;if(z=Q(f),ye=Q(f,t.draggable),q("drop",this,{evt:a}),_=f&&f.parentNode,z=Q(f),ye=Q(f,t.draggable),C.eventCanceled){this._nulling();return}xe=!1,ze=!1,Re=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Bt(this.cloneId),Bt(this._dragStartId),this.nativeDraggable&&(M(document,"drop",this),M(e,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Oe&&S(document.body,"user-select",""),S(f,"transform",""),a&&(_e&&(a.cancelable&&a.preventDefault(),!t.dropBubble&&a.stopPropagation()),T&&T.parentNode&&T.parentNode.removeChild(T),(A===_||K&&K.lastPutMode!=="clone")&&I&&I.parentNode&&I.parentNode.removeChild(I),f&&(this.nativeDraggable&&M(f,"dragend",this),Nt(f),f.style["will-change"]="",_e&&!xe&&U(f,K?K.options.ghostClass:this.options.ghostClass,!1),U(f,this.options.chosenClass,!1),V({sortable:this,name:"unchoose",toEl:_,newIndex:null,newDraggableIndex:null,originalEvent:a}),A!==_?(z>=0&&(V({rootEl:_,name:"add",toEl:_,fromEl:A,originalEvent:a}),V({sortable:this,name:"remove",toEl:_,originalEvent:a}),V({rootEl:_,name:"sort",toEl:_,fromEl:A,originalEvent:a}),V({sortable:this,name:"sort",toEl:_,originalEvent:a})),K&&K.save()):z!==Me&&z>=0&&(V({sortable:this,name:"update",toEl:_,originalEvent:a}),V({sortable:this,name:"sort",toEl:_,originalEvent:a})),C.active&&((z==null||z===-1)&&(z=Me,ye=Ke),V({sortable:this,name:"end",toEl:_,originalEvent:a}),this.save()))),this._nulling()},_nulling:function(){q("nulling",this),A=f=_=T=Ce=I=et=ve=ke=se=_e=z=ye=Me=Ke=Ee=je=K=Ue=C.dragged=C.ghost=C.clone=C.active=null,ot.forEach(function(a){a.checked=!0}),ot.length=Mt=Ft=0},handleEvent:function(a){switch(a.type){case"drop":case"dragend":this._onDrop(a);break;case"dragenter":case"dragover":f&&(this._onDragOver(a),ga(a));break;case"selectstart":a.preventDefault();break}},toArray:function(){for(var a=[],e,t=this.el.children,n=0,s=t.length,r=this.options;n<s;n++)e=t[n],ie(e,r.draggable,this.el,!1)&&a.push(e.getAttribute(r.dataIdAttr)||wa(e));return a},sort:function(a,e){var t={},n=this.el;this.toArray().forEach(function(s,r){var o=n.children[r];ie(o,this.options.draggable,n,!1)&&(t[s]=o)},this),e&&this.captureAnimationState(),a.forEach(function(s){t[s]&&(n.removeChild(t[s]),n.appendChild(t[s]))}),e&&this.animateAll()},save:function(){var a=this.options.store;a&&a.set&&a.set(this)},closest:function(a,e){return ie(a,e||this.options.draggable,this.el,!1)},option:function(a,e){var t=this.options;if(e===void 0)return t[a];var n=Ye.modifyOption(this,a,e);typeof n!="undefined"?t[a]=n:t[a]=e,a==="group"&&Cn(t)},destroy:function(){q("destroy",this);var a=this.el;a[X]=null,M(a,"mousedown",this._onTapStart),M(a,"touchstart",this._onTapStart),M(a,"pointerdown",this._onTapStart),this.nativeDraggable&&(M(a,"dragover",this),M(a,"dragenter",this)),Array.prototype.forEach.call(a.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),rt.splice(rt.indexOf(this.el),1),this.el=a=null},_hideClone:function(){if(!ve){if(q("hideClone",this),C.eventCanceled)return;S(I,"display","none"),this.options.removeCloneOnHide&&I.parentNode&&I.parentNode.removeChild(I),ve=!0}},_showClone:function(a){if(a.lastPutMode!=="clone"){this._hideClone();return}if(ve){if(q("showClone",this),C.eventCanceled)return;f.parentNode==A&&!this.options.group.revertClone?A.insertBefore(I,f):Ce?A.insertBefore(I,Ce):A.appendChild(I),this.options.group.revertClone&&this.animate(f,I),S(I,"display",""),ve=!1}}};function ga(i){i.dataTransfer&&(i.dataTransfer.dropEffect="move"),i.cancelable&&i.preventDefault()}function Qe(i,a,e,t,n,s,r,o){var c,l=i[X],d=l.options.onMove,u;return window.CustomEvent&&!fe&&!Ve?c=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(c=document.createEvent("Event"),c.initEvent("move",!0,!0)),c.to=a,c.from=i,c.dragged=e,c.draggedRect=t,c.related=n||a,c.relatedRect=s||O(a),c.willInsertAfter=o,c.originalEvent=r,i.dispatchEvent(c),d&&(u=d.call(l,c,r)),u}function Nt(i){i.draggable=!1}function fa(){Lt=!1}function ma(i,a,e){var t=O(Pe(e.el,0,e.options,!0)),n=wn(e.el,e.options,T),s=10;return a?i.clientX<n.left-s||i.clientY<t.top&&i.clientX<t.right:i.clientY<n.top-s||i.clientY<t.bottom&&i.clientX<t.left}function ba(i,a,e){var t=O(jt(e.el,e.options.draggable)),n=wn(e.el,e.options,T),s=10;return a?i.clientX>n.right+s||i.clientY>t.bottom&&i.clientX>t.left:i.clientY>n.bottom+s||i.clientX>t.right&&i.clientY>t.top}function ya(i,a,e,t,n,s,r,o){var c=t?i.clientY:i.clientX,l=t?e.height:e.width,d=t?e.top:e.left,u=t?e.bottom:e.right,h=!1;if(!r){if(o&&tt<l*n){if(!Re&&(je===1?c>d+l*s/2:c<u-l*s/2)&&(Re=!0),Re)h=!0;else if(je===1?c<d+tt:c>u-tt)return-je}else if(c>d+l*(1-n)/2&&c<u-l*(1-n)/2)return va(a)}return h=h||r,h&&(c<d+l*s/2||c>u-l*s/2)?c>d+l/2?1:-1:0}function va(i){return Q(f)<Q(i)?1:-1}function wa(i){for(var a=i.tagName+i.className+i.src+i.href+i.textContent,e=a.length,t=0;e--;)t+=a.charCodeAt(e);return t.toString(36)}function ka(i){ot.length=0;for(var a=i.getElementsByTagName("input"),e=a.length;e--;){var t=a[e];t.checked&&ot.push(t)}}function nt(i){return setTimeout(i,0)}function Bt(i){return clearTimeout(i)}ct&&F(document,"touchmove",function(i){(C.active||xe)&&i.cancelable&&i.preventDefault()});C.utils={on:F,off:M,css:S,find:mn,is:function(a,e){return!!ie(a,e,a,!1)},extend:aa,throttle:bn,closest:ie,toggleClass:U,clone:vn,index:Q,nextTick:nt,cancelNextTick:Bt,detectDirection:Sn,getChild:Pe,expando:X};C.get=function(i){return i[X]};C.mount=function(){for(var i=arguments.length,a=new Array(i),e=0;e<i;e++)a[e]=arguments[e];a[0].constructor===Array&&(a=a[0]),a.forEach(function(t){if(!t.prototype||!t.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(t));t.utils&&(C.utils=ue(ue({},C.utils),t.utils)),Ye.mount(t)})};C.create=function(i,a){return new C(i,a)};C.version=ta;var B=[],Le,Ot,$t=!1,At,It,lt,Be;function Sa(){function i(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var a in this)a.charAt(0)==="_"&&typeof this[a]=="function"&&(this[a]=this[a].bind(this))}return i.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?F(document,"dragover",this._handleAutoScroll):this.options.supportPointer?F(document,"pointermove",this._handleFallbackAutoScroll):t.touches?F(document,"touchmove",this._handleFallbackAutoScroll):F(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;!this.options.dragOverBubble&&!t.rootEl&&this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?M(document,"dragover",this._handleAutoScroll):(M(document,"pointermove",this._handleFallbackAutoScroll),M(document,"touchmove",this._handleFallbackAutoScroll),M(document,"mousemove",this._handleFallbackAutoScroll)),hn(),at(),sa()},nulling:function(){lt=Ot=Le=$t=Be=At=It=null,B.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var n=this,s=(e.touches?e.touches[0]:e).clientX,r=(e.touches?e.touches[0]:e).clientY,o=document.elementFromPoint(s,r);if(lt=e,t||this.options.forceAutoScrollFallback||Ve||fe||Oe){_t(e,this.options,o,t);var c=we(o,!0);$t&&(!Be||s!==At||r!==It)&&(Be&&hn(),Be=setInterval(function(){var l=we(document.elementFromPoint(s,r),!0);l!==c&&(c=l,at()),_t(e,n.options,l,t)},10),At=s,It=r)}else{if(!this.options.bubbleScroll||we(o,!0)===de()){at();return}_t(e,this.options,we(o,!1),!1)}}},ge(i,{pluginName:"scroll",initializeByDefault:!0})}function at(){B.forEach(function(i){clearInterval(i.pid)}),B=[]}function hn(){clearInterval(Be)}var _t=bn(function(i,a,e,t){if(a.scroll){var n=(i.touches?i.touches[0]:i).clientX,s=(i.touches?i.touches[0]:i).clientY,r=a.scrollSensitivity,o=a.scrollSpeed,c=de(),l=!1,d;Ot!==e&&(Ot=e,at(),Le=a.scroll,d=a.scrollFn,Le===!0&&(Le=we(e,!0)));var u=0,h=Le;do{var b=h,y=O(b),p=y.top,w=y.bottom,m=y.left,v=y.right,x=y.width,D=y.height,P=void 0,N=void 0,le=b.scrollWidth,W=b.scrollHeight,L=S(b),me=b.scrollLeft,ce=b.scrollTop;b===c?(P=x<le&&(L.overflowX==="auto"||L.overflowX==="scroll"||L.overflowX==="visible"),N=D<W&&(L.overflowY==="auto"||L.overflowY==="scroll"||L.overflowY==="visible")):(P=x<le&&(L.overflowX==="auto"||L.overflowX==="scroll"),N=D<W&&(L.overflowY==="auto"||L.overflowY==="scroll"));var be=P&&(Math.abs(v-n)<=r&&me+x<le)-(Math.abs(m-n)<=r&&!!me),H=N&&(Math.abs(w-s)<=r&&ce+D<W)-(Math.abs(p-s)<=r&&!!ce);if(!B[u])for(var J=0;J<=u;J++)B[J]||(B[J]={});(B[u].vx!=be||B[u].vy!=H||B[u].el!==b)&&(B[u].el=b,B[u].vx=be,B[u].vy=H,clearInterval(B[u].pid),(be!=0||H!=0)&&(l=!0,B[u].pid=setInterval(function(){t&&this.layer===0&&C.active._onTouchMove(lt);var ae=B[this.layer].vy?B[this.layer].vy*o:0,R=B[this.layer].vx?B[this.layer].vx*o:0;typeof d=="function"&&d.call(C.dragged.parentNode[X],R,ae,i,lt,B[this.layer].el)!=="continue"||yn(B[this.layer].el,R,ae)}.bind({layer:u}),24))),u++}while(a.bubbleScroll&&h!==c&&(h=we(h,!1)));$t=l}},30),En=function(a){var e=a.originalEvent,t=a.putSortable,n=a.dragEl,s=a.activeSortable,r=a.dispatchSortableEvent,o=a.hideGhostForTarget,c=a.unhideGhostForTarget;if(e){var l=t||s;o();var d=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e,u=document.elementFromPoint(d.clientX,d.clientY);c(),l&&!l.el.contains(u)&&(r("spill"),this.onSpill({dragEl:n,putSortable:t}))}};function Rt(){}Rt.prototype={startIndex:null,dragStart:function(a){var e=a.oldDraggableIndex;this.startIndex=e},onSpill:function(a){var e=a.dragEl,t=a.putSortable;this.sortable.captureAnimationState(),t&&t.captureAnimationState();var n=Pe(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(e,n):this.sortable.el.appendChild(e),this.sortable.animateAll(),t&&t.animateAll()},drop:En};ge(Rt,{pluginName:"revertOnSpill"});function Vt(){}Vt.prototype={onSpill:function(a){var e=a.dragEl,t=a.putSortable,n=t||this.sortable;n.captureAnimationState(),e.parentNode&&e.parentNode.removeChild(e),n.animateAll()},drop:En};ge(Vt,{pluginName:"removeOnSpill"});C.mount(new Sa);C.mount(Vt,Rt);var Yt=C;var dt={text:"",tags:[],projects:[],dueState:"all",showCompleted:!0},Ge={enabled:!1,tasksFolder:"Tasks",query:"",statusField:"status",progressField:"progress",projectField:"project",laneMapping:{},conflictResolution:"prompt",syncInterval:0,createMissingTasks:!1,archiveCompletedTasks:!1},Ne={enabled:!1,tasksFolder:"500 Plan & Reflect/520 Tasks",epicsFolder:"500 Plan & Reflect/510 Epics",projectsFolder:"400 Projects",goalsFolder:"300 Goals & Milestone/Goals",typeField:"Type",areaField:"Area",goalField:"Goal",projectField:"Project",epicField:"Epic",statusField:"Status",priorityField:"Priority",statusValues:{backlog:"backlog",todo:"todo",inProgress:"in-progress",done:"done"},priorityValues:{low:"low",medium:"medium",high:"high",critical:"critical"},syncChecklistToBoard:!0,updateStatusOnMove:!0,createBoardForEpic:!1},ut={Backlog:"backlog","To Do":"todo","In Progress":"in-progress",Done:"done"},Z={"new-card-insertion-method":"append","prepend-archive-date":!1,"prepend-archive-format":"YYYY-MM-DD","date-format":"YYYY-MM-DD","time-format":"HH:mm","date-trigger":"@","time-trigger":"@@","link-date-to-daily-note":!1,"show-relative-date":!1,"hide-tags-in-title":!1,"hide-date-in-title":!1,"hide-metadata-in-title":!1,"default-lane-width":"272px","show-checkboxes":!0,"show-card-menu":!0,"show-progress":!0,"show-project":!0,"default-project":"","template-path":"","card-note-template":"","card-note-folder":"","parse-natural-dates":!0,"parse-recurrence":!0,"enable-reminders":!1,"reminder-time":"1h","reminder-type":"notice","date-serialization-format":"iso","show-card-composer":!0,"composer-position":"bottom","show-subtasks":!0,"base-sync":{...Ge},"show-filter-toolbar":!0,"default-wip-limit":0,"wip-block-exceeded":!1,"auto-create-note":!1,"gpt-task-manager":{...Ne}},ee="kanban",te="kanban-plugin";var Y={TODAY:/\btoday\b/i,TOMORROW:/\btomorrow\b/i,YESTERDAY:/\byesterday\b/i,NEXT_DAY:/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\b/i,THIS_DAY:/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\b/i,LAST_DAY:/\blast\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\b/i,IN_X_DAYS:/\bin\s+(\d+)\s+days?\b/i,IN_X_WEEKS:/\bin\s+(\d+)\s+weeks?\b/i,IN_X_MONTHS:/\bin\s+(\d+)\s+months?\b/i,X_DAYS_AGO:/\b(\d+)\s+days?\s+ago\b/i,NEXT_WEEK:/\bnext\s+week\b/i,NEXT_MONTH:/\bnext\s+month\b/i,END_OF_WEEK:/\bend\s+of\s+week\b/i,END_OF_MONTH:/\bend\s+of\s+month\b/i},re={DAILY:/\b(?:every\s+day|daily)\b/i,WEEKLY:/\b(?:every\s+week|weekly)\b/i,MONTHLY:/\b(?:every\s+month|monthly)\b/i,YEARLY:/\b(?:every\s+year|yearly|annually)\b/i,EVERY_X_DAYS:/\bevery\s+(\d+)\s+days?\b/i,EVERY_X_WEEKS:/\bevery\s+(\d+)\s+weeks?\b/i,EVERY_X_MONTHS:/\bevery\s+(\d+)\s+months?\b/i,EVERY_DAY_OF_WEEK:/\bevery\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday)(?:\s*,\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday))*\b/i,WEEKDAYS:/\b(?:every\s+weekday|weekdays)\b/i,WEEKENDS:/\b(?:every\s+weekend|weekends)\b/i},We={sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6},xn={0:"sunday",1:"monday",2:"tuesday",3:"wednesday",4:"thursday",5:"friday",6:"saturday"},Mn=["progress","project","priority","status","assignee","estimate","spent"];function Te(){return Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4)}function Gt(i={}){let a=new Date,e=Te(),t;return i.tags&&(t=Array.isArray(i.tags)?i.tags.join(", "):i.tags),{title:i.title||"",date:G(a),time:a.toTimeString().slice(0,5),datetime:a.toISOString(),project:i.project,lane:i.lane,board:i.board,dueDate:i.dueDate,priority:i.priority,tags:t,id:e,...i.customVars}}function Wt(i,a){return i.replace(/\{\{([^}]+)\}\}/g,(e,t)=>{let n=t.trim();if(n.startsWith("date:")){let r=n.slice(5);return Ca(new Date,r)}if(n.includes("|")){let[r,o]=n.split("|").map(l=>l.trim()),c=a[r];return c!==void 0&&c!==""?String(c):o}let s=a[n];return s!==void 0?String(s):e})}function Ca(i,a){let e=i.getFullYear(),t=String(i.getMonth()+1).padStart(2,"0"),n=String(i.getDate()).padStart(2,"0"),s=String(i.getHours()).padStart(2,"0"),r=String(i.getMinutes()).padStart(2,"0"),o=String(i.getSeconds()).padStart(2,"0"),c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],d=["January","February","March","April","May","June","July","August","September","October","November","December"],u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return a.replace(/YYYY/g,String(e)).replace(/YY/g,String(e).slice(-2)).replace(/MMMM/g,d[i.getMonth()]).replace(/MMM/g,u[i.getMonth()]).replace(/MM/g,t).replace(/M/g,String(i.getMonth()+1)).replace(/DDDD/g,c[i.getDay()]).replace(/DDD/g,l[i.getDay()]).replace(/DD/g,n).replace(/D/g,String(i.getDate())).replace(/HH/g,s).replace(/H/g,String(i.getHours())).replace(/mm/g,r).replace(/m/g,String(i.getMinutes())).replace(/ss/g,o).replace(/s/g,String(i.getSeconds()))}function Fn(i,a=new Date){let e=new Date(a);e.setHours(0,0,0,0);let t=i.match(Y.TODAY);if(t)return{date:G(e),matched:t[0]};let n=i.match(Y.TOMORROW);if(n){let m=new Date(e);return m.setDate(m.getDate()+1),{date:G(m),matched:n[0]}}let s=i.match(Y.YESTERDAY);if(s){let m=new Date(e);return m.setDate(m.getDate()-1),{date:G(m),matched:s[0]}}let r=i.match(Y.NEXT_DAY);if(r){let m=r[1].toLowerCase(),v=We[m];if(v!==void 0){let x=ht(e,v,!0);return{date:G(x),matched:r[0]}}}let o=i.match(Y.THIS_DAY);if(o){let m=o[1].toLowerCase(),v=We[m];if(v!==void 0){let x=ht(e,v,!1);return{date:G(x),matched:o[0]}}}let c=i.match(Y.LAST_DAY);if(c){let m=c[1].toLowerCase(),v=We[m];if(v!==void 0){let x=Ta(e,v);return{date:G(x),matched:c[0]}}}let l=i.match(Y.IN_X_DAYS);if(l){let m=parseInt(l[1],10),v=new Date(e);return v.setDate(v.getDate()+m),{date:G(v),matched:l[0]}}let d=i.match(Y.IN_X_WEEKS);if(d){let m=parseInt(d[1],10),v=new Date(e);return v.setDate(v.getDate()+m*7),{date:G(v),matched:d[0]}}let u=i.match(Y.IN_X_MONTHS);if(u){let m=parseInt(u[1],10),v=new Date(e);return v.setMonth(v.getMonth()+m),{date:G(v),matched:u[0]}}let h=i.match(Y.X_DAYS_AGO);if(h){let m=parseInt(h[1],10),v=new Date(e);return v.setDate(v.getDate()-m),{date:G(v),matched:h[0]}}let b=i.match(Y.NEXT_WEEK);if(b){let m=ht(e,1,!0);return{date:G(m),matched:b[0]}}let y=i.match(Y.NEXT_MONTH);if(y){let m=new Date(e);return m.setMonth(m.getMonth()+1),m.setDate(1),{date:G(m),matched:y[0]}}let p=i.match(Y.END_OF_WEEK);if(p){let m=ht(e,0,!1);return m.getTime()===e.getTime()&&e.getDay()!==0&&m.setDate(m.getDate()+7),{date:G(m),matched:p[0]}}let w=i.match(Y.END_OF_MONTH);if(w){let m=new Date(e.getFullYear(),e.getMonth()+1,0);return{date:G(m),matched:w[0]}}return{date:null,matched:null}}function ht(i,a,e){let t=new Date(i),n=t.getDay(),s=a-n;return(s<=0||e&&s<7)&&(s+=7),t.setDate(t.getDate()+s),t}function Ta(i,a){let e=new Date(i),n=e.getDay()-a;return n<=0&&(n+=7),e.setDate(e.getDate()-n),e}function G(i){let a=i.getFullYear(),e=String(i.getMonth()+1).padStart(2,"0"),t=String(i.getDate()).padStart(2,"0");return`${a}-${e}-${t}`}function Pn(i){let a=i.match(re.DAILY);if(a)return{pattern:{frequency:"daily",_rawPattern:a[0]},matched:a[0]};let e=i.match(re.WEEKLY);if(e)return{pattern:{frequency:"weekly",_rawPattern:e[0]},matched:e[0]};let t=i.match(re.MONTHLY);if(t)return{pattern:{frequency:"monthly",_rawPattern:t[0]},matched:t[0]};let n=i.match(re.YEARLY);if(n)return{pattern:{frequency:"yearly",_rawPattern:n[0]},matched:n[0]};let s=i.match(re.EVERY_X_DAYS);if(s)return{pattern:{frequency:"daily",interval:parseInt(s[1],10),_rawPattern:s[0]},matched:s[0]};let r=i.match(re.EVERY_X_WEEKS);if(r)return{pattern:{frequency:"weekly",interval:parseInt(r[1],10),_rawPattern:r[0]},matched:r[0]};let o=i.match(re.EVERY_X_MONTHS);if(o)return{pattern:{frequency:"monthly",interval:parseInt(o[1],10),_rawPattern:o[0]},matched:o[0]};let c=i.match(re.EVERY_DAY_OF_WEEK);if(c)return{pattern:{frequency:"weekly",daysOfWeek:(c[0].toLowerCase().match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\b/g)||[]).map(b=>b),_rawPattern:c[0]},matched:c[0]};let l=i.match(re.WEEKDAYS);if(l)return{pattern:{frequency:"weekly",daysOfWeek:["monday","tuesday","wednesday","thursday","friday"],_rawPattern:l[0]},matched:l[0]};let d=i.match(re.WEEKENDS);return d?{pattern:{frequency:"weekly",daysOfWeek:["saturday","sunday"],_rawPattern:d[0]},matched:d[0]}:{pattern:null,matched:null}}function Ht(i){if(i._rawPattern)return i._rawPattern;if(i.daysOfWeek&&i.daysOfWeek.length>0)return i.daysOfWeek.length===5&&["monday","tuesday","wednesday","thursday","friday"].every(e=>i.daysOfWeek.includes(e))?"weekdays":i.daysOfWeek.length===2&&i.daysOfWeek.includes("saturday")&&i.daysOfWeek.includes("sunday")?"weekends":`every ${i.daysOfWeek.join(", ")}`;let a=i.interval||1;switch(i.frequency){case"daily":return a===1?"daily":`every ${a} days`;case"weekly":return a===1?"weekly":`every ${a} weeks`;case"monthly":return a===1?"monthly":`every ${a} months`;case"yearly":return a===1?"yearly":`every ${a} years`;default:return"daily"}}function In(i,a=new Date){let e=new Date(a);e.setHours(0,0,0,0);let t=i.interval||1;switch(i.frequency){case"daily":e.setDate(e.getDate()+t);break;case"weekly":if(i.daysOfWeek&&i.daysOfWeek.length>0){let n=e.getDay(),s=i.daysOfWeek.map(o=>We[o]).sort((o,c)=>o-c),r=s.find(o=>o>n);r===void 0?(r=s[0],e.setDate(e.getDate()+(7-n+r))):e.setDate(e.getDate()+(r-n))}else e.setDate(e.getDate()+7*t);break;case"monthly":e.setMonth(e.getMonth()+t),i.dayOfMonth&&e.setDate(Math.min(i.dayOfMonth,Da(e)));break;case"yearly":e.setFullYear(e.getFullYear()+t);break}return e}function Da(i){return new Date(i.getFullYear(),i.getMonth()+1,0).getDate()}function _n(i,a=new Date){if(!i)return"";let e=new Date(i),t=new Date(a);t.setHours(0,0,0,0),e.setHours(0,0,0,0);let n=e.getTime()-t.getTime(),s=Math.round(n/(1e3*60*60*24));if(s===0)return"Today";if(s===1)return"Tomorrow";if(s===-1)return"Yesterday";if(s>1&&s<7)return`In ${s} days`;if(s===7)return"In 1 week";if(s>7&&s<14)return`In ${s} days`;if(s>=14&&s<30)return`In ${Math.floor(s/7)} weeks`;if(s<-1&&s>-7)return`${Math.abs(s)} days ago`;if(s===-7)return"1 week ago";if(s<-7&&s>-30)return`${Math.floor(Math.abs(s)/7)} weeks ago`;let r=xn[e.getDay()];return s>0&&s<=7?r.charAt(0).toUpperCase()+r.slice(1):i}function Ln(i){let a=i.match(/\s*\^([\w-]+)\s*$/);return a?{content:i.replace(/\s*\^[\w-]+\s*$/,""),id:a[1]}:{content:i,id:null}}function Ea(i){let a={},e=i,t=/\[(\w+)::([^\]]+)\]/g,n;for(;(n=t.exec(i))!==null;){let o=n[1].toLowerCase(),c=n[2].trim();if(o==="progress"){let l=parseInt(c.replace("%",""),10);a[o]=isNaN(l)?0:l}else a[o]=c;e=e.replace(n[0],"").trim()}let s=e.match(/progress::(\d+)%?/i);s&&a.progress===void 0&&(a.progress=parseInt(s[1],10),e=e.replace(s[0],"").trim());let r=e.match(/project::([^\s\]]+)/i);return r&&!a.project&&(a.project=r[1],e=e.replace(r[0],"").trim()),{cleanText:e,metadata:a}}function xa(i){let e=(i.match(/#[\w-/]+/g)||[]).map(t=>t.substring(1));return{cleanText:i,tags:e}}function Ma(i,a=!0){let e=i,t,n,s,r,o=i.match(/@(\d{4}-\d{2}-\d{2})(?:T(\d{2}:\d{2}))?/);o&&(t=o[1],n=o[2],e=e.replace(o[0],"").trim());let c=i.match(/@@(\d{2}:\d{2})/);if(c&&!n&&(n=c[1],e=e.replace(c[0],"").trim()),a&&!t){let b=i.match(/@(today|tomorrow|yesterday|next\s+\w+|this\s+\w+|last\s+\w+|in\s+\d+\s+\w+|\d+\s+\w+\s+ago|end\s+of\s+\w+)/i);if(b){let{date:y,matched:p}=Fn(b[1]);y&&p&&(t=y,e=e.replace(`@${b[1]}`,"").trim())}else{let{date:y,matched:p}=Fn(i);y&&p&&(t=y,e=e.replace(p,"").trim())}}let{pattern:l,matched:d}=Pn(e);l&&d&&(s=l,e=e.replace(d,"").trim());let u=e.match(/\[recur::([^\]]+)\]/);if(u&&!s){let{pattern:b}=Pn(u[1]);b?s={...b,_rawPattern:u[1]}:s={frequency:"daily",_rawPattern:u[1]},e=e.replace(u[0],"").trim()}let h=e.match(/\[remind::([^\]]+)\]/);return h&&(r=h[1],e=e.replace(h[0],"").trim()),{cleanText:e,dueDate:t,dueTime:n,recurrence:s,reminderTime:r}}function Fa(i,a,e=!0){let t=i[a],n=t.match(/^(\s*)-\s*\[([ xX])\]\s*(.*)$/);if(!n)return{card:null,endIndex:a};let s=n[1].length,r=n[2].toLowerCase()==="x",o=n[3].trim(),{content:c,id:l}=Ln(o);o=c;let{cleanText:d,metadata:u}=Ea(o),h;u.note&&(h=u.note,delete u.note);let{tags:b}=xa(d),{cleanText:y,dueDate:p,dueTime:w,recurrence:m,reminderTime:v}=Ma(d,e),x=[],D=[],P=[],N=a;for(let W=a+1;W<i.length;W++){let L=i[W],me=L.match(/^(\s*)/),ce=me?me[1].length:0;if(L.trim()===""){let J=!1;for(let ae=W+1;ae<i.length;ae++){let R=i[ae];if(R.trim()==="")continue;((R.match(/^(\s*)/)||["",""])[1].length>s||R.match(/^\s*>/)||R.match(/^\s+-\s*\[/))&&(J=!0);break}if(J){D.push(""),N=W;continue}else break}let be=L.match(/^\s*>\s?(.*)$/);if(be){x.push(be[1]),D.push(L),N=W;continue}let H=L.match(/^(\s+)-\s*\[([ xX])\]\s*(.*)$/);if(H&&H[1].length>s){let J=H[2].toLowerCase()==="x",ae=H[3].trim(),R=Te();P.push({id:R,text:ae,completed:J}),D.push(L),N=W;continue}if(ce>s){D.push(L),N=W;continue}break}return{card:{id:l||Te(),title:d,completed:r,tags:b,dueDate:p,dueTime:w,recurrence:m,reminderTime:v,notes:x.length>0?x.join(`
`):void 0,notePath:h,content:D.length>0?D.join(`
`):void 0,subtasks:P.length>0?P:void 0,metadata:u,_rawLine:t},endIndex:N}}function Nn(i){let a=i.split(`
`),e=a[0],t=e.match(/^##\s+(.+)$/);if(!t)return null;let{content:n,id:s}=Ln(t[1].trim()),r={id:s||Te(),title:n,cards:[],_rawHeader:e},o=1;for(;o<a.length;){if(a[o].trim().startsWith("- [")){let{card:l,endIndex:d}=Fa(a,o);if(l){r.cards.push(l),o=d+1;continue}}o++}return r}function Pa(i){let a=i.match(/%% kanban:settings\s*```(?:json)?\s*([\s\S]*?)\s*```\s*%%/);if(a)try{return JSON.parse(a[1])}catch(e){return console.warn("Failed to parse kanban settings JSON"),{}}return{}}function Na(i){let a=i.match(/^(---\s*\n[\s\S]*?\n---\s*\n?)/);return a?{frontmatter:a[1],body:i.slice(a[1].length)}:{frontmatter:"",body:i}}function Aa(i){return i?i.includes(te)?i:i.replace(/^(---\s*\n)/,`$1${te}: basic
`):`---
${te}: basic
---

`}function An(i){let a=i.split(`
`),e=0;for(let n=0;n<a.length;n++){let s=a[n];if(s.match(/^##\s/)||s.match(/^\s*-\s*\[/)||s.match(/^\s*>/))e=n;else if(s.trim()===""){let r=!1;for(let o=n+1;o<a.length;o++)if(a[o].match(/^\s*-\s*\[/)||a[o].match(/^\s*>/)){r=!0;break}else if(a[o].trim()!=="")break;r&&(e=n)}}let t=0;for(let n=0;n<=e;n++)t+=a[n].length+1;return t}function pt(i){let{frontmatter:a,body:e}=Na(i),t=/^## .+$/gm,n=[],s;for(;(s=t.exec(e))!==null;)n.push({index:s.index,match:s[0]});let r=e.match(/%% kanban:settings[\s\S]*?%%/),o=r?e.indexOf(r[0]):-1,c=r?o+r[0].length:-1,l="";n.length>0?l=e.slice(0,n[0].index).trim():o>0?l=e.slice(0,o).trim():l=e.trim();let d=[],u=[],h="";for(let p=0;p<n.length;p++){let w=n[p].index,m,v=p===n.length-1;p+1<n.length?m=n[p+1].index:o>w?m=o:m=e.length;let x=e.slice(w,m),D=n[p].match;if(v&&o>w){let P=An(x),N=x.slice(P).trim();N&&(h=N)}if(D.match(/^##\s+Archive\s*$/i)){let P=Nn(x);P&&(u=P.cards)}else{let P=Nn(x);P&&d.push(P)}}let b="";if(c>0)b=e.slice(c).trim();else if(n.length>0){let p=n[n.length-1].index,w=e.slice(p),m=An(w),v=w.slice(m).trim();v&&(b=v)}let y=Pa(e);return{lanes:d,archive:u,settings:y,_frontmatter:a,_headerContent:l,_footerContent:b,_preSettingsContent:h}}function Bn(i,a=!0,e="iso"){let t=i.completed?"[x]":"[ ]",n=i.title,s=[];if(i.metadata.progress!==void 0&&!n.includes("progress::")&&s.push(`[progress::${i.metadata.progress}%]`),i.metadata.project&&!n.includes("project::")&&!n.includes("[project::")&&s.push(`[project::${i.metadata.project}]`),i.notePath&&!n.includes("note::")&&s.push(`[note::${i.notePath}]`),i.recurrence&&!n.includes("recur::")&&!n.match(/\b(daily|weekly|monthly|yearly|every\s)/i)){let o=Ht(i.recurrence);s.push(`[recur::${o}]`)}i.reminderTime&&!n.includes("remind::")&&s.push(`[remind::${i.reminderTime}]`);for(let[o,c]of Object.entries(i.metadata))o!=="progress"&&o!=="project"&&c!==void 0&&(n.includes(`${o}::`)||s.push(`[${o}::${c}]`));s.length>0&&(n=`${n} ${s.join(" ")}`),n.includes("@")||(i.dueDate&&i.dueTime?n=`${n} @${i.dueDate}T${i.dueTime}`:i.dueDate?n=`${n} @${i.dueDate}`:i.dueTime&&(n=`${n} @@${i.dueTime}`)),a&&(n=`${n} ^${i.id}`);let r=`- ${t} ${n}`;if(i.content&&!i.notePath)r+=`
`+i.content;else{let o=[];if(i.subtasks&&i.subtasks.length>0)for(let c of i.subtasks){let l=c.completed?"[x]":"[ ]";o.push(`	- ${l} ${c.text}`)}if(i.notes&&!i.notePath){let c=i.notes.split(`
`).map(l=>`	> ${l}`);o.push(...c)}o.length>0&&(r+=`
`+o.join(`
`))}return r}function On(i,a,e){let t=i.split(`
`),n=0;for(let s=0;s<t.length;s++){let r=t[s].match(/^(\s*-\s*\[)([ xX])(\]\s*.*)$/);if(r){if(n===a){t[s]=`${r[1]}${e?"x":" "}${r[3]}`;break}n++}}return t.join(`
`)}function Ia(i,a=!0){let e=a?` ^${i.id}`:"",t=[`## ${i.title}${e}`,""];for(let n of i.cards)t.push(Bn(n,a));return t.push(""),t.join(`
`)}function _a(i){return Object.keys(i).length===0?"":`
%% kanban:settings
\`\`\`json
${JSON.stringify(i,null,2)}
\`\`\`
%%
`}function La(i,a=!0){if(i.length===0)return"";let e=["## Archive",""];for(let t of i)e.push(Bn(t,a));return e.push(""),e.join(`
`)}function gt(i){let a=[],e=Aa(i._frontmatter||"");a.push(e),i._headerContent&&(a.push(i._headerContent),a.push(""));for(let n of i.lanes)a.push(Ia(n));i.archive.length>0&&a.push(La(i.archive)),i._preSettingsContent&&(a.push(i._preSettingsContent),a.push(""));let t=_a(i.settings);return t&&a.push(t),i._footerContent&&a.push(i._footerContent),a.join(`
`)}function ft(){return{lanes:[{id:Te(),title:"To Do",cards:[]},{id:Te(),title:"In Progress",cards:[]},{id:Te(),title:"Done",cards:[]}],archive:[],settings:{}}}var mt=`---
${te}: basic
---

`;function qt(i,a,e=!1){if(!i)return"";if(e){let o=new Date(i),c=new Date,l=Math.floor((o.getTime()-c.getTime())/(1e3*60*60*24));if(l===0)return"Today";if(l===1)return"Tomorrow";if(l===-1)return"Yesterday";if(l>1&&l<7)return`In ${l} days`;if(l<-1&&l>-7)return`${Math.abs(l)} days ago`}let t=new Date(i),n=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return a.replace("YYYY",String(n)).replace("MM",s).replace("DD",r)}function He(i,a){let e=new Date,t=qt(e.toISOString().split("T")[0],a);return{...i,title:`${t} ${i.title}`}}function $n(i,a={},e){let t=Gt({project:a.project,...e}),n=Wt(i,t),s=n.match(/^#\s+(.+)$/m),r=s?s[1]:n.split(`
`)[0].trim()||"New card",o=n.match(/^---\s*\n([\s\S]*?)\n---/),c={...a};if(o){let p=o[1].split(`
`);for(let w of p){let m=w.match(/^(\w+):\s*(.+)$/);if(m){let v=m[1].toLowerCase(),x=m[2].trim();Mn.includes(v)&&(v==="progress"?c.progress=parseInt(x.replace("%",""),10):c[v]=x)}}}let d=(r.match(/#[\w-/]+/g)||[]).map(y=>y.substring(1)),u=r.match(/@(\d{4}-\d{2}-\d{2})(?:T(\d{2}:\d{2}))?/),h=u?u[1]:void 0,b=u?u[2]:void 0;return{id:t.id,title:r,completed:!1,tags:d,dueDate:h,dueTime:b,metadata:c,notes:n}}var $=require("obsidian");var bt=class{constructor(a,e){this.syncInProgress=!1;this.app=a,this.config=e||{...Ge}}setConfig(a){this.config=a}getConfig(){return this.config}isEnabled(){return this.config.enabled}async readBaseTask(a){try{let e=await this.app.vault.read(a),t=this.parseFrontmatter(e);return t?{path:a.path,title:t.title||a.basename,status:t[this.config.statusField],progress:t[this.config.progressField],project:t[this.config.projectField],priority:t.priority,dueDate:t.due||t.dueDate,tags:t.tags,completed:t.completed===!0||t.status==="done",modified:a.stat.mtime,...t}:null}catch(e){return console.error(`Error reading Base task ${a.path}:`,e),null}}async queryBaseTasks(){let a=[],e=this.app.vault.getAbstractFileByPath(this.config.tasksFolder);if(!(e instanceof $.TFolder))return console.warn(`Tasks folder not found: ${this.config.tasksFolder}`),a;let t=this.getMarkdownFiles(e);for(let n of t){let s=await this.readBaseTask(n);s&&this.matchesQuery(s)&&a.push(s)}return a}getMarkdownFiles(a){let e=[];for(let t of a.children)t instanceof $.TFile&&t.extension==="md"?e.push(t):t instanceof $.TFolder&&e.push(...this.getMarkdownFiles(t));return e}matchesQuery(a){var n,s,r,o;if(!this.config.query||this.config.query.trim()==="")return!0;let t=this.config.query.toLowerCase().split(/\s+and\s+/i);for(let c of t){let l=c.trim(),d=l.match(/^status:\s*(.+)$/i);if(d){let p=d[1].toLowerCase();if(((n=a.status)==null?void 0:n.toLowerCase())!==p)return!1;continue}let u=l.match(/^project:\s*(.+)$/i);if(u){let p=u[1].toLowerCase();if(((s=a.project)==null?void 0:s.toLowerCase())!==p)return!1;continue}let h=l.match(/^tag:\s*(.+)$/i);if(h){let p=h[1].toLowerCase();if(!((r=a.tags)!=null&&r.some(w=>w.toLowerCase()===p)))return!1;continue}let b=l.match(/^priority:\s*(.+)$/i);if(b){let p=b[1].toLowerCase();if(((o=a.priority)==null?void 0:o.toLowerCase())!==p)return!1;continue}let y=l.match(/^completed:\s*(true|false)$/i);if(y){let p=y[1].toLowerCase()==="true";if(a.completed!==p)return!1;continue}}return!0}async updateTaskField(a,e,t){try{let n=this.app.vault.getAbstractFileByPath(a);if(!(n instanceof $.TFile))return console.warn(`Task file not found: ${a}`),!1;let s=await this.app.vault.read(n),r=this.updateFrontmatterField(s,e,t);return r!==s?(await this.app.vault.modify(n,r),!0):!1}catch(n){return console.error(`Error updating task ${a}:`,n),!1}}async updateTaskFields(a,e){try{let t=this.app.vault.getAbstractFileByPath(a);if(!(t instanceof $.TFile))return console.warn(`Task file not found: ${a}`),!1;let n=await this.app.vault.read(t);for(let[s,r]of Object.entries(e))n=this.updateFrontmatterField(n,s,r);return await this.app.vault.modify(t,n),!0}catch(t){return console.error(`Error updating task ${a}:`,t),!1}}async createBaseTask(a,e,t){try{if(!(this.app.vault.getAbstractFileByPath(this.config.tasksFolder)instanceof $.TFolder))try{await this.app.vault.createFolder(this.config.tasksFolder)}catch(u){if(!(this.app.vault.getAbstractFileByPath(this.config.tasksFolder)instanceof $.TFolder))return console.error("Cannot create tasks folder:",this.config.tasksFolder,u),null}let s=(a||"Untitled Task").replace(/[\\/:*?"<>|]/g,"-").replace(/\s+/g," ").trim().substring(0,100)||"task",r=Date.now(),o=`${s}-${r}.md`,c=`${this.config.tasksFolder}/${o}`,l={title:a||"Untitled Task",created:new Date().toISOString()};t&&this.config.laneMapping[t.title]&&(l[this.config.statusField]=this.config.laneMapping[t.title]),e.progress!==void 0&&(l[this.config.progressField]=e.progress),e.project&&(l[this.config.projectField]=e.project),e.priority&&(l.priority=e.priority);let d=this.createFileWithFrontmatter(l,`# ${a||"Untitled Task"}
`);return await this.app.vault.create(c,d),c}catch(n){return console.error("Error creating Base task:",n),null}}async onCardMoveToLane(a,e){if(!this.config.enabled||!a.baseTaskPath)return!1;let t=this.config.laneMapping[e.title];return t?await this.updateTaskField(a.baseTaskPath,this.config.statusField,t):!1}async syncProgress(a,e){return!this.config.enabled||!a.baseTaskPath?!1:await this.updateTaskField(a.baseTaskPath,this.config.progressField,e)}async syncProject(a,e){return!this.config.enabled||!a.baseTaskPath?!1:await this.updateTaskField(a.baseTaskPath,this.config.projectField,e||"")}async syncFromBase(a,e){if(this.syncInProgress)return{created:0,updated:0,conflicts:[],errors:["Sync already in progress"]};if(!a.lanes||a.lanes.length===0)return{created:0,updated:0,conflicts:[],errors:["Board has no lanes - add at least one lane before syncing"]};this.syncInProgress=!0;let t={created:0,updated:0,conflicts:[],errors:[]};try{let n=await this.queryBaseTasks(),s=new Map;for(let r of a.lanes)for(let o of r.cards)o.baseTaskPath&&s.set(o.baseTaskPath,{card:o,lane:r});for(let r of n){let o=s.get(r.path);if(o){let c=await this.updateCardFromTask(o.card,r,a,e);c.length>0&&t.conflicts.push(...c),t.updated++}else{let c=this.findLaneForTask(r,a);if(c){let l=this.createCardFromTask(r);c.cards.push(l),t.created++}else console.warn(`No lane found for task: ${r.path}`)}}}catch(n){t.errors.push(`Sync error: ${n}`)}finally{this.syncInProgress=!1}return t}findLaneForTask(a,e){if(!a.status)return e.lanes[0]||null;for(let[t,n]of Object.entries(this.config.laneMapping))if(n.toLowerCase()===a.status.toLowerCase()){let s=e.lanes.find(r=>r.title.toLowerCase()===t.toLowerCase());if(s)return s}return e.lanes[0]||null}createCardFromTask(a){return{id:this.generateId(),title:a.title,completed:a.completed||!1,tags:a.tags||[],dueDate:a.dueDate,metadata:{progress:a.progress,project:a.project,priority:a.priority,status:a.status},baseTaskPath:a.path,baseSyncTime:Date.now()}}async updateCardFromTask(a,e,t,n){let s=[],r=[{field:"title",local:a.title,remote:e.title},{field:"progress",local:a.metadata.progress,remote:e.progress},{field:"project",local:a.metadata.project,remote:e.project}];for(let{field:l,local:d,remote:u}of r)if(d!==u&&d!==void 0&&u!==void 0){let h={cardId:a.id,cardTitle:a.title,taskPath:e.path,localValue:String(d),remoteValue:String(u),field:l},b=this.config.conflictResolution==="remote";if(this.config.conflictResolution==="last-write"){let y=a.baseSyncTime||0;b=(e.modified||0)>y}else if(this.config.conflictResolution==="prompt"&&n){let y=await n(h);if(y==="skip")continue;b=y==="remote"}b&&(l==="title"&&(a.title=u),l==="progress"&&(a.metadata.progress=u),l==="project"&&(a.metadata.project=u)),s.push(h)}else u!==void 0&&d===void 0&&(l==="title"&&(a.title=u),l==="progress"&&(a.metadata.progress=u),l==="project"&&(a.metadata.project=u));let o=this.findLaneForTask(e,t),c=t.lanes.find(l=>l.cards.some(d=>d.id===a.id));if(o&&c&&o.id!==c.id){let l=c.cards.findIndex(d=>d.id===a.id);l>=0&&(c.cards.splice(l,1),o.cards.push(a))}return a.baseSyncTime=Date.now(),s}generateId(){return Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4)}parseFrontmatter(a){let e=a.match(/^---\n([\s\S]*?)\n---/);if(!e)return null;let t={},n=e[1].split(`
`);for(let s of n){let r=s.indexOf(":");if(r>0){let o=s.substring(0,r).trim(),c=s.substring(r+1).trim();c==="true"?c=!0:c==="false"?c=!1:!isNaN(Number(c))&&c!==""?c=Number(c):c.startsWith("[")&&c.endsWith("]")?c=c.slice(1,-1).split(",").map(l=>l.trim().replace(/['"]/g,"")):c=c.replace(/^['"]|['"]$/g,""),t[o]=c}}return t}updateFrontmatterField(a,e,t){let n=a.match(/^---\n([\s\S]*?)\n---/);if(!n){let l=this.formatFrontmatterValue(t);return`---
${e}: ${l}
---

${a}`}let r=n[1].split(`
`),o=!1,c=r.map(l=>{let d=l.indexOf(":");return d>0&&l.substring(0,d).trim()===e?(o=!0,t===void 0||t===""?null:`${e}: ${this.formatFrontmatterValue(t)}`):l}).filter(l=>l!==null);return!o&&t!==void 0&&t!==""&&c.push(`${e}: ${this.formatFrontmatterValue(t)}`),a.replace(n[0],`---
${c.join(`
`)}
---`)}formatFrontmatterValue(a){return a===void 0?"":typeof a=="boolean"||typeof a=="number"?a.toString():a.includes(":")||a.includes("#")?`"${a}"`:a}createFileWithFrontmatter(a,e){let t=["---"];for(let[n,s]of Object.entries(a))s!==void 0&&s!==""&&t.push(`${n}: ${this.formatFrontmatterValue(s)}`);return t.push("---","",e),t.join(`
`)}},yt=class extends $.Modal{constructor(e,t,n){super(e);this.conflict=t,this.onResolve=n}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("kanban-sync-conflict-modal"),e.createEl("h2",{text:"Sync Conflict"}),e.createEl("p",{text:`Conflict detected for "${this.conflict.cardTitle}" in field "${this.conflict.field}":`});let t=e.createDiv({cls:"conflict-comparison"}),n=t.createDiv({cls:"conflict-value local"});n.createEl("strong",{text:"Local (Kanban):"}),n.createEl("span",{text:this.conflict.localValue||"(empty)"});let s=t.createDiv({cls:"conflict-value remote"});s.createEl("strong",{text:"Remote (Base):"}),s.createEl("span",{text:this.conflict.remoteValue||"(empty)"}),new $.Setting(e).addButton(r=>r.setButtonText("Keep Local").onClick(()=>{this.onResolve("local"),this.close()})).addButton(r=>r.setButtonText("Use Remote").setCta().onClick(()=>{this.onResolve("remote"),this.close()})).addButton(r=>r.setButtonText("Skip").onClick(()=>{this.onResolve("skip"),this.close()}))}onClose(){let{contentEl:e}=this;e.empty()}},vt=class extends $.Modal{constructor(e,t,n){super(e);this.tasks=[];this.tasksFolder=t,this.onSelect=n}async onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("kanban-task-picker-modal"),e.createEl("h2",{text:"Link to Base Task"}),this.filterEl=e.createEl("input",{type:"text",cls:"task-picker-filter",attr:{placeholder:"Filter tasks..."}}),this.filterEl.addEventListener("input",()=>this.filterTasks()),this.listEl=e.createDiv({cls:"task-picker-list"}),await this.loadTasks(),this.renderTasks(),this.filterEl.focus(),new $.Setting(e).addButton(t=>t.setButtonText("Cancel").onClick(()=>{this.onSelect(null),this.close()}))}async loadTasks(){let e=this.app.vault.getAbstractFileByPath(this.tasksFolder);if(!(e instanceof $.TFolder))return;let t=this.getMarkdownFiles(e);for(let n of t){let r=(await this.app.vault.read(n)).match(/^---[\s\S]*?title:\s*(.+?)[\r\n]/m),o=r?r[1].replace(/['"]/g,""):n.basename;this.tasks.push({path:n.path,title:o})}this.tasks.sort((n,s)=>n.title.localeCompare(s.title))}getMarkdownFiles(e){let t=[];for(let n of e.children)n instanceof $.TFile&&n.extension==="md"?t.push(n):n instanceof $.TFolder&&t.push(...this.getMarkdownFiles(n));return t}filterTasks(){this.renderTasks()}renderTasks(){this.listEl.empty();let e=this.filterEl.value.toLowerCase(),t=this.tasks.filter(n=>n.title.toLowerCase().includes(e)||n.path.toLowerCase().includes(e));if(t.length===0){this.listEl.createEl("p",{text:"No tasks found",cls:"task-picker-empty"});return}for(let n of t){let s=this.listEl.createDiv({cls:"task-picker-item"});s.createEl("strong",{text:n.title}),s.createEl("span",{text:n.path,cls:"task-path"}),s.addEventListener("click",()=>{this.onSelect(n.path),this.close()})}}onClose(){let{contentEl:e}=this;e.empty()}};function Kn(){let i=document.createElement("div");return i.className="kanban-sync-status",i.style.display="none",i}function he(i,a,e){i.className=`kanban-sync-status ${a}`,i.style.display=a==="idle"?"none":"flex",a==="syncing"?i.innerHTML='<span class="sync-spinner"></span><span>Syncing...</span>':a==="success"?(i.innerHTML=`<span>\u2713</span><span>${e||"Synced"}</span>`,setTimeout(()=>he(i,"idle"),2e3)):a==="error"&&(i.innerHTML=`<span>\u26A0</span><span>${e||"Sync failed"}</span>`)}var ne=class extends g.TextFileView{constructor(e,t){super(e);this.sortableInstances=[];this.syncIntervalId=null;this.filterState={...dt};this.filterToolbarEl=null;this.pendingAutoCreateNote=null;this.plugin=t,this.board=ft(),this.baseSyncService=new bt(this.app),this.syncStatusEl=Kn(),this.filterState={...dt}}getViewType(){return ee}getDisplayText(){var e;return((e=this.file)==null?void 0:e.basename)||"Kanban Board"}getIcon(){return"columns"}getViewData(){return gt(this.board)}setViewData(e,t){t&&(this.board=ft()),e.trim()&&(this.board=pt(e)),this.render()}clear(){this.board=ft(),this.render()}async onOpen(){let e=this.containerEl.children[1];e.empty(),e.addClass("kanban-plugin"),this.boardContainer=e.createDiv({cls:"kanban-board-wrapper"}),this.render()}async onClose(){this.destroySortables(),this.stopBackgroundSync()}onPaneMenu(e,t){super.onPaneMenu(e,t),e.addItem(n=>{n.setTitle("Add a list").setIcon("plus-circle").onClick(()=>this.addLane())}),e.addItem(n=>{n.setTitle("Archive completed cards").setIcon("archive").onClick(()=>this.archiveCompletedCards())}),e.addSeparator(),e.addItem(n=>{n.setTitle("Board settings").setIcon("settings").onClick(()=>this.openBoardSettings())})}getSetting(e){if(this.board.settings[e]!==void 0)return this.board.settings[e];let t=e;return t in this.plugin.settings?this.plugin.settings[t]:Z[t]}getBaseSyncConfig(){return this.board.settings["base-sync"]?{...Ge,...this.board.settings["base-sync"]}:{...this.plugin.settings["base-sync"]}}startBackgroundSync(){this.stopBackgroundSync();let e=this.getBaseSyncConfig();if(!e.enabled||e.syncInterval<=0)return;let t=e.syncInterval*60*1e3;this.syncIntervalId=window.setInterval(()=>{this.performBackgroundSync()},t)}stopBackgroundSync(){this.syncIntervalId!==null&&(window.clearInterval(this.syncIntervalId),this.syncIntervalId=null)}async performBackgroundSync(){let e=this.getBaseSyncConfig();if(e.enabled){this.baseSyncService.setConfig(e),he(this.syncStatusEl,"syncing");try{let t=await this.baseSyncService.syncFromBase(this.board,async n=>e.conflictResolution==="prompt"?await this.promptConflictResolution(n):e.conflictResolution);if(t.errors.length>0)he(this.syncStatusEl,"error",t.errors[0]),new g.Notice(`Sync error: ${t.errors[0]}`);else{let n=`Synced: ${t.created} created, ${t.updated} updated`;he(this.syncStatusEl,"success",n),(t.created>0||t.updated>0)&&(this.requestSave(),this.render())}}catch(t){he(this.syncStatusEl,"error","Sync failed"),console.error("Base sync error:",t)}}}async promptConflictResolution(e){return new Promise(t=>{new yt(this.app,e,s=>{t(s)}).open()})}async manualSync(){await this.performBackgroundSync()}async linkCardToBaseTask(e){let t=this.getBaseSyncConfig();if(!t.enabled){new g.Notice("Base sync is not enabled. Enable it in settings first.");return}new vt(this.app,t.tasksFolder,async s=>{s&&(e.baseTaskPath=s,e.baseSyncTime=Date.now(),this.requestSave(),this.render(),new g.Notice(`Card linked to: ${s}`))}).open()}async createBaseTaskForCard(e,t){let n=this.getBaseSyncConfig();if(!n.enabled){new g.Notice("Base sync is not enabled. Enable it in settings first.");return}this.baseSyncService.setConfig(n);let s=await this.baseSyncService.createBaseTask(e.title,e.metadata,t);s?(e.baseTaskPath=s,e.baseSyncTime=Date.now(),this.requestSave(),this.render(),new g.Notice(`Created Base task: ${s}`)):new g.Notice("Failed to create Base task")}destroySortables(){for(let e of this.sortableInstances)e.destroy();this.sortableInstances=[]}render(){if(!this.boardContainer)return;this.destroySortables(),this.boardContainer.empty();let e=this.getSetting("lane-width")||this.plugin.settings["default-lane-width"];this.boardContainer.style.setProperty("--kanban-lane-width",e),this.getBaseSyncConfig().enabled&&this.renderSyncToolbar(),this.getSetting("show-filter-toolbar")!==!1&&this.renderFilterToolbar();let s=this.boardContainer.createDiv({cls:"kanban-board"});for(let o of this.board.lanes)this.renderLane(s,o);if(this.getSetting("show-add-list")!==!1){let o=s.createDiv({cls:"kanban-add-lane-btn"});o.createSpan({text:"+ Add list"}),o.addEventListener("click",()=>this.addLane())}this.setupLaneSortable(s),this.startBackgroundSync()}renderSyncToolbar(){let e=this.boardContainer.createDiv({cls:"kanban-sync-toolbar"});e.appendChild(this.syncStatusEl);let t=e.createDiv({cls:"kanban-sync-btn"});(0,g.setIcon)(t,"refresh-cw"),t.title="Sync with Base",t.addEventListener("click",()=>this.manualSync());let n=e.createDiv({cls:"kanban-base-indicator"});(0,g.setIcon)(n,"database"),n.createSpan({text:"Base sync enabled"})}renderFilterToolbar(){this.filterToolbarEl=this.boardContainer.createDiv({cls:"kanban-filter-toolbar"});let e=this.filterToolbarEl.createDiv({cls:"filter-search-container"}),t=e.createSpan({cls:"filter-search-icon"});(0,g.setIcon)(t,"search");let n=e.createEl("input",{type:"text",cls:"filter-search-input",attr:{placeholder:"Search cards..."}});n.value=this.filterState.text,n.addEventListener("input",()=>{this.filterState.text=n.value,this.applyFilters()});let s=this.filterToolbarEl.createDiv({cls:"filter-buttons"}),r=s.createDiv({cls:"filter-btn"});(0,g.setIcon)(r,"tag"),r.createSpan({text:"Tags"}),this.filterState.tags.length>0&&(r.addClass("has-filter"),r.createSpan({cls:"filter-badge",text:String(this.filterState.tags.length)})),r.addEventListener("click",h=>this.showTagFilterMenu(h));let o=s.createDiv({cls:"filter-btn"});(0,g.setIcon)(o,"folder"),o.createSpan({text:"Project"}),this.filterState.projects.length>0&&(o.addClass("has-filter"),o.createSpan({cls:"filter-badge",text:String(this.filterState.projects.length)})),o.addEventListener("click",h=>this.showProjectFilterMenu(h));let c=s.createDiv({cls:"filter-btn"});(0,g.setIcon)(c,"calendar"),c.createSpan({text:"Due"}),this.filterState.dueState!=="all"&&c.addClass("has-filter"),c.addEventListener("click",h=>this.showDueFilterMenu(h));let l=s.createDiv({cls:`filter-btn ${this.filterState.showCompleted?"":"has-filter"}`});if((0,g.setIcon)(l,this.filterState.showCompleted?"check-circle":"circle"),l.createSpan({text:this.filterState.showCompleted?"Showing completed":"Hiding completed"}),l.addEventListener("click",()=>{this.filterState.showCompleted=!this.filterState.showCompleted,this.applyFilters()}),this.hasActiveFilters()){let h=s.createDiv({cls:"filter-btn filter-clear-btn"});(0,g.setIcon)(h,"x"),h.createSpan({text:"Clear filters"}),h.addEventListener("click",()=>this.clearFilters())}let d=this.getFilteredCardCount(),u=this.getTotalCardCount();if(this.hasActiveFilters()){let h=this.filterToolbarEl.createDiv({cls:"filter-count"});h.textContent=`Showing ${d} of ${u} cards`}}showTagFilterMenu(e){let t=new g.Menu,n=this.getAllTags();if(n.length===0)t.addItem(s=>{s.setTitle("No tags found").setDisabled(!0)});else{for(let s of n){let r=this.filterState.tags.includes(s);t.addItem(o=>{o.setTitle(`${r?"\u2713 ":""}#${s}`).onClick(()=>{r?this.filterState.tags=this.filterState.tags.filter(c=>c!==s):this.filterState.tags.push(s),this.applyFilters()})})}this.filterState.tags.length>0&&(t.addSeparator(),t.addItem(s=>{s.setTitle("Clear tag filter").onClick(()=>{this.filterState.tags=[],this.applyFilters()})}))}t.showAtMouseEvent(e)}showProjectFilterMenu(e){let t=new g.Menu,n=this.getAllProjects();if(n.length===0)t.addItem(s=>{s.setTitle("No projects found").setDisabled(!0)});else{for(let s of n){let r=this.filterState.projects.includes(s);t.addItem(o=>{o.setTitle(`${r?"\u2713 ":""}${s}`).onClick(()=>{r?this.filterState.projects=this.filterState.projects.filter(c=>c!==s):this.filterState.projects.push(s),this.applyFilters()})})}this.filterState.projects.length>0&&(t.addSeparator(),t.addItem(s=>{s.setTitle("Clear project filter").onClick(()=>{this.filterState.projects=[],this.applyFilters()})}))}t.showAtMouseEvent(e)}showDueFilterMenu(e){let t=new g.Menu,n=[{value:"all",label:"All cards"},{value:"overdue",label:"Overdue"},{value:"due-today",label:"Due today"},{value:"due-week",label:"Due this week"},{value:"has-date",label:"Has due date"},{value:"no-date",label:"No due date"}];for(let s of n){let r=this.filterState.dueState===s.value;t.addItem(o=>{o.setTitle(`${r?"\u2713 ":""}${s.label}`).onClick(()=>{this.filterState.dueState=s.value,this.applyFilters()})})}t.showAtMouseEvent(e)}getAllTags(){let e=new Set;for(let t of this.board.lanes)for(let n of t.cards)for(let s of n.tags)e.add(s);return Array.from(e).sort()}getAllProjects(){let e=new Set;for(let t of this.board.lanes)for(let n of t.cards)n.metadata.project&&e.add(n.metadata.project);return Array.from(e).sort()}hasActiveFilters(){return this.filterState.text!==""||this.filterState.tags.length>0||this.filterState.projects.length>0||this.filterState.dueState!=="all"||!this.filterState.showCompleted}clearFilters(){this.filterState={...dt},this.applyFilters()}applyFilters(){this.render()}cardMatchesFilter(e){var t,n;if(this.filterState.text){let s=this.filterState.text.toLowerCase(),r=e.title.toLowerCase().includes(s),o=((t=e.notes)==null?void 0:t.toLowerCase().includes(s))||!1,c=((n=e.content)==null?void 0:n.toLowerCase().includes(s))||!1;if(!r&&!o&&!c)return!1}if(this.filterState.tags.length>0&&!this.filterState.tags.some(r=>e.tags.includes(r))||this.filterState.projects.length>0&&(!e.metadata.project||!this.filterState.projects.includes(e.metadata.project))||!this.filterState.showCompleted&&e.completed)return!1;if(this.filterState.dueState!=="all"){let s=new Date;s.setHours(0,0,0,0);let r=e.dueDate?new Date(e.dueDate):null;switch(r&&r.setHours(0,0,0,0),this.filterState.dueState){case"overdue":if(!r||r>=s)return!1;break;case"due-today":if(!r||r.getTime()!==s.getTime())return!1;break;case"due-week":{let o=new Date(s);if(o.setDate(o.getDate()+7),!r||r<s||r>o)return!1;break}case"has-date":if(!e.dueDate)return!1;break;case"no-date":if(e.dueDate)return!1;break}}return!(this.filterState.priority&&e.metadata.priority!==this.filterState.priority)}getFilteredCards(e){return this.hasActiveFilters()?e.cards.filter(t=>this.cardMatchesFilter(t)):e.cards}getFilteredCardCount(){let e=0;for(let t of this.board.lanes)e+=this.getFilteredCards(t).length;return e}getTotalCardCount(){let e=0;for(let t of this.board.lanes)e+=t.cards.length;return e}renderLane(e,t){let n=this.getLaneWipConfig(t),s=t.cards.length,r=n.limit>0&&s>n.limit,o=n.limit>0&&n.warnAt&&s>=n.warnAt,c=["kanban-lane"];r?c.push("wip-exceeded"):o&&c.push("wip-warning");let l=e.createDiv({cls:c.join(" "),attr:{"data-lane-id":t.id}}),d=l.createDiv({cls:"kanban-lane-header"}),u=d.createDiv({cls:"kanban-lane-title-container"}),h=u.createSpan({cls:"kanban-lane-title",text:t.title});if(h.contentEditable="true",h.addEventListener("blur",()=>{t.title=h.textContent||"Untitled",this.requestSave()}),h.addEventListener("keydown",D=>{D.key==="Enter"&&(D.preventDefault(),h.blur())}),!this.getSetting("hide-card-count")){let D=this.getFilteredCards(t),P=n.limit>0?`${s}/${n.limit}`:`${s}`,N=["kanban-lane-count"];r?N.push("over-limit"):o&&N.push("at-warning");let le=u.createSpan({cls:N.join(" "),text:P});this.hasActiveFilters()&&D.length!==t.cards.length&&(le.title=`${D.length} visible, ${t.cards.length} total`)}let y=d.createDiv({cls:"kanban-lane-menu-btn"});(0,g.setIcon)(y,"more-vertical"),y.addEventListener("click",D=>{D.stopPropagation(),this.showLaneMenu(D,t)});let p=this.getSetting("show-card-composer")!==!1,w=this.getSetting("composer-position")||this.plugin.settings["composer-position"]||"bottom",m=!n.blockExceeded||!r;p&&w==="top"&&this.renderCardComposer(l,t,m);let v=l.createDiv({cls:"kanban-lane-cards",attr:{"data-lane-id":t.id}}),x=this.getFilteredCards(t);for(let D of x)this.renderCard(v,D,t);if(this.hasActiveFilters()&&x.length<t.cards.length){let D=t.cards.length-x.length,P=v.createDiv({cls:"kanban-hidden-cards-indicator"});P.textContent=`${D} card${D>1?"s":""} hidden by filter`}if(p&&w==="bottom"&&this.renderCardComposer(l,t,m),!p){let D=l.createDiv({cls:`kanban-add-card-btn ${m?"":"disabled"}`});D.createSpan({text:"+ Add card"}),m?D.addEventListener("click",()=>this.addCard(t)):D.title="WIP limit exceeded"}this.setupCardSortable(v,t)}getLaneWipConfig(e){let t=this.board.settings["lane-configs"]||{},n=t[e.title]||t[e.id];if(n!=null&&n.wipLimit)return{limit:n.wipLimit.limit,warnAt:n.wipLimit.warnAt||n.wipLimit.limit,blockExceeded:n.wipLimit.blockExceeded};let s=this.plugin.settings["default-wip-limit"]||0,r=this.plugin.settings["wip-block-exceeded"]||!1;return{limit:s,warnAt:s,blockExceeded:r}}renderCardComposer(e,t,n=!0){let s=e.createDiv({cls:`kanban-card-composer ${n?"":"disabled"}`}),r=s.createEl("textarea",{cls:"kanban-composer-input",attr:{placeholder:n?"Add a card... (Enter to add, Shift+Enter for newline)":"WIP limit exceeded",rows:"1",disabled:n?void 0:"disabled"}});if(!n){s.title="WIP limit exceeded - cannot add more cards";return}let o=()=>{r.style.height="auto",r.style.height=Math.min(r.scrollHeight,150)+"px"};r.addEventListener("input",o),r.addEventListener("keydown",l=>{if(l.key==="Enter"){if(l.shiftKey)return;{l.preventDefault();let d=r.value.trim();d&&(this.addCardFromComposer(t,d),r.value="",o())}}else l.key==="Escape"&&(r.value="",r.blur(),o())});let c=s.createDiv({cls:"kanban-composer-add-btn"});(0,g.setIcon)(c,"plus"),c.addEventListener("click",()=>{let l=r.value.trim();l&&(this.addCardFromComposer(t,l),r.value="",o())})}async addCardFromComposer(e,t){let n=t.split(`
`),s=n[0].trim(),r=n.slice(1),o=[],c=[];for(let p of r){let w=p.match(/^\s*-\s*\[([ xX])\]\s*(.*)$/);w?o.push({id:Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4),text:w[2].trim(),completed:w[1].toLowerCase()==="x"}):p.trim()&&c.push(p)}let l=this.getSetting("default-project"),d={id:Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4),title:s||"New card",completed:!1,tags:[],metadata:l?{project:l}:{},subtasks:o.length>0?o:void 0,content:r.length>0?r.map(p=>"	"+p).join(`
`):void 0},u=s.match(/#[\w-/]+/g)||[];d.tags=u.map(p=>p.substring(1));let h=s.match(/@(\d{4}-\d{2}-\d{2})(?:T(\d{2}:\d{2}))?/);h&&(d.dueDate=h[1],d.dueTime=h[2]),(this.getSetting("new-card-insertion-method")||this.plugin.settings["new-card-insertion-method"])==="prepend"?e.cards.unshift(d):e.cards.push(d),this.requestSave(),this.render(),(this.getSetting("auto-create-note")||this.plugin.settings["auto-create-note"])&&s&&await this.createCardNote(d)}renderSubtasks(e,t,n){if(!t.subtasks||t.subtasks.length===0)return;let s=e.createDiv({cls:"kanban-card-subtasks"}),r=t.subtasks.filter(h=>h.completed).length,o=t.subtasks.length,c=s.createDiv({cls:"kanban-subtasks-progress"});c.createSpan({cls:"subtask-count",text:`${r}/${o}`});let d=c.createDiv({cls:"subtask-progress-bar"}).createDiv({cls:"subtask-progress-fill"});d.style.width=`${r/o*100}%`,r===o&&c.addClass("all-complete");let u=s.createDiv({cls:"kanban-subtasks-list"});t.subtasks.forEach((h,b)=>{let y=u.createDiv({cls:`kanban-subtask ${h.completed?"is-completed":""}`}),p=y.createEl("input",{type:"checkbox"});p.checked=h.completed,p.addEventListener("change",w=>{w.stopPropagation(),h.completed=p.checked,y.toggleClass("is-completed",h.completed),t.content&&(t.content=On(t.content,b,h.completed));let m=t.subtasks.filter(x=>x.completed).length,v=c.querySelector(".subtask-count");v&&(v.textContent=`${m}/${o}`),d.style.width=`${m/o*100}%`,c.toggleClass("all-complete",m===o),this.requestSave()}),y.createSpan({cls:"subtask-text",text:h.text})})}renderCard(e,t,n){let s=["kanban-card"];t.completed&&s.push("is-completed"),t.baseTaskPath&&s.push("has-base-task");let r=e.createDiv({cls:s.join(" "),attr:{"data-card-id":t.id}});if(t.baseTaskPath){let p=r.createDiv({cls:"kanban-base-link-indicator"});p.title=`Linked to: ${t.baseTaskPath}`}if(this.getSetting("show-checkboxes")!==!1){let w=r.createDiv({cls:"kanban-card-checkbox"}).createEl("input",{type:"checkbox"});w.checked=t.completed,w.addEventListener("change",()=>{t.completed=w.checked,r.toggleClass("is-completed",t.completed),this.requestSave()})}let c=r.createDiv({cls:"kanban-card-content"}),l=this.getDisplayTitle(t),d=c.createDiv({cls:"kanban-card-title"});d.innerHTML=this.renderCardTitleHTML(l,t);let u=d.querySelector(".kanban-card-title-text");if(u&&(u.contentEditable="true",u.addEventListener("blur",async()=>{let p=u.textContent||"";if(t.title=this.reconstructCardTitle(p,t),this.requestSave(),this.pendingAutoCreateNote&&this.pendingAutoCreateNote.card.id===t.id){let w=this.pendingAutoCreateNote;this.pendingAutoCreateNote=null,t.title&&t.title!=="New card"&&await this.createCardNote(w.card)}}),u.addEventListener("keydown",p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),u.blur())})),this.renderMetadataPills(c,t),!this.getSetting("hide-tags-in-title")&&t.tags.length>0){let p=c.createDiv({cls:"kanban-card-tags"});for(let w of t.tags)p.createSpan({cls:"kanban-card-tag",text:`#${w}`}).addEventListener("click",v=>{var x,D,P,N;v.stopPropagation(),(N=(P=(D=(x=this.app.internalPlugins)==null?void 0:x.plugins)==null?void 0:D["global-search"])==null?void 0:P.instance)==null||N.openGlobalSearch(`tag:#${w}`)})}if(this.getSetting("show-subtasks")!==!1&&t.subtasks&&t.subtasks.length>0&&this.renderSubtasks(c,t,n),t.notePath){let p=c.createDiv({cls:"kanban-card-notes-indicator has-dedicated-note"});(0,g.setIcon)(p,"file-symlink"),p.title=`Open note: ${t.notePath}`,p.addEventListener("click",w=>{w.stopPropagation(),this.openCardNote(t)})}else if(t.notes||t.content){let p=c.createDiv({cls:"kanban-card-notes-indicator"});(0,g.setIcon)(p,t.content?"file-edit":"file-text"),p.title=t.content?"Edit card content":"Has inline notes",p.addEventListener("click",w=>{w.stopPropagation(),this.openCardContentModal(t)})}if(this.getSetting("show-card-menu")!==!1){let p=r.createDiv({cls:"kanban-card-menu-btn"});(0,g.setIcon)(p,"more-horizontal"),p.addEventListener("click",w=>{w.stopPropagation(),this.showCardMenu(w,t,n)})}r.addEventListener("click",p=>{var v;let w=p.target;if(w.contentEditable==="true"||w.tagName==="INPUT"||w.closest(".kanban-card-menu-btn")||w.closest(".kanban-card-tag")||w.closest(".kanban-card-notes-indicator")||w.closest(".kanban-subtask-checkbox"))return;if(t.notePath){this.openCardNote(t);return}let m=t.title.match(/\[\[([^\]|]+)(?:\|[^\]]+)?\]\]/);m&&this.app.workspace.openLinkText(m[1],((v=this.file)==null?void 0:v.path)||"")})}getDisplayTitle(e){let t=e.title;return this.getSetting("hide-tags-in-title")&&(t=t.replace(/#[\w-/]+/g,"").trim()),this.getSetting("hide-date-in-title")&&(t=t.replace(/@\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2})?/g,"").trim(),t=t.replace(/@@\d{2}:\d{2}/g,"").trim()),this.getSetting("hide-metadata-in-title")&&(t=t.replace(/\[\w+::[^\]]+\]/g,"").trim(),t=t.replace(/\w+::\S+/g,"").trim()),t.replace(/\s+/g," ").trim()}escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}renderCardTitleHTML(e,t){return`<span class="kanban-card-title-text">${this.escapeHtml(e).replace(/\[\[([^\]|]+)(?:\|([^\]]+))?\]\]/g,(r,o,c)=>`<a class="internal-link" data-href="${o.replace(/"/g,"&quot;")}">${c||o}</a>`)}</span>`}reconstructCardTitle(e,t){let n=e;if(this.getSetting("hide-tags-in-title")&&t.tags.length>0){let s=n.match(/#[\w-/]+/g)||[];for(let r of t.tags)s.includes(`#${r}`)||(n+=` #${r}`)}if(this.getSetting("hide-date-in-title")&&t.dueDate&&!n.includes("@")){let s=t.dueTime?`@${t.dueDate}T${t.dueTime}`:`@${t.dueDate}`;n+=` ${s}`}return n}renderMetadataPills(e,t){let n=e.createDiv({cls:"kanban-card-metadata-pills"}),s=!1;if(this.getSetting("show-progress")&&t.metadata.progress!==void 0){s=!0;let r=n.createDiv({cls:"kanban-metadata-pill kanban-progress-pill"});(0,g.setIcon)(r.createSpan(),"activity");let o=r.createSpan({cls:"pill-value",text:`${t.metadata.progress}%`}),l=r.createDiv({cls:"progress-bar-container"}).createDiv({cls:"progress-bar-fill"});l.style.width=`${t.metadata.progress}%`,t.metadata.progress>=100?r.addClass("complete"):t.metadata.progress>=50&&r.addClass("in-progress")}if(this.getSetting("show-project")&&t.metadata.project){s=!0;let r=n.createDiv({cls:"kanban-metadata-pill kanban-project-pill"});(0,g.setIcon)(r.createSpan(),"folder"),r.createSpan({cls:"pill-value",text:t.metadata.project})}if(t.dueDate||t.dueTime){s=!0;let r=n.createDiv({cls:"kanban-metadata-pill kanban-date-pill"});(0,g.setIcon)(r.createSpan(),t.dueDate?"calendar":"clock");let o="";if(t.dueDate){let l=this.getSetting("show-relative-date"),d=this.getSetting("date-format")||this.plugin.settings["date-format"];l?o=_n(t.dueDate):o=qt(t.dueDate,d,!1),t.dueTime&&(o+=` ${t.dueTime}`)}else t.dueTime&&(o=t.dueTime);let c=r.createSpan({cls:"pill-value",text:o});if(t.dueDate&&(r.title=t.dueDate+(t.dueTime?`T${t.dueTime}`:"")),t.dueDate&&this.getSetting("link-date-to-daily-note")&&(c.addClass("clickable"),c.addEventListener("click",l=>{var d;l.stopPropagation(),this.app.workspace.openLinkText(t.dueDate,((d=this.file)==null?void 0:d.path)||"")})),t.dueDate){let l=new Date().toISOString().split("T")[0];t.dueDate<l?r.addClass("overdue"):t.dueDate===l&&r.addClass("due-today")}}if(t.recurrence){s=!0;let r=n.createDiv({cls:"kanban-metadata-pill kanban-recurrence-pill"});(0,g.setIcon)(r.createSpan(),"repeat");let o=this.formatRecurrenceDisplay(t.recurrence);if(r.createSpan({cls:"pill-value",text:o}),t.dueDate){let c=In(t.recurrence,new Date(t.dueDate));r.title=`Next: ${c.toISOString().split("T")[0]}`}}if(t.metadata.priority){s=!0;let r=n.createDiv({cls:`kanban-metadata-pill kanban-priority-pill priority-${t.metadata.priority}`});(0,g.setIcon)(r.createSpan(),"flag"),r.createSpan({cls:"pill-value",text:t.metadata.priority})}if(t.reminderTime&&this.plugin.settings["enable-reminders"]){s=!0;let r=n.createDiv({cls:"kanban-metadata-pill kanban-reminder-pill"});(0,g.setIcon)(r.createSpan(),"bell"),r.createSpan({cls:"pill-value",text:t.reminderTime}),r.title=`Reminder ${t.reminderTime} before due`}s||n.remove()}formatRecurrenceDisplay(e){if(e._rawPattern){let t=e._rawPattern.toLowerCase();return t==="daily"||t==="every day"?"Daily":t==="weekly"||t==="every week"?"Weekly":t==="monthly"||t==="every month"?"Monthly":t==="yearly"||t==="every year"||t==="annually"?"Yearly":t==="weekdays"||t==="every weekday"?"Weekdays":t==="weekends"||t==="every weekend"?"Weekends":e._rawPattern.replace(/^every\s+/i,"")}return Ht(e)}setupCardSortable(e,t){let n=Yt.create(e,{group:"cards",animation:150,ghostClass:"kanban-card-ghost",chosenClass:"kanban-card-chosen",dragClass:"kanban-card-drag",handle:".kanban-card",filter:'.kanban-card-menu-btn, input, [contenteditable="true"], .kanban-card-tag, .kanban-metadata-pill',preventOnFilter:!1,onEnd:s=>{let r=s.item.getAttribute("data-card-id"),o=s.from.getAttribute("data-lane-id"),c=s.to.getAttribute("data-lane-id");if(!r||!o||!c)return;let l=this.board.lanes.find(b=>b.id===o),d=this.board.lanes.find(b=>b.id===c);if(!l||!d)return;let u=l.cards.findIndex(b=>b.id===r);if(u===-1)return;let[h]=l.cards.splice(u,1);d.cards.splice(s.newIndex||0,0,h),o!==c&&this.plugin.onCardMovedToLane(h,d.title),this.requestSave(),this.render()}});this.sortableInstances.push(n)}setupLaneSortable(e){let t=Yt.create(e,{animation:150,ghostClass:"kanban-lane-ghost",chosenClass:"kanban-lane-chosen",dragClass:"kanban-lane-drag",handle:".kanban-lane-header",filter:'.kanban-add-lane-btn, [contenteditable="true"]',preventOnFilter:!1,onEnd:n=>{let s=n.oldIndex,r=n.newIndex;if(s===void 0||r===void 0||s===r||r>=this.board.lanes.length)return;let[o]=this.board.lanes.splice(s,1);this.board.lanes.splice(r,0,o),this.requestSave(),this.render()}});this.sortableInstances.push(t)}showLaneMenu(e,t){let n=new g.Menu;n.addItem(o=>{o.setTitle("Add card").setIcon("plus").onClick(()=>this.addCard(t))}),this.getSetting("template-path")&&n.addItem(o=>{o.setTitle("Add card from template").setIcon("file-plus").onClick(()=>this.addCardFromTemplate(t))}),n.addSeparator(),n.addItem(o=>{o.setTitle("Move left").setIcon("arrow-left").onClick(()=>this.moveLane(t,-1))}),n.addItem(o=>{o.setTitle("Move right").setIcon("arrow-right").onClick(()=>this.moveLane(t,1))}),n.addSeparator(),n.addItem(o=>{o.setTitle("Archive all cards").setIcon("archive").onClick(()=>this.archiveLaneCards(t))}),n.addItem(o=>{o.setTitle("Archive completed").setIcon("check-square").onClick(()=>this.archiveCompletedInLane(t))}),n.addSeparator();let r=this.getLaneWipConfig(t);n.addItem(o=>{o.setTitle(`Set WIP limit${r.limit>0?` (currently ${r.limit})`:""}`).setIcon("gauge").onClick(()=>this.showWipLimitModal(t))}),n.addSeparator(),n.addItem(o=>{o.setTitle("Delete list").setIcon("trash").onClick(()=>this.deleteLane(t))}),n.showAtMouseEvent(e)}showWipLimitModal(e){new Qt(this.app,e,this.getLaneWipConfig(e),n=>{this.board.settings["lane-configs"]||(this.board.settings["lane-configs"]={}),this.board.settings["lane-configs"][e.title]||(this.board.settings["lane-configs"][e.title]={}),this.board.settings["lane-configs"][e.title].wipLimit=n,this.requestSave(),this.render()}).open()}showCardMenu(e,t,n){let s=new g.Menu;s.addItem(c=>{c.setTitle("Edit card").setIcon("pencil").onClick(()=>this.openCardEditModal(t))}),t.notePath?(s.addItem(c=>{c.setTitle("Open note").setIcon("file-symlink").onClick(()=>this.openCardNote(t))}),s.addItem(c=>{c.setTitle("Sync to note").setIcon("refresh-cw").onClick(()=>this.syncCardToNote(t))}),s.addItem(c=>{c.setTitle("Unlink note").setIcon("unlink").onClick(()=>this.unlinkCardNote(t))})):(s.addItem(c=>{c.setTitle("Create note").setIcon("file-plus").onClick(()=>this.createCardNote(t))}),s.addItem(c=>{c.setTitle("Link to existing note").setIcon("link").onClick(()=>this.linkToExistingNote(t))})),s.addItem(c=>{c.setTitle("Edit content").setIcon("file-edit").onClick(()=>this.openCardContentModal(t))}),!t.notePath&&!t.content&&s.addItem(c=>{c.setTitle("Edit inline notes").setIcon("file-text").onClick(()=>this.openCardNotesModal(t))}),s.addSeparator();let r=this.board.lanes.filter(c=>c.id!==n.id);r.length>0&&s.addItem(c=>{c.setTitle("Move to..."),c.setIcon("arrow-right");let l=c.setSubmenu();for(let d of r)l.addItem(u=>{u.setTitle(d.title).onClick(()=>this.moveCard(t,n,d))})}),s.addSeparator(),s.addItem(c=>{c.setTitle("Set progress...").setIcon("activity").onClick(()=>this.setCardProgress(t))}),s.addItem(c=>{c.setTitle("Set project...").setIcon("folder").onClick(()=>this.setCardProject(t))}),s.addItem(c=>{c.setTitle("Set due date...").setIcon("calendar").onClick(()=>this.setCardDueDate(t))}),s.addSeparator(),this.getBaseSyncConfig().enabled&&(t.baseTaskPath?(s.addItem(c=>{c.setTitle("Open Base task").setIcon("external-link").onClick(()=>{t.baseTaskPath&&this.app.workspace.openLinkText(t.baseTaskPath,"")})}),s.addItem(c=>{c.setTitle("Unlink from Base").setIcon("unlink").onClick(()=>{t.baseTaskPath=void 0,t.baseSyncTime=void 0,this.requestSave(),this.render(),new g.Notice("Card unlinked from Base task")})})):(s.addItem(c=>{c.setTitle("Link to Base task").setIcon("link").onClick(()=>this.linkCardToBaseTask(t))}),s.addItem(c=>{c.setTitle("Create Base task").setIcon("file-plus-2").onClick(()=>this.createBaseTaskForCard(t,n))})),s.addSeparator()),s.addItem(c=>{c.setTitle("Archive").setIcon("archive").onClick(()=>this.archiveCard(t,n))}),s.addItem(c=>{c.setTitle("Delete").setIcon("trash").onClick(()=>this.deleteCard(t,n))}),s.showAtMouseEvent(e)}addLane(){let e={id:Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4),title:"New List",cards:[]};this.board.lanes.push(e),this.requestSave(),this.render(),setTimeout(()=>{let t=this.boardContainer.querySelector(`[data-lane-id="${e.id}"] .kanban-lane-title`);if(t instanceof HTMLElement){t.focus();let n=document.createRange();n.selectNodeContents(t);let s=window.getSelection();s==null||s.removeAllRanges(),s==null||s.addRange(n)}},50)}moveLane(e,t){let n=this.board.lanes.indexOf(e),s=n+t;s<0||s>=this.board.lanes.length||(this.board.lanes.splice(n,1),this.board.lanes.splice(s,0,e),this.requestSave(),this.render())}deleteLane(e){let t=this.board.lanes.indexOf(e);t!==-1&&(this.board.lanes.splice(t,1),this.requestSave(),this.render())}addCard(e){let t=this.getSetting("default-project"),n={id:Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4),title:"New card",completed:!1,tags:[],metadata:t?{project:t}:{}};(this.getSetting("new-card-insertion-method")||this.plugin.settings["new-card-insertion-method"])==="prepend"?e.cards.unshift(n):e.cards.push(n),this.requestSave(),this.render(),setTimeout(()=>{let o=this.boardContainer.querySelector(`[data-card-id="${n.id}"] .kanban-card-title-text`);if(o instanceof HTMLElement){o.focus();let c=document.createRange();c.selectNodeContents(o);let l=window.getSelection();l==null||l.removeAllRanges(),l==null||l.addRange(c)}},50),(this.getSetting("auto-create-note")||this.plugin.settings["auto-create-note"])&&(this.pendingAutoCreateNote={card:n,lane:e})}async addCardFromTemplate(e){let t=this.getSetting("template-path");if(!t)return;let n=this.app.vault.getAbstractFileByPath(t);if(!(n instanceof g.TFile)){console.warn("Template file not found:",t);return}try{let s=await this.app.vault.read(n),r=this.getSetting("default-project"),o=$n(s,r?{project:r}:{});(this.getSetting("new-card-insertion-method")||this.plugin.settings["new-card-insertion-method"])==="prepend"?e.cards.unshift(o):e.cards.push(o),this.requestSave(),this.render()}catch(s){console.error("Error reading template:",s)}}moveCard(e,t,n){let s=t.cards.indexOf(e);s!==-1&&(t.cards.splice(s,1),n.cards.push(e),this.syncCardStatusToBase(e,n),this.requestSave(),this.render())}async syncCardStatusToBase(e,t){let n=this.getBaseSyncConfig();if(n.enabled){if(this.baseSyncService.setConfig(n),e.baseTaskPath)await this.baseSyncService.onCardMoveToLane(e,t)&&he(this.syncStatusEl,"success","Status synced");else if(n.createMissingTasks){let s=await this.baseSyncService.createBaseTask(e.title,e.metadata,t);s&&(e.baseTaskPath=s,e.baseSyncTime=Date.now(),he(this.syncStatusEl,"success","Task created"))}}}deleteCard(e,t){let n=t.cards.indexOf(e);n!==-1&&(t.cards.splice(n,1),this.requestSave(),this.render())}archiveCard(e,t){let n=t.cards.indexOf(e);if(n===-1)return;t.cards.splice(n,1);let s=e;this.plugin.settings["prepend-archive-date"]&&(s=He(e,this.plugin.settings["prepend-archive-format"])),this.board.archive.push(s),this.requestSave(),this.render()}archiveLaneCards(e){for(let t of e.cards){let n=t;this.plugin.settings["prepend-archive-date"]&&(n=He(t,this.plugin.settings["prepend-archive-format"])),this.board.archive.push(n)}e.cards=[],this.requestSave(),this.render()}archiveCompletedInLane(e){let t=e.cards.filter(s=>s.completed),n=e.cards.filter(s=>!s.completed);for(let s of t){let r=s;this.plugin.settings["prepend-archive-date"]&&(r=He(s,this.plugin.settings["prepend-archive-format"])),this.board.archive.push(r)}e.cards=n,this.requestSave(),this.render()}archiveCompletedCards(){for(let e of this.board.lanes){let t=e.cards.filter(s=>s.completed),n=e.cards.filter(s=>!s.completed);for(let s of t){let r=s;this.plugin.settings["prepend-archive-date"]&&(r=He(s,this.plugin.settings["prepend-archive-format"])),this.board.archive.push(r)}e.cards=n}this.requestSave(),this.render()}openCardEditModal(e){new Xt(this.app,e,n=>{Object.assign(e,n),this.requestSave(),this.render()}).open()}openCardNotesModal(e){new Ut(this.app,e,n=>{e.notes=n||void 0,this.requestSave(),this.render()}).open()}openCardContentModal(e){new zt(this.app,e,(n,s)=>{if(e.content=n||void 0,e.subtasks=s&&s.length>0?s:void 0,!(!n&&e.notes)){if(n){let r=[];for(let o of n.split(`
`)){let c=o.match(/^\s*>\s?(.*)$/);c&&r.push(c[1])}e.notes=r.length>0?r.join(`
`):void 0}}this.requestSave(),this.render()}).open()}setCardProgress(e){var n;new qe(this.app,"Set Progress","Enter progress (0-100%)",((n=e.metadata.progress)==null?void 0:n.toString())||"0",async s=>{let r=parseInt(s.replace("%",""),10);if(!isNaN(r)){let o=Math.min(100,Math.max(0,r));e.metadata.progress=o,await this.syncCardProgressToBase(e,o),this.requestSave(),this.render()}}).open()}async syncCardProgressToBase(e,t){let n=this.getBaseSyncConfig();if(!n.enabled||!e.baseTaskPath)return;this.baseSyncService.setConfig(n),await this.baseSyncService.syncProgress(e,t)&&he(this.syncStatusEl,"success","Progress synced")}setCardProject(e){new qe(this.app,"Set Project","Enter project name",e.metadata.project||"",async n=>{e.metadata.project=n||void 0,await this.syncCardProjectToBase(e,n),this.requestSave(),this.render()}).open()}async syncCardProjectToBase(e,t){let n=this.getBaseSyncConfig();if(!n.enabled||!e.baseTaskPath)return;this.baseSyncService.setConfig(n),await this.baseSyncService.syncProject(e,t)&&he(this.syncStatusEl,"success","Project synced")}setCardDueDate(e){new qe(this.app,"Set Due Date","Enter date (YYYY-MM-DD)",e.dueDate||"",n=>{n.match(/^\d{4}-\d{2}-\d{2}$/)?e.dueDate=n:n||(e.dueDate=void 0),this.requestSave(),this.render()}).open()}openBoardSettings(){new Jt(this.app,this.board.settings,t=>{this.board.settings=t,this.requestSave(),this.render()}).open()}async openCardNote(e){var n;if(!e.notePath)return;let t=this.app.vault.getAbstractFileByPath(e.notePath);t instanceof g.TFile?(await this.syncCardFromNote(e,t),await this.app.workspace.openLinkText(e.notePath,((n=this.file)==null?void 0:n.path)||"")):new wt(this.app,"Note not found",`The note "${e.notePath}" no longer exists. Would you like to create it?`,async()=>{await this.createCardNote(e)}).open()}async createCardNote(e){var l,d,u;let t=this.getSetting("card-note-template")||this.plugin.settings["card-note-template"],n=this.getSetting("card-note-folder")||this.plugin.settings["card-note-folder"],r=this.sanitizeFilename(e.title)||`card-${e.id}`,o="";if(n)this.app.vault.getAbstractFileByPath(n)||await this.app.vault.createFolder(n),o=`${n}/${r}.md`;else{let h=((d=(l=this.file)==null?void 0:l.parent)==null?void 0:d.path)||"";o=h?`${h}/${r}.md`:`${r}.md`}o=await this.ensureUniqueFilename(o);let c=await this.generateCardNoteContent(e,t);try{let h=await this.app.vault.create(o,c);if(e.notePath=h.path,e.notes){let b=await this.app.vault.read(h);b.includes(e.notes)||await this.app.vault.modify(h,b+`

## Notes

`+e.notes),e.notes=void 0}this.requestSave(),this.render(),await this.app.workspace.openLinkText(h.path,((u=this.file)==null?void 0:u.path)||"")}catch(h){console.error("Error creating card note:",h)}}async unlinkCardNote(e){if(!e.notePath)return;new wt(this.app,"Unlink note",`Unlink "${e.notePath}" from this card? The note file will be kept.`,()=>{e.notePath=void 0,this.requestSave(),this.render(),new g.Notice("Note unlinked from card")}).open()}async linkToExistingNote(e){new Zt(this.app,async n=>{if(n){e.notePath=n;let s=this.app.vault.getAbstractFileByPath(n);s instanceof g.TFile&&await this.syncCardFromNote(e,s),this.requestSave(),this.render(),new g.Notice(`Card linked to: ${n}`)}}).open()}sanitizeFilename(e){let t=e.replace(/\[\[([^\]|]+)(?:\|[^\]]+)?\]\]/g,"$1");return t=t.replace(/\[\w+::[^\]]+\]/g,""),t=t.replace(/\w+::\S+/g,""),t=t.replace(/#[\w-/]+/g,""),t=t.replace(/@\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2})?/g,""),t=t.replace(/@@\d{2}:\d{2}/g,""),t=t.replace(/[\\/:*?"<>|]/g,""),t=t.replace(/\s+/g," ").trim(),t.length>100&&(t=t.substring(0,100).trim()),t}async ensureUniqueFilename(e){let t=e.endsWith(".md")?"":".md",n=e.endsWith(".md")?e:e+t,s=1;for(;this.app.vault.getAbstractFileByPath(n);)n=`${e.replace(/\.md$/,"")} ${s}.md`,s++;return n}async generateCardNoteContent(e,t){let n="";if(t){let s=this.app.vault.getAbstractFileByPath(t);if(s instanceof g.TFile)try{n=await this.app.vault.read(s),n=this.processCardNoteTemplate(n,e)}catch(r){console.warn("Error reading template:",r)}}return n||(n=this.generateDefaultCardNoteContent(e)),n}processCardNoteTemplate(e,t){var s,r,o;let n=Gt({title:t.title,project:t.metadata.project,dueDate:t.dueDate,priority:t.metadata.priority,tags:t.tags,customVars:{dueTime:t.dueTime||"",progress:((s=t.metadata.progress)==null?void 0:s.toString())||"",completed:t.completed?"true":"false",board:((r=this.file)==null?void 0:r.basename)||"",boardPath:((o=this.file)==null?void 0:o.path)||"",cardId:t.id,notes:t.notes||""}});return Wt(e,n)}generateDefaultCardNoteContent(e){var s;let t=[];t.push("---"),t.push(`kanban-card: ${e.id}`),t.push(`kanban-board: "[[${((s=this.file)==null?void 0:s.basename)||"Kanban"}]]"`),e.dueDate&&t.push(`due: ${e.dueDate}${e.dueTime?"T"+e.dueTime:""}`),e.metadata.progress!==void 0&&t.push(`progress: ${e.metadata.progress}`),e.metadata.project&&t.push(`project: "${e.metadata.project}"`),e.metadata.priority&&t.push(`priority: ${e.metadata.priority}`),e.tags.length>0&&t.push(`tags: [${e.tags.map(r=>`"${r}"`).join(", ")}]`),t.push(`completed: ${e.completed}`),t.push(`created: ${new Date().toISOString().split("T")[0]}`),t.push("---"),t.push("");let n=this.getDisplayTitle(e);if(t.push(`# ${n||"Card"}`),t.push(""),e.notes&&(t.push("## Notes"),t.push(""),t.push(e.notes),t.push("")),e.subtasks&&e.subtasks.length>0){t.push("## Tasks"),t.push("");for(let r of e.subtasks)t.push(`- [${r.completed?"x":" "}] ${r.text}`);t.push("")}return t.join(`
`)}async syncCardToNote(e){if(!e.notePath)return;let t=this.app.vault.getAbstractFileByPath(e.notePath);if(t instanceof g.TFile)try{let n=await this.app.vault.read(t),s=n.match(/^---\n([\s\S]*?)\n---/);if(s){let o=s[1];o=this.updateFrontmatterField(o,"due",e.dueDate?e.dueTime?`${e.dueDate}T${e.dueTime}`:e.dueDate:void 0),o=this.updateFrontmatterField(o,"progress",e.metadata.progress!==void 0?String(e.metadata.progress):void 0),o=this.updateFrontmatterField(o,"project",e.metadata.project),o=this.updateFrontmatterField(o,"priority",e.metadata.priority),o=this.updateFrontmatterField(o,"completed",String(e.completed)),e.tags.length>0&&(o=this.updateFrontmatterField(o,"tags",`[${e.tags.map(c=>`"${c}"`).join(", ")}]`)),n=n.replace(s[0],`---
${o}
---`)}else n=this.generateCardFrontmatter(e)+`
`+n;let r=n.match(/^# .+$/m);if(r){let o=this.getDisplayTitle(e);n=n.replace(r[0],`# ${o}`)}await this.app.vault.modify(t,n)}catch(n){console.warn("Error syncing card to note:",n)}}updateFrontmatterField(e,t,n){let s=e.split(`
`),r=new RegExp(`^${t}:\\s*.*$`,"m");if(n!==void 0&&n!==""){let o=s.findIndex(d=>d.startsWith(`${t}:`)),l=(n.includes(":")||n.includes("#")||n.includes('"'))&&!n.startsWith("[")?`"${n}"`:n;o>=0?s[o]=`${t}: ${l}`:s.push(`${t}: ${l}`)}else{let o=s.findIndex(c=>c.startsWith(`${t}:`));o>=0&&s.splice(o,1)}return s.filter(o=>o.trim()!==""||o==="").join(`
`)}generateCardFrontmatter(e){var n;let t=["---"];return t.push(`kanban-card: ${e.id}`),t.push(`kanban-board: "[[${((n=this.file)==null?void 0:n.basename)||"Kanban"}]]"`),e.dueDate&&t.push(`due: ${e.dueDate}${e.dueTime?"T"+e.dueTime:""}`),e.metadata.progress!==void 0&&t.push(`progress: ${e.metadata.progress}`),e.metadata.project&&t.push(`project: "${e.metadata.project}"`),e.metadata.priority&&t.push(`priority: ${e.metadata.priority}`),e.tags.length>0&&t.push(`tags: [${e.tags.map(s=>`"${s}"`).join(", ")}]`),t.push(`completed: ${e.completed}`),t.push("---"),t.join(`
`)}async syncCardFromNote(e,t){try{let n=await this.app.vault.read(t),s=this.app.metadataCache.getFileCache(t);if(s!=null&&s.frontmatter){let r=s.frontmatter;if(s.headings&&s.headings.length>0){let o=s.headings[0];if(o.level===1){let c=o.heading;c&&c!==e.title&&(e.title=c)}}r.due&&typeof r.due=="string"&&(e.dueDate=r.due),r.progress!==void 0&&(e.metadata.progress=typeof r.progress=="number"?r.progress:parseInt(r.progress,10)),r.project&&(e.metadata.project=r.project),r.priority&&(e.metadata.priority=r.priority),r.completed!==void 0&&(e.completed=r.completed===!0||r.completed==="true"),Array.isArray(r.tags)&&(e.tags=r.tags.map(o=>o.replace(/^#/,""))),this.requestSave(),this.render()}}catch(n){console.warn("Error syncing card from note:",n)}}async createOrOpenCardNote(){let e=this.findFocusedCard();e&&(e.card.notePath?await this.openCardNote(e.card):await this.createCardNote(e.card))}findFocusedCard(){let e=document.activeElement;if(e){let t=e.closest("[data-card-id]");if(t){let n=t.getAttribute("data-card-id");for(let s of this.board.lanes){let r=s.cards.find(o=>o.id===n);if(r)return{card:r,lane:s}}}}return null}},Xt=class extends g.Modal{constructor(e,t,n){super(e);this.card={...t,metadata:{...t.metadata}},this.onSave=n}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("kanban-card-edit-modal"),e.createEl("h2",{text:"Edit Card"}),new g.Setting(e).setName("Title").addText(t=>t.setValue(this.card.title).onChange(n=>this.card.title=n)),new g.Setting(e).setName("Due Date").setDesc("YYYY-MM-DD format").addText(t=>t.setValue(this.card.dueDate||"").onChange(n=>this.card.dueDate=n||void 0)),new g.Setting(e).setName("Progress").setDesc("0-100").addSlider(t=>t.setLimits(0,100,5).setValue(this.card.metadata.progress||0).setDynamicTooltip().onChange(n=>this.card.metadata.progress=n)),new g.Setting(e).setName("Project").addText(t=>t.setValue(this.card.metadata.project||"").onChange(n=>this.card.metadata.project=n||void 0)),new g.Setting(e).setName("Priority").addDropdown(t=>t.addOption("","None").addOption("low","Low").addOption("medium","Medium").addOption("high","High").addOption("urgent","Urgent").setValue(this.card.metadata.priority||"").onChange(n=>this.card.metadata.priority=n||void 0)),new g.Setting(e).addButton(t=>t.setButtonText("Save").setCta().onClick(()=>{this.onSave(this.card),this.close()})).addButton(t=>t.setButtonText("Cancel").onClick(()=>this.close()))}onClose(){let{contentEl:e}=this;e.empty()}},Ut=class extends g.Modal{constructor(e,t,n){super(e);this.card=t,this.notesValue=t.notes||"",this.onSave=n}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("kanban-card-notes-modal"),e.createEl("h2",{text:"Card Notes"}),e.createEl("p",{text:this.card.title,cls:"kanban-notes-card-title"});let t=e.createEl("textarea",{cls:"kanban-notes-textarea",attr:{rows:"10"}});t.value=this.notesValue,t.addEventListener("input",()=>{this.notesValue=t.value}),new g.Setting(e).addButton(n=>n.setButtonText("Save").setCta().onClick(()=>{this.onSave(this.notesValue),this.close()})).addButton(n=>n.setButtonText("Cancel").onClick(()=>this.close()))}onClose(){let{contentEl:e}=this;e.empty()}},zt=class extends g.Modal{constructor(e,t,n){super(e);this.card=t,this.contentValue=t.content||"",this.subtasks=t.subtasks?[...t.subtasks]:[],this.onSave=n}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("kanban-card-content-modal"),e.createEl("h2",{text:"Edit Card Content"}),e.createEl("p",{text:this.card.title,cls:"kanban-content-card-title"}),e.createEl("p",{text:'Add subtasks with "- [ ] task" format. Content is saved in markdown under the card.',cls:"kanban-content-info"});let t=e.createEl("textarea",{cls:"kanban-content-textarea",attr:{rows:"12",placeholder:`Add content, notes, or subtasks...

- [ ] Subtask 1
- [ ] Subtask 2

> Notes can use > prefix`}});if(this.subtasks.length>0&&!this.contentValue){let l=this.subtasks.map(d=>`	- [${d.completed?"x":" "}] ${d.text}`);this.contentValue=l.join(`
`)}if(this.card.notes&&!this.contentValue){let l=this.card.notes.split(`
`).map(d=>`	> ${d}`);this.contentValue=l.join(`
`)}t.value=this.contentValue,t.addEventListener("input",()=>{this.contentValue=t.value,this.parseSubtasksFromContent(),this.updateSubtaskPreview()});let n=e.createDiv({cls:"kanban-content-preview"});n.createEl("h4",{text:"Subtasks Preview"}),this.subtaskPreviewEl=n.createDiv({cls:"kanban-subtask-preview-list"}),this.updateSubtaskPreview();let s=e.createDiv({cls:"kanban-quick-add-subtask"}),r=s.createEl("input",{type:"text",cls:"kanban-subtask-input",attr:{placeholder:"Quick add subtask..."}}),o=s.createEl("button",{text:"Add"}),c=()=>{let l=r.value.trim();if(l){let d=`	- [ ] ${l}`;this.contentValue?this.contentValue+=`
`+d:this.contentValue=d,t.value=this.contentValue,this.parseSubtasksFromContent(),this.updateSubtaskPreview(),r.value=""}};o.addEventListener("click",c),r.addEventListener("keydown",l=>{l.key==="Enter"&&(l.preventDefault(),c())}),new g.Setting(e).addButton(l=>l.setButtonText("Save").setCta().onClick(()=>{this.parseSubtasksFromContent(),this.onSave(this.contentValue,this.subtasks),this.close()})).addButton(l=>l.setButtonText("Cancel").onClick(()=>this.close()))}parseSubtasksFromContent(){this.subtasks=[];let e=this.contentValue.split(`
`);for(let t of e){let n=t.match(/^\s*-\s*\[([ xX])\]\s*(.*)$/);n&&this.subtasks.push({id:Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4),text:n[2].trim(),completed:n[1].toLowerCase()==="x"})}}updateSubtaskPreview(){if(this.subtaskPreviewEl.empty(),this.subtasks.length===0){this.subtaskPreviewEl.createEl("p",{text:'No subtasks found. Add subtasks with "- [ ] task" format.',cls:"kanban-subtask-empty"});return}let e=this.subtasks.filter(t=>t.completed).length;this.subtaskPreviewEl.createEl("p",{text:`${e}/${this.subtasks.length} completed`,cls:"kanban-subtask-summary"});for(let t of this.subtasks){let n=this.subtaskPreviewEl.createDiv({cls:`kanban-subtask-preview-item ${t.completed?"is-completed":""}`});n.createSpan({text:t.completed?"\u2611":"\u2610"}),n.createSpan({text:t.text})}}onClose(){let{contentEl:e}=this;e.empty()}},qe=class extends g.Modal{constructor(e,t,n,s,r){super(e);this.title=t,this.placeholder=n,this.initialValue=s,this.onSave=r}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h3",{text:this.title});let t=this.initialValue;new g.Setting(e).setName(this.placeholder).addText(n=>n.setValue(this.initialValue).onChange(s=>t=s).inputEl.addEventListener("keydown",s=>{s.key==="Enter"&&(this.onSave(t),this.close())})),new g.Setting(e).addButton(n=>n.setButtonText("OK").setCta().onClick(()=>{this.onSave(t),this.close()})).addButton(n=>n.setButtonText("Cancel").onClick(()=>this.close()))}onClose(){let{contentEl:e}=this;e.empty()}},Jt=class extends g.Modal{constructor(e,t,n){super(e);this.settings={...t},this.onSave=n}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("kanban-board-settings-modal"),e.createEl("h2",{text:"Board Settings"}),e.createEl("p",{text:"These settings override global plugin settings for this board.",cls:"setting-item-description"}),e.createEl("h3",{text:"Display"}),new g.Setting(e).setName("Lane width").setDesc("Width of lanes (e.g., 272px, 300px)").addText(n=>n.setValue(this.settings["lane-width"]||"").setPlaceholder("272px").onChange(s=>this.settings["lane-width"]=s||void 0)),new g.Setting(e).setName("Show checkboxes").addToggle(n=>n.setValue(this.settings["show-checkboxes"]!==!1).onChange(s=>this.settings["show-checkboxes"]=s)),new g.Setting(e).setName("Show card count").addToggle(n=>n.setValue(this.settings["hide-card-count"]!==!0).onChange(s=>this.settings["hide-card-count"]=!s)),new g.Setting(e).setName("Hide tags in title").addToggle(n=>n.setValue(this.settings["hide-tags-in-title"]||!1).onChange(s=>this.settings["hide-tags-in-title"]=s)),new g.Setting(e).setName("Hide dates in title").addToggle(n=>n.setValue(this.settings["hide-date-in-title"]||!1).onChange(s=>this.settings["hide-date-in-title"]=s)),e.createEl("h3",{text:"Metadata"}),new g.Setting(e).setName("Show progress").addToggle(n=>n.setValue(this.settings["show-progress"]!==!1).onChange(s=>this.settings["show-progress"]=s)),new g.Setting(e).setName("Show project").addToggle(n=>n.setValue(this.settings["show-project"]!==!1).onChange(s=>this.settings["show-project"]=s)),new g.Setting(e).setName("Default project").setDesc("Default project for new cards").addText(n=>n.setValue(this.settings["default-project"]||"").onChange(s=>this.settings["default-project"]=s||void 0)),e.createEl("h3",{text:"Dates"}),new g.Setting(e).setName("Date format").addText(n=>n.setValue(this.settings["date-format"]||"").setPlaceholder("YYYY-MM-DD").onChange(s=>this.settings["date-format"]=s||void 0)),new g.Setting(e).setName("Show relative dates").addToggle(n=>n.setValue(this.settings["show-relative-date"]||!1).onChange(s=>this.settings["show-relative-date"]=s)),new g.Setting(e).setName("Link dates to daily notes").addToggle(n=>n.setValue(this.settings["link-date-to-daily-note"]||!1).onChange(s=>this.settings["link-date-to-daily-note"]=s)),e.createEl("h3",{text:"Cards"}),new g.Setting(e).setName("New card position").addDropdown(n=>n.addOption("","Use global setting").addOption("prepend","Top of list").addOption("append","Bottom of list").setValue(this.settings["new-card-insertion-method"]||"").onChange(s=>this.settings["new-card-insertion-method"]=s||void 0)),new g.Setting(e).setName("Template path").setDesc("Path to template file for new cards").addText(n=>n.setValue(this.settings["template-path"]||"").setPlaceholder("templates/card.md").onChange(s=>this.settings["template-path"]=s||void 0)),e.createEl("h3",{text:"Card Composer"}),new g.Setting(e).setName("Show card composer").setDesc("Show quick-add composer in lanes").addToggle(n=>n.setValue(this.settings["show-card-composer"]!==!1).onChange(s=>this.settings["show-card-composer"]=s)),new g.Setting(e).setName("Composer position").setDesc("Where to show the quick-add composer").addDropdown(n=>n.addOption("bottom","Bottom of lane").addOption("top","Top of lane").setValue(this.settings["composer-position"]||"bottom").onChange(s=>this.settings["composer-position"]=s)),new g.Setting(e).setName("Show subtasks").setDesc("Display subtask checkboxes in cards").addToggle(n=>n.setValue(this.settings["show-subtasks"]!==!1).onChange(s=>this.settings["show-subtasks"]=s)),e.createEl("h3",{text:"Card Notes"});let t=e.createDiv({cls:"kanban-settings-info"});t.createEl("span",{text:"Template variables: ",cls:"setting-item-name"}),t.createEl("span",{text:"{{title}}, {{date}}, {{time}}, {{project}}, {{lane}}, {{board}}, {{dueDate}}, {{tags}}, {{id}}",cls:"kanban-template-var"}),new g.Setting(e).setName("Card note template").setDesc("Template file for dedicated card notes").addText(n=>n.setValue(this.settings["card-note-template"]||"").setPlaceholder("templates/card-note.md").onChange(s=>this.settings["card-note-template"]=s||void 0)),new g.Setting(e).setName("Card note folder").setDesc("Folder for dedicated card notes").addText(n=>n.setValue(this.settings["card-note-folder"]||"").setPlaceholder("cards/").onChange(s=>this.settings["card-note-folder"]=s||void 0)),new g.Setting(e).setName("Auto-create note for new cards").setDesc("Automatically create a dedicated note when adding new cards").addToggle(n=>n.setValue(this.settings["auto-create-note"]||!1).onChange(s=>this.settings["auto-create-note"]=s)),new g.Setting(e).addButton(n=>n.setButtonText("Save").setCta().onClick(()=>{let s={};for(let[r,o]of Object.entries(this.settings))o!==void 0&&o!==""&&(s[r]=o);this.onSave(s),this.close()})).addButton(n=>n.setButtonText("Cancel").onClick(()=>this.close()))}onClose(){let{contentEl:e}=this;e.empty()}},wt=class extends g.Modal{constructor(e,t,n,s){super(e);this.title=t,this.message=n,this.onConfirm=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h3",{text:this.title}),e.createEl("p",{text:this.message}),new g.Setting(e).addButton(t=>t.setButtonText("Yes").setCta().onClick(()=>{this.onConfirm(),this.close()})).addButton(t=>t.setButtonText("No").onClick(()=>this.close()))}onClose(){let{contentEl:e}=this;e.empty()}},Qt=class extends g.Modal{constructor(e,t,n,s){super(e);this.lane=t,this.currentConfig={...n},this.onSave=s}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("kanban-wip-limit-modal"),e.createEl("h2",{text:`WIP Limit: ${this.lane.title}`}),e.createEl("p",{text:"Set a Work In Progress limit for this lane. Cards exceeding the limit will show a warning.",cls:"setting-item-description"}),new g.Setting(e).setName("WIP limit").setDesc("Maximum cards allowed (0 = no limit)").addText(t=>t.setPlaceholder("0").setValue(String(this.currentConfig.limit)).onChange(n=>{let s=parseInt(n,10);this.currentConfig.limit=isNaN(s)?0:Math.max(0,s)})),new g.Setting(e).setName("Warning threshold").setDesc("Show warning when this many cards (leave empty to use limit)").addText(t=>t.setPlaceholder("Same as limit").setValue(this.currentConfig.warnAt?String(this.currentConfig.warnAt):"").onChange(n=>{let s=parseInt(n,10);this.currentConfig.warnAt=isNaN(s)?void 0:Math.max(0,s)})),new g.Setting(e).setName("Block when exceeded").setDesc("Prevent adding new cards when limit is exceeded").addToggle(t=>t.setValue(this.currentConfig.blockExceeded).onChange(n=>this.currentConfig.blockExceeded=n)),new g.Setting(e).addButton(t=>t.setButtonText("Save").setCta().onClick(()=>{this.onSave(this.currentConfig),this.close()})).addButton(t=>t.setButtonText("Remove limit").onClick(()=>{this.onSave({limit:0,blockExceeded:!1}),this.close()})).addButton(t=>t.setButtonText("Cancel").onClick(()=>this.close()))}onClose(){let{contentEl:e}=this;e.empty()}},Zt=class extends g.Modal{constructor(e,t){super(e);this.allNotes=[];this.onSelect=t}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("kanban-note-link-modal"),e.createEl("h2",{text:"Link to Note"}),e.createEl("p",{text:"Search for an existing note to link to this card.",cls:"setting-item-description"}),this.searchInput=e.createEl("input",{type:"text",cls:"note-link-search",attr:{placeholder:"Search notes..."}}),this.searchInput.addEventListener("input",()=>this.updateResults()),this.resultsEl=e.createDiv({cls:"note-link-results"}),this.loadNotes(),this.searchInput.focus(),new g.Setting(e).addButton(t=>t.setButtonText("Cancel").onClick(()=>{this.onSelect(null),this.close()}))}loadNotes(){this.allNotes=this.app.vault.getMarkdownFiles().sort((e,t)=>t.stat.mtime-e.stat.mtime),this.updateResults()}updateResults(){this.resultsEl.empty();let e=this.searchInput.value.toLowerCase(),t=this.allNotes.filter(n=>n.basename.toLowerCase().includes(e)||n.path.toLowerCase().includes(e)).slice(0,20);if(t.length===0){this.resultsEl.createEl("p",{text:e?"No matching notes found":"Start typing to search notes",cls:"note-link-empty"});return}for(let n of t){let s=this.resultsEl.createDiv({cls:"note-link-item"});s.createEl("strong",{text:n.basename}),s.createEl("span",{text:n.path,cls:"note-link-path"}),s.addEventListener("click",()=>{this.onSelect(n.path),this.close()})}}onClose(){let{contentEl:e}=this;e.empty()}};var k=require("obsidian");var kt=class extends k.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h1",{text:"Kanban Settings"}),e.createEl("h2",{text:"Display"}),new k.Setting(e).setName("Default lane width").setDesc("Default width for lanes (e.g., 272px, 300px, 20rem)").addText(l=>l.setPlaceholder("272px").setValue(this.plugin.settings["default-lane-width"]).onChange(async d=>{this.plugin.settings["default-lane-width"]=d||Z["default-lane-width"],await this.plugin.saveSettings()})),new k.Setting(e).setName("Show checkboxes").setDesc("Show completion checkboxes on cards").addToggle(l=>l.setValue(this.plugin.settings["show-checkboxes"]).onChange(async d=>{this.plugin.settings["show-checkboxes"]=d,await this.plugin.saveSettings()})),new k.Setting(e).setName("Show card menu").setDesc("Show the menu button on cards").addToggle(l=>l.setValue(this.plugin.settings["show-card-menu"]).onChange(async d=>{this.plugin.settings["show-card-menu"]=d,await this.plugin.saveSettings()})),new k.Setting(e).setName("Hide tags in card titles").setDesc("Hide #tags from displaying inline in card titles (still shown as pills)").addToggle(l=>l.setValue(this.plugin.settings["hide-tags-in-title"]).onChange(async d=>{this.plugin.settings["hide-tags-in-title"]=d,await this.plugin.saveSettings()})),new k.Setting(e).setName("Hide dates in card titles").setDesc("Hide @dates from displaying inline in card titles (still shown as pills)").addToggle(l=>l.setValue(this.plugin.settings["hide-date-in-title"]).onChange(async d=>{this.plugin.settings["hide-date-in-title"]=d,await this.plugin.saveSettings()})),new k.Setting(e).setName("Hide metadata in card titles").setDesc("Hide [key::value] metadata from displaying inline (still shown as pills)").addToggle(l=>l.setValue(this.plugin.settings["hide-metadata-in-title"]).onChange(async d=>{this.plugin.settings["hide-metadata-in-title"]=d,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Metadata (Base Integration)"}),new k.Setting(e).setName("Show progress").setDesc("Display progress percentage on cards").addToggle(l=>l.setValue(this.plugin.settings["show-progress"]).onChange(async d=>{this.plugin.settings["show-progress"]=d,await this.plugin.saveSettings()})),new k.Setting(e).setName("Show project").setDesc("Display project name on cards").addToggle(l=>l.setValue(this.plugin.settings["show-project"]).onChange(async d=>{this.plugin.settings["show-project"]=d,await this.plugin.saveSettings()})),new k.Setting(e).setName("Default project").setDesc("Default project name for new cards (leave empty for none)").addText(l=>l.setPlaceholder("").setValue(this.plugin.settings["default-project"]).onChange(async d=>{this.plugin.settings["default-project"]=d,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Cards"}),new k.Setting(e).setName("New card insertion method").setDesc("Where to insert new cards in a lane").addDropdown(l=>l.addOption("prepend","At the top").addOption("append","At the bottom").setValue(this.plugin.settings["new-card-insertion-method"]).onChange(async d=>{this.plugin.settings["new-card-insertion-method"]=d,await this.plugin.saveSettings()})),new k.Setting(e).setName("Template path").setDesc("Path to a template file for creating new cards (e.g., templates/card-template.md)").addText(l=>l.setPlaceholder("templates/card-template.md").setValue(this.plugin.settings["template-path"]).onChange(async d=>{this.plugin.settings["template-path"]=d,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Card Composer"}),new k.Setting(e).setName("Show card composer").setDesc("Show quick-add composer in lanes for rapid card creation").addToggle(l=>l.setValue(this.plugin.settings["show-card-composer"]).onChange(async d=>{this.plugin.settings["show-card-composer"]=d,await this.plugin.saveSettings()})),new k.Setting(e).setName("Composer position").setDesc("Where to show the quick-add composer in lanes").addDropdown(l=>l.addOption("bottom","Bottom of lane").addOption("top","Top of lane").setValue(this.plugin.settings["composer-position"]).onChange(async d=>{this.plugin.settings["composer-position"]=d,await this.plugin.saveSettings()})),new k.Setting(e).setName("Show subtasks").setDesc("Display subtask checkboxes in card view").addToggle(l=>l.setValue(this.plugin.settings["show-subtasks"]).onChange(async d=>{this.plugin.settings["show-subtasks"]=d,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Filtering"}),new k.Setting(e).setName("Show filter toolbar").setDesc("Display filter toolbar at the top of boards for searching and filtering cards").addToggle(l=>l.setValue(this.plugin.settings["show-filter-toolbar"]).onChange(async d=>{this.plugin.settings["show-filter-toolbar"]=d,await this.plugin.saveSettings()})),e.createEl("h2",{text:"WIP Limits"}),e.createEl("p",{text:"Work In Progress limits help manage workflow by limiting cards per lane. Configure per-lane limits in board settings.",cls:"setting-item-description"}),new k.Setting(e).setName("Default WIP limit").setDesc("Default maximum cards per lane (0 = no limit). Can be overridden per-lane.").addText(l=>l.setPlaceholder("0").setValue(String(this.plugin.settings["default-wip-limit"])).onChange(async d=>{let u=parseInt(d,10);this.plugin.settings["default-wip-limit"]=isNaN(u)?0:Math.max(0,u),await this.plugin.saveSettings()})),new k.Setting(e).setName("Block when exceeded").setDesc("Prevent adding new cards when a lane exceeds its WIP limit").addToggle(l=>l.setValue(this.plugin.settings["wip-block-exceeded"]).onChange(async d=>{this.plugin.settings["wip-block-exceeded"]=d,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Card Notes"});let t=e.createDiv({cls:"kanban-settings-info"});t.createEl("p",{text:"Available template variables:",cls:"setting-item-name"});let n=t.createEl("ul",{cls:"kanban-template-vars-list"}),s=["{{title}} - Card title","{{id}} - Unique card ID","{{date}} - Current date (YYYY-MM-DD)","{{time}} - Current time (HH:mm)","{{datetime}} - Full ISO datetime","{{dueDate}} - Card due date","{{project}} - Project name","{{priority}} - Priority level","{{tags}} - Card tags (comma-separated)","{{board}} - Board name","{{lane}} - Lane name","{{date:FORMAT}} - Custom date format (e.g., {{date:MMMM DD, YYYY}})","{{variable|default}} - Variable with default value"];for(let l of s)n.createEl("li",{text:l,cls:"kanban-template-var"});new k.Setting(e).setName("Card note template").setDesc("Template file for dedicated card notes").addText(l=>l.setPlaceholder("templates/card-note.md").setValue(this.plugin.settings["card-note-template"]).onChange(async d=>{this.plugin.settings["card-note-template"]=d,await this.plugin.saveSettings()})),new k.Setting(e).setName("Card note folder").setDesc("Default folder for dedicated card notes. Leave empty to use the same folder as the board.").addText(l=>l.setPlaceholder("cards/").setValue(this.plugin.settings["card-note-folder"]).onChange(async d=>{this.plugin.settings["card-note-folder"]=d,await this.plugin.saveSettings()})),new k.Setting(e).setName("Auto-create note for new cards").setDesc("Automatically create a dedicated note file when adding new cards").addToggle(l=>l.setValue(this.plugin.settings["auto-create-note"]).onChange(async d=>{this.plugin.settings["auto-create-note"]=d,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Dates"}),new k.Setting(e).setName("Date format").setDesc("Format for displaying dates (YYYY-MM-DD, DD/MM/YYYY, etc.)").addText(l=>l.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings["date-format"]).onChange(async d=>{this.plugin.settings["date-format"]=d||Z["date-format"],await this.plugin.saveSettings()})),new k.Setting(e).setName("Time format").setDesc("Format for displaying times (HH:mm, hh:mm A, etc.)").addText(l=>l.setPlaceholder("HH:mm").setValue(this.plugin.settings["time-format"]).onChange(async d=>{this.plugin.settings["time-format"]=d||Z["time-format"],await this.plugin.saveSettings()})),new k.Setting(e).setName("Date trigger").setDesc("Character to trigger date input (e.g., @)").addText(l=>l.setPlaceholder("@").setValue(this.plugin.settings["date-trigger"]).onChange(async d=>{this.plugin.settings["date-trigger"]=d||Z["date-trigger"],await this.plugin.saveSettings()})),new k.Setting(e).setName("Time trigger").setDesc("Character to trigger time input (e.g., @@)").addText(l=>l.setPlaceholder("@@").setValue(this.plugin.settings["time-trigger"]).onChange(async d=>{this.plugin.settings["time-trigger"]=d||Z["time-trigger"],await this.plugin.saveSettings()})),new k.Setting(e).setName("Link dates to daily notes").setDesc("Make dates clickable to open corresponding daily notes").addToggle(l=>l.setValue(this.plugin.settings["link-date-to-daily-note"]).onChange(async d=>{this.plugin.settings["link-date-to-daily-note"]=d,await this.plugin.saveSettings()})),new k.Setting(e).setName("Show relative dates").setDesc('Display dates as "Today", "Tomorrow", "In 3 days", etc.').addToggle(l=>l.setValue(this.plugin.settings["show-relative-date"]).onChange(async d=>{this.plugin.settings["show-relative-date"]=d,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Natural Language Dates"}),new k.Setting(e).setName("Parse natural language dates").setDesc('Automatically convert phrases like "today", "tomorrow", "next Monday", "in 3 days" to dates').addToggle(l=>l.setValue(this.plugin.settings["parse-natural-dates"]).onChange(async d=>{this.plugin.settings["parse-natural-dates"]=d,await this.plugin.saveSettings()})),new k.Setting(e).setName("Parse recurrence patterns").setDesc('Recognize patterns like "daily", "every Monday", "weekly", "every 2 weeks"').addToggle(l=>l.setValue(this.plugin.settings["parse-recurrence"]).onChange(async d=>{this.plugin.settings["parse-recurrence"]=d,await this.plugin.saveSettings()})),new k.Setting(e).setName("Date serialization format").setDesc("How dates are saved in markdown (ISO format recommended for compatibility)").addDropdown(l=>l.addOption("iso","ISO format (2024-01-15)").addOption("natural","Natural language (tomorrow)").setValue(this.plugin.settings["date-serialization-format"]).onChange(async d=>{this.plugin.settings["date-serialization-format"]=d,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Reminders"}),new k.Setting(e).setName("Enable reminders").setDesc("Show notifications when cards are approaching their due dates").addToggle(l=>l.setValue(this.plugin.settings["enable-reminders"]).onChange(async d=>{this.plugin.settings["enable-reminders"]=d,await this.plugin.saveSettings(),this.plugin.restartReminders()})),new k.Setting(e).setName("Default reminder time").setDesc("How long before due date to show reminder (e.g., 30m, 1h, 2h, 1d)").addText(l=>l.setPlaceholder("1h").setValue(this.plugin.settings["reminder-time"]).onChange(async d=>{this.plugin.settings["reminder-time"]=d||Z["reminder-time"],await this.plugin.saveSettings()})),new k.Setting(e).setName("Reminder type").setDesc("How to show reminders").addDropdown(l=>l.addOption("notice","Obsidian notice (in-app)").addOption("system","System notification (desktop)").setValue(this.plugin.settings["reminder-type"]).onChange(async d=>{this.plugin.settings["reminder-type"]=d,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Archive"}),new k.Setting(e).setName("Prepend archive date").setDesc("Add the archive date to the beginning of archived card titles").addToggle(l=>l.setValue(this.plugin.settings["prepend-archive-date"]).onChange(async d=>{this.plugin.settings["prepend-archive-date"]=d,await this.plugin.saveSettings()})),new k.Setting(e).setName("Archive date format").setDesc("Format for prepended archive dates").addText(l=>l.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings["prepend-archive-format"]).onChange(async d=>{this.plugin.settings["prepend-archive-format"]=d||Z["prepend-archive-format"],await this.plugin.saveSettings()})),e.createEl("h2",{text:"Base Task Sync"});let r=this.plugin.settings["base-sync"];if(new k.Setting(e).setName("Enable Base sync").setDesc("Sync cards with Base task files. When enabled, moving cards updates task status fields.").addToggle(l=>l.setValue(r.enabled).onChange(async d=>{this.plugin.settings["base-sync"].enabled=d,await this.plugin.saveSettings(),this.display()})),r.enabled){new k.Setting(e).setName("Tasks folder").setDesc("Folder containing Base task files").addText(d=>d.setPlaceholder("Tasks").setValue(r.tasksFolder).onChange(async u=>{this.plugin.settings["base-sync"].tasksFolder=u||"Tasks",await this.plugin.saveSettings()})),new k.Setting(e).setName("Task query").setDesc('Filter tasks to sync (e.g., "project:MyProject", "status:todo", "tag:work")').addText(d=>d.setPlaceholder("Leave empty for all tasks").setValue(r.query).onChange(async u=>{this.plugin.settings["base-sync"].query=u,await this.plugin.saveSettings()})),new k.Setting(e).setName("Status field").setDesc("Frontmatter field name for task status").addText(d=>d.setPlaceholder("status").setValue(r.statusField).onChange(async u=>{this.plugin.settings["base-sync"].statusField=u||"status",await this.plugin.saveSettings()})),new k.Setting(e).setName("Progress field").setDesc("Frontmatter field name for task progress").addText(d=>d.setPlaceholder("progress").setValue(r.progressField).onChange(async u=>{this.plugin.settings["base-sync"].progressField=u||"progress",await this.plugin.saveSettings()})),new k.Setting(e).setName("Project field").setDesc("Frontmatter field name for task project").addText(d=>d.setPlaceholder("project").setValue(r.projectField).onChange(async u=>{this.plugin.settings["base-sync"].projectField=u||"project",await this.plugin.saveSettings()})),new k.Setting(e).setName("Conflict resolution").setDesc("How to handle conflicts between local cards and remote tasks").addDropdown(d=>d.addOption("local","Keep local (card) values").addOption("remote","Use remote (Base) values").addOption("last-write","Last write wins (most recent modification)").addOption("prompt","Ask me each time").setValue(r.conflictResolution).onChange(async u=>{this.plugin.settings["base-sync"].conflictResolution=u,await this.plugin.saveSettings()})),new k.Setting(e).setName("Auto-sync interval").setDesc("Minutes between auto-syncs (0 = manual only)").addText(d=>d.setPlaceholder("0").setValue(r.syncInterval.toString()).onChange(async u=>{let h=parseInt(u,10);this.plugin.settings["base-sync"].syncInterval=isNaN(h)?0:Math.max(0,h),await this.plugin.saveSettings()})),new k.Setting(e).setName("Create missing tasks").setDesc("Automatically create Base task files for cards without a linked task").addToggle(d=>d.setValue(r.createMissingTasks).onChange(async u=>{this.plugin.settings["base-sync"].createMissingTasks=u,await this.plugin.saveSettings()})),e.createEl("h3",{text:"Lane \u2192 Status Mapping"}),e.createEl("p",{text:"Map lane titles to Base status values. When a card moves to a lane, its status will be updated.",cls:"setting-item-description"});let l=e.createDiv({cls:"kanban-lane-mapping"});for(let[d,u]of Object.entries(r.laneMapping))this.createMappingRow(l,d,u);new k.Setting(e).setName("Add mapping").setDesc("Add a new lane \u2192 status mapping").addButton(d=>d.setButtonText("+ Add mapping").onClick(()=>{this.createMappingRow(l,"","")}))}e.createEl("h2",{text:"GPT Task Manager Integration"});let o=this.plugin.settings["gpt-task-manager"];e.createEl("p",{text:"Integrate with GPT Task Manager plugin to view and manage tasks in Kanban format. When enabled, tasks created by GPT Task Manager can be displayed as Kanban cards.",cls:"setting-item-description"}),new k.Setting(e).setName("Enable GPT Task Manager integration").setDesc("Sync cards with GPT Task Manager task files. Moving cards will update task status.").addToggle(l=>l.setValue(o.enabled).onChange(async d=>{if(this.plugin.settings["gpt-task-manager"].enabled=d,d){let u=this.plugin.settings["base-sync"];u.enabled=!0,u.tasksFolder=o.tasksFolder,u.statusField=o.statusField,u.projectField=o.projectField,u.laneMapping={...ut}}await this.plugin.saveSettings(),this.display()})),o.enabled&&(new k.Setting(e).setName("Tasks folder").setDesc("Folder containing GPT Task Manager task files").addText(l=>l.setPlaceholder("500 Plan & Reflect/520 Tasks").setValue(o.tasksFolder).onChange(async d=>{this.plugin.settings["gpt-task-manager"].tasksFolder=d||Ne.tasksFolder,this.plugin.settings["base-sync"].tasksFolder=d||Ne.tasksFolder,await this.plugin.saveSettings()})),new k.Setting(e).setName("Epics folder").setDesc("Folder containing GPT Task Manager epic files").addText(l=>l.setPlaceholder("500 Plan & Reflect/510 Epics").setValue(o.epicsFolder).onChange(async d=>{this.plugin.settings["gpt-task-manager"].epicsFolder=d||Ne.epicsFolder,await this.plugin.saveSettings()})),new k.Setting(e).setName("Projects folder").setDesc("Folder containing GPT Task Manager project files").addText(l=>l.setPlaceholder("400 Projects").setValue(o.projectsFolder).onChange(async d=>{this.plugin.settings["gpt-task-manager"].projectsFolder=d||Ne.projectsFolder,await this.plugin.saveSettings()})),new k.Setting(e).setName("Status field").setDesc("Frontmatter field name for task status (case-sensitive)").addText(l=>l.setPlaceholder("Status").setValue(o.statusField).onChange(async d=>{this.plugin.settings["gpt-task-manager"].statusField=d||"Status",this.plugin.settings["base-sync"].statusField=d||"Status",await this.plugin.saveSettings()})),new k.Setting(e).setName("Update status on card move").setDesc("Automatically update task status when a card is moved between lanes").addToggle(l=>l.setValue(o.updateStatusOnMove).onChange(async d=>{this.plugin.settings["gpt-task-manager"].updateStatusOnMove=d,await this.plugin.saveSettings()})),new k.Setting(e).setName("Sync checklist items").setDesc("Display the task's ## \u{1F504} Sync checklist item as the card title").addToggle(l=>l.setValue(o.syncChecklistToBoard).onChange(async d=>{this.plugin.settings["gpt-task-manager"].syncChecklistToBoard=d,await this.plugin.saveSettings()})),e.createEl("h3",{text:"Status Values"}),e.createEl("p",{text:"Configure the status values used by GPT Task Manager. These should match the Status field values in your task files.",cls:"setting-item-description"}),new k.Setting(e).setName("Backlog status value").setDesc("Status value for tasks in the Backlog lane").addText(l=>l.setPlaceholder("backlog").setValue(o.statusValues.backlog).onChange(async d=>{this.plugin.settings["gpt-task-manager"].statusValues.backlog=d||"backlog",await this.plugin.saveSettings()})),new k.Setting(e).setName("To Do status value").setDesc("Status value for tasks in the To Do lane").addText(l=>l.setPlaceholder("todo").setValue(o.statusValues.todo).onChange(async d=>{this.plugin.settings["gpt-task-manager"].statusValues.todo=d||"todo",await this.plugin.saveSettings()})),new k.Setting(e).setName("In Progress status value").setDesc("Status value for tasks in the In Progress lane").addText(l=>l.setPlaceholder("in-progress").setValue(o.statusValues.inProgress).onChange(async d=>{this.plugin.settings["gpt-task-manager"].statusValues.inProgress=d||"in-progress",await this.plugin.saveSettings()})),new k.Setting(e).setName("Done status value").setDesc("Status value for tasks in the Done lane").addText(l=>l.setPlaceholder("done").setValue(o.statusValues.done).onChange(async d=>{this.plugin.settings["gpt-task-manager"].statusValues.done=d||"done",await this.plugin.saveSettings()}))),e.createEl("h2",{text:"About"});let c=e.createDiv({cls:"kanban-settings-about"});c.createEl("p",{text:"Base Kanban is a markdown-backed Kanban board plugin with support for Obsidian Base task metadata."}),c.createEl("p",{text:"Per-board settings can override these global settings. Access board settings from the board menu (three dots in the header) or via the command palette."}),c.createEl("p",{text:"GPT Task Manager integration allows viewing tasks created by GPT Task Manager in Kanban format. Use the command palette to create boards from Epics or Projects."})}createMappingRow(e,t,n){let s=e.createDiv({cls:"kanban-mapping-row"}),r=s.createEl("input",{type:"text",cls:"kanban-mapping-lane",attr:{placeholder:"Lane title"}});r.value=t,s.createSpan({text:"\u2192",cls:"kanban-mapping-arrow"});let o=s.createEl("input",{type:"text",cls:"kanban-mapping-status",attr:{placeholder:"Status value"}});o.value=n;let c=s.createEl("button",{cls:"kanban-mapping-delete"});c.textContent="\xD7";let l=async()=>{let d=r.value.trim(),u=o.value.trim();t&&t!==d&&delete this.plugin.settings["base-sync"].laneMapping[t],d&&u&&(this.plugin.settings["base-sync"].laneMapping[d]=u),await this.plugin.saveSettings()};r.addEventListener("change",l),o.addEventListener("change",l),c.addEventListener("click",async()=>{let d=r.value.trim();d&&this.plugin.settings["base-sync"].laneMapping[d]&&(delete this.plugin.settings["base-sync"].laneMapping[d],await this.plugin.saveSettings()),s.remove()})}};var oe=require("obsidian");function Ba(i){let a={},e=i.match(/^---\s*\n([\s\S]*?)\n---/);if(!e)return a;let n=e[1].split(`
`);for(let s of n){let r=s.match(/^(\w+):\s*(.+)$/);if(r){let o=r[1],c=r[2].trim();switch(c=c.replace(/^["']|["']$/g,""),c=c.replace(/^\[\[|\]\]$/g,""),o.toLowerCase()){case"type":a.type=c;break;case"area":a.area=c;break;case"goal":a.goal=c;break;case"project":a.project=c;break;case"epic":a.epic=c;break;case"status":a.status=c;break;case"priority":a.priority=c;break;case"due":a.due=c;break;case"created":a.created=c;break;case"updated":a.updated=c;break;case"parent":a.parent=c;break;case"description":a.description=c;break;case"tags":c.startsWith("[")&&(a.tags=c.replace(/[\[\]]/g,"").split(",").map(l=>l.trim()));break}}if(s.trim().startsWith("- ")&&a.tags===void 0){let o=s.trim().replace(/^-\s*/,"");a.tags||(a.tags=[]),a.tags.push(o)}}return a}function Oa(i){let a=i.match(/##  Sync\s*\n([\s\S]*?)(?=\n## |$)/);if(!a)return null;let t=a[1].match(/-\s*\[([ xX])\]\s*(.+)/);return t?{completed:t[1].toLowerCase()==="x",text:t[2].trim()}:null}async function $a(i,a){try{let e=await i.vault.read(a),t=Ba(e);if(!t.type||!t.type.includes("Tasks"))return null;let n=Oa(e),s=(n==null?void 0:n.text)||a.basename;return{file:a,title:s,metadata:t,syncChecklistItem:n==null?void 0:n.text,completed:(n==null?void 0:n.completed)||!1,content:e}}catch(e){return console.error(`Failed to parse GPT task file: ${a.path}`,e),null}}async function St(i,a,e){let t=[],n=i.vault.getAbstractFileByPath(a.tasksFolder);if(!(n instanceof oe.TFolder))return console.warn(`GPT Task Manager tasks folder not found: ${a.tasksFolder}`),t;let s=o=>{let c=[];for(let l of o.children)l instanceof oe.TFile&&l.extension==="md"?c.push(l):l instanceof oe.TFolder&&c.push(...s(l));return c},r=s(n);for(let o of r){let c=await $a(i,o);c&&(e&&(e.epic&&c.metadata.epic!==e.epic||e.project&&c.metadata.project!==e.project||e.status&&e.status.length>0&&c.metadata.status&&!e.status.includes(c.metadata.status)||!e.includeCompleted&&c.completed)||t.push(c))}return t}function Ka(i,a){if(!i)return"Backlog";let e=i.toLowerCase(),{statusValues:t}=a;return e===t.backlog?"Backlog":e===t.todo?"To Do":e===t.inProgress?"In Progress":e===t.done?"Done":"Backlog"}function jn(i,a){let e=i.toLowerCase(),{statusValues:t}=a;return e==="backlog"||e.includes("backlog")?t.backlog:e==="to do"||e==="todo"||e.includes("todo")?t.todo:e==="in progress"||e.includes("progress")||e.includes("doing")?t.inProgress:e==="done"||e.includes("done")||e.includes("complete")?t.done:t.backlog}function ja(i){return{id:(()=>Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4))(),title:i.title,completed:i.completed,tags:i.metadata.tags||[],dueDate:i.metadata.due,metadata:{project:i.metadata.project,priority:i.metadata.priority,status:i.metadata.status},baseTaskPath:i.file.path,baseSyncTime:Date.now()}}function Ct(i,a,e){let t=()=>Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4),n=[{id:t(),title:"Backlog",cards:[]},{id:t(),title:"To Do",cards:[]},{id:t(),title:"In Progress",cards:[]},{id:t(),title:"Done",cards:[]}];for(let r of i){let o=ja(r),c=Ka(r.metadata.status,a),l=n.find(d=>d.title===c);l?l.cards.push(o):n[0].cards.push(o)}let s={critical:0,high:1,medium:2,low:3};for(let r of n)r.cards.sort((o,c)=>{var u,h;let l=(u=s[o.metadata.priority||"medium"])!=null?u:2,d=(h=s[c.metadata.priority||"medium"])!=null?h:2;return l-d});return{lanes:n,archive:[],settings:{"lane-width":"300px","show-checkboxes":!0,"show-progress":!0,"show-project":!0,"base-sync":{enabled:!0,tasksFolder:a.tasksFolder,query:"",statusField:a.statusField,progressField:"progress",projectField:a.projectField,laneMapping:{...ut},conflictResolution:"prompt",syncInterval:0,createMissingTasks:!1,archiveCompletedTasks:!1}},_frontmatter:`---
kanban-plugin: basic
title: ${e||"Task Board"}
---

`}}async function Rn(i,a,e,t){try{let n=i.vault.getAbstractFileByPath(a);if(!(n instanceof oe.TFile))return console.warn(`Task file not found: ${a}`),!1;let s=await i.vault.read(n),r=new RegExp(`^(${t.statusField}:)\\s*.+$`,"mi");if(r.test(s))s=s.replace(r,`$1 ${e}`);else{let d=s.match(/^---\s*\n([\s\S]*?)\n---/);if(d){let h=d[1]+`
${t.statusField}: ${e}`;s=s.replace(d[1],h)}}let o=/^(Updated:)\s*.+$/mi,c=new Date,l=`"${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")} ${String(c.getHours()).padStart(2,"0")}:${String(c.getMinutes()).padStart(2,"0")}"`;return o.test(s)&&(s=s.replace(o,`$1 ${l}`)),await i.vault.modify(n,s),!0}catch(n){return console.error(`Failed to update GPT task status: ${a}`,n),!1}}async function Vn(i,a){let e=[],t=i.vault.getAbstractFileByPath(a.epicsFolder);if(!(t instanceof oe.TFolder))return e;for(let n of t.children)n instanceof oe.TFile&&n.extension==="md"&&e.push(n.basename);return e.sort()}async function Yn(i,a){let e=[],t=i.vault.getAbstractFileByPath(a.projectsFolder);if(!(t instanceof oe.TFolder))return e;let n=s=>{let r=[];for(let o of s.children)o instanceof oe.TFolder?(r.push(o.name),r.push(...n(o))):o instanceof oe.TFile&&o.extension==="md"&&r.push(o.basename);return r};return n(t).sort()}function Xe(i){return i.enabled&&!!i.tasksFolder}var Tt=class extends E.Plugin{constructor(){super(...arguments);this.kanbanFileModes={};this.reminderIntervalId=null;this.notifiedCards=new Set}async onload(){var e,t;await this.loadSettings(),this.registerView(ee,n=>new ne(n,this)),this.registerExtensions(["kanban"],ee),this.settingsTab=new kt(this.app,this),this.addSettingTab(this.settingsTab),this.addRibbonIcon("columns","Create new Kanban board",()=>{this.createNewKanban()}),this.registerCommands(),this.registerFileMenu(),this.registerMonkeyPatch(),(t=(e=this.app.workspace).registerHoverLinkSource)==null||t.call(e,te,{display:"Kanban",defaultMod:!0}),this.settings["enable-reminders"]&&this.startReminderCheck(),this.registerEvent(this.app.vault.on("rename",(n,s)=>{this.kanbanFileModes[s]&&(this.kanbanFileModes[n.path]=this.kanbanFileModes[s],delete this.kanbanFileModes[s])})),this.registerEvent(this.app.vault.on("delete",n=>{this.kanbanFileModes[n.path]&&delete this.kanbanFileModes[n.path]}))}onunload(){var e,t;(t=(e=this.app.workspace).unregisterHoverLinkSource)==null||t.call(e,te),this.stopReminderCheck()}async loadSettings(){this.settings=Object.assign({},Z,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}registerCommands(){this.addCommand({id:"create-new-kanban-board",name:"Create new board",callback:()=>this.createNewKanban()}),this.addCommand({id:"toggle-kanban-view",name:"Toggle between Kanban and markdown mode",checkCallback:e=>{var o;let t=this.app.workspace.getActiveFile();if(!t)return!1;let n=this.app.metadataCache.getFileCache(t),s=(o=n==null?void 0:n.frontmatter)==null?void 0:o[te];if(e)return!!s;let r=this.app.workspace.getActiveViewOfType(ne);if(r)this.kanbanFileModes[t.path]="markdown",this.setMarkdownView(r.leaf);else{let c=this.app.workspace.getActiveViewOfType(E.MarkdownView);c&&(this.kanbanFileModes[t.path]=ee,this.setKanbanView(c.leaf))}}}),this.addCommand({id:"archive-completed-cards",name:"Archive completed cards in active board",checkCallback:e=>{let t=this.app.workspace.getActiveViewOfType(ne);if(!t)return!1;if(e)return!0;t.archiveCompletedCards()}}),this.addCommand({id:"convert-to-kanban",name:"Convert empty note to Kanban",checkCallback:e=>{var s;let t=this.app.workspace.getActiveViewOfType(E.MarkdownView);if(!t)return!1;let n=((s=t.file)==null?void 0:s.stat.size)===0;if(e)return!!n;n&&t.file&&this.app.vault.modify(t.file,mt).then(()=>{this.setKanbanView(t.leaf)}).catch(r=>console.error("Error converting to kanban:",r))}}),this.addCommand({id:"add-kanban-lane",name:"Add a list",checkCallback:e=>{let t=this.app.workspace.getActiveViewOfType(ne);if(!t)return!1;if(e)return!0;t.addLane()}}),this.addCommand({id:"open-board-settings",name:"Open board settings",checkCallback:e=>{var n;let t=this.app.workspace.getActiveViewOfType(ne);if(!t)return!1;if(e)return!0;(n=t.openBoardSettings)==null||n.call(t)}}),this.addCommand({id:"create-or-open-card-note",name:"Create or open card note",checkCallback:e=>{let t=this.app.workspace.getActiveViewOfType(ne);if(!t)return!1;if(e)return!0;t.createOrOpenCardNote()}}),this.addCommand({id:"sync-with-base",name:"Sync with Base",checkCallback:e=>{let t=this.app.workspace.getActiveViewOfType(ne);if(!t)return!1;if(!this.settings["base-sync"].enabled)return e||new E.Notice("Base sync is not enabled. Enable it in plugin settings first."),!1;if(e)return!0;t.manualSync()}}),this.addCommand({id:"gpt-create-board-from-epic",name:"GPT: Create Kanban board from Epic",callback:async()=>{let e=this.settings["gpt-task-manager"];if(!Xe(e)){new E.Notice("GPT Task Manager integration is not enabled. Enable it in plugin settings.");return}let t=await Vn(this.app,e);if(t.length===0){new E.Notice(`No epics found in ${e.epicsFolder}`);return}new en(this.app,t,async n=>{await this.createGptBoardFromEpic(n)}).open()}}),this.addCommand({id:"gpt-create-board-from-project",name:"GPT: Create Kanban board from Project",callback:async()=>{let e=this.settings["gpt-task-manager"];if(!Xe(e)){new E.Notice("GPT Task Manager integration is not enabled. Enable it in plugin settings.");return}let t=await Yn(this.app,e);if(t.length===0){new E.Notice(`No projects found in ${e.projectsFolder}`);return}new tn(this.app,t,async n=>{await this.createGptBoardFromProject(n)}).open()}}),this.addCommand({id:"gpt-create-board-all-tasks",name:"GPT: Create Kanban board from all tasks",callback:async()=>{let e=this.settings["gpt-task-manager"];if(!Xe(e)){new E.Notice("GPT Task Manager integration is not enabled. Enable it in plugin settings.");return}await this.createGptBoardFromAllTasks()}}),this.addCommand({id:"gpt-refresh-board",name:"GPT: Refresh board with latest tasks",checkCallback:e=>{let t=this.app.workspace.getActiveViewOfType(ne);if(!t)return!1;let n=this.settings["gpt-task-manager"];if(!Xe(n))return!1;if(e)return!0;t.manualSync(),new E.Notice("Board refreshed with latest GPT tasks")}})}registerFileMenu(){this.registerEvent(this.app.workspace.on("file-menu",(e,t,n,s)=>{var r;if(n!=="link-context-menu"){if(t instanceof E.TFolder){e.addItem(o=>{o.setSection("action-primary").setTitle("New kanban board").setIcon("columns").onClick(()=>this.createNewKanban(t))});return}if(t instanceof E.TFile&&s){let o=s.view instanceof E.MarkdownView,c=s.view instanceof ne,l=this.app.metadataCache.getFileCache(t),d=(r=l==null?void 0:l.frontmatter)==null?void 0:r[te];o&&d&&e.addItem(u=>{u.setTitle("Open as kanban board").setIcon("columns").setSection("pane").onClick(()=>{this.kanbanFileModes[t.path]=ee,this.setKanbanView(s)})}),c&&e.addItem(u=>{u.setTitle("Open as markdown").setIcon("file-text").setSection("pane").onClick(()=>{this.kanbanFileModes[t.path]="markdown",this.setMarkdownView(s)})})}}}))}registerMonkeyPatch(){let e=this;this.register(Ra(E.WorkspaceLeaf.prototype,{detach(t){return function(){var r;let n=(r=this.view)==null?void 0:r.getState(),s=n==null?void 0:n.file;return s&&e.kanbanFileModes[s]&&delete e.kanbanFileModes[s],t.apply(this)}},setViewState(t){return function(n,...s){var o,c;let r=(o=n.state)==null?void 0:o.file;if(n.type==="markdown"&&r&&e.kanbanFileModes[r]!=="markdown"){let l=e.app.metadataCache.getCache(r);if((c=l==null?void 0:l.frontmatter)!=null&&c[te]){let d={...n,type:ee};return e.kanbanFileModes[r]=ee,t.apply(this,[d,...s])}}return t.apply(this,[n,...s])}}}))}async setMarkdownView(e,t=!0){await e.setViewState({type:"markdown",state:e.view.getState(),popstate:!0},{focus:t})}async setKanbanView(e){await e.setViewState({type:ee,state:e.view.getState(),popstate:!0})}async createNewKanban(e){var s;let t=e||this.app.fileManager.getNewFileParent(((s=this.app.workspace.getActiveFile())==null?void 0:s.path)||""),n=null;try{n=await this.app.fileManager.createNewMarkdownFile(t,"Untitled Kanban")}catch(r){console.warn("Primary file creation failed, using fallback:",r);try{let o=t.path?`${t.path}/`:"",c=`${o}Untitled Kanban.md`,l=1;for(;this.app.vault.getAbstractFileByPath(c);)c=`${o}Untitled Kanban ${l}.md`,l++;n=await this.app.vault.create(c,mt)}catch(o){console.error("Error creating kanban board:",o),new E.Notice("Error creating Kanban board");return}}if(!n){new E.Notice("Error creating Kanban board");return}try{await this.app.vault.modify(n,mt),await this.app.workspace.getLeaf().setViewState({type:ee,state:{file:n.path}}),new E.Notice("Created new Kanban board")}catch(r){console.error("Error setting up kanban board:",r),new E.Notice("Error creating Kanban board")}}async createGptBoardFromEpic(e){let t=this.settings["gpt-task-manager"];new E.Notice(`Loading tasks for Epic: ${e}...`);let n=await St(this.app,t,{epic:e,includeCompleted:!0});if(n.length===0){new E.Notice(`No tasks found for Epic: ${e}`);return}let s=Ct(n,t,`${e} Board`);await this.createBoardFile(s,`${e} Board`),new E.Notice(`Created Kanban board with ${n.length} tasks from Epic: ${e}`)}async createGptBoardFromProject(e){let t=this.settings["gpt-task-manager"];new E.Notice(`Loading tasks for Project: ${e}...`);let n=await St(this.app,t,{project:e,includeCompleted:!0});if(n.length===0){new E.Notice(`No tasks found for Project: ${e}`);return}let s=Ct(n,t,`${e} Board`);await this.createBoardFile(s,`${e} Board`),new E.Notice(`Created Kanban board with ${n.length} tasks from Project: ${e}`)}async createGptBoardFromAllTasks(){let e=this.settings["gpt-task-manager"];new E.Notice("Loading all GPT tasks...");let t=await St(this.app,e,{includeCompleted:!1});if(t.length===0){new E.Notice("No active tasks found");return}let n=Ct(t,e,"All Tasks Board");await this.createBoardFile(n,"All Tasks Board"),new E.Notice(`Created Kanban board with ${t.length} active tasks`)}async createBoardFile(e,t){var d;let n=this.app.fileManager.getNewFileParent(((d=this.app.workspace.getActiveFile())==null?void 0:d.path)||""),s=n.path?`${n.path}/`:"",r=`${s}${t}.md`,o=1;for(;this.app.vault.getAbstractFileByPath(r);)r=`${s}${t} ${o}.md`,o++;let c=gt(e),l=await this.app.vault.create(r,c);await this.app.workspace.getLeaf().setViewState({type:ee,state:{file:l.path}})}async onCardMovedToLane(e,t){let n=this.settings["gpt-task-manager"];if(!n.enabled||!n.updateStatusOnMove||!e.baseTaskPath)return;let s=jn(t,n);await Rn(this.app,e.baseTaskPath,s,n)&&new E.Notice(`Updated task status to: ${s}`)}startReminderCheck(){this.reminderIntervalId===null&&(this.reminderIntervalId=window.setInterval(()=>{this.checkReminders()},60*1e3),this.checkReminders())}stopReminderCheck(){this.reminderIntervalId!==null&&(window.clearInterval(this.reminderIntervalId),this.reminderIntervalId=null)}async checkReminders(){if(!this.settings["enable-reminders"])return;let e=new Date,t=this.app.vault.getMarkdownFiles().filter(n=>{var r;let s=this.app.metadataCache.getFileCache(n);return(r=s==null?void 0:s.frontmatter)==null?void 0:r[te]});for(let n of t)try{let s=await this.app.vault.read(n),r=pt(s);for(let o of r.lanes)for(let c of o.cards)this.shouldRemind(c,e)&&this.showReminder(c,n.basename,o.title)}catch(s){}}shouldRemind(e,t){if(e.completed||!e.dueDate)return!1;let n=`${e.id}-${e.dueDate}`;if(this.notifiedCards.has(n))return!1;let s=this.parseDueDateTime(e);if(!s)return!1;let r=e.reminderTime||this.settings["reminder-time"]||"1h",o=this.parseReminderOffset(r),c=new Date(s.getTime()-o),l=t>=c&&t<=s;return l&&this.notifiedCards.add(n),l}parseDueDateTime(e){if(!e.dueDate)return null;try{let t=e.dueDate,n=e.dueTime||"09:00",[s,r,o]=t.split("-").map(Number),[c,l]=n.split(":").map(Number);return new Date(s,r-1,o,c,l)}catch(t){return null}}parseReminderOffset(e){let t=e.match(/^(\d+)\s*(m|min|h|hr|d|day)s?$/i);if(!t)return 60*60*1e3;let n=parseInt(t[1],10);switch(t[2].toLowerCase()){case"m":case"min":return n*60*1e3;case"h":case"hr":return n*60*60*1e3;case"d":case"day":return n*24*60*60*1e3;default:return 60*60*1e3}}showReminder(e,t,n){let s=e.title.replace(/\[\[([^\]|]+)(?:\|[^\]]+)?\]\]/g,"$1"),r=e.dueTime?`${e.dueDate} ${e.dueTime}`:e.dueDate,o=`\u{1F4CB} ${t} / ${n}
"${s}"
Due: ${r}`;this.settings["reminder-type"]==="system"&&"Notification"in window?Notification.permission==="granted"?new Notification("Kanban Reminder",{body:o,icon:"columns"}):Notification.permission!=="denied"?Notification.requestPermission().then(c=>{c==="granted"?new Notification("Kanban Reminder",{body:o}):new E.Notice(o,1e4)}):new E.Notice(o,1e4):new E.Notice(o,1e4)}clearNotificationHistory(){this.notifiedCards.clear()}restartReminders(){this.stopReminderCheck(),this.settings["enable-reminders"]&&(this.clearNotificationHistory(),this.startReminderCheck())}};function Ra(i,a){let e=[];for(let t in a){let n=i[t],s=a[t];if(s&&typeof n=="function"){let r=s(n);i[t]=r,e.push(()=>{i[t]=n})}}return()=>{for(let t of e)t()}}var en=class extends E.FuzzySuggestModal{constructor(e,t,n){super(e);this.epics=t,this.onChoose=n,this.setPlaceholder("Select an Epic to create a Kanban board from...")}getItems(){return this.epics}getItemText(e){return e}onChooseItem(e,t){this.onChoose(e)}},tn=class extends E.FuzzySuggestModal{constructor(e,t,n){super(e);this.projects=t,this.onChoose=n,this.setPlaceholder("Select a Project to create a Kanban board from...")}getItems(){return this.projects}getItemText(e){return e}onChooseItem(e,t){this.onChoose(e)}};
/*! Bundled license information:

sortablejs/modular/sortable.esm.js:
  (**!
   * Sortable 1.15.6
   * @author	RubaXa   <trash@rubaxa.org>
   * @author	owenm    <owen23355@gmail.com>
   * @license MIT
   *)
*/
