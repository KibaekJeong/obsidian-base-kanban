/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var vt=Object.defineProperty;var _n=Object.getOwnPropertyDescriptor;var Ln=Object.getOwnPropertyNames;var On=Object.prototype.hasOwnProperty;var Bn=(i,a)=>{for(var e in a)vt(i,e,{get:a[e],enumerable:!0})},$n=(i,a,e,t)=>{if(a&&typeof a=="object"||typeof a=="function")for(let n of Ln(a))!On.call(i,n)&&n!==e&&vt(i,n,{get:()=>a[n],enumerable:!(t=_n(a,n))||t.enumerable});return i};var Kn=i=>$n(vt({},"__esModule",{value:!0}),i);var Da={};Bn(Da,{default:()=>bt});module.exports=Kn(Da);var L=require("obsidian");var f=require("obsidian");function Ut(i,a){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(i);a&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),e.push.apply(e,t)}return e}function de(i){for(var a=1;a<arguments.length;a++){var e=arguments[a]!=null?arguments[a]:{};a%2?Ut(Object(e),!0).forEach(function(t){jn(i,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):Ut(Object(e)).forEach(function(t){Object.defineProperty(i,t,Object.getOwnPropertyDescriptor(e,t))})}return i}function ze(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ze=function(a){return typeof a}:ze=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},ze(i)}function jn(i,a,e){return a in i?Object.defineProperty(i,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[a]=e,i}function pe(){return pe=Object.assign||function(i){for(var a=1;a<arguments.length;a++){var e=arguments[a];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i[t]=e[t])}return i},pe.apply(this,arguments)}function Rn(i,a){if(i==null)return{};var e={},t=Object.keys(i),n,s;for(s=0;s<t.length;s++)n=t[s],!(a.indexOf(n)>=0)&&(e[n]=i[n]);return e}function Vn(i,a){if(i==null)return{};var e=Rn(i,a),t,n;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);for(n=0;n<s.length;n++)t=s[n],!(a.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(i,t)&&(e[t]=i[t])}return e}var Yn="1.15.6";function he(i){if(typeof window!="undefined"&&window.navigator)return!!navigator.userAgent.match(i)}var fe=he(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),je=he(/Edge/i),Gt=he(/firefox/i),Le=he(/safari/i)&&!he(/chrome/i)&&!he(/android/i),Ft=he(/iP(ad|od|hone)/i),an=he(/chrome/i)&&he(/android/i),sn={capture:!1,passive:!1};function M(i,a,e){i.addEventListener(a,e,!fe&&sn)}function x(i,a,e){i.removeEventListener(a,e,!fe&&sn)}function tt(i,a){if(a){if(a[0]===">"&&(a=a.substring(1)),i)try{if(i.matches)return i.matches(a);if(i.msMatchesSelector)return i.msMatchesSelector(a);if(i.webkitMatchesSelector)return i.webkitMatchesSelector(a)}catch(e){return!1}return!1}}function rn(i){return i.host&&i!==document&&i.host.nodeType?i.host:i.parentNode}function ae(i,a,e,t){if(i){e=e||document;do{if(a!=null&&(a[0]===">"?i.parentNode===e&&tt(i,a):tt(i,a))||t&&i===e)return i;if(i===e)break}while(i=rn(i))}return null}var zt=/\s+/g;function G(i,a,e){if(i&&a)if(i.classList)i.classList[e?"add":"remove"](a);else{var t=(" "+i.className+" ").replace(zt," ").replace(" "+a+" "," ");i.className=(t+(e?" "+a:"")).replace(zt," ")}}function S(i,a,e){var t=i&&i.style;if(t){if(e===void 0)return document.defaultView&&document.defaultView.getComputedStyle?e=document.defaultView.getComputedStyle(i,""):i.currentStyle&&(e=i.currentStyle),a===void 0?e:e[a];!(a in t)&&a.indexOf("webkit")===-1&&(a="-webkit-"+a),t[a]=e+(typeof e=="string"?"":"px")}}function Me(i,a){var e="";if(typeof i=="string")e=i;else do{var t=S(i,"transform");t&&t!=="none"&&(e=t+" "+e)}while(!a&&(i=i.parentNode));var n=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return n&&new n(e)}function on(i,a,e){if(i){var t=i.getElementsByTagName(a),n=0,s=t.length;if(e)for(;n<s;n++)e(t[n],n);return t}return[]}function ce(){var i=document.scrollingElement;return i||document.documentElement}function B(i,a,e,t,n){if(!(!i.getBoundingClientRect&&i!==window)){var s,r,l,o,c,d,u;if(i!==window&&i.parentNode&&i!==ce()?(s=i.getBoundingClientRect(),r=s.top,l=s.left,o=s.bottom,c=s.right,d=s.height,u=s.width):(r=0,l=0,o=window.innerHeight,c=window.innerWidth,d=window.innerHeight,u=window.innerWidth),(a||e)&&i!==window&&(n=n||i.parentNode,!fe))do if(n&&n.getBoundingClientRect&&(S(n,"transform")!=="none"||e&&S(n,"position")!=="static")){var h=n.getBoundingClientRect();r-=h.top+parseInt(S(n,"border-top-width")),l-=h.left+parseInt(S(n,"border-left-width")),o=r+s.height,c=l+s.width;break}while(n=n.parentNode);if(t&&i!==window){var b=Me(n||i),v=b&&b.a,p=b&&b.d;b&&(r/=p,l/=v,u/=v,d/=p,o=r+d,c=l+u)}return{top:r,left:l,bottom:o,right:c,width:u,height:d}}}function Jt(i,a,e){for(var t=ye(i,!0),n=B(i)[a];t;){var s=B(t)[e],r=void 0;if(e==="top"||e==="left"?r=n>=s:r=n<=s,!r)return t;if(t===ce())break;t=ye(t,!1)}return!1}function Pe(i,a,e,t){for(var n=0,s=0,r=i.children;s<r.length;){if(r[s].style.display!=="none"&&r[s]!==C.ghost&&(t||r[s]!==C.dragged)&&ae(r[s],e.draggable,i,!1)){if(n===a)return r[s];n++}s++}return null}function At(i,a){for(var e=i.lastElementChild;e&&(e===C.ghost||S(e,"display")==="none"||a&&!tt(e,a));)e=e.previousElementSibling;return e||null}function Q(i,a){var e=0;if(!i||!i.parentNode)return-1;for(;i=i.previousElementSibling;)i.nodeName.toUpperCase()!=="TEMPLATE"&&i!==C.clone&&(!a||tt(i,a))&&e++;return e}function Qt(i){var a=0,e=0,t=ce();if(i)do{var n=Me(i),s=n.a,r=n.d;a+=i.scrollLeft*s,e+=i.scrollTop*r}while(i!==t&&(i=i.parentNode));return[a,e]}function Wn(i,a){for(var e in i)if(i.hasOwnProperty(e)){for(var t in a)if(a.hasOwnProperty(t)&&a[t]===i[e][t])return Number(e)}return-1}function ye(i,a){if(!i||!i.getBoundingClientRect)return ce();var e=i,t=!1;do if(e.clientWidth<e.scrollWidth||e.clientHeight<e.scrollHeight){var n=S(e);if(e.clientWidth<e.scrollWidth&&(n.overflowX=="auto"||n.overflowX=="scroll")||e.clientHeight<e.scrollHeight&&(n.overflowY=="auto"||n.overflowY=="scroll")){if(!e.getBoundingClientRect||e===document.body)return ce();if(t||a)return e;t=!0}}while(e=e.parentNode);return ce()}function Hn(i,a){if(i&&a)for(var e in a)a.hasOwnProperty(e)&&(i[e]=a[e]);return i}function yt(i,a){return Math.round(i.top)===Math.round(a.top)&&Math.round(i.left)===Math.round(a.left)&&Math.round(i.height)===Math.round(a.height)&&Math.round(i.width)===Math.round(a.width)}var Oe;function ln(i,a){return function(){if(!Oe){var e=arguments,t=this;e.length===1?i.call(t,e[0]):i.apply(t,e),Oe=setTimeout(function(){Oe=void 0},a)}}}function qn(){clearTimeout(Oe),Oe=void 0}function cn(i,a,e){i.scrollLeft+=a,i.scrollTop+=e}function dn(i){var a=window.Polymer,e=window.jQuery||window.Zepto;return a&&a.dom?a.dom(i).cloneNode(!0):e?e(i).clone(!0)[0]:i.cloneNode(!0)}function un(i,a,e){var t={};return Array.from(i.children).forEach(function(n){var s,r,l,o;if(!(!ae(n,a.draggable,i,!1)||n.animated||n===e)){var c=B(n);t.left=Math.min((s=t.left)!==null&&s!==void 0?s:1/0,c.left),t.top=Math.min((r=t.top)!==null&&r!==void 0?r:1/0,c.top),t.right=Math.max((l=t.right)!==null&&l!==void 0?l:-1/0,c.right),t.bottom=Math.max((o=t.bottom)!==null&&o!==void 0?o:-1/0,c.bottom)}}),t.width=t.right-t.left,t.height=t.bottom-t.top,t.x=t.left,t.y=t.top,t}var U="Sortable"+new Date().getTime();function Xn(){var i=[],a;return{captureAnimationState:function(){if(i=[],!!this.options.animation){var t=[].slice.call(this.el.children);t.forEach(function(n){if(!(S(n,"display")==="none"||n===C.ghost)){i.push({target:n,rect:B(n)});var s=de({},i[i.length-1].rect);if(n.thisAnimationDuration){var r=Me(n,!0);r&&(s.top-=r.f,s.left-=r.e)}n.fromRect=s}})}},addAnimationState:function(t){i.push(t)},removeAnimationState:function(t){i.splice(Wn(i,{target:t}),1)},animateAll:function(t){var n=this;if(!this.options.animation){clearTimeout(a),typeof t=="function"&&t();return}var s=!1,r=0;i.forEach(function(l){var o=0,c=l.target,d=c.fromRect,u=B(c),h=c.prevFromRect,b=c.prevToRect,v=l.rect,p=Me(c,!0);p&&(u.top-=p.f,u.left-=p.e),c.toRect=u,c.thisAnimationDuration&&yt(h,u)&&!yt(d,u)&&(v.top-u.top)/(v.left-u.left)===(d.top-u.top)/(d.left-u.left)&&(o=Gn(v,h,b,n.options)),yt(u,d)||(c.prevFromRect=d,c.prevToRect=u,o||(o=n.options.animation),n.animate(c,v,u,o)),o&&(s=!0,r=Math.max(r,o),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},o),c.thisAnimationDuration=o)}),clearTimeout(a),s?a=setTimeout(function(){typeof t=="function"&&t()},r):typeof t=="function"&&t(),i=[]},animate:function(t,n,s,r){if(r){S(t,"transition",""),S(t,"transform","");var l=Me(this.el),o=l&&l.a,c=l&&l.d,d=(n.left-s.left)/(o||1),u=(n.top-s.top)/(c||1);t.animatingX=!!d,t.animatingY=!!u,S(t,"transform","translate3d("+d+"px,"+u+"px,0)"),this.forRepaintDummy=Un(t),S(t,"transition","transform "+r+"ms"+(this.options.easing?" "+this.options.easing:"")),S(t,"transform","translate3d(0,0,0)"),typeof t.animated=="number"&&clearTimeout(t.animated),t.animated=setTimeout(function(){S(t,"transition",""),S(t,"transform",""),t.animated=!1,t.animatingX=!1,t.animatingY=!1},r)}}}}function Un(i){return i.offsetWidth}function Gn(i,a,e,t){return Math.sqrt(Math.pow(a.top-i.top,2)+Math.pow(a.left-i.left,2))/Math.sqrt(Math.pow(a.top-e.top,2)+Math.pow(a.left-e.left,2))*t.animation}var Te=[],wt={initializeByDefault:!0},Re={mount:function(a){for(var e in wt)wt.hasOwnProperty(e)&&!(e in a)&&(a[e]=wt[e]);Te.forEach(function(t){if(t.pluginName===a.pluginName)throw"Sortable: Cannot mount plugin ".concat(a.pluginName," more than once")}),Te.push(a)},pluginEvent:function(a,e,t){var n=this;this.eventCanceled=!1,t.cancel=function(){n.eventCanceled=!0};var s=a+"Global";Te.forEach(function(r){e[r.pluginName]&&(e[r.pluginName][s]&&e[r.pluginName][s](de({sortable:e},t)),e.options[r.pluginName]&&e[r.pluginName][a]&&e[r.pluginName][a](de({sortable:e},t)))})},initializePlugins:function(a,e,t,n){Te.forEach(function(l){var o=l.pluginName;if(!(!a.options[o]&&!l.initializeByDefault)){var c=new l(a,e,a.options);c.sortable=a,c.options=a.options,a[o]=c,pe(t,c.defaults)}});for(var s in a.options)if(a.options.hasOwnProperty(s)){var r=this.modifyOption(a,s,a.options[s]);typeof r!="undefined"&&(a.options[s]=r)}},getEventProperties:function(a,e){var t={};return Te.forEach(function(n){typeof n.eventProperties=="function"&&pe(t,n.eventProperties.call(e[n.pluginName],a))}),t},modifyOption:function(a,e,t){var n;return Te.forEach(function(s){a[s.pluginName]&&s.optionListeners&&typeof s.optionListeners[e]=="function"&&(n=s.optionListeners[e].call(a[s.pluginName],t))}),n}};function zn(i){var a=i.sortable,e=i.rootEl,t=i.name,n=i.targetEl,s=i.cloneEl,r=i.toEl,l=i.fromEl,o=i.oldIndex,c=i.newIndex,d=i.oldDraggableIndex,u=i.newDraggableIndex,h=i.originalEvent,b=i.putSortable,v=i.extraEventProperties;if(a=a||e&&e[U],!!a){var p,w=a.options,m="on"+t.charAt(0).toUpperCase()+t.substr(1);window.CustomEvent&&!fe&&!je?p=new CustomEvent(t,{bubbles:!0,cancelable:!0}):(p=document.createEvent("Event"),p.initEvent(t,!0,!0)),p.to=r||e,p.from=l||e,p.item=n||e,p.clone=s,p.oldIndex=o,p.newIndex=c,p.oldDraggableIndex=d,p.newDraggableIndex=u,p.originalEvent=h,p.pullMode=b?b.lastPutMode:void 0;var y=de(de({},v),Re.getEventProperties(t,a));for(var E in y)p[E]=y[E];e&&e.dispatchEvent(p),w[m]&&w[m].call(a,p)}}var Jn=["evt"],X=function(a,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=t.evt,s=Vn(t,Jn);Re.pluginEvent.bind(C)(a,e,de({dragEl:g,parentEl:A,ghostEl:T,rootEl:I,nextEl:Ce,lastDownEl:Je,cloneEl:F,cloneHidden:ve,dragStarted:Fe,putSortable:K,activeSortable:C.active,originalEvent:n,oldIndex:xe,oldDraggableIndex:Be,newIndex:z,newDraggableIndex:be,hideGhostForTarget:gn,unhideGhostForTarget:mn,cloneNowHidden:function(){ve=!0},cloneNowShown:function(){ve=!1},dispatchSortableEvent:function(l){V({sortable:e,name:l,originalEvent:n})}},s))};function V(i){zn(de({putSortable:K,cloneEl:F,targetEl:g,rootEl:I,oldIndex:xe,oldDraggableIndex:Be,newIndex:z,newDraggableIndex:be},i))}var g,A,T,I,Ce,Je,F,ve,xe,z,Be,be,qe,K,Ee=!1,nt=!1,at=[],we,ne,St,Ct,Zt,en,Fe,De,$e,Ke=!1,Xe=!1,Qe,j,kt=[],Mt=!1,st=[],rt=typeof document!="undefined",Ue=Ft,tn=je||fe?"cssFloat":"float",Qn=rt&&!an&&!Ft&&"draggable"in document.createElement("div"),hn=function(){if(rt){if(fe)return!1;var i=document.createElement("x");return i.style.cssText="pointer-events:auto",i.style.pointerEvents==="auto"}}(),pn=function(a,e){var t=S(a),n=parseInt(t.width)-parseInt(t.paddingLeft)-parseInt(t.paddingRight)-parseInt(t.borderLeftWidth)-parseInt(t.borderRightWidth),s=Pe(a,0,e),r=Pe(a,1,e),l=s&&S(s),o=r&&S(r),c=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+B(s).width,d=o&&parseInt(o.marginLeft)+parseInt(o.marginRight)+B(r).width;if(t.display==="flex")return t.flexDirection==="column"||t.flexDirection==="column-reverse"?"vertical":"horizontal";if(t.display==="grid")return t.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(s&&l.float&&l.float!=="none"){var u=l.float==="left"?"left":"right";return r&&(o.clear==="both"||o.clear===u)?"vertical":"horizontal"}return s&&(l.display==="block"||l.display==="flex"||l.display==="table"||l.display==="grid"||c>=n&&t[tn]==="none"||r&&t[tn]==="none"&&c+d>n)?"vertical":"horizontal"},Zn=function(a,e,t){var n=t?a.left:a.top,s=t?a.right:a.bottom,r=t?a.width:a.height,l=t?e.left:e.top,o=t?e.right:e.bottom,c=t?e.width:e.height;return n===l||s===o||n+r/2===l+c/2},ea=function(a,e){var t;return at.some(function(n){var s=n[U].options.emptyInsertThreshold;if(!(!s||At(n))){var r=B(n),l=a>=r.left-s&&a<=r.right+s,o=e>=r.top-s&&e<=r.bottom+s;if(l&&o)return t=n}}),t},fn=function(a){function e(s,r){return function(l,o,c,d){var u=l.options.group.name&&o.options.group.name&&l.options.group.name===o.options.group.name;if(s==null&&(r||u))return!0;if(s==null||s===!1)return!1;if(r&&s==="clone")return s;if(typeof s=="function")return e(s(l,o,c,d),r)(l,o,c,d);var h=(r?l:o).options.group.name;return s===!0||typeof s=="string"&&s===h||s.join&&s.indexOf(h)>-1}}var t={},n=a.group;(!n||ze(n)!="object")&&(n={name:n}),t.name=n.name,t.checkPull=e(n.pull,!0),t.checkPut=e(n.put),t.revertClone=n.revertClone,a.group=t},gn=function(){!hn&&T&&S(T,"display","none")},mn=function(){!hn&&T&&S(T,"display","")};rt&&!an&&document.addEventListener("click",function(i){if(nt)return i.preventDefault(),i.stopPropagation&&i.stopPropagation(),i.stopImmediatePropagation&&i.stopImmediatePropagation(),nt=!1,!1},!0);var Se=function(a){if(g){a=a.touches?a.touches[0]:a;var e=ea(a.clientX,a.clientY);if(e){var t={};for(var n in a)a.hasOwnProperty(n)&&(t[n]=a[n]);t.target=t.rootEl=e,t.preventDefault=void 0,t.stopPropagation=void 0,e[U]._onDragOver(t)}}},ta=function(a){g&&g.parentNode[U]._isOutsideThisEl(a.target)};function C(i,a){if(!(i&&i.nodeType&&i.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(i));this.el=i,this.options=a=pe({},a),i[U]=this;var e={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(i.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return pn(i,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(r,l){r.setData("Text",l.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:C.supportPointer!==!1&&"PointerEvent"in window&&(!Le||Ft),emptyInsertThreshold:5};Re.initializePlugins(this,i,e);for(var t in e)!(t in a)&&(a[t]=e[t]);fn(a);for(var n in this)n.charAt(0)==="_"&&typeof this[n]=="function"&&(this[n]=this[n].bind(this));this.nativeDraggable=a.forceFallback?!1:Qn,this.nativeDraggable&&(this.options.touchStartThreshold=1),a.supportPointer?M(i,"pointerdown",this._onTapStart):(M(i,"mousedown",this._onTapStart),M(i,"touchstart",this._onTapStart)),this.nativeDraggable&&(M(i,"dragover",this),M(i,"dragenter",this)),at.push(this.el),a.store&&a.store.get&&this.sort(a.store.get(this)||[]),pe(this,Xn())}C.prototype={constructor:C,_isOutsideThisEl:function(a){!this.el.contains(a)&&a!==this.el&&(De=null)},_getDirection:function(a,e){return typeof this.options.direction=="function"?this.options.direction.call(this,a,e,g):this.options.direction},_onTapStart:function(a){if(a.cancelable){var e=this,t=this.el,n=this.options,s=n.preventOnFilter,r=a.type,l=a.touches&&a.touches[0]||a.pointerType&&a.pointerType==="touch"&&a,o=(l||a).target,c=a.target.shadowRoot&&(a.path&&a.path[0]||a.composedPath&&a.composedPath()[0])||o,d=n.filter;if(ca(t),!g&&!(/mousedown|pointerdown/.test(r)&&a.button!==0||n.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&Le&&o&&o.tagName.toUpperCase()==="SELECT")&&(o=ae(o,n.draggable,t,!1),!(o&&o.animated)&&Je!==o)){if(xe=Q(o),Be=Q(o,n.draggable),typeof d=="function"){if(d.call(this,a,o,this)){V({sortable:e,rootEl:c,name:"filter",targetEl:o,toEl:t,fromEl:t}),X("filter",e,{evt:a}),s&&a.preventDefault();return}}else if(d&&(d=d.split(",").some(function(u){if(u=ae(c,u.trim(),t,!1),u)return V({sortable:e,rootEl:u,name:"filter",targetEl:o,fromEl:t,toEl:t}),X("filter",e,{evt:a}),!0}),d)){s&&a.preventDefault();return}n.handle&&!ae(c,n.handle,t,!1)||this._prepareDragStart(a,l,o)}}},_prepareDragStart:function(a,e,t){var n=this,s=n.el,r=n.options,l=s.ownerDocument,o;if(t&&!g&&t.parentNode===s){var c=B(t);if(I=s,g=t,A=g.parentNode,Ce=g.nextSibling,Je=t,qe=r.group,C.dragged=g,we={target:g,clientX:(e||a).clientX,clientY:(e||a).clientY},Zt=we.clientX-c.left,en=we.clientY-c.top,this._lastX=(e||a).clientX,this._lastY=(e||a).clientY,g.style["will-change"]="all",o=function(){if(X("delayEnded",n,{evt:a}),C.eventCanceled){n._onDrop();return}n._disableDelayedDragEvents(),!Gt&&n.nativeDraggable&&(g.draggable=!0),n._triggerDragStart(a,e),V({sortable:n,name:"choose",originalEvent:a}),G(g,r.chosenClass,!0)},r.ignore.split(",").forEach(function(d){on(g,d.trim(),Tt)}),M(l,"dragover",Se),M(l,"mousemove",Se),M(l,"touchmove",Se),r.supportPointer?(M(l,"pointerup",n._onDrop),!this.nativeDraggable&&M(l,"pointercancel",n._onDrop)):(M(l,"mouseup",n._onDrop),M(l,"touchend",n._onDrop),M(l,"touchcancel",n._onDrop)),Gt&&this.nativeDraggable&&(this.options.touchStartThreshold=4,g.draggable=!0),X("delayStart",this,{evt:a}),r.delay&&(!r.delayOnTouchOnly||e)&&(!this.nativeDraggable||!(je||fe))){if(C.eventCanceled){this._onDrop();return}r.supportPointer?(M(l,"pointerup",n._disableDelayedDrag),M(l,"pointercancel",n._disableDelayedDrag)):(M(l,"mouseup",n._disableDelayedDrag),M(l,"touchend",n._disableDelayedDrag),M(l,"touchcancel",n._disableDelayedDrag)),M(l,"mousemove",n._delayedDragTouchMoveHandler),M(l,"touchmove",n._delayedDragTouchMoveHandler),r.supportPointer&&M(l,"pointermove",n._delayedDragTouchMoveHandler),n._dragStartTimer=setTimeout(o,r.delay)}else o()}},_delayedDragTouchMoveHandler:function(a){var e=a.touches?a.touches[0]:a;Math.max(Math.abs(e.clientX-this._lastX),Math.abs(e.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){g&&Tt(g),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var a=this.el.ownerDocument;x(a,"mouseup",this._disableDelayedDrag),x(a,"touchend",this._disableDelayedDrag),x(a,"touchcancel",this._disableDelayedDrag),x(a,"pointerup",this._disableDelayedDrag),x(a,"pointercancel",this._disableDelayedDrag),x(a,"mousemove",this._delayedDragTouchMoveHandler),x(a,"touchmove",this._delayedDragTouchMoveHandler),x(a,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(a,e){e=e||a.pointerType=="touch"&&a,!this.nativeDraggable||e?this.options.supportPointer?M(document,"pointermove",this._onTouchMove):e?M(document,"touchmove",this._onTouchMove):M(document,"mousemove",this._onTouchMove):(M(g,"dragend",this),M(I,"dragstart",this._onDragStart));try{document.selection?Ze(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(t){}},_dragStarted:function(a,e){if(Ee=!1,I&&g){X("dragStarted",this,{evt:e}),this.nativeDraggable&&M(document,"dragover",ta);var t=this.options;!a&&G(g,t.dragClass,!1),G(g,t.ghostClass,!0),C.active=this,a&&this._appendGhost(),V({sortable:this,name:"start",originalEvent:e})}else this._nulling()},_emulateDragOver:function(){if(ne){this._lastX=ne.clientX,this._lastY=ne.clientY,gn();for(var a=document.elementFromPoint(ne.clientX,ne.clientY),e=a;a&&a.shadowRoot&&(a=a.shadowRoot.elementFromPoint(ne.clientX,ne.clientY),a!==e);)e=a;if(g.parentNode[U]._isOutsideThisEl(a),e)do{if(e[U]){var t=void 0;if(t=e[U]._onDragOver({clientX:ne.clientX,clientY:ne.clientY,target:a,rootEl:e}),t&&!this.options.dragoverBubble)break}a=e}while(e=rn(e));mn()}},_onTouchMove:function(a){if(we){var e=this.options,t=e.fallbackTolerance,n=e.fallbackOffset,s=a.touches?a.touches[0]:a,r=T&&Me(T,!0),l=T&&r&&r.a,o=T&&r&&r.d,c=Ue&&j&&Qt(j),d=(s.clientX-we.clientX+n.x)/(l||1)+(c?c[0]-kt[0]:0)/(l||1),u=(s.clientY-we.clientY+n.y)/(o||1)+(c?c[1]-kt[1]:0)/(o||1);if(!C.active&&!Ee){if(t&&Math.max(Math.abs(s.clientX-this._lastX),Math.abs(s.clientY-this._lastY))<t)return;this._onDragStart(a,!0)}if(T){r?(r.e+=d-(St||0),r.f+=u-(Ct||0)):r={a:1,b:0,c:0,d:1,e:d,f:u};var h="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");S(T,"webkitTransform",h),S(T,"mozTransform",h),S(T,"msTransform",h),S(T,"transform",h),St=d,Ct=u,ne=s}a.cancelable&&a.preventDefault()}},_appendGhost:function(){if(!T){var a=this.options.fallbackOnBody?document.body:I,e=B(g,!0,Ue,!0,a),t=this.options;if(Ue){for(j=a;S(j,"position")==="static"&&S(j,"transform")==="none"&&j!==document;)j=j.parentNode;j!==document.body&&j!==document.documentElement?(j===document&&(j=ce()),e.top+=j.scrollTop,e.left+=j.scrollLeft):j=ce(),kt=Qt(j)}T=g.cloneNode(!0),G(T,t.ghostClass,!1),G(T,t.fallbackClass,!0),G(T,t.dragClass,!0),S(T,"transition",""),S(T,"transform",""),S(T,"box-sizing","border-box"),S(T,"margin",0),S(T,"top",e.top),S(T,"left",e.left),S(T,"width",e.width),S(T,"height",e.height),S(T,"opacity","0.8"),S(T,"position",Ue?"absolute":"fixed"),S(T,"zIndex","100000"),S(T,"pointerEvents","none"),C.ghost=T,a.appendChild(T),S(T,"transform-origin",Zt/parseInt(T.style.width)*100+"% "+en/parseInt(T.style.height)*100+"%")}},_onDragStart:function(a,e){var t=this,n=a.dataTransfer,s=t.options;if(X("dragStart",this,{evt:a}),C.eventCanceled){this._onDrop();return}X("setupClone",this),C.eventCanceled||(F=dn(g),F.removeAttribute("id"),F.draggable=!1,F.style["will-change"]="",this._hideClone(),G(F,this.options.chosenClass,!1),C.clone=F),t.cloneId=Ze(function(){X("clone",t),!C.eventCanceled&&(t.options.removeCloneOnHide||I.insertBefore(F,g),t._hideClone(),V({sortable:t,name:"clone"}))}),!e&&G(g,s.dragClass,!0),e?(nt=!0,t._loopId=setInterval(t._emulateDragOver,50)):(x(document,"mouseup",t._onDrop),x(document,"touchend",t._onDrop),x(document,"touchcancel",t._onDrop),n&&(n.effectAllowed="move",s.setData&&s.setData.call(t,n,g)),M(document,"drop",t),S(g,"transform","translateZ(0)")),Ee=!0,t._dragStartId=Ze(t._dragStarted.bind(t,e,a)),M(document,"selectstart",t),Fe=!0,window.getSelection().removeAllRanges(),Le&&S(document.body,"user-select","none")},_onDragOver:function(a){var e=this.el,t=a.target,n,s,r,l=this.options,o=l.group,c=C.active,d=qe===o,u=l.sort,h=K||c,b,v=this,p=!1;if(Mt)return;function w(Ie,Fn){X(Ie,v,de({evt:a,isOwner:d,axis:b?"vertical":"horizontal",revert:r,dragRect:n,targetRect:s,canSort:u,fromSortable:h,target:t,completed:y,onMove:function(Xt,An){return Ge(I,e,g,n,Xt,B(Xt),a,An)},changed:E},Fn))}function m(){w("dragOverAnimationCapture"),v.captureAnimationState(),v!==h&&h.captureAnimationState()}function y(Ie){return w("dragOverCompleted",{insertion:Ie}),Ie&&(d?c._hideClone():c._showClone(v),v!==h&&(G(g,K?K.options.ghostClass:c.options.ghostClass,!1),G(g,l.ghostClass,!0)),K!==v&&v!==C.active?K=v:v===C.active&&K&&(K=null),h===v&&(v._ignoreWhileAnimating=t),v.animateAll(function(){w("dragOverAnimationComplete"),v._ignoreWhileAnimating=null}),v!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(t===g&&!g.animated||t===e&&!t.animated)&&(De=null),!l.dragoverBubble&&!a.rootEl&&t!==document&&(g.parentNode[U]._isOutsideThisEl(a.target),!Ie&&Se(a)),!l.dragoverBubble&&a.stopPropagation&&a.stopPropagation(),p=!0}function E(){z=Q(g),be=Q(g,l.draggable),V({sortable:v,name:"change",toEl:e,newIndex:z,newDraggableIndex:be,originalEvent:a})}if(a.preventDefault!==void 0&&a.cancelable&&a.preventDefault(),t=ae(t,l.draggable,e,!0),w("dragOver"),C.eventCanceled)return p;if(g.contains(a.target)||t.animated&&t.animatingX&&t.animatingY||v._ignoreWhileAnimating===t)return y(!1);if(nt=!1,c&&!l.disabled&&(d?u||(r=A!==I):K===this||(this.lastPutMode=qe.checkPull(this,c,g,a))&&o.checkPut(this,c,g,a))){if(b=this._getDirection(a,t)==="vertical",n=B(g),w("dragOverValid"),C.eventCanceled)return p;if(r)return A=I,m(),this._hideClone(),w("revert"),C.eventCanceled||(Ce?I.insertBefore(g,Ce):I.appendChild(g)),y(!0);var D=At(e,l.draggable);if(!D||ia(a,b,this)&&!D.animated){if(D===g)return y(!1);if(D&&e===a.target&&(t=D),t&&(s=B(t)),Ge(I,e,g,n,t,s,a,!!t)!==!1)return m(),D&&D.nextSibling?e.insertBefore(g,D.nextSibling):e.appendChild(g),A=e,E(),y(!0)}else if(D&&sa(a,b,this)){var P=Pe(e,0,l,!0);if(P===g)return y(!1);if(t=P,s=B(t),Ge(I,e,g,n,t,s,a,!1)!==!1)return m(),e.insertBefore(g,P),A=e,E(),y(!0)}else if(t.parentNode===e){s=B(t);var N=0,oe,H=g.parentNode!==e,_=!Zn(g.animated&&g.toRect||n,t.animated&&t.toRect||s,b),ge=b?"top":"left",le=Jt(t,"top","top")||Jt(g,"top","top"),me=le?le.scrollTop:void 0;De!==t&&(oe=s[ge],Ke=!1,Xe=!_&&l.invertSwap||H),N=ra(a,t,s,b,_?1:l.swapThreshold,l.invertedSwapThreshold==null?l.swapThreshold:l.invertedSwapThreshold,Xe,De===t);var q;if(N!==0){var J=Q(g);do J-=N,q=A.children[J];while(q&&(S(q,"display")==="none"||q===T))}if(N===0||q===t)return y(!1);De=t,$e=N;var te=t.nextElementSibling,R=!1;R=N===1;var Ne=Ge(I,e,g,n,t,s,a,R);if(Ne!==!1)return(Ne===1||Ne===-1)&&(R=Ne===1),Mt=!0,setTimeout(aa,30),m(),R&&!te?e.appendChild(g):t.parentNode.insertBefore(g,R?te:t),le&&cn(le,0,me-le.scrollTop),A=g.parentNode,oe!==void 0&&!Xe&&(Qe=Math.abs(oe-B(t)[ge])),E(),y(!0)}if(e.contains(g))return y(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){x(document,"mousemove",this._onTouchMove),x(document,"touchmove",this._onTouchMove),x(document,"pointermove",this._onTouchMove),x(document,"dragover",Se),x(document,"mousemove",Se),x(document,"touchmove",Se)},_offUpEvents:function(){var a=this.el.ownerDocument;x(a,"mouseup",this._onDrop),x(a,"touchend",this._onDrop),x(a,"pointerup",this._onDrop),x(a,"pointercancel",this._onDrop),x(a,"touchcancel",this._onDrop),x(document,"selectstart",this)},_onDrop:function(a){var e=this.el,t=this.options;if(z=Q(g),be=Q(g,t.draggable),X("drop",this,{evt:a}),A=g&&g.parentNode,z=Q(g),be=Q(g,t.draggable),C.eventCanceled){this._nulling();return}Ee=!1,Xe=!1,Ke=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Pt(this.cloneId),Pt(this._dragStartId),this.nativeDraggable&&(x(document,"drop",this),x(e,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Le&&S(document.body,"user-select",""),S(g,"transform",""),a&&(Fe&&(a.cancelable&&a.preventDefault(),!t.dropBubble&&a.stopPropagation()),T&&T.parentNode&&T.parentNode.removeChild(T),(I===A||K&&K.lastPutMode!=="clone")&&F&&F.parentNode&&F.parentNode.removeChild(F),g&&(this.nativeDraggable&&x(g,"dragend",this),Tt(g),g.style["will-change"]="",Fe&&!Ee&&G(g,K?K.options.ghostClass:this.options.ghostClass,!1),G(g,this.options.chosenClass,!1),V({sortable:this,name:"unchoose",toEl:A,newIndex:null,newDraggableIndex:null,originalEvent:a}),I!==A?(z>=0&&(V({rootEl:A,name:"add",toEl:A,fromEl:I,originalEvent:a}),V({sortable:this,name:"remove",toEl:A,originalEvent:a}),V({rootEl:A,name:"sort",toEl:A,fromEl:I,originalEvent:a}),V({sortable:this,name:"sort",toEl:A,originalEvent:a})),K&&K.save()):z!==xe&&z>=0&&(V({sortable:this,name:"update",toEl:A,originalEvent:a}),V({sortable:this,name:"sort",toEl:A,originalEvent:a})),C.active&&((z==null||z===-1)&&(z=xe,be=Be),V({sortable:this,name:"end",toEl:A,originalEvent:a}),this.save()))),this._nulling()},_nulling:function(){X("nulling",this),I=g=A=T=Ce=F=Je=ve=we=ne=Fe=z=be=xe=Be=De=$e=K=qe=C.dragged=C.ghost=C.clone=C.active=null,st.forEach(function(a){a.checked=!0}),st.length=St=Ct=0},handleEvent:function(a){switch(a.type){case"drop":case"dragend":this._onDrop(a);break;case"dragenter":case"dragover":g&&(this._onDragOver(a),na(a));break;case"selectstart":a.preventDefault();break}},toArray:function(){for(var a=[],e,t=this.el.children,n=0,s=t.length,r=this.options;n<s;n++)e=t[n],ae(e,r.draggable,this.el,!1)&&a.push(e.getAttribute(r.dataIdAttr)||la(e));return a},sort:function(a,e){var t={},n=this.el;this.toArray().forEach(function(s,r){var l=n.children[r];ae(l,this.options.draggable,n,!1)&&(t[s]=l)},this),e&&this.captureAnimationState(),a.forEach(function(s){t[s]&&(n.removeChild(t[s]),n.appendChild(t[s]))}),e&&this.animateAll()},save:function(){var a=this.options.store;a&&a.set&&a.set(this)},closest:function(a,e){return ae(a,e||this.options.draggable,this.el,!1)},option:function(a,e){var t=this.options;if(e===void 0)return t[a];var n=Re.modifyOption(this,a,e);typeof n!="undefined"?t[a]=n:t[a]=e,a==="group"&&fn(t)},destroy:function(){X("destroy",this);var a=this.el;a[U]=null,x(a,"mousedown",this._onTapStart),x(a,"touchstart",this._onTapStart),x(a,"pointerdown",this._onTapStart),this.nativeDraggable&&(x(a,"dragover",this),x(a,"dragenter",this)),Array.prototype.forEach.call(a.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),at.splice(at.indexOf(this.el),1),this.el=a=null},_hideClone:function(){if(!ve){if(X("hideClone",this),C.eventCanceled)return;S(F,"display","none"),this.options.removeCloneOnHide&&F.parentNode&&F.parentNode.removeChild(F),ve=!0}},_showClone:function(a){if(a.lastPutMode!=="clone"){this._hideClone();return}if(ve){if(X("showClone",this),C.eventCanceled)return;g.parentNode==I&&!this.options.group.revertClone?I.insertBefore(F,g):Ce?I.insertBefore(F,Ce):I.appendChild(F),this.options.group.revertClone&&this.animate(g,F),S(F,"display",""),ve=!1}}};function na(i){i.dataTransfer&&(i.dataTransfer.dropEffect="move"),i.cancelable&&i.preventDefault()}function Ge(i,a,e,t,n,s,r,l){var o,c=i[U],d=c.options.onMove,u;return window.CustomEvent&&!fe&&!je?o=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(o=document.createEvent("Event"),o.initEvent("move",!0,!0)),o.to=a,o.from=i,o.dragged=e,o.draggedRect=t,o.related=n||a,o.relatedRect=s||B(a),o.willInsertAfter=l,o.originalEvent=r,i.dispatchEvent(o),d&&(u=d.call(c,o,r)),u}function Tt(i){i.draggable=!1}function aa(){Mt=!1}function sa(i,a,e){var t=B(Pe(e.el,0,e.options,!0)),n=un(e.el,e.options,T),s=10;return a?i.clientX<n.left-s||i.clientY<t.top&&i.clientX<t.right:i.clientY<n.top-s||i.clientY<t.bottom&&i.clientX<t.left}function ia(i,a,e){var t=B(At(e.el,e.options.draggable)),n=un(e.el,e.options,T),s=10;return a?i.clientX>n.right+s||i.clientY>t.bottom&&i.clientX>t.left:i.clientY>n.bottom+s||i.clientX>t.right&&i.clientY>t.top}function ra(i,a,e,t,n,s,r,l){var o=t?i.clientY:i.clientX,c=t?e.height:e.width,d=t?e.top:e.left,u=t?e.bottom:e.right,h=!1;if(!r){if(l&&Qe<c*n){if(!Ke&&($e===1?o>d+c*s/2:o<u-c*s/2)&&(Ke=!0),Ke)h=!0;else if($e===1?o<d+Qe:o>u-Qe)return-$e}else if(o>d+c*(1-n)/2&&o<u-c*(1-n)/2)return oa(a)}return h=h||r,h&&(o<d+c*s/2||o>u-c*s/2)?o>d+c/2?1:-1:0}function oa(i){return Q(g)<Q(i)?1:-1}function la(i){for(var a=i.tagName+i.className+i.src+i.href+i.textContent,e=a.length,t=0;e--;)t+=a.charCodeAt(e);return t.toString(36)}function ca(i){st.length=0;for(var a=i.getElementsByTagName("input"),e=a.length;e--;){var t=a[e];t.checked&&st.push(t)}}function Ze(i){return setTimeout(i,0)}function Pt(i){return clearTimeout(i)}rt&&M(document,"touchmove",function(i){(C.active||Ee)&&i.cancelable&&i.preventDefault()});C.utils={on:M,off:x,css:S,find:on,is:function(a,e){return!!ae(a,e,a,!1)},extend:Hn,throttle:ln,closest:ae,toggleClass:G,clone:dn,index:Q,nextTick:Ze,cancelNextTick:Pt,detectDirection:pn,getChild:Pe,expando:U};C.get=function(i){return i[U]};C.mount=function(){for(var i=arguments.length,a=new Array(i),e=0;e<i;e++)a[e]=arguments[e];a[0].constructor===Array&&(a=a[0]),a.forEach(function(t){if(!t.prototype||!t.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(t));t.utils&&(C.utils=de(de({},C.utils),t.utils)),Re.mount(t)})};C.create=function(i,a){return new C(i,a)};C.version=Yn;var O=[],Ae,Nt,It=!1,Dt,Et,it,_e;function da(){function i(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var a in this)a.charAt(0)==="_"&&typeof this[a]=="function"&&(this[a]=this[a].bind(this))}return i.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?M(document,"dragover",this._handleAutoScroll):this.options.supportPointer?M(document,"pointermove",this._handleFallbackAutoScroll):t.touches?M(document,"touchmove",this._handleFallbackAutoScroll):M(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;!this.options.dragOverBubble&&!t.rootEl&&this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?x(document,"dragover",this._handleAutoScroll):(x(document,"pointermove",this._handleFallbackAutoScroll),x(document,"touchmove",this._handleFallbackAutoScroll),x(document,"mousemove",this._handleFallbackAutoScroll)),nn(),et(),qn()},nulling:function(){it=Nt=Ae=It=_e=Dt=Et=null,O.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var n=this,s=(e.touches?e.touches[0]:e).clientX,r=(e.touches?e.touches[0]:e).clientY,l=document.elementFromPoint(s,r);if(it=e,t||this.options.forceAutoScrollFallback||je||fe||Le){xt(e,this.options,l,t);var o=ye(l,!0);It&&(!_e||s!==Dt||r!==Et)&&(_e&&nn(),_e=setInterval(function(){var c=ye(document.elementFromPoint(s,r),!0);c!==o&&(o=c,et()),xt(e,n.options,c,t)},10),Dt=s,Et=r)}else{if(!this.options.bubbleScroll||ye(l,!0)===ce()){et();return}xt(e,this.options,ye(l,!1),!1)}}},pe(i,{pluginName:"scroll",initializeByDefault:!0})}function et(){O.forEach(function(i){clearInterval(i.pid)}),O=[]}function nn(){clearInterval(_e)}var xt=ln(function(i,a,e,t){if(a.scroll){var n=(i.touches?i.touches[0]:i).clientX,s=(i.touches?i.touches[0]:i).clientY,r=a.scrollSensitivity,l=a.scrollSpeed,o=ce(),c=!1,d;Nt!==e&&(Nt=e,et(),Ae=a.scroll,d=a.scrollFn,Ae===!0&&(Ae=ye(e,!0)));var u=0,h=Ae;do{var b=h,v=B(b),p=v.top,w=v.bottom,m=v.left,y=v.right,E=v.width,D=v.height,P=void 0,N=void 0,oe=b.scrollWidth,H=b.scrollHeight,_=S(b),ge=b.scrollLeft,le=b.scrollTop;b===o?(P=E<oe&&(_.overflowX==="auto"||_.overflowX==="scroll"||_.overflowX==="visible"),N=D<H&&(_.overflowY==="auto"||_.overflowY==="scroll"||_.overflowY==="visible")):(P=E<oe&&(_.overflowX==="auto"||_.overflowX==="scroll"),N=D<H&&(_.overflowY==="auto"||_.overflowY==="scroll"));var me=P&&(Math.abs(y-n)<=r&&ge+E<oe)-(Math.abs(m-n)<=r&&!!ge),q=N&&(Math.abs(w-s)<=r&&le+D<H)-(Math.abs(p-s)<=r&&!!le);if(!O[u])for(var J=0;J<=u;J++)O[J]||(O[J]={});(O[u].vx!=me||O[u].vy!=q||O[u].el!==b)&&(O[u].el=b,O[u].vx=me,O[u].vy=q,clearInterval(O[u].pid),(me!=0||q!=0)&&(c=!0,O[u].pid=setInterval(function(){t&&this.layer===0&&C.active._onTouchMove(it);var te=O[this.layer].vy?O[this.layer].vy*l:0,R=O[this.layer].vx?O[this.layer].vx*l:0;typeof d=="function"&&d.call(C.dragged.parentNode[U],R,te,i,it,O[this.layer].el)!=="continue"||cn(O[this.layer].el,R,te)}.bind({layer:u}),24))),u++}while(a.bubbleScroll&&h!==o&&(h=ye(h,!1)));It=c}},30),bn=function(a){var e=a.originalEvent,t=a.putSortable,n=a.dragEl,s=a.activeSortable,r=a.dispatchSortableEvent,l=a.hideGhostForTarget,o=a.unhideGhostForTarget;if(e){var c=t||s;l();var d=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e,u=document.elementFromPoint(d.clientX,d.clientY);o(),c&&!c.el.contains(u)&&(r("spill"),this.onSpill({dragEl:n,putSortable:t}))}};function _t(){}_t.prototype={startIndex:null,dragStart:function(a){var e=a.oldDraggableIndex;this.startIndex=e},onSpill:function(a){var e=a.dragEl,t=a.putSortable;this.sortable.captureAnimationState(),t&&t.captureAnimationState();var n=Pe(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(e,n):this.sortable.el.appendChild(e),this.sortable.animateAll(),t&&t.animateAll()},drop:bn};pe(_t,{pluginName:"revertOnSpill"});function Lt(){}Lt.prototype={onSpill:function(a){var e=a.dragEl,t=a.putSortable,n=t||this.sortable;n.captureAnimationState(),e.parentNode&&e.parentNode.removeChild(e),n.animateAll()},drop:bn};pe(Lt,{pluginName:"removeOnSpill"});C.mount(new da);C.mount(Lt,_t);var Ot=C;var ot={text:"",tags:[],projects:[],dueState:"all",showCompleted:!0},Ve={enabled:!1,tasksFolder:"Tasks",query:"",statusField:"status",progressField:"progress",projectField:"project",laneMapping:{},conflictResolution:"prompt",syncInterval:0,createMissingTasks:!1,archiveCompletedTasks:!1},Z={"new-card-insertion-method":"append","prepend-archive-date":!1,"prepend-archive-format":"YYYY-MM-DD","date-format":"YYYY-MM-DD","time-format":"HH:mm","date-trigger":"@","time-trigger":"@@","link-date-to-daily-note":!1,"show-relative-date":!1,"hide-tags-in-title":!1,"hide-date-in-title":!1,"hide-metadata-in-title":!1,"default-lane-width":"272px","show-checkboxes":!0,"show-card-menu":!0,"show-progress":!0,"show-project":!0,"default-project":"","template-path":"","card-note-template":"","card-note-folder":"","parse-natural-dates":!0,"parse-recurrence":!0,"enable-reminders":!1,"reminder-time":"1h","reminder-type":"notice","date-serialization-format":"iso","show-card-composer":!0,"composer-position":"bottom","show-subtasks":!0,"base-sync":{...Ve},"show-filter-toolbar":!0,"default-wip-limit":0,"wip-block-exceeded":!1,"auto-create-note":!1},se="kanban",ee="kanban-plugin";var Y={TODAY:/\btoday\b/i,TOMORROW:/\btomorrow\b/i,YESTERDAY:/\byesterday\b/i,NEXT_DAY:/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\b/i,THIS_DAY:/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\b/i,LAST_DAY:/\blast\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\b/i,IN_X_DAYS:/\bin\s+(\d+)\s+days?\b/i,IN_X_WEEKS:/\bin\s+(\d+)\s+weeks?\b/i,IN_X_MONTHS:/\bin\s+(\d+)\s+months?\b/i,X_DAYS_AGO:/\b(\d+)\s+days?\s+ago\b/i,NEXT_WEEK:/\bnext\s+week\b/i,NEXT_MONTH:/\bnext\s+month\b/i,END_OF_WEEK:/\bend\s+of\s+week\b/i,END_OF_MONTH:/\bend\s+of\s+month\b/i},ie={DAILY:/\b(?:every\s+day|daily)\b/i,WEEKLY:/\b(?:every\s+week|weekly)\b/i,MONTHLY:/\b(?:every\s+month|monthly)\b/i,YEARLY:/\b(?:every\s+year|yearly|annually)\b/i,EVERY_X_DAYS:/\bevery\s+(\d+)\s+days?\b/i,EVERY_X_WEEKS:/\bevery\s+(\d+)\s+weeks?\b/i,EVERY_X_MONTHS:/\bevery\s+(\d+)\s+months?\b/i,EVERY_DAY_OF_WEEK:/\bevery\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday)(?:\s*,\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday))*\b/i,WEEKDAYS:/\b(?:every\s+weekday|weekdays)\b/i,WEEKENDS:/\b(?:every\s+weekend|weekends)\b/i},Ye={sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6},vn={0:"sunday",1:"monday",2:"tuesday",3:"wednesday",4:"thursday",5:"friday",6:"saturday"},yn=["progress","project","priority","status","assignee","estimate","spent"];function ke(){return Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4)}function Bt(i={}){let a=new Date,e=ke(),t;return i.tags&&(t=Array.isArray(i.tags)?i.tags.join(", "):i.tags),{title:i.title||"",date:W(a),time:a.toTimeString().slice(0,5),datetime:a.toISOString(),project:i.project,lane:i.lane,board:i.board,dueDate:i.dueDate,priority:i.priority,tags:t,id:e,...i.customVars}}function $t(i,a){return i.replace(/\{\{([^}]+)\}\}/g,(e,t)=>{let n=t.trim();if(n.startsWith("date:")){let r=n.slice(5);return ua(new Date,r)}if(n.includes("|")){let[r,l]=n.split("|").map(c=>c.trim()),o=a[r];return o!==void 0&&o!==""?String(o):l}let s=a[n];return s!==void 0?String(s):e})}function ua(i,a){let e=i.getFullYear(),t=String(i.getMonth()+1).padStart(2,"0"),n=String(i.getDate()).padStart(2,"0"),s=String(i.getHours()).padStart(2,"0"),r=String(i.getMinutes()).padStart(2,"0"),l=String(i.getSeconds()).padStart(2,"0"),o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],c=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],d=["January","February","March","April","May","June","July","August","September","October","November","December"],u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return a.replace(/YYYY/g,String(e)).replace(/YY/g,String(e).slice(-2)).replace(/MMMM/g,d[i.getMonth()]).replace(/MMM/g,u[i.getMonth()]).replace(/MM/g,t).replace(/M/g,String(i.getMonth()+1)).replace(/DDDD/g,o[i.getDay()]).replace(/DDD/g,c[i.getDay()]).replace(/DD/g,n).replace(/D/g,String(i.getDate())).replace(/HH/g,s).replace(/H/g,String(i.getHours())).replace(/mm/g,r).replace(/m/g,String(i.getMinutes())).replace(/ss/g,l).replace(/s/g,String(i.getSeconds()))}function wn(i,a=new Date){let e=new Date(a);e.setHours(0,0,0,0);let t=i.match(Y.TODAY);if(t)return{date:W(e),matched:t[0]};let n=i.match(Y.TOMORROW);if(n){let m=new Date(e);return m.setDate(m.getDate()+1),{date:W(m),matched:n[0]}}let s=i.match(Y.YESTERDAY);if(s){let m=new Date(e);return m.setDate(m.getDate()-1),{date:W(m),matched:s[0]}}let r=i.match(Y.NEXT_DAY);if(r){let m=r[1].toLowerCase(),y=Ye[m];if(y!==void 0){let E=lt(e,y,!0);return{date:W(E),matched:r[0]}}}let l=i.match(Y.THIS_DAY);if(l){let m=l[1].toLowerCase(),y=Ye[m];if(y!==void 0){let E=lt(e,y,!1);return{date:W(E),matched:l[0]}}}let o=i.match(Y.LAST_DAY);if(o){let m=o[1].toLowerCase(),y=Ye[m];if(y!==void 0){let E=ha(e,y);return{date:W(E),matched:o[0]}}}let c=i.match(Y.IN_X_DAYS);if(c){let m=parseInt(c[1],10),y=new Date(e);return y.setDate(y.getDate()+m),{date:W(y),matched:c[0]}}let d=i.match(Y.IN_X_WEEKS);if(d){let m=parseInt(d[1],10),y=new Date(e);return y.setDate(y.getDate()+m*7),{date:W(y),matched:d[0]}}let u=i.match(Y.IN_X_MONTHS);if(u){let m=parseInt(u[1],10),y=new Date(e);return y.setMonth(y.getMonth()+m),{date:W(y),matched:u[0]}}let h=i.match(Y.X_DAYS_AGO);if(h){let m=parseInt(h[1],10),y=new Date(e);return y.setDate(y.getDate()-m),{date:W(y),matched:h[0]}}let b=i.match(Y.NEXT_WEEK);if(b){let m=lt(e,1,!0);return{date:W(m),matched:b[0]}}let v=i.match(Y.NEXT_MONTH);if(v){let m=new Date(e);return m.setMonth(m.getMonth()+1),m.setDate(1),{date:W(m),matched:v[0]}}let p=i.match(Y.END_OF_WEEK);if(p){let m=lt(e,0,!1);return m.getTime()===e.getTime()&&e.getDay()!==0&&m.setDate(m.getDate()+7),{date:W(m),matched:p[0]}}let w=i.match(Y.END_OF_MONTH);if(w){let m=new Date(e.getFullYear(),e.getMonth()+1,0);return{date:W(m),matched:w[0]}}return{date:null,matched:null}}function lt(i,a,e){let t=new Date(i),n=t.getDay(),s=a-n;return(s<=0||e&&s<7)&&(s+=7),t.setDate(t.getDate()+s),t}function ha(i,a){let e=new Date(i),n=e.getDay()-a;return n<=0&&(n+=7),e.setDate(e.getDate()-n),e}function W(i){let a=i.getFullYear(),e=String(i.getMonth()+1).padStart(2,"0"),t=String(i.getDate()).padStart(2,"0");return`${a}-${e}-${t}`}function Sn(i){let a=i.match(ie.DAILY);if(a)return{pattern:{frequency:"daily",_rawPattern:a[0]},matched:a[0]};let e=i.match(ie.WEEKLY);if(e)return{pattern:{frequency:"weekly",_rawPattern:e[0]},matched:e[0]};let t=i.match(ie.MONTHLY);if(t)return{pattern:{frequency:"monthly",_rawPattern:t[0]},matched:t[0]};let n=i.match(ie.YEARLY);if(n)return{pattern:{frequency:"yearly",_rawPattern:n[0]},matched:n[0]};let s=i.match(ie.EVERY_X_DAYS);if(s)return{pattern:{frequency:"daily",interval:parseInt(s[1],10),_rawPattern:s[0]},matched:s[0]};let r=i.match(ie.EVERY_X_WEEKS);if(r)return{pattern:{frequency:"weekly",interval:parseInt(r[1],10),_rawPattern:r[0]},matched:r[0]};let l=i.match(ie.EVERY_X_MONTHS);if(l)return{pattern:{frequency:"monthly",interval:parseInt(l[1],10),_rawPattern:l[0]},matched:l[0]};let o=i.match(ie.EVERY_DAY_OF_WEEK);if(o)return{pattern:{frequency:"weekly",daysOfWeek:(o[0].toLowerCase().match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\b/g)||[]).map(b=>b),_rawPattern:o[0]},matched:o[0]};let c=i.match(ie.WEEKDAYS);if(c)return{pattern:{frequency:"weekly",daysOfWeek:["monday","tuesday","wednesday","thursday","friday"],_rawPattern:c[0]},matched:c[0]};let d=i.match(ie.WEEKENDS);return d?{pattern:{frequency:"weekly",daysOfWeek:["saturday","sunday"],_rawPattern:d[0]},matched:d[0]}:{pattern:null,matched:null}}function Kt(i){if(i._rawPattern)return i._rawPattern;if(i.daysOfWeek&&i.daysOfWeek.length>0)return i.daysOfWeek.length===5&&["monday","tuesday","wednesday","thursday","friday"].every(e=>i.daysOfWeek.includes(e))?"weekdays":i.daysOfWeek.length===2&&i.daysOfWeek.includes("saturday")&&i.daysOfWeek.includes("sunday")?"weekends":`every ${i.daysOfWeek.join(", ")}`;let a=i.interval||1;switch(i.frequency){case"daily":return a===1?"daily":`every ${a} days`;case"weekly":return a===1?"weekly":`every ${a} weeks`;case"monthly":return a===1?"monthly":`every ${a} months`;case"yearly":return a===1?"yearly":`every ${a} years`;default:return"daily"}}function Tn(i,a=new Date){let e=new Date(a);e.setHours(0,0,0,0);let t=i.interval||1;switch(i.frequency){case"daily":e.setDate(e.getDate()+t);break;case"weekly":if(i.daysOfWeek&&i.daysOfWeek.length>0){let n=e.getDay(),s=i.daysOfWeek.map(l=>Ye[l]).sort((l,o)=>l-o),r=s.find(l=>l>n);r===void 0?(r=s[0],e.setDate(e.getDate()+(7-n+r))):e.setDate(e.getDate()+(r-n))}else e.setDate(e.getDate()+7*t);break;case"monthly":e.setMonth(e.getMonth()+t),i.dayOfMonth&&e.setDate(Math.min(i.dayOfMonth,pa(e)));break;case"yearly":e.setFullYear(e.getFullYear()+t);break}return e}function pa(i){return new Date(i.getFullYear(),i.getMonth()+1,0).getDate()}function Dn(i,a=new Date){if(!i)return"";let e=new Date(i),t=new Date(a);t.setHours(0,0,0,0),e.setHours(0,0,0,0);let n=e.getTime()-t.getTime(),s=Math.round(n/(1e3*60*60*24));if(s===0)return"Today";if(s===1)return"Tomorrow";if(s===-1)return"Yesterday";if(s>1&&s<7)return`In ${s} days`;if(s===7)return"In 1 week";if(s>7&&s<14)return`In ${s} days`;if(s>=14&&s<30)return`In ${Math.floor(s/7)} weeks`;if(s<-1&&s>-7)return`${Math.abs(s)} days ago`;if(s===-7)return"1 week ago";if(s<-7&&s>-30)return`${Math.floor(Math.abs(s)/7)} weeks ago`;let r=vn[e.getDay()];return s>0&&s<=7?r.charAt(0).toUpperCase()+r.slice(1):i}function En(i){let a=i.match(/\s*\^([\w-]+)\s*$/);return a?{content:i.replace(/\s*\^[\w-]+\s*$/,""),id:a[1]}:{content:i,id:null}}function fa(i){let a={},e=i,t=/\[(\w+)::([^\]]+)\]/g,n;for(;(n=t.exec(i))!==null;){let l=n[1].toLowerCase(),o=n[2].trim();if(l==="progress"){let c=parseInt(o.replace("%",""),10);a[l]=isNaN(c)?0:c}else a[l]=o;e=e.replace(n[0],"").trim()}let s=e.match(/progress::(\d+)%?/i);s&&a.progress===void 0&&(a.progress=parseInt(s[1],10),e=e.replace(s[0],"").trim());let r=e.match(/project::([^\s\]]+)/i);return r&&!a.project&&(a.project=r[1],e=e.replace(r[0],"").trim()),{cleanText:e,metadata:a}}function ga(i){let e=(i.match(/#[\w-/]+/g)||[]).map(t=>t.substring(1));return{cleanText:i,tags:e}}function ma(i,a=!0){let e=i,t,n,s,r,l=i.match(/@(\d{4}-\d{2}-\d{2})(?:T(\d{2}:\d{2}))?/);l&&(t=l[1],n=l[2],e=e.replace(l[0],"").trim());let o=i.match(/@@(\d{2}:\d{2})/);if(o&&!n&&(n=o[1],e=e.replace(o[0],"").trim()),a&&!t){let b=i.match(/@(today|tomorrow|yesterday|next\s+\w+|this\s+\w+|last\s+\w+|in\s+\d+\s+\w+|\d+\s+\w+\s+ago|end\s+of\s+\w+)/i);if(b){let{date:v,matched:p}=wn(b[1]);v&&p&&(t=v,e=e.replace(`@${b[1]}`,"").trim())}else{let{date:v,matched:p}=wn(i);v&&p&&(t=v,e=e.replace(p,"").trim())}}let{pattern:c,matched:d}=Sn(e);c&&d&&(s=c,e=e.replace(d,"").trim());let u=e.match(/\[recur::([^\]]+)\]/);if(u&&!s){let{pattern:b}=Sn(u[1]);b?s={...b,_rawPattern:u[1]}:s={frequency:"daily",_rawPattern:u[1]},e=e.replace(u[0],"").trim()}let h=e.match(/\[remind::([^\]]+)\]/);return h&&(r=h[1],e=e.replace(h[0],"").trim()),{cleanText:e,dueDate:t,dueTime:n,recurrence:s,reminderTime:r}}function ba(i,a,e=!0){let t=i[a],n=t.match(/^(\s*)-\s*\[([ xX])\]\s*(.*)$/);if(!n)return{card:null,endIndex:a};let s=n[1].length,r=n[2].toLowerCase()==="x",l=n[3].trim(),{content:o,id:c}=En(l);l=o;let{cleanText:d,metadata:u}=fa(l),h;u.note&&(h=u.note,delete u.note);let{tags:b}=ga(d),{cleanText:v,dueDate:p,dueTime:w,recurrence:m,reminderTime:y}=ma(d,e),E=[],D=[],P=[],N=a;for(let H=a+1;H<i.length;H++){let _=i[H],ge=_.match(/^(\s*)/),le=ge?ge[1].length:0;if(_.trim()===""){let J=!1;for(let te=H+1;te<i.length;te++){let R=i[te];if(R.trim()==="")continue;((R.match(/^(\s*)/)||["",""])[1].length>s||R.match(/^\s*>/)||R.match(/^\s+-\s*\[/))&&(J=!0);break}if(J){D.push(""),N=H;continue}else break}let me=_.match(/^\s*>\s?(.*)$/);if(me){E.push(me[1]),D.push(_),N=H;continue}let q=_.match(/^(\s+)-\s*\[([ xX])\]\s*(.*)$/);if(q&&q[1].length>s){let J=q[2].toLowerCase()==="x",te=q[3].trim(),R=ke();P.push({id:R,text:te,completed:J}),D.push(_),N=H;continue}if(le>s){D.push(_),N=H;continue}break}return{card:{id:c||ke(),title:d,completed:r,tags:b,dueDate:p,dueTime:w,recurrence:m,reminderTime:y,notes:E.length>0?E.join(`
`):void 0,notePath:h,content:D.length>0?D.join(`
`):void 0,subtasks:P.length>0?P:void 0,metadata:u,_rawLine:t},endIndex:N}}function Cn(i){let a=i.split(`
`),e=a[0],t=e.match(/^##\s+(.+)$/);if(!t)return null;let{content:n,id:s}=En(t[1].trim()),r={id:s||ke(),title:n,cards:[],_rawHeader:e},l=1;for(;l<a.length;){if(a[l].trim().startsWith("- [")){let{card:c,endIndex:d}=ba(a,l);if(c){r.cards.push(c),l=d+1;continue}}l++}return r}function va(i){let a=i.match(/%% kanban:settings\s*```(?:json)?\s*([\s\S]*?)\s*```\s*%%/);if(a)try{return JSON.parse(a[1])}catch(e){return console.warn("Failed to parse kanban settings JSON"),{}}return{}}function ya(i){let a=i.match(/^(---\s*\n[\s\S]*?\n---\s*\n?)/);return a?{frontmatter:a[1],body:i.slice(a[1].length)}:{frontmatter:"",body:i}}function wa(i){return i?i.includes(ee)?i:i.replace(/^(---\s*\n)/,`$1${ee}: basic
`):`---
${ee}: basic
---

`}function kn(i){let a=i.split(`
`),e=0;for(let n=0;n<a.length;n++){let s=a[n];if(s.match(/^##\s/)||s.match(/^\s*-\s*\[/)||s.match(/^\s*>/))e=n;else if(s.trim()===""){let r=!1;for(let l=n+1;l<a.length;l++)if(a[l].match(/^\s*-\s*\[/)||a[l].match(/^\s*>/)){r=!0;break}else if(a[l].trim()!=="")break;r&&(e=n)}}let t=0;for(let n=0;n<=e;n++)t+=a[n].length+1;return t}function ct(i){let{frontmatter:a,body:e}=ya(i),t=/^## .+$/gm,n=[],s;for(;(s=t.exec(e))!==null;)n.push({index:s.index,match:s[0]});let r=e.match(/%% kanban:settings[\s\S]*?%%/),l=r?e.indexOf(r[0]):-1,o=r?l+r[0].length:-1,c="";n.length>0?c=e.slice(0,n[0].index).trim():l>0?c=e.slice(0,l).trim():c=e.trim();let d=[],u=[],h="";for(let p=0;p<n.length;p++){let w=n[p].index,m,y=p===n.length-1;p+1<n.length?m=n[p+1].index:l>w?m=l:m=e.length;let E=e.slice(w,m),D=n[p].match;if(y&&l>w){let P=kn(E),N=E.slice(P).trim();N&&(h=N)}if(D.match(/^##\s+Archive\s*$/i)){let P=Cn(E);P&&(u=P.cards)}else{let P=Cn(E);P&&d.push(P)}}let b="";if(o>0)b=e.slice(o).trim();else if(n.length>0){let p=n[n.length-1].index,w=e.slice(p),m=kn(w),y=w.slice(m).trim();y&&(b=y)}let v=va(e);return{lanes:d,archive:u,settings:v,_frontmatter:a,_headerContent:c,_footerContent:b,_preSettingsContent:h}}function xn(i,a=!0,e="iso"){let t=i.completed?"[x]":"[ ]",n=i.title,s=[];if(i.metadata.progress!==void 0&&!n.includes("progress::")&&s.push(`[progress::${i.metadata.progress}%]`),i.metadata.project&&!n.includes("project::")&&!n.includes("[project::")&&s.push(`[project::${i.metadata.project}]`),i.notePath&&!n.includes("note::")&&s.push(`[note::${i.notePath}]`),i.recurrence&&!n.includes("recur::")&&!n.match(/\b(daily|weekly|monthly|yearly|every\s)/i)){let l=Kt(i.recurrence);s.push(`[recur::${l}]`)}i.reminderTime&&!n.includes("remind::")&&s.push(`[remind::${i.reminderTime}]`);for(let[l,o]of Object.entries(i.metadata))l!=="progress"&&l!=="project"&&o!==void 0&&(n.includes(`${l}::`)||s.push(`[${l}::${o}]`));s.length>0&&(n=`${n} ${s.join(" ")}`),n.includes("@")||(i.dueDate&&i.dueTime?n=`${n} @${i.dueDate}T${i.dueTime}`:i.dueDate?n=`${n} @${i.dueDate}`:i.dueTime&&(n=`${n} @@${i.dueTime}`)),a&&(n=`${n} ^${i.id}`);let r=`- ${t} ${n}`;if(i.content&&!i.notePath)r+=`
`+i.content;else{let l=[];if(i.subtasks&&i.subtasks.length>0)for(let o of i.subtasks){let c=o.completed?"[x]":"[ ]";l.push(`	- ${c} ${o.text}`)}if(i.notes&&!i.notePath){let o=i.notes.split(`
`).map(c=>`	> ${c}`);l.push(...o)}l.length>0&&(r+=`
`+l.join(`
`))}return r}function Mn(i,a,e){let t=i.split(`
`),n=0;for(let s=0;s<t.length;s++){let r=t[s].match(/^(\s*-\s*\[)([ xX])(\]\s*.*)$/);if(r){if(n===a){t[s]=`${r[1]}${e?"x":" "}${r[3]}`;break}n++}}return t.join(`
`)}function Sa(i,a=!0){let e=a?` ^${i.id}`:"",t=[`## ${i.title}${e}`,""];for(let n of i.cards)t.push(xn(n,a));return t.push(""),t.join(`
`)}function Ca(i){return Object.keys(i).length===0?"":`
%% kanban:settings
\`\`\`json
${JSON.stringify(i,null,2)}
\`\`\`
%%
`}function ka(i,a=!0){if(i.length===0)return"";let e=["## Archive",""];for(let t of i)e.push(xn(t,a));return e.push(""),e.join(`
`)}function Pn(i){let a=[],e=wa(i._frontmatter||"");a.push(e),i._headerContent&&(a.push(i._headerContent),a.push(""));for(let n of i.lanes)a.push(Sa(n));i.archive.length>0&&a.push(ka(i.archive)),i._preSettingsContent&&(a.push(i._preSettingsContent),a.push(""));let t=Ca(i.settings);return t&&a.push(t),i._footerContent&&a.push(i._footerContent),a.join(`
`)}function dt(){return{lanes:[{id:ke(),title:"To Do",cards:[]},{id:ke(),title:"In Progress",cards:[]},{id:ke(),title:"Done",cards:[]}],archive:[],settings:{}}}var ut=`---
${ee}: basic
---

`;function jt(i,a,e=!1){if(!i)return"";if(e){let l=new Date(i),o=new Date,c=Math.floor((l.getTime()-o.getTime())/(1e3*60*60*24));if(c===0)return"Today";if(c===1)return"Tomorrow";if(c===-1)return"Yesterday";if(c>1&&c<7)return`In ${c} days`;if(c<-1&&c>-7)return`${Math.abs(c)} days ago`}let t=new Date(i),n=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return a.replace("YYYY",String(n)).replace("MM",s).replace("DD",r)}function We(i,a){let e=new Date,t=jt(e.toISOString().split("T")[0],a);return{...i,title:`${t} ${i.title}`}}function Nn(i,a={},e){let t=Bt({project:a.project,...e}),n=$t(i,t),s=n.match(/^#\s+(.+)$/m),r=s?s[1]:n.split(`
`)[0].trim()||"New card",l=n.match(/^---\s*\n([\s\S]*?)\n---/),o={...a};if(l){let p=l[1].split(`
`);for(let w of p){let m=w.match(/^(\w+):\s*(.+)$/);if(m){let y=m[1].toLowerCase(),E=m[2].trim();yn.includes(y)&&(y==="progress"?o.progress=parseInt(E.replace("%",""),10):o[y]=E)}}}let d=(r.match(/#[\w-/]+/g)||[]).map(v=>v.substring(1)),u=r.match(/@(\d{4}-\d{2}-\d{2})(?:T(\d{2}:\d{2}))?/),h=u?u[1]:void 0,b=u?u[2]:void 0;return{id:t.id,title:r,completed:!1,tags:d,dueDate:h,dueTime:b,metadata:o,notes:n}}var $=require("obsidian");var ht=class{constructor(a,e){this.syncInProgress=!1;this.app=a,this.config=e||{...Ve}}setConfig(a){this.config=a}getConfig(){return this.config}isEnabled(){return this.config.enabled}async readBaseTask(a){try{let e=await this.app.vault.read(a),t=this.parseFrontmatter(e);return t?{path:a.path,title:t.title||a.basename,status:t[this.config.statusField],progress:t[this.config.progressField],project:t[this.config.projectField],priority:t.priority,dueDate:t.due||t.dueDate,tags:t.tags,completed:t.completed===!0||t.status==="done",modified:a.stat.mtime,...t}:null}catch(e){return console.error(`Error reading Base task ${a.path}:`,e),null}}async queryBaseTasks(){let a=[],e=this.app.vault.getAbstractFileByPath(this.config.tasksFolder);if(!(e instanceof $.TFolder))return console.warn(`Tasks folder not found: ${this.config.tasksFolder}`),a;let t=this.getMarkdownFiles(e);for(let n of t){let s=await this.readBaseTask(n);s&&this.matchesQuery(s)&&a.push(s)}return a}getMarkdownFiles(a){let e=[];for(let t of a.children)t instanceof $.TFile&&t.extension==="md"?e.push(t):t instanceof $.TFolder&&e.push(...this.getMarkdownFiles(t));return e}matchesQuery(a){var n,s,r,l;if(!this.config.query||this.config.query.trim()==="")return!0;let t=this.config.query.toLowerCase().split(/\s+and\s+/i);for(let o of t){let c=o.trim(),d=c.match(/^status:\s*(.+)$/i);if(d){let p=d[1].toLowerCase();if(((n=a.status)==null?void 0:n.toLowerCase())!==p)return!1;continue}let u=c.match(/^project:\s*(.+)$/i);if(u){let p=u[1].toLowerCase();if(((s=a.project)==null?void 0:s.toLowerCase())!==p)return!1;continue}let h=c.match(/^tag:\s*(.+)$/i);if(h){let p=h[1].toLowerCase();if(!((r=a.tags)!=null&&r.some(w=>w.toLowerCase()===p)))return!1;continue}let b=c.match(/^priority:\s*(.+)$/i);if(b){let p=b[1].toLowerCase();if(((l=a.priority)==null?void 0:l.toLowerCase())!==p)return!1;continue}let v=c.match(/^completed:\s*(true|false)$/i);if(v){let p=v[1].toLowerCase()==="true";if(a.completed!==p)return!1;continue}}return!0}async updateTaskField(a,e,t){try{let n=this.app.vault.getAbstractFileByPath(a);if(!(n instanceof $.TFile))return console.warn(`Task file not found: ${a}`),!1;let s=await this.app.vault.read(n),r=this.updateFrontmatterField(s,e,t);return r!==s?(await this.app.vault.modify(n,r),!0):!1}catch(n){return console.error(`Error updating task ${a}:`,n),!1}}async updateTaskFields(a,e){try{let t=this.app.vault.getAbstractFileByPath(a);if(!(t instanceof $.TFile))return console.warn(`Task file not found: ${a}`),!1;let n=await this.app.vault.read(t);for(let[s,r]of Object.entries(e))n=this.updateFrontmatterField(n,s,r);return await this.app.vault.modify(t,n),!0}catch(t){return console.error(`Error updating task ${a}:`,t),!1}}async createBaseTask(a,e,t){try{if(!(this.app.vault.getAbstractFileByPath(this.config.tasksFolder)instanceof $.TFolder))try{await this.app.vault.createFolder(this.config.tasksFolder)}catch(u){if(!(this.app.vault.getAbstractFileByPath(this.config.tasksFolder)instanceof $.TFolder))return console.error("Cannot create tasks folder:",this.config.tasksFolder,u),null}let s=(a||"Untitled Task").replace(/[\\/:*?"<>|]/g,"-").replace(/\s+/g," ").trim().substring(0,100)||"task",r=Date.now(),l=`${s}-${r}.md`,o=`${this.config.tasksFolder}/${l}`,c={title:a||"Untitled Task",created:new Date().toISOString()};t&&this.config.laneMapping[t.title]&&(c[this.config.statusField]=this.config.laneMapping[t.title]),e.progress!==void 0&&(c[this.config.progressField]=e.progress),e.project&&(c[this.config.projectField]=e.project),e.priority&&(c.priority=e.priority);let d=this.createFileWithFrontmatter(c,`# ${a||"Untitled Task"}
`);return await this.app.vault.create(o,d),o}catch(n){return console.error("Error creating Base task:",n),null}}async onCardMoveToLane(a,e){if(!this.config.enabled||!a.baseTaskPath)return!1;let t=this.config.laneMapping[e.title];return t?await this.updateTaskField(a.baseTaskPath,this.config.statusField,t):!1}async syncProgress(a,e){return!this.config.enabled||!a.baseTaskPath?!1:await this.updateTaskField(a.baseTaskPath,this.config.progressField,e)}async syncProject(a,e){return!this.config.enabled||!a.baseTaskPath?!1:await this.updateTaskField(a.baseTaskPath,this.config.projectField,e||"")}async syncFromBase(a,e){if(this.syncInProgress)return{created:0,updated:0,conflicts:[],errors:["Sync already in progress"]};if(!a.lanes||a.lanes.length===0)return{created:0,updated:0,conflicts:[],errors:["Board has no lanes - add at least one lane before syncing"]};this.syncInProgress=!0;let t={created:0,updated:0,conflicts:[],errors:[]};try{let n=await this.queryBaseTasks(),s=new Map;for(let r of a.lanes)for(let l of r.cards)l.baseTaskPath&&s.set(l.baseTaskPath,{card:l,lane:r});for(let r of n){let l=s.get(r.path);if(l){let o=await this.updateCardFromTask(l.card,r,a,e);o.length>0&&t.conflicts.push(...o),t.updated++}else{let o=this.findLaneForTask(r,a);if(o){let c=this.createCardFromTask(r);o.cards.push(c),t.created++}else console.warn(`No lane found for task: ${r.path}`)}}}catch(n){t.errors.push(`Sync error: ${n}`)}finally{this.syncInProgress=!1}return t}findLaneForTask(a,e){if(!a.status)return e.lanes[0]||null;for(let[t,n]of Object.entries(this.config.laneMapping))if(n.toLowerCase()===a.status.toLowerCase()){let s=e.lanes.find(r=>r.title.toLowerCase()===t.toLowerCase());if(s)return s}return e.lanes[0]||null}createCardFromTask(a){return{id:this.generateId(),title:a.title,completed:a.completed||!1,tags:a.tags||[],dueDate:a.dueDate,metadata:{progress:a.progress,project:a.project,priority:a.priority,status:a.status},baseTaskPath:a.path,baseSyncTime:Date.now()}}async updateCardFromTask(a,e,t,n){let s=[],r=[{field:"title",local:a.title,remote:e.title},{field:"progress",local:a.metadata.progress,remote:e.progress},{field:"project",local:a.metadata.project,remote:e.project}];for(let{field:c,local:d,remote:u}of r)if(d!==u&&d!==void 0&&u!==void 0){let h={cardId:a.id,cardTitle:a.title,taskPath:e.path,localValue:String(d),remoteValue:String(u),field:c},b=this.config.conflictResolution==="remote";if(this.config.conflictResolution==="last-write"){let v=a.baseSyncTime||0;b=(e.modified||0)>v}else if(this.config.conflictResolution==="prompt"&&n){let v=await n(h);if(v==="skip")continue;b=v==="remote"}b&&(c==="title"&&(a.title=u),c==="progress"&&(a.metadata.progress=u),c==="project"&&(a.metadata.project=u)),s.push(h)}else u!==void 0&&d===void 0&&(c==="title"&&(a.title=u),c==="progress"&&(a.metadata.progress=u),c==="project"&&(a.metadata.project=u));let l=this.findLaneForTask(e,t),o=t.lanes.find(c=>c.cards.some(d=>d.id===a.id));if(l&&o&&l.id!==o.id){let c=o.cards.findIndex(d=>d.id===a.id);c>=0&&(o.cards.splice(c,1),l.cards.push(a))}return a.baseSyncTime=Date.now(),s}generateId(){return Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4)}parseFrontmatter(a){let e=a.match(/^---\n([\s\S]*?)\n---/);if(!e)return null;let t={},n=e[1].split(`
`);for(let s of n){let r=s.indexOf(":");if(r>0){let l=s.substring(0,r).trim(),o=s.substring(r+1).trim();o==="true"?o=!0:o==="false"?o=!1:!isNaN(Number(o))&&o!==""?o=Number(o):o.startsWith("[")&&o.endsWith("]")?o=o.slice(1,-1).split(",").map(c=>c.trim().replace(/['"]/g,"")):o=o.replace(/^['"]|['"]$/g,""),t[l]=o}}return t}updateFrontmatterField(a,e,t){let n=a.match(/^---\n([\s\S]*?)\n---/);if(!n){let c=this.formatFrontmatterValue(t);return`---
${e}: ${c}
---

${a}`}let r=n[1].split(`
`),l=!1,o=r.map(c=>{let d=c.indexOf(":");return d>0&&c.substring(0,d).trim()===e?(l=!0,t===void 0||t===""?null:`${e}: ${this.formatFrontmatterValue(t)}`):c}).filter(c=>c!==null);return!l&&t!==void 0&&t!==""&&o.push(`${e}: ${this.formatFrontmatterValue(t)}`),a.replace(n[0],`---
${o.join(`
`)}
---`)}formatFrontmatterValue(a){return a===void 0?"":typeof a=="boolean"||typeof a=="number"?a.toString():a.includes(":")||a.includes("#")?`"${a}"`:a}createFileWithFrontmatter(a,e){let t=["---"];for(let[n,s]of Object.entries(a))s!==void 0&&s!==""&&t.push(`${n}: ${this.formatFrontmatterValue(s)}`);return t.push("---","",e),t.join(`
`)}},pt=class extends $.Modal{constructor(e,t,n){super(e);this.conflict=t,this.onResolve=n}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("kanban-sync-conflict-modal"),e.createEl("h2",{text:"Sync Conflict"}),e.createEl("p",{text:`Conflict detected for "${this.conflict.cardTitle}" in field "${this.conflict.field}":`});let t=e.createDiv({cls:"conflict-comparison"}),n=t.createDiv({cls:"conflict-value local"});n.createEl("strong",{text:"Local (Kanban):"}),n.createEl("span",{text:this.conflict.localValue||"(empty)"});let s=t.createDiv({cls:"conflict-value remote"});s.createEl("strong",{text:"Remote (Base):"}),s.createEl("span",{text:this.conflict.remoteValue||"(empty)"}),new $.Setting(e).addButton(r=>r.setButtonText("Keep Local").onClick(()=>{this.onResolve("local"),this.close()})).addButton(r=>r.setButtonText("Use Remote").setCta().onClick(()=>{this.onResolve("remote"),this.close()})).addButton(r=>r.setButtonText("Skip").onClick(()=>{this.onResolve("skip"),this.close()}))}onClose(){let{contentEl:e}=this;e.empty()}},ft=class extends $.Modal{constructor(e,t,n){super(e);this.tasks=[];this.tasksFolder=t,this.onSelect=n}async onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("kanban-task-picker-modal"),e.createEl("h2",{text:"Link to Base Task"}),this.filterEl=e.createEl("input",{type:"text",cls:"task-picker-filter",attr:{placeholder:"Filter tasks..."}}),this.filterEl.addEventListener("input",()=>this.filterTasks()),this.listEl=e.createDiv({cls:"task-picker-list"}),await this.loadTasks(),this.renderTasks(),this.filterEl.focus(),new $.Setting(e).addButton(t=>t.setButtonText("Cancel").onClick(()=>{this.onSelect(null),this.close()}))}async loadTasks(){let e=this.app.vault.getAbstractFileByPath(this.tasksFolder);if(!(e instanceof $.TFolder))return;let t=this.getMarkdownFiles(e);for(let n of t){let r=(await this.app.vault.read(n)).match(/^---[\s\S]*?title:\s*(.+?)[\r\n]/m),l=r?r[1].replace(/['"]/g,""):n.basename;this.tasks.push({path:n.path,title:l})}this.tasks.sort((n,s)=>n.title.localeCompare(s.title))}getMarkdownFiles(e){let t=[];for(let n of e.children)n instanceof $.TFile&&n.extension==="md"?t.push(n):n instanceof $.TFolder&&t.push(...this.getMarkdownFiles(n));return t}filterTasks(){this.renderTasks()}renderTasks(){this.listEl.empty();let e=this.filterEl.value.toLowerCase(),t=this.tasks.filter(n=>n.title.toLowerCase().includes(e)||n.path.toLowerCase().includes(e));if(t.length===0){this.listEl.createEl("p",{text:"No tasks found",cls:"task-picker-empty"});return}for(let n of t){let s=this.listEl.createDiv({cls:"task-picker-item"});s.createEl("strong",{text:n.title}),s.createEl("span",{text:n.path,cls:"task-path"}),s.addEventListener("click",()=>{this.onSelect(n.path),this.close()})}}onClose(){let{contentEl:e}=this;e.empty()}};function In(){let i=document.createElement("div");return i.className="kanban-sync-status",i.style.display="none",i}function ue(i,a,e){i.className=`kanban-sync-status ${a}`,i.style.display=a==="idle"?"none":"flex",a==="syncing"?i.innerHTML='<span class="sync-spinner"></span><span>Syncing...</span>':a==="success"?(i.innerHTML=`<span>\u2713</span><span>${e||"Synced"}</span>`,setTimeout(()=>ue(i,"idle"),2e3)):a==="error"&&(i.innerHTML=`<span>\u26A0</span><span>${e||"Sync failed"}</span>`)}var re=class extends f.TextFileView{constructor(e,t){super(e);this.sortableInstances=[];this.syncIntervalId=null;this.filterState={...ot};this.filterToolbarEl=null;this.pendingAutoCreateNote=null;this.plugin=t,this.board=dt(),this.baseSyncService=new ht(this.app),this.syncStatusEl=In(),this.filterState={...ot}}getViewType(){return se}getDisplayText(){var e;return((e=this.file)==null?void 0:e.basename)||"Kanban Board"}getIcon(){return"columns"}getViewData(){return Pn(this.board)}setViewData(e,t){t&&(this.board=dt()),e.trim()&&(this.board=ct(e)),this.render()}clear(){this.board=dt(),this.render()}async onOpen(){let e=this.containerEl.children[1];e.empty(),e.addClass("kanban-plugin"),this.boardContainer=e.createDiv({cls:"kanban-board-wrapper"}),this.render()}async onClose(){this.destroySortables(),this.stopBackgroundSync()}onPaneMenu(e,t){super.onPaneMenu(e,t),e.addItem(n=>{n.setTitle("Add a list").setIcon("plus-circle").onClick(()=>this.addLane())}),e.addItem(n=>{n.setTitle("Archive completed cards").setIcon("archive").onClick(()=>this.archiveCompletedCards())}),e.addSeparator(),e.addItem(n=>{n.setTitle("Board settings").setIcon("settings").onClick(()=>this.openBoardSettings())})}getSetting(e){if(this.board.settings[e]!==void 0)return this.board.settings[e];let t=e;return t in this.plugin.settings?this.plugin.settings[t]:Z[t]}getBaseSyncConfig(){return this.board.settings["base-sync"]?{...Ve,...this.board.settings["base-sync"]}:{...this.plugin.settings["base-sync"]}}startBackgroundSync(){this.stopBackgroundSync();let e=this.getBaseSyncConfig();if(!e.enabled||e.syncInterval<=0)return;let t=e.syncInterval*60*1e3;this.syncIntervalId=window.setInterval(()=>{this.performBackgroundSync()},t)}stopBackgroundSync(){this.syncIntervalId!==null&&(window.clearInterval(this.syncIntervalId),this.syncIntervalId=null)}async performBackgroundSync(){let e=this.getBaseSyncConfig();if(e.enabled){this.baseSyncService.setConfig(e),ue(this.syncStatusEl,"syncing");try{let t=await this.baseSyncService.syncFromBase(this.board,async n=>e.conflictResolution==="prompt"?await this.promptConflictResolution(n):e.conflictResolution);if(t.errors.length>0)ue(this.syncStatusEl,"error",t.errors[0]),new f.Notice(`Sync error: ${t.errors[0]}`);else{let n=`Synced: ${t.created} created, ${t.updated} updated`;ue(this.syncStatusEl,"success",n),(t.created>0||t.updated>0)&&(this.requestSave(),this.render())}}catch(t){ue(this.syncStatusEl,"error","Sync failed"),console.error("Base sync error:",t)}}}async promptConflictResolution(e){return new Promise(t=>{new pt(this.app,e,s=>{t(s)}).open()})}async manualSync(){await this.performBackgroundSync()}async linkCardToBaseTask(e){let t=this.getBaseSyncConfig();if(!t.enabled){new f.Notice("Base sync is not enabled. Enable it in settings first.");return}new ft(this.app,t.tasksFolder,async s=>{s&&(e.baseTaskPath=s,e.baseSyncTime=Date.now(),this.requestSave(),this.render(),new f.Notice(`Card linked to: ${s}`))}).open()}async createBaseTaskForCard(e,t){let n=this.getBaseSyncConfig();if(!n.enabled){new f.Notice("Base sync is not enabled. Enable it in settings first.");return}this.baseSyncService.setConfig(n);let s=await this.baseSyncService.createBaseTask(e.title,e.metadata,t);s?(e.baseTaskPath=s,e.baseSyncTime=Date.now(),this.requestSave(),this.render(),new f.Notice(`Created Base task: ${s}`)):new f.Notice("Failed to create Base task")}destroySortables(){for(let e of this.sortableInstances)e.destroy();this.sortableInstances=[]}render(){if(!this.boardContainer)return;this.destroySortables(),this.boardContainer.empty();let e=this.getSetting("lane-width")||this.plugin.settings["default-lane-width"];this.boardContainer.style.setProperty("--kanban-lane-width",e),this.getBaseSyncConfig().enabled&&this.renderSyncToolbar(),this.getSetting("show-filter-toolbar")!==!1&&this.renderFilterToolbar();let s=this.boardContainer.createDiv({cls:"kanban-board"});for(let l of this.board.lanes)this.renderLane(s,l);if(this.getSetting("show-add-list")!==!1){let l=s.createDiv({cls:"kanban-add-lane-btn"});l.createSpan({text:"+ Add list"}),l.addEventListener("click",()=>this.addLane())}this.setupLaneSortable(s),this.startBackgroundSync()}renderSyncToolbar(){let e=this.boardContainer.createDiv({cls:"kanban-sync-toolbar"});e.appendChild(this.syncStatusEl);let t=e.createDiv({cls:"kanban-sync-btn"});(0,f.setIcon)(t,"refresh-cw"),t.title="Sync with Base",t.addEventListener("click",()=>this.manualSync());let n=e.createDiv({cls:"kanban-base-indicator"});(0,f.setIcon)(n,"database"),n.createSpan({text:"Base sync enabled"})}renderFilterToolbar(){this.filterToolbarEl=this.boardContainer.createDiv({cls:"kanban-filter-toolbar"});let e=this.filterToolbarEl.createDiv({cls:"filter-search-container"}),t=e.createSpan({cls:"filter-search-icon"});(0,f.setIcon)(t,"search");let n=e.createEl("input",{type:"text",cls:"filter-search-input",attr:{placeholder:"Search cards..."}});n.value=this.filterState.text,n.addEventListener("input",()=>{this.filterState.text=n.value,this.applyFilters()});let s=this.filterToolbarEl.createDiv({cls:"filter-buttons"}),r=s.createDiv({cls:"filter-btn"});(0,f.setIcon)(r,"tag"),r.createSpan({text:"Tags"}),this.filterState.tags.length>0&&(r.addClass("has-filter"),r.createSpan({cls:"filter-badge",text:String(this.filterState.tags.length)})),r.addEventListener("click",h=>this.showTagFilterMenu(h));let l=s.createDiv({cls:"filter-btn"});(0,f.setIcon)(l,"folder"),l.createSpan({text:"Project"}),this.filterState.projects.length>0&&(l.addClass("has-filter"),l.createSpan({cls:"filter-badge",text:String(this.filterState.projects.length)})),l.addEventListener("click",h=>this.showProjectFilterMenu(h));let o=s.createDiv({cls:"filter-btn"});(0,f.setIcon)(o,"calendar"),o.createSpan({text:"Due"}),this.filterState.dueState!=="all"&&o.addClass("has-filter"),o.addEventListener("click",h=>this.showDueFilterMenu(h));let c=s.createDiv({cls:`filter-btn ${this.filterState.showCompleted?"":"has-filter"}`});if((0,f.setIcon)(c,this.filterState.showCompleted?"check-circle":"circle"),c.createSpan({text:this.filterState.showCompleted?"Showing completed":"Hiding completed"}),c.addEventListener("click",()=>{this.filterState.showCompleted=!this.filterState.showCompleted,this.applyFilters()}),this.hasActiveFilters()){let h=s.createDiv({cls:"filter-btn filter-clear-btn"});(0,f.setIcon)(h,"x"),h.createSpan({text:"Clear filters"}),h.addEventListener("click",()=>this.clearFilters())}let d=this.getFilteredCardCount(),u=this.getTotalCardCount();if(this.hasActiveFilters()){let h=this.filterToolbarEl.createDiv({cls:"filter-count"});h.textContent=`Showing ${d} of ${u} cards`}}showTagFilterMenu(e){let t=new f.Menu,n=this.getAllTags();if(n.length===0)t.addItem(s=>{s.setTitle("No tags found").setDisabled(!0)});else{for(let s of n){let r=this.filterState.tags.includes(s);t.addItem(l=>{l.setTitle(`${r?"\u2713 ":""}#${s}`).onClick(()=>{r?this.filterState.tags=this.filterState.tags.filter(o=>o!==s):this.filterState.tags.push(s),this.applyFilters()})})}this.filterState.tags.length>0&&(t.addSeparator(),t.addItem(s=>{s.setTitle("Clear tag filter").onClick(()=>{this.filterState.tags=[],this.applyFilters()})}))}t.showAtMouseEvent(e)}showProjectFilterMenu(e){let t=new f.Menu,n=this.getAllProjects();if(n.length===0)t.addItem(s=>{s.setTitle("No projects found").setDisabled(!0)});else{for(let s of n){let r=this.filterState.projects.includes(s);t.addItem(l=>{l.setTitle(`${r?"\u2713 ":""}${s}`).onClick(()=>{r?this.filterState.projects=this.filterState.projects.filter(o=>o!==s):this.filterState.projects.push(s),this.applyFilters()})})}this.filterState.projects.length>0&&(t.addSeparator(),t.addItem(s=>{s.setTitle("Clear project filter").onClick(()=>{this.filterState.projects=[],this.applyFilters()})}))}t.showAtMouseEvent(e)}showDueFilterMenu(e){let t=new f.Menu,n=[{value:"all",label:"All cards"},{value:"overdue",label:"Overdue"},{value:"due-today",label:"Due today"},{value:"due-week",label:"Due this week"},{value:"has-date",label:"Has due date"},{value:"no-date",label:"No due date"}];for(let s of n){let r=this.filterState.dueState===s.value;t.addItem(l=>{l.setTitle(`${r?"\u2713 ":""}${s.label}`).onClick(()=>{this.filterState.dueState=s.value,this.applyFilters()})})}t.showAtMouseEvent(e)}getAllTags(){let e=new Set;for(let t of this.board.lanes)for(let n of t.cards)for(let s of n.tags)e.add(s);return Array.from(e).sort()}getAllProjects(){let e=new Set;for(let t of this.board.lanes)for(let n of t.cards)n.metadata.project&&e.add(n.metadata.project);return Array.from(e).sort()}hasActiveFilters(){return this.filterState.text!==""||this.filterState.tags.length>0||this.filterState.projects.length>0||this.filterState.dueState!=="all"||!this.filterState.showCompleted}clearFilters(){this.filterState={...ot},this.applyFilters()}applyFilters(){this.render()}cardMatchesFilter(e){var t,n;if(this.filterState.text){let s=this.filterState.text.toLowerCase(),r=e.title.toLowerCase().includes(s),l=((t=e.notes)==null?void 0:t.toLowerCase().includes(s))||!1,o=((n=e.content)==null?void 0:n.toLowerCase().includes(s))||!1;if(!r&&!l&&!o)return!1}if(this.filterState.tags.length>0&&!this.filterState.tags.some(r=>e.tags.includes(r))||this.filterState.projects.length>0&&(!e.metadata.project||!this.filterState.projects.includes(e.metadata.project))||!this.filterState.showCompleted&&e.completed)return!1;if(this.filterState.dueState!=="all"){let s=new Date;s.setHours(0,0,0,0);let r=e.dueDate?new Date(e.dueDate):null;switch(r&&r.setHours(0,0,0,0),this.filterState.dueState){case"overdue":if(!r||r>=s)return!1;break;case"due-today":if(!r||r.getTime()!==s.getTime())return!1;break;case"due-week":{let l=new Date(s);if(l.setDate(l.getDate()+7),!r||r<s||r>l)return!1;break}case"has-date":if(!e.dueDate)return!1;break;case"no-date":if(e.dueDate)return!1;break}}return!(this.filterState.priority&&e.metadata.priority!==this.filterState.priority)}getFilteredCards(e){return this.hasActiveFilters()?e.cards.filter(t=>this.cardMatchesFilter(t)):e.cards}getFilteredCardCount(){let e=0;for(let t of this.board.lanes)e+=this.getFilteredCards(t).length;return e}getTotalCardCount(){let e=0;for(let t of this.board.lanes)e+=t.cards.length;return e}renderLane(e,t){let n=this.getLaneWipConfig(t),s=t.cards.length,r=n.limit>0&&s>n.limit,l=n.limit>0&&n.warnAt&&s>=n.warnAt,o=["kanban-lane"];r?o.push("wip-exceeded"):l&&o.push("wip-warning");let c=e.createDiv({cls:o.join(" "),attr:{"data-lane-id":t.id}}),d=c.createDiv({cls:"kanban-lane-header"}),u=d.createDiv({cls:"kanban-lane-title-container"}),h=u.createSpan({cls:"kanban-lane-title",text:t.title});if(h.contentEditable="true",h.addEventListener("blur",()=>{t.title=h.textContent||"Untitled",this.requestSave()}),h.addEventListener("keydown",D=>{D.key==="Enter"&&(D.preventDefault(),h.blur())}),!this.getSetting("hide-card-count")){let D=this.getFilteredCards(t),P=n.limit>0?`${s}/${n.limit}`:`${s}`,N=["kanban-lane-count"];r?N.push("over-limit"):l&&N.push("at-warning");let oe=u.createSpan({cls:N.join(" "),text:P});this.hasActiveFilters()&&D.length!==t.cards.length&&(oe.title=`${D.length} visible, ${t.cards.length} total`)}let v=d.createDiv({cls:"kanban-lane-menu-btn"});(0,f.setIcon)(v,"more-vertical"),v.addEventListener("click",D=>{D.stopPropagation(),this.showLaneMenu(D,t)});let p=this.getSetting("show-card-composer")!==!1,w=this.getSetting("composer-position")||this.plugin.settings["composer-position"]||"bottom",m=!n.blockExceeded||!r;p&&w==="top"&&this.renderCardComposer(c,t,m);let y=c.createDiv({cls:"kanban-lane-cards",attr:{"data-lane-id":t.id}}),E=this.getFilteredCards(t);for(let D of E)this.renderCard(y,D,t);if(this.hasActiveFilters()&&E.length<t.cards.length){let D=t.cards.length-E.length,P=y.createDiv({cls:"kanban-hidden-cards-indicator"});P.textContent=`${D} card${D>1?"s":""} hidden by filter`}if(p&&w==="bottom"&&this.renderCardComposer(c,t,m),!p){let D=c.createDiv({cls:`kanban-add-card-btn ${m?"":"disabled"}`});D.createSpan({text:"+ Add card"}),m?D.addEventListener("click",()=>this.addCard(t)):D.title="WIP limit exceeded"}this.setupCardSortable(y,t)}getLaneWipConfig(e){let t=this.board.settings["lane-configs"]||{},n=t[e.title]||t[e.id];if(n!=null&&n.wipLimit)return{limit:n.wipLimit.limit,warnAt:n.wipLimit.warnAt||n.wipLimit.limit,blockExceeded:n.wipLimit.blockExceeded};let s=this.plugin.settings["default-wip-limit"]||0,r=this.plugin.settings["wip-block-exceeded"]||!1;return{limit:s,warnAt:s,blockExceeded:r}}renderCardComposer(e,t,n=!0){let s=e.createDiv({cls:`kanban-card-composer ${n?"":"disabled"}`}),r=s.createEl("textarea",{cls:"kanban-composer-input",attr:{placeholder:n?"Add a card... (Enter to add, Shift+Enter for newline)":"WIP limit exceeded",rows:"1",disabled:n?void 0:"disabled"}});if(!n){s.title="WIP limit exceeded - cannot add more cards";return}let l=()=>{r.style.height="auto",r.style.height=Math.min(r.scrollHeight,150)+"px"};r.addEventListener("input",l),r.addEventListener("keydown",c=>{if(c.key==="Enter"){if(c.shiftKey)return;{c.preventDefault();let d=r.value.trim();d&&(this.addCardFromComposer(t,d),r.value="",l())}}else c.key==="Escape"&&(r.value="",r.blur(),l())});let o=s.createDiv({cls:"kanban-composer-add-btn"});(0,f.setIcon)(o,"plus"),o.addEventListener("click",()=>{let c=r.value.trim();c&&(this.addCardFromComposer(t,c),r.value="",l())})}async addCardFromComposer(e,t){let n=t.split(`
`),s=n[0].trim(),r=n.slice(1),l=[],o=[];for(let p of r){let w=p.match(/^\s*-\s*\[([ xX])\]\s*(.*)$/);w?l.push({id:Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4),text:w[2].trim(),completed:w[1].toLowerCase()==="x"}):p.trim()&&o.push(p)}let c=this.getSetting("default-project"),d={id:Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4),title:s||"New card",completed:!1,tags:[],metadata:c?{project:c}:{},subtasks:l.length>0?l:void 0,content:r.length>0?r.map(p=>"	"+p).join(`
`):void 0},u=s.match(/#[\w-/]+/g)||[];d.tags=u.map(p=>p.substring(1));let h=s.match(/@(\d{4}-\d{2}-\d{2})(?:T(\d{2}:\d{2}))?/);h&&(d.dueDate=h[1],d.dueTime=h[2]),(this.getSetting("new-card-insertion-method")||this.plugin.settings["new-card-insertion-method"])==="prepend"?e.cards.unshift(d):e.cards.push(d),this.requestSave(),this.render(),(this.getSetting("auto-create-note")||this.plugin.settings["auto-create-note"])&&s&&await this.createCardNote(d)}renderSubtasks(e,t,n){if(!t.subtasks||t.subtasks.length===0)return;let s=e.createDiv({cls:"kanban-card-subtasks"}),r=t.subtasks.filter(h=>h.completed).length,l=t.subtasks.length,o=s.createDiv({cls:"kanban-subtasks-progress"});o.createSpan({cls:"subtask-count",text:`${r}/${l}`});let d=o.createDiv({cls:"subtask-progress-bar"}).createDiv({cls:"subtask-progress-fill"});d.style.width=`${r/l*100}%`,r===l&&o.addClass("all-complete");let u=s.createDiv({cls:"kanban-subtasks-list"});t.subtasks.forEach((h,b)=>{let v=u.createDiv({cls:`kanban-subtask ${h.completed?"is-completed":""}`}),p=v.createEl("input",{type:"checkbox"});p.checked=h.completed,p.addEventListener("change",w=>{w.stopPropagation(),h.completed=p.checked,v.toggleClass("is-completed",h.completed),t.content&&(t.content=Mn(t.content,b,h.completed));let m=t.subtasks.filter(E=>E.completed).length,y=o.querySelector(".subtask-count");y&&(y.textContent=`${m}/${l}`),d.style.width=`${m/l*100}%`,o.toggleClass("all-complete",m===l),this.requestSave()}),v.createSpan({cls:"subtask-text",text:h.text})})}renderCard(e,t,n){let s=["kanban-card"];t.completed&&s.push("is-completed"),t.baseTaskPath&&s.push("has-base-task");let r=e.createDiv({cls:s.join(" "),attr:{"data-card-id":t.id}});if(t.baseTaskPath){let p=r.createDiv({cls:"kanban-base-link-indicator"});p.title=`Linked to: ${t.baseTaskPath}`}if(this.getSetting("show-checkboxes")!==!1){let w=r.createDiv({cls:"kanban-card-checkbox"}).createEl("input",{type:"checkbox"});w.checked=t.completed,w.addEventListener("change",()=>{t.completed=w.checked,r.toggleClass("is-completed",t.completed),this.requestSave()})}let o=r.createDiv({cls:"kanban-card-content"}),c=this.getDisplayTitle(t),d=o.createDiv({cls:"kanban-card-title"});d.innerHTML=this.renderCardTitleHTML(c,t);let u=d.querySelector(".kanban-card-title-text");if(u&&(u.contentEditable="true",u.addEventListener("blur",async()=>{let p=u.textContent||"";if(t.title=this.reconstructCardTitle(p,t),this.requestSave(),this.pendingAutoCreateNote&&this.pendingAutoCreateNote.card.id===t.id){let w=this.pendingAutoCreateNote;this.pendingAutoCreateNote=null,t.title&&t.title!=="New card"&&await this.createCardNote(w.card)}}),u.addEventListener("keydown",p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),u.blur())})),this.renderMetadataPills(o,t),!this.getSetting("hide-tags-in-title")&&t.tags.length>0){let p=o.createDiv({cls:"kanban-card-tags"});for(let w of t.tags)p.createSpan({cls:"kanban-card-tag",text:`#${w}`}).addEventListener("click",y=>{var E,D,P,N;y.stopPropagation(),(N=(P=(D=(E=this.app.internalPlugins)==null?void 0:E.plugins)==null?void 0:D["global-search"])==null?void 0:P.instance)==null||N.openGlobalSearch(`tag:#${w}`)})}if(this.getSetting("show-subtasks")!==!1&&t.subtasks&&t.subtasks.length>0&&this.renderSubtasks(o,t,n),t.notePath){let p=o.createDiv({cls:"kanban-card-notes-indicator has-dedicated-note"});(0,f.setIcon)(p,"file-symlink"),p.title=`Open note: ${t.notePath}`,p.addEventListener("click",w=>{w.stopPropagation(),this.openCardNote(t)})}else if(t.notes||t.content){let p=o.createDiv({cls:"kanban-card-notes-indicator"});(0,f.setIcon)(p,t.content?"file-edit":"file-text"),p.title=t.content?"Edit card content":"Has inline notes",p.addEventListener("click",w=>{w.stopPropagation(),this.openCardContentModal(t)})}if(this.getSetting("show-card-menu")!==!1){let p=r.createDiv({cls:"kanban-card-menu-btn"});(0,f.setIcon)(p,"more-horizontal"),p.addEventListener("click",w=>{w.stopPropagation(),this.showCardMenu(w,t,n)})}r.addEventListener("click",p=>{var y;let w=p.target;if(w.contentEditable==="true"||w.tagName==="INPUT"||w.closest(".kanban-card-menu-btn")||w.closest(".kanban-card-tag")||w.closest(".kanban-card-notes-indicator")||w.closest(".kanban-subtask-checkbox"))return;if(t.notePath){this.openCardNote(t);return}let m=t.title.match(/\[\[([^\]|]+)(?:\|[^\]]+)?\]\]/);m&&this.app.workspace.openLinkText(m[1],((y=this.file)==null?void 0:y.path)||"")})}getDisplayTitle(e){let t=e.title;return this.getSetting("hide-tags-in-title")&&(t=t.replace(/#[\w-/]+/g,"").trim()),this.getSetting("hide-date-in-title")&&(t=t.replace(/@\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2})?/g,"").trim(),t=t.replace(/@@\d{2}:\d{2}/g,"").trim()),this.getSetting("hide-metadata-in-title")&&(t=t.replace(/\[\w+::[^\]]+\]/g,"").trim(),t=t.replace(/\w+::\S+/g,"").trim()),t.replace(/\s+/g," ").trim()}escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}renderCardTitleHTML(e,t){return`<span class="kanban-card-title-text">${this.escapeHtml(e).replace(/\[\[([^\]|]+)(?:\|([^\]]+))?\]\]/g,(r,l,o)=>`<a class="internal-link" data-href="${l.replace(/"/g,"&quot;")}">${o||l}</a>`)}</span>`}reconstructCardTitle(e,t){let n=e;if(this.getSetting("hide-tags-in-title")&&t.tags.length>0){let s=n.match(/#[\w-/]+/g)||[];for(let r of t.tags)s.includes(`#${r}`)||(n+=` #${r}`)}if(this.getSetting("hide-date-in-title")&&t.dueDate&&!n.includes("@")){let s=t.dueTime?`@${t.dueDate}T${t.dueTime}`:`@${t.dueDate}`;n+=` ${s}`}return n}renderMetadataPills(e,t){let n=e.createDiv({cls:"kanban-card-metadata-pills"}),s=!1;if(this.getSetting("show-progress")&&t.metadata.progress!==void 0){s=!0;let r=n.createDiv({cls:"kanban-metadata-pill kanban-progress-pill"});(0,f.setIcon)(r.createSpan(),"activity");let l=r.createSpan({cls:"pill-value",text:`${t.metadata.progress}%`}),c=r.createDiv({cls:"progress-bar-container"}).createDiv({cls:"progress-bar-fill"});c.style.width=`${t.metadata.progress}%`,t.metadata.progress>=100?r.addClass("complete"):t.metadata.progress>=50&&r.addClass("in-progress")}if(this.getSetting("show-project")&&t.metadata.project){s=!0;let r=n.createDiv({cls:"kanban-metadata-pill kanban-project-pill"});(0,f.setIcon)(r.createSpan(),"folder"),r.createSpan({cls:"pill-value",text:t.metadata.project})}if(t.dueDate||t.dueTime){s=!0;let r=n.createDiv({cls:"kanban-metadata-pill kanban-date-pill"});(0,f.setIcon)(r.createSpan(),t.dueDate?"calendar":"clock");let l="";if(t.dueDate){let c=this.getSetting("show-relative-date"),d=this.getSetting("date-format")||this.plugin.settings["date-format"];c?l=Dn(t.dueDate):l=jt(t.dueDate,d,!1),t.dueTime&&(l+=` ${t.dueTime}`)}else t.dueTime&&(l=t.dueTime);let o=r.createSpan({cls:"pill-value",text:l});if(t.dueDate&&(r.title=t.dueDate+(t.dueTime?`T${t.dueTime}`:"")),t.dueDate&&this.getSetting("link-date-to-daily-note")&&(o.addClass("clickable"),o.addEventListener("click",c=>{var d;c.stopPropagation(),this.app.workspace.openLinkText(t.dueDate,((d=this.file)==null?void 0:d.path)||"")})),t.dueDate){let c=new Date().toISOString().split("T")[0];t.dueDate<c?r.addClass("overdue"):t.dueDate===c&&r.addClass("due-today")}}if(t.recurrence){s=!0;let r=n.createDiv({cls:"kanban-metadata-pill kanban-recurrence-pill"});(0,f.setIcon)(r.createSpan(),"repeat");let l=this.formatRecurrenceDisplay(t.recurrence);if(r.createSpan({cls:"pill-value",text:l}),t.dueDate){let o=Tn(t.recurrence,new Date(t.dueDate));r.title=`Next: ${o.toISOString().split("T")[0]}`}}if(t.metadata.priority){s=!0;let r=n.createDiv({cls:`kanban-metadata-pill kanban-priority-pill priority-${t.metadata.priority}`});(0,f.setIcon)(r.createSpan(),"flag"),r.createSpan({cls:"pill-value",text:t.metadata.priority})}if(t.reminderTime&&this.plugin.settings["enable-reminders"]){s=!0;let r=n.createDiv({cls:"kanban-metadata-pill kanban-reminder-pill"});(0,f.setIcon)(r.createSpan(),"bell"),r.createSpan({cls:"pill-value",text:t.reminderTime}),r.title=`Reminder ${t.reminderTime} before due`}s||n.remove()}formatRecurrenceDisplay(e){if(e._rawPattern){let t=e._rawPattern.toLowerCase();return t==="daily"||t==="every day"?"Daily":t==="weekly"||t==="every week"?"Weekly":t==="monthly"||t==="every month"?"Monthly":t==="yearly"||t==="every year"||t==="annually"?"Yearly":t==="weekdays"||t==="every weekday"?"Weekdays":t==="weekends"||t==="every weekend"?"Weekends":e._rawPattern.replace(/^every\s+/i,"")}return Kt(e)}setupCardSortable(e,t){let n=Ot.create(e,{group:"cards",animation:150,ghostClass:"kanban-card-ghost",chosenClass:"kanban-card-chosen",dragClass:"kanban-card-drag",handle:".kanban-card",filter:'.kanban-card-menu-btn, input, [contenteditable="true"], .kanban-card-tag, .kanban-metadata-pill',preventOnFilter:!1,onEnd:s=>{let r=s.item.getAttribute("data-card-id"),l=s.from.getAttribute("data-lane-id"),o=s.to.getAttribute("data-lane-id");if(!r||!l||!o)return;let c=this.board.lanes.find(b=>b.id===l),d=this.board.lanes.find(b=>b.id===o);if(!c||!d)return;let u=c.cards.findIndex(b=>b.id===r);if(u===-1)return;let[h]=c.cards.splice(u,1);d.cards.splice(s.newIndex||0,0,h),this.requestSave(),this.render()}});this.sortableInstances.push(n)}setupLaneSortable(e){let t=Ot.create(e,{animation:150,ghostClass:"kanban-lane-ghost",chosenClass:"kanban-lane-chosen",dragClass:"kanban-lane-drag",handle:".kanban-lane-header",filter:'.kanban-add-lane-btn, [contenteditable="true"]',preventOnFilter:!1,onEnd:n=>{let s=n.oldIndex,r=n.newIndex;if(s===void 0||r===void 0||s===r||r>=this.board.lanes.length)return;let[l]=this.board.lanes.splice(s,1);this.board.lanes.splice(r,0,l),this.requestSave(),this.render()}});this.sortableInstances.push(t)}showLaneMenu(e,t){let n=new f.Menu;n.addItem(l=>{l.setTitle("Add card").setIcon("plus").onClick(()=>this.addCard(t))}),this.getSetting("template-path")&&n.addItem(l=>{l.setTitle("Add card from template").setIcon("file-plus").onClick(()=>this.addCardFromTemplate(t))}),n.addSeparator(),n.addItem(l=>{l.setTitle("Move left").setIcon("arrow-left").onClick(()=>this.moveLane(t,-1))}),n.addItem(l=>{l.setTitle("Move right").setIcon("arrow-right").onClick(()=>this.moveLane(t,1))}),n.addSeparator(),n.addItem(l=>{l.setTitle("Archive all cards").setIcon("archive").onClick(()=>this.archiveLaneCards(t))}),n.addItem(l=>{l.setTitle("Archive completed").setIcon("check-square").onClick(()=>this.archiveCompletedInLane(t))}),n.addSeparator();let r=this.getLaneWipConfig(t);n.addItem(l=>{l.setTitle(`Set WIP limit${r.limit>0?` (currently ${r.limit})`:""}`).setIcon("gauge").onClick(()=>this.showWipLimitModal(t))}),n.addSeparator(),n.addItem(l=>{l.setTitle("Delete list").setIcon("trash").onClick(()=>this.deleteLane(t))}),n.showAtMouseEvent(e)}showWipLimitModal(e){new Ht(this.app,e,this.getLaneWipConfig(e),n=>{this.board.settings["lane-configs"]||(this.board.settings["lane-configs"]={}),this.board.settings["lane-configs"][e.title]||(this.board.settings["lane-configs"][e.title]={}),this.board.settings["lane-configs"][e.title].wipLimit=n,this.requestSave(),this.render()}).open()}showCardMenu(e,t,n){let s=new f.Menu;s.addItem(o=>{o.setTitle("Edit card").setIcon("pencil").onClick(()=>this.openCardEditModal(t))}),t.notePath?(s.addItem(o=>{o.setTitle("Open note").setIcon("file-symlink").onClick(()=>this.openCardNote(t))}),s.addItem(o=>{o.setTitle("Sync to note").setIcon("refresh-cw").onClick(()=>this.syncCardToNote(t))}),s.addItem(o=>{o.setTitle("Unlink note").setIcon("unlink").onClick(()=>this.unlinkCardNote(t))})):(s.addItem(o=>{o.setTitle("Create note").setIcon("file-plus").onClick(()=>this.createCardNote(t))}),s.addItem(o=>{o.setTitle("Link to existing note").setIcon("link").onClick(()=>this.linkToExistingNote(t))})),s.addItem(o=>{o.setTitle("Edit content").setIcon("file-edit").onClick(()=>this.openCardContentModal(t))}),!t.notePath&&!t.content&&s.addItem(o=>{o.setTitle("Edit inline notes").setIcon("file-text").onClick(()=>this.openCardNotesModal(t))}),s.addSeparator();let r=this.board.lanes.filter(o=>o.id!==n.id);r.length>0&&s.addItem(o=>{o.setTitle("Move to..."),o.setIcon("arrow-right");let c=o.setSubmenu();for(let d of r)c.addItem(u=>{u.setTitle(d.title).onClick(()=>this.moveCard(t,n,d))})}),s.addSeparator(),s.addItem(o=>{o.setTitle("Set progress...").setIcon("activity").onClick(()=>this.setCardProgress(t))}),s.addItem(o=>{o.setTitle("Set project...").setIcon("folder").onClick(()=>this.setCardProject(t))}),s.addItem(o=>{o.setTitle("Set due date...").setIcon("calendar").onClick(()=>this.setCardDueDate(t))}),s.addSeparator(),this.getBaseSyncConfig().enabled&&(t.baseTaskPath?(s.addItem(o=>{o.setTitle("Open Base task").setIcon("external-link").onClick(()=>{t.baseTaskPath&&this.app.workspace.openLinkText(t.baseTaskPath,"")})}),s.addItem(o=>{o.setTitle("Unlink from Base").setIcon("unlink").onClick(()=>{t.baseTaskPath=void 0,t.baseSyncTime=void 0,this.requestSave(),this.render(),new f.Notice("Card unlinked from Base task")})})):(s.addItem(o=>{o.setTitle("Link to Base task").setIcon("link").onClick(()=>this.linkCardToBaseTask(t))}),s.addItem(o=>{o.setTitle("Create Base task").setIcon("file-plus-2").onClick(()=>this.createBaseTaskForCard(t,n))})),s.addSeparator()),s.addItem(o=>{o.setTitle("Archive").setIcon("archive").onClick(()=>this.archiveCard(t,n))}),s.addItem(o=>{o.setTitle("Delete").setIcon("trash").onClick(()=>this.deleteCard(t,n))}),s.showAtMouseEvent(e)}addLane(){let e={id:Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4),title:"New List",cards:[]};this.board.lanes.push(e),this.requestSave(),this.render(),setTimeout(()=>{let t=this.boardContainer.querySelector(`[data-lane-id="${e.id}"] .kanban-lane-title`);if(t instanceof HTMLElement){t.focus();let n=document.createRange();n.selectNodeContents(t);let s=window.getSelection();s==null||s.removeAllRanges(),s==null||s.addRange(n)}},50)}moveLane(e,t){let n=this.board.lanes.indexOf(e),s=n+t;s<0||s>=this.board.lanes.length||(this.board.lanes.splice(n,1),this.board.lanes.splice(s,0,e),this.requestSave(),this.render())}deleteLane(e){let t=this.board.lanes.indexOf(e);t!==-1&&(this.board.lanes.splice(t,1),this.requestSave(),this.render())}addCard(e){let t=this.getSetting("default-project"),n={id:Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4),title:"New card",completed:!1,tags:[],metadata:t?{project:t}:{}};(this.getSetting("new-card-insertion-method")||this.plugin.settings["new-card-insertion-method"])==="prepend"?e.cards.unshift(n):e.cards.push(n),this.requestSave(),this.render(),setTimeout(()=>{let l=this.boardContainer.querySelector(`[data-card-id="${n.id}"] .kanban-card-title-text`);if(l instanceof HTMLElement){l.focus();let o=document.createRange();o.selectNodeContents(l);let c=window.getSelection();c==null||c.removeAllRanges(),c==null||c.addRange(o)}},50),(this.getSetting("auto-create-note")||this.plugin.settings["auto-create-note"])&&(this.pendingAutoCreateNote={card:n,lane:e})}async addCardFromTemplate(e){let t=this.getSetting("template-path");if(!t)return;let n=this.app.vault.getAbstractFileByPath(t);if(!(n instanceof f.TFile)){console.warn("Template file not found:",t);return}try{let s=await this.app.vault.read(n),r=this.getSetting("default-project"),l=Nn(s,r?{project:r}:{});(this.getSetting("new-card-insertion-method")||this.plugin.settings["new-card-insertion-method"])==="prepend"?e.cards.unshift(l):e.cards.push(l),this.requestSave(),this.render()}catch(s){console.error("Error reading template:",s)}}moveCard(e,t,n){let s=t.cards.indexOf(e);s!==-1&&(t.cards.splice(s,1),n.cards.push(e),this.syncCardStatusToBase(e,n),this.requestSave(),this.render())}async syncCardStatusToBase(e,t){let n=this.getBaseSyncConfig();if(n.enabled){if(this.baseSyncService.setConfig(n),e.baseTaskPath)await this.baseSyncService.onCardMoveToLane(e,t)&&ue(this.syncStatusEl,"success","Status synced");else if(n.createMissingTasks){let s=await this.baseSyncService.createBaseTask(e.title,e.metadata,t);s&&(e.baseTaskPath=s,e.baseSyncTime=Date.now(),ue(this.syncStatusEl,"success","Task created"))}}}deleteCard(e,t){let n=t.cards.indexOf(e);n!==-1&&(t.cards.splice(n,1),this.requestSave(),this.render())}archiveCard(e,t){let n=t.cards.indexOf(e);if(n===-1)return;t.cards.splice(n,1);let s=e;this.plugin.settings["prepend-archive-date"]&&(s=We(e,this.plugin.settings["prepend-archive-format"])),this.board.archive.push(s),this.requestSave(),this.render()}archiveLaneCards(e){for(let t of e.cards){let n=t;this.plugin.settings["prepend-archive-date"]&&(n=We(t,this.plugin.settings["prepend-archive-format"])),this.board.archive.push(n)}e.cards=[],this.requestSave(),this.render()}archiveCompletedInLane(e){let t=e.cards.filter(s=>s.completed),n=e.cards.filter(s=>!s.completed);for(let s of t){let r=s;this.plugin.settings["prepend-archive-date"]&&(r=We(s,this.plugin.settings["prepend-archive-format"])),this.board.archive.push(r)}e.cards=n,this.requestSave(),this.render()}archiveCompletedCards(){for(let e of this.board.lanes){let t=e.cards.filter(s=>s.completed),n=e.cards.filter(s=>!s.completed);for(let s of t){let r=s;this.plugin.settings["prepend-archive-date"]&&(r=We(s,this.plugin.settings["prepend-archive-format"])),this.board.archive.push(r)}e.cards=n}this.requestSave(),this.render()}openCardEditModal(e){new Rt(this.app,e,n=>{Object.assign(e,n),this.requestSave(),this.render()}).open()}openCardNotesModal(e){new Vt(this.app,e,n=>{e.notes=n||void 0,this.requestSave(),this.render()}).open()}openCardContentModal(e){new Yt(this.app,e,(n,s)=>{if(e.content=n||void 0,e.subtasks=s&&s.length>0?s:void 0,!(!n&&e.notes)){if(n){let r=[];for(let l of n.split(`
`)){let o=l.match(/^\s*>\s?(.*)$/);o&&r.push(o[1])}e.notes=r.length>0?r.join(`
`):void 0}}this.requestSave(),this.render()}).open()}setCardProgress(e){var n;new He(this.app,"Set Progress","Enter progress (0-100%)",((n=e.metadata.progress)==null?void 0:n.toString())||"0",async s=>{let r=parseInt(s.replace("%",""),10);if(!isNaN(r)){let l=Math.min(100,Math.max(0,r));e.metadata.progress=l,await this.syncCardProgressToBase(e,l),this.requestSave(),this.render()}}).open()}async syncCardProgressToBase(e,t){let n=this.getBaseSyncConfig();if(!n.enabled||!e.baseTaskPath)return;this.baseSyncService.setConfig(n),await this.baseSyncService.syncProgress(e,t)&&ue(this.syncStatusEl,"success","Progress synced")}setCardProject(e){new He(this.app,"Set Project","Enter project name",e.metadata.project||"",async n=>{e.metadata.project=n||void 0,await this.syncCardProjectToBase(e,n),this.requestSave(),this.render()}).open()}async syncCardProjectToBase(e,t){let n=this.getBaseSyncConfig();if(!n.enabled||!e.baseTaskPath)return;this.baseSyncService.setConfig(n),await this.baseSyncService.syncProject(e,t)&&ue(this.syncStatusEl,"success","Project synced")}setCardDueDate(e){new He(this.app,"Set Due Date","Enter date (YYYY-MM-DD)",e.dueDate||"",n=>{n.match(/^\d{4}-\d{2}-\d{2}$/)?e.dueDate=n:n||(e.dueDate=void 0),this.requestSave(),this.render()}).open()}openBoardSettings(){new Wt(this.app,this.board.settings,t=>{this.board.settings=t,this.requestSave(),this.render()}).open()}async openCardNote(e){var n;if(!e.notePath)return;let t=this.app.vault.getAbstractFileByPath(e.notePath);t instanceof f.TFile?(await this.syncCardFromNote(e,t),await this.app.workspace.openLinkText(e.notePath,((n=this.file)==null?void 0:n.path)||"")):new gt(this.app,"Note not found",`The note "${e.notePath}" no longer exists. Would you like to create it?`,async()=>{await this.createCardNote(e)}).open()}async createCardNote(e){var c,d,u;let t=this.getSetting("card-note-template")||this.plugin.settings["card-note-template"],n=this.getSetting("card-note-folder")||this.plugin.settings["card-note-folder"],r=this.sanitizeFilename(e.title)||`card-${e.id}`,l="";if(n)this.app.vault.getAbstractFileByPath(n)||await this.app.vault.createFolder(n),l=`${n}/${r}.md`;else{let h=((d=(c=this.file)==null?void 0:c.parent)==null?void 0:d.path)||"";l=h?`${h}/${r}.md`:`${r}.md`}l=await this.ensureUniqueFilename(l);let o=await this.generateCardNoteContent(e,t);try{let h=await this.app.vault.create(l,o);if(e.notePath=h.path,e.notes){let b=await this.app.vault.read(h);b.includes(e.notes)||await this.app.vault.modify(h,b+`

## Notes

`+e.notes),e.notes=void 0}this.requestSave(),this.render(),await this.app.workspace.openLinkText(h.path,((u=this.file)==null?void 0:u.path)||"")}catch(h){console.error("Error creating card note:",h)}}async unlinkCardNote(e){if(!e.notePath)return;new gt(this.app,"Unlink note",`Unlink "${e.notePath}" from this card? The note file will be kept.`,()=>{e.notePath=void 0,this.requestSave(),this.render(),new f.Notice("Note unlinked from card")}).open()}async linkToExistingNote(e){new qt(this.app,async n=>{if(n){e.notePath=n;let s=this.app.vault.getAbstractFileByPath(n);s instanceof f.TFile&&await this.syncCardFromNote(e,s),this.requestSave(),this.render(),new f.Notice(`Card linked to: ${n}`)}}).open()}sanitizeFilename(e){let t=e.replace(/\[\[([^\]|]+)(?:\|[^\]]+)?\]\]/g,"$1");return t=t.replace(/\[\w+::[^\]]+\]/g,""),t=t.replace(/\w+::\S+/g,""),t=t.replace(/#[\w-/]+/g,""),t=t.replace(/@\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2})?/g,""),t=t.replace(/@@\d{2}:\d{2}/g,""),t=t.replace(/[\\/:*?"<>|]/g,""),t=t.replace(/\s+/g," ").trim(),t.length>100&&(t=t.substring(0,100).trim()),t}async ensureUniqueFilename(e){let t=e.endsWith(".md")?"":".md",n=e.endsWith(".md")?e:e+t,s=1;for(;this.app.vault.getAbstractFileByPath(n);)n=`${e.replace(/\.md$/,"")} ${s}.md`,s++;return n}async generateCardNoteContent(e,t){let n="";if(t){let s=this.app.vault.getAbstractFileByPath(t);if(s instanceof f.TFile)try{n=await this.app.vault.read(s),n=this.processCardNoteTemplate(n,e)}catch(r){console.warn("Error reading template:",r)}}return n||(n=this.generateDefaultCardNoteContent(e)),n}processCardNoteTemplate(e,t){var s,r,l;let n=Bt({title:t.title,project:t.metadata.project,dueDate:t.dueDate,priority:t.metadata.priority,tags:t.tags,customVars:{dueTime:t.dueTime||"",progress:((s=t.metadata.progress)==null?void 0:s.toString())||"",completed:t.completed?"true":"false",board:((r=this.file)==null?void 0:r.basename)||"",boardPath:((l=this.file)==null?void 0:l.path)||"",cardId:t.id,notes:t.notes||""}});return $t(e,n)}generateDefaultCardNoteContent(e){var s;let t=[];t.push("---"),t.push(`kanban-card: ${e.id}`),t.push(`kanban-board: "[[${((s=this.file)==null?void 0:s.basename)||"Kanban"}]]"`),e.dueDate&&t.push(`due: ${e.dueDate}${e.dueTime?"T"+e.dueTime:""}`),e.metadata.progress!==void 0&&t.push(`progress: ${e.metadata.progress}`),e.metadata.project&&t.push(`project: "${e.metadata.project}"`),e.metadata.priority&&t.push(`priority: ${e.metadata.priority}`),e.tags.length>0&&t.push(`tags: [${e.tags.map(r=>`"${r}"`).join(", ")}]`),t.push(`completed: ${e.completed}`),t.push(`created: ${new Date().toISOString().split("T")[0]}`),t.push("---"),t.push("");let n=this.getDisplayTitle(e);if(t.push(`# ${n||"Card"}`),t.push(""),e.notes&&(t.push("## Notes"),t.push(""),t.push(e.notes),t.push("")),e.subtasks&&e.subtasks.length>0){t.push("## Tasks"),t.push("");for(let r of e.subtasks)t.push(`- [${r.completed?"x":" "}] ${r.text}`);t.push("")}return t.join(`
`)}async syncCardToNote(e){if(!e.notePath)return;let t=this.app.vault.getAbstractFileByPath(e.notePath);if(t instanceof f.TFile)try{let n=await this.app.vault.read(t),s=n.match(/^---\n([\s\S]*?)\n---/);if(s){let l=s[1];l=this.updateFrontmatterField(l,"due",e.dueDate?e.dueTime?`${e.dueDate}T${e.dueTime}`:e.dueDate:void 0),l=this.updateFrontmatterField(l,"progress",e.metadata.progress!==void 0?String(e.metadata.progress):void 0),l=this.updateFrontmatterField(l,"project",e.metadata.project),l=this.updateFrontmatterField(l,"priority",e.metadata.priority),l=this.updateFrontmatterField(l,"completed",String(e.completed)),e.tags.length>0&&(l=this.updateFrontmatterField(l,"tags",`[${e.tags.map(o=>`"${o}"`).join(", ")}]`)),n=n.replace(s[0],`---
${l}
---`)}else n=this.generateCardFrontmatter(e)+`
`+n;let r=n.match(/^# .+$/m);if(r){let l=this.getDisplayTitle(e);n=n.replace(r[0],`# ${l}`)}await this.app.vault.modify(t,n)}catch(n){console.warn("Error syncing card to note:",n)}}updateFrontmatterField(e,t,n){let s=e.split(`
`),r=new RegExp(`^${t}:\\s*.*$`,"m");if(n!==void 0&&n!==""){let l=s.findIndex(d=>d.startsWith(`${t}:`)),c=(n.includes(":")||n.includes("#")||n.includes('"'))&&!n.startsWith("[")?`"${n}"`:n;l>=0?s[l]=`${t}: ${c}`:s.push(`${t}: ${c}`)}else{let l=s.findIndex(o=>o.startsWith(`${t}:`));l>=0&&s.splice(l,1)}return s.filter(l=>l.trim()!==""||l==="").join(`
`)}generateCardFrontmatter(e){var n;let t=["---"];return t.push(`kanban-card: ${e.id}`),t.push(`kanban-board: "[[${((n=this.file)==null?void 0:n.basename)||"Kanban"}]]"`),e.dueDate&&t.push(`due: ${e.dueDate}${e.dueTime?"T"+e.dueTime:""}`),e.metadata.progress!==void 0&&t.push(`progress: ${e.metadata.progress}`),e.metadata.project&&t.push(`project: "${e.metadata.project}"`),e.metadata.priority&&t.push(`priority: ${e.metadata.priority}`),e.tags.length>0&&t.push(`tags: [${e.tags.map(s=>`"${s}"`).join(", ")}]`),t.push(`completed: ${e.completed}`),t.push("---"),t.join(`
`)}async syncCardFromNote(e,t){try{let n=await this.app.vault.read(t),s=this.app.metadataCache.getFileCache(t);if(s!=null&&s.frontmatter){let r=s.frontmatter;if(s.headings&&s.headings.length>0){let l=s.headings[0];if(l.level===1){let o=l.heading;o&&o!==e.title&&(e.title=o)}}r.due&&typeof r.due=="string"&&(e.dueDate=r.due),r.progress!==void 0&&(e.metadata.progress=typeof r.progress=="number"?r.progress:parseInt(r.progress,10)),r.project&&(e.metadata.project=r.project),r.priority&&(e.metadata.priority=r.priority),r.completed!==void 0&&(e.completed=r.completed===!0||r.completed==="true"),Array.isArray(r.tags)&&(e.tags=r.tags.map(l=>l.replace(/^#/,""))),this.requestSave(),this.render()}}catch(n){console.warn("Error syncing card from note:",n)}}async createOrOpenCardNote(){let e=this.findFocusedCard();e&&(e.card.notePath?await this.openCardNote(e.card):await this.createCardNote(e.card))}findFocusedCard(){let e=document.activeElement;if(e){let t=e.closest("[data-card-id]");if(t){let n=t.getAttribute("data-card-id");for(let s of this.board.lanes){let r=s.cards.find(l=>l.id===n);if(r)return{card:r,lane:s}}}}return null}},Rt=class extends f.Modal{constructor(e,t,n){super(e);this.card={...t,metadata:{...t.metadata}},this.onSave=n}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("kanban-card-edit-modal"),e.createEl("h2",{text:"Edit Card"}),new f.Setting(e).setName("Title").addText(t=>t.setValue(this.card.title).onChange(n=>this.card.title=n)),new f.Setting(e).setName("Due Date").setDesc("YYYY-MM-DD format").addText(t=>t.setValue(this.card.dueDate||"").onChange(n=>this.card.dueDate=n||void 0)),new f.Setting(e).setName("Progress").setDesc("0-100").addSlider(t=>t.setLimits(0,100,5).setValue(this.card.metadata.progress||0).setDynamicTooltip().onChange(n=>this.card.metadata.progress=n)),new f.Setting(e).setName("Project").addText(t=>t.setValue(this.card.metadata.project||"").onChange(n=>this.card.metadata.project=n||void 0)),new f.Setting(e).setName("Priority").addDropdown(t=>t.addOption("","None").addOption("low","Low").addOption("medium","Medium").addOption("high","High").addOption("urgent","Urgent").setValue(this.card.metadata.priority||"").onChange(n=>this.card.metadata.priority=n||void 0)),new f.Setting(e).addButton(t=>t.setButtonText("Save").setCta().onClick(()=>{this.onSave(this.card),this.close()})).addButton(t=>t.setButtonText("Cancel").onClick(()=>this.close()))}onClose(){let{contentEl:e}=this;e.empty()}},Vt=class extends f.Modal{constructor(e,t,n){super(e);this.card=t,this.notesValue=t.notes||"",this.onSave=n}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("kanban-card-notes-modal"),e.createEl("h2",{text:"Card Notes"}),e.createEl("p",{text:this.card.title,cls:"kanban-notes-card-title"});let t=e.createEl("textarea",{cls:"kanban-notes-textarea",attr:{rows:"10"}});t.value=this.notesValue,t.addEventListener("input",()=>{this.notesValue=t.value}),new f.Setting(e).addButton(n=>n.setButtonText("Save").setCta().onClick(()=>{this.onSave(this.notesValue),this.close()})).addButton(n=>n.setButtonText("Cancel").onClick(()=>this.close()))}onClose(){let{contentEl:e}=this;e.empty()}},Yt=class extends f.Modal{constructor(e,t,n){super(e);this.card=t,this.contentValue=t.content||"",this.subtasks=t.subtasks?[...t.subtasks]:[],this.onSave=n}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("kanban-card-content-modal"),e.createEl("h2",{text:"Edit Card Content"}),e.createEl("p",{text:this.card.title,cls:"kanban-content-card-title"}),e.createEl("p",{text:'Add subtasks with "- [ ] task" format. Content is saved in markdown under the card.',cls:"kanban-content-info"});let t=e.createEl("textarea",{cls:"kanban-content-textarea",attr:{rows:"12",placeholder:`Add content, notes, or subtasks...

- [ ] Subtask 1
- [ ] Subtask 2

> Notes can use > prefix`}});if(this.subtasks.length>0&&!this.contentValue){let c=this.subtasks.map(d=>`	- [${d.completed?"x":" "}] ${d.text}`);this.contentValue=c.join(`
`)}if(this.card.notes&&!this.contentValue){let c=this.card.notes.split(`
`).map(d=>`	> ${d}`);this.contentValue=c.join(`
`)}t.value=this.contentValue,t.addEventListener("input",()=>{this.contentValue=t.value,this.parseSubtasksFromContent(),this.updateSubtaskPreview()});let n=e.createDiv({cls:"kanban-content-preview"});n.createEl("h4",{text:"Subtasks Preview"}),this.subtaskPreviewEl=n.createDiv({cls:"kanban-subtask-preview-list"}),this.updateSubtaskPreview();let s=e.createDiv({cls:"kanban-quick-add-subtask"}),r=s.createEl("input",{type:"text",cls:"kanban-subtask-input",attr:{placeholder:"Quick add subtask..."}}),l=s.createEl("button",{text:"Add"}),o=()=>{let c=r.value.trim();if(c){let d=`	- [ ] ${c}`;this.contentValue?this.contentValue+=`
`+d:this.contentValue=d,t.value=this.contentValue,this.parseSubtasksFromContent(),this.updateSubtaskPreview(),r.value=""}};l.addEventListener("click",o),r.addEventListener("keydown",c=>{c.key==="Enter"&&(c.preventDefault(),o())}),new f.Setting(e).addButton(c=>c.setButtonText("Save").setCta().onClick(()=>{this.parseSubtasksFromContent(),this.onSave(this.contentValue,this.subtasks),this.close()})).addButton(c=>c.setButtonText("Cancel").onClick(()=>this.close()))}parseSubtasksFromContent(){this.subtasks=[];let e=this.contentValue.split(`
`);for(let t of e){let n=t.match(/^\s*-\s*\[([ xX])\]\s*(.*)$/);n&&this.subtasks.push({id:Math.random().toString(36).substring(2,11)+Date.now().toString(36).slice(-4),text:n[2].trim(),completed:n[1].toLowerCase()==="x"})}}updateSubtaskPreview(){if(this.subtaskPreviewEl.empty(),this.subtasks.length===0){this.subtaskPreviewEl.createEl("p",{text:'No subtasks found. Add subtasks with "- [ ] task" format.',cls:"kanban-subtask-empty"});return}let e=this.subtasks.filter(t=>t.completed).length;this.subtaskPreviewEl.createEl("p",{text:`${e}/${this.subtasks.length} completed`,cls:"kanban-subtask-summary"});for(let t of this.subtasks){let n=this.subtaskPreviewEl.createDiv({cls:`kanban-subtask-preview-item ${t.completed?"is-completed":""}`});n.createSpan({text:t.completed?"\u2611":"\u2610"}),n.createSpan({text:t.text})}}onClose(){let{contentEl:e}=this;e.empty()}},He=class extends f.Modal{constructor(e,t,n,s,r){super(e);this.title=t,this.placeholder=n,this.initialValue=s,this.onSave=r}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h3",{text:this.title});let t=this.initialValue;new f.Setting(e).setName(this.placeholder).addText(n=>n.setValue(this.initialValue).onChange(s=>t=s).inputEl.addEventListener("keydown",s=>{s.key==="Enter"&&(this.onSave(t),this.close())})),new f.Setting(e).addButton(n=>n.setButtonText("OK").setCta().onClick(()=>{this.onSave(t),this.close()})).addButton(n=>n.setButtonText("Cancel").onClick(()=>this.close()))}onClose(){let{contentEl:e}=this;e.empty()}},Wt=class extends f.Modal{constructor(e,t,n){super(e);this.settings={...t},this.onSave=n}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("kanban-board-settings-modal"),e.createEl("h2",{text:"Board Settings"}),e.createEl("p",{text:"These settings override global plugin settings for this board.",cls:"setting-item-description"}),e.createEl("h3",{text:"Display"}),new f.Setting(e).setName("Lane width").setDesc("Width of lanes (e.g., 272px, 300px)").addText(n=>n.setValue(this.settings["lane-width"]||"").setPlaceholder("272px").onChange(s=>this.settings["lane-width"]=s||void 0)),new f.Setting(e).setName("Show checkboxes").addToggle(n=>n.setValue(this.settings["show-checkboxes"]!==!1).onChange(s=>this.settings["show-checkboxes"]=s)),new f.Setting(e).setName("Show card count").addToggle(n=>n.setValue(this.settings["hide-card-count"]!==!0).onChange(s=>this.settings["hide-card-count"]=!s)),new f.Setting(e).setName("Hide tags in title").addToggle(n=>n.setValue(this.settings["hide-tags-in-title"]||!1).onChange(s=>this.settings["hide-tags-in-title"]=s)),new f.Setting(e).setName("Hide dates in title").addToggle(n=>n.setValue(this.settings["hide-date-in-title"]||!1).onChange(s=>this.settings["hide-date-in-title"]=s)),e.createEl("h3",{text:"Metadata"}),new f.Setting(e).setName("Show progress").addToggle(n=>n.setValue(this.settings["show-progress"]!==!1).onChange(s=>this.settings["show-progress"]=s)),new f.Setting(e).setName("Show project").addToggle(n=>n.setValue(this.settings["show-project"]!==!1).onChange(s=>this.settings["show-project"]=s)),new f.Setting(e).setName("Default project").setDesc("Default project for new cards").addText(n=>n.setValue(this.settings["default-project"]||"").onChange(s=>this.settings["default-project"]=s||void 0)),e.createEl("h3",{text:"Dates"}),new f.Setting(e).setName("Date format").addText(n=>n.setValue(this.settings["date-format"]||"").setPlaceholder("YYYY-MM-DD").onChange(s=>this.settings["date-format"]=s||void 0)),new f.Setting(e).setName("Show relative dates").addToggle(n=>n.setValue(this.settings["show-relative-date"]||!1).onChange(s=>this.settings["show-relative-date"]=s)),new f.Setting(e).setName("Link dates to daily notes").addToggle(n=>n.setValue(this.settings["link-date-to-daily-note"]||!1).onChange(s=>this.settings["link-date-to-daily-note"]=s)),e.createEl("h3",{text:"Cards"}),new f.Setting(e).setName("New card position").addDropdown(n=>n.addOption("","Use global setting").addOption("prepend","Top of list").addOption("append","Bottom of list").setValue(this.settings["new-card-insertion-method"]||"").onChange(s=>this.settings["new-card-insertion-method"]=s||void 0)),new f.Setting(e).setName("Template path").setDesc("Path to template file for new cards").addText(n=>n.setValue(this.settings["template-path"]||"").setPlaceholder("templates/card.md").onChange(s=>this.settings["template-path"]=s||void 0)),e.createEl("h3",{text:"Card Composer"}),new f.Setting(e).setName("Show card composer").setDesc("Show quick-add composer in lanes").addToggle(n=>n.setValue(this.settings["show-card-composer"]!==!1).onChange(s=>this.settings["show-card-composer"]=s)),new f.Setting(e).setName("Composer position").setDesc("Where to show the quick-add composer").addDropdown(n=>n.addOption("bottom","Bottom of lane").addOption("top","Top of lane").setValue(this.settings["composer-position"]||"bottom").onChange(s=>this.settings["composer-position"]=s)),new f.Setting(e).setName("Show subtasks").setDesc("Display subtask checkboxes in cards").addToggle(n=>n.setValue(this.settings["show-subtasks"]!==!1).onChange(s=>this.settings["show-subtasks"]=s)),e.createEl("h3",{text:"Card Notes"});let t=e.createDiv({cls:"kanban-settings-info"});t.createEl("span",{text:"Template variables: ",cls:"setting-item-name"}),t.createEl("span",{text:"{{title}}, {{date}}, {{time}}, {{project}}, {{lane}}, {{board}}, {{dueDate}}, {{tags}}, {{id}}",cls:"kanban-template-var"}),new f.Setting(e).setName("Card note template").setDesc("Template file for dedicated card notes").addText(n=>n.setValue(this.settings["card-note-template"]||"").setPlaceholder("templates/card-note.md").onChange(s=>this.settings["card-note-template"]=s||void 0)),new f.Setting(e).setName("Card note folder").setDesc("Folder for dedicated card notes").addText(n=>n.setValue(this.settings["card-note-folder"]||"").setPlaceholder("cards/").onChange(s=>this.settings["card-note-folder"]=s||void 0)),new f.Setting(e).setName("Auto-create note for new cards").setDesc("Automatically create a dedicated note when adding new cards").addToggle(n=>n.setValue(this.settings["auto-create-note"]||!1).onChange(s=>this.settings["auto-create-note"]=s)),new f.Setting(e).addButton(n=>n.setButtonText("Save").setCta().onClick(()=>{let s={};for(let[r,l]of Object.entries(this.settings))l!==void 0&&l!==""&&(s[r]=l);this.onSave(s),this.close()})).addButton(n=>n.setButtonText("Cancel").onClick(()=>this.close()))}onClose(){let{contentEl:e}=this;e.empty()}},gt=class extends f.Modal{constructor(e,t,n,s){super(e);this.title=t,this.message=n,this.onConfirm=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h3",{text:this.title}),e.createEl("p",{text:this.message}),new f.Setting(e).addButton(t=>t.setButtonText("Yes").setCta().onClick(()=>{this.onConfirm(),this.close()})).addButton(t=>t.setButtonText("No").onClick(()=>this.close()))}onClose(){let{contentEl:e}=this;e.empty()}},Ht=class extends f.Modal{constructor(e,t,n,s){super(e);this.lane=t,this.currentConfig={...n},this.onSave=s}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("kanban-wip-limit-modal"),e.createEl("h2",{text:`WIP Limit: ${this.lane.title}`}),e.createEl("p",{text:"Set a Work In Progress limit for this lane. Cards exceeding the limit will show a warning.",cls:"setting-item-description"}),new f.Setting(e).setName("WIP limit").setDesc("Maximum cards allowed (0 = no limit)").addText(t=>t.setPlaceholder("0").setValue(String(this.currentConfig.limit)).onChange(n=>{let s=parseInt(n,10);this.currentConfig.limit=isNaN(s)?0:Math.max(0,s)})),new f.Setting(e).setName("Warning threshold").setDesc("Show warning when this many cards (leave empty to use limit)").addText(t=>t.setPlaceholder("Same as limit").setValue(this.currentConfig.warnAt?String(this.currentConfig.warnAt):"").onChange(n=>{let s=parseInt(n,10);this.currentConfig.warnAt=isNaN(s)?void 0:Math.max(0,s)})),new f.Setting(e).setName("Block when exceeded").setDesc("Prevent adding new cards when limit is exceeded").addToggle(t=>t.setValue(this.currentConfig.blockExceeded).onChange(n=>this.currentConfig.blockExceeded=n)),new f.Setting(e).addButton(t=>t.setButtonText("Save").setCta().onClick(()=>{this.onSave(this.currentConfig),this.close()})).addButton(t=>t.setButtonText("Remove limit").onClick(()=>{this.onSave({limit:0,blockExceeded:!1}),this.close()})).addButton(t=>t.setButtonText("Cancel").onClick(()=>this.close()))}onClose(){let{contentEl:e}=this;e.empty()}},qt=class extends f.Modal{constructor(e,t){super(e);this.allNotes=[];this.onSelect=t}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("kanban-note-link-modal"),e.createEl("h2",{text:"Link to Note"}),e.createEl("p",{text:"Search for an existing note to link to this card.",cls:"setting-item-description"}),this.searchInput=e.createEl("input",{type:"text",cls:"note-link-search",attr:{placeholder:"Search notes..."}}),this.searchInput.addEventListener("input",()=>this.updateResults()),this.resultsEl=e.createDiv({cls:"note-link-results"}),this.loadNotes(),this.searchInput.focus(),new f.Setting(e).addButton(t=>t.setButtonText("Cancel").onClick(()=>{this.onSelect(null),this.close()}))}loadNotes(){this.allNotes=this.app.vault.getMarkdownFiles().sort((e,t)=>t.stat.mtime-e.stat.mtime),this.updateResults()}updateResults(){this.resultsEl.empty();let e=this.searchInput.value.toLowerCase(),t=this.allNotes.filter(n=>n.basename.toLowerCase().includes(e)||n.path.toLowerCase().includes(e)).slice(0,20);if(t.length===0){this.resultsEl.createEl("p",{text:e?"No matching notes found":"Start typing to search notes",cls:"note-link-empty"});return}for(let n of t){let s=this.resultsEl.createDiv({cls:"note-link-item"});s.createEl("strong",{text:n.basename}),s.createEl("span",{text:n.path,cls:"note-link-path"}),s.addEventListener("click",()=>{this.onSelect(n.path),this.close()})}}onClose(){let{contentEl:e}=this;e.empty()}};var k=require("obsidian");var mt=class extends k.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h1",{text:"Kanban Settings"}),e.createEl("h2",{text:"Display"}),new k.Setting(e).setName("Default lane width").setDesc("Default width for lanes (e.g., 272px, 300px, 20rem)").addText(o=>o.setPlaceholder("272px").setValue(this.plugin.settings["default-lane-width"]).onChange(async c=>{this.plugin.settings["default-lane-width"]=c||Z["default-lane-width"],await this.plugin.saveSettings()})),new k.Setting(e).setName("Show checkboxes").setDesc("Show completion checkboxes on cards").addToggle(o=>o.setValue(this.plugin.settings["show-checkboxes"]).onChange(async c=>{this.plugin.settings["show-checkboxes"]=c,await this.plugin.saveSettings()})),new k.Setting(e).setName("Show card menu").setDesc("Show the menu button on cards").addToggle(o=>o.setValue(this.plugin.settings["show-card-menu"]).onChange(async c=>{this.plugin.settings["show-card-menu"]=c,await this.plugin.saveSettings()})),new k.Setting(e).setName("Hide tags in card titles").setDesc("Hide #tags from displaying inline in card titles (still shown as pills)").addToggle(o=>o.setValue(this.plugin.settings["hide-tags-in-title"]).onChange(async c=>{this.plugin.settings["hide-tags-in-title"]=c,await this.plugin.saveSettings()})),new k.Setting(e).setName("Hide dates in card titles").setDesc("Hide @dates from displaying inline in card titles (still shown as pills)").addToggle(o=>o.setValue(this.plugin.settings["hide-date-in-title"]).onChange(async c=>{this.plugin.settings["hide-date-in-title"]=c,await this.plugin.saveSettings()})),new k.Setting(e).setName("Hide metadata in card titles").setDesc("Hide [key::value] metadata from displaying inline (still shown as pills)").addToggle(o=>o.setValue(this.plugin.settings["hide-metadata-in-title"]).onChange(async c=>{this.plugin.settings["hide-metadata-in-title"]=c,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Metadata (Base Integration)"}),new k.Setting(e).setName("Show progress").setDesc("Display progress percentage on cards").addToggle(o=>o.setValue(this.plugin.settings["show-progress"]).onChange(async c=>{this.plugin.settings["show-progress"]=c,await this.plugin.saveSettings()})),new k.Setting(e).setName("Show project").setDesc("Display project name on cards").addToggle(o=>o.setValue(this.plugin.settings["show-project"]).onChange(async c=>{this.plugin.settings["show-project"]=c,await this.plugin.saveSettings()})),new k.Setting(e).setName("Default project").setDesc("Default project name for new cards (leave empty for none)").addText(o=>o.setPlaceholder("").setValue(this.plugin.settings["default-project"]).onChange(async c=>{this.plugin.settings["default-project"]=c,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Cards"}),new k.Setting(e).setName("New card insertion method").setDesc("Where to insert new cards in a lane").addDropdown(o=>o.addOption("prepend","At the top").addOption("append","At the bottom").setValue(this.plugin.settings["new-card-insertion-method"]).onChange(async c=>{this.plugin.settings["new-card-insertion-method"]=c,await this.plugin.saveSettings()})),new k.Setting(e).setName("Template path").setDesc("Path to a template file for creating new cards (e.g., templates/card-template.md)").addText(o=>o.setPlaceholder("templates/card-template.md").setValue(this.plugin.settings["template-path"]).onChange(async c=>{this.plugin.settings["template-path"]=c,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Card Composer"}),new k.Setting(e).setName("Show card composer").setDesc("Show quick-add composer in lanes for rapid card creation").addToggle(o=>o.setValue(this.plugin.settings["show-card-composer"]).onChange(async c=>{this.plugin.settings["show-card-composer"]=c,await this.plugin.saveSettings()})),new k.Setting(e).setName("Composer position").setDesc("Where to show the quick-add composer in lanes").addDropdown(o=>o.addOption("bottom","Bottom of lane").addOption("top","Top of lane").setValue(this.plugin.settings["composer-position"]).onChange(async c=>{this.plugin.settings["composer-position"]=c,await this.plugin.saveSettings()})),new k.Setting(e).setName("Show subtasks").setDesc("Display subtask checkboxes in card view").addToggle(o=>o.setValue(this.plugin.settings["show-subtasks"]).onChange(async c=>{this.plugin.settings["show-subtasks"]=c,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Filtering"}),new k.Setting(e).setName("Show filter toolbar").setDesc("Display filter toolbar at the top of boards for searching and filtering cards").addToggle(o=>o.setValue(this.plugin.settings["show-filter-toolbar"]).onChange(async c=>{this.plugin.settings["show-filter-toolbar"]=c,await this.plugin.saveSettings()})),e.createEl("h2",{text:"WIP Limits"}),e.createEl("p",{text:"Work In Progress limits help manage workflow by limiting cards per lane. Configure per-lane limits in board settings.",cls:"setting-item-description"}),new k.Setting(e).setName("Default WIP limit").setDesc("Default maximum cards per lane (0 = no limit). Can be overridden per-lane.").addText(o=>o.setPlaceholder("0").setValue(String(this.plugin.settings["default-wip-limit"])).onChange(async c=>{let d=parseInt(c,10);this.plugin.settings["default-wip-limit"]=isNaN(d)?0:Math.max(0,d),await this.plugin.saveSettings()})),new k.Setting(e).setName("Block when exceeded").setDesc("Prevent adding new cards when a lane exceeds its WIP limit").addToggle(o=>o.setValue(this.plugin.settings["wip-block-exceeded"]).onChange(async c=>{this.plugin.settings["wip-block-exceeded"]=c,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Card Notes"});let t=e.createDiv({cls:"kanban-settings-info"});t.createEl("p",{text:"Available template variables:",cls:"setting-item-name"});let n=t.createEl("ul",{cls:"kanban-template-vars-list"}),s=["{{title}} - Card title","{{id}} - Unique card ID","{{date}} - Current date (YYYY-MM-DD)","{{time}} - Current time (HH:mm)","{{datetime}} - Full ISO datetime","{{dueDate}} - Card due date","{{project}} - Project name","{{priority}} - Priority level","{{tags}} - Card tags (comma-separated)","{{board}} - Board name","{{lane}} - Lane name","{{date:FORMAT}} - Custom date format (e.g., {{date:MMMM DD, YYYY}})","{{variable|default}} - Variable with default value"];for(let o of s)n.createEl("li",{text:o,cls:"kanban-template-var"});new k.Setting(e).setName("Card note template").setDesc("Template file for dedicated card notes").addText(o=>o.setPlaceholder("templates/card-note.md").setValue(this.plugin.settings["card-note-template"]).onChange(async c=>{this.plugin.settings["card-note-template"]=c,await this.plugin.saveSettings()})),new k.Setting(e).setName("Card note folder").setDesc("Default folder for dedicated card notes. Leave empty to use the same folder as the board.").addText(o=>o.setPlaceholder("cards/").setValue(this.plugin.settings["card-note-folder"]).onChange(async c=>{this.plugin.settings["card-note-folder"]=c,await this.plugin.saveSettings()})),new k.Setting(e).setName("Auto-create note for new cards").setDesc("Automatically create a dedicated note file when adding new cards").addToggle(o=>o.setValue(this.plugin.settings["auto-create-note"]).onChange(async c=>{this.plugin.settings["auto-create-note"]=c,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Dates"}),new k.Setting(e).setName("Date format").setDesc("Format for displaying dates (YYYY-MM-DD, DD/MM/YYYY, etc.)").addText(o=>o.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings["date-format"]).onChange(async c=>{this.plugin.settings["date-format"]=c||Z["date-format"],await this.plugin.saveSettings()})),new k.Setting(e).setName("Time format").setDesc("Format for displaying times (HH:mm, hh:mm A, etc.)").addText(o=>o.setPlaceholder("HH:mm").setValue(this.plugin.settings["time-format"]).onChange(async c=>{this.plugin.settings["time-format"]=c||Z["time-format"],await this.plugin.saveSettings()})),new k.Setting(e).setName("Date trigger").setDesc("Character to trigger date input (e.g., @)").addText(o=>o.setPlaceholder("@").setValue(this.plugin.settings["date-trigger"]).onChange(async c=>{this.plugin.settings["date-trigger"]=c||Z["date-trigger"],await this.plugin.saveSettings()})),new k.Setting(e).setName("Time trigger").setDesc("Character to trigger time input (e.g., @@)").addText(o=>o.setPlaceholder("@@").setValue(this.plugin.settings["time-trigger"]).onChange(async c=>{this.plugin.settings["time-trigger"]=c||Z["time-trigger"],await this.plugin.saveSettings()})),new k.Setting(e).setName("Link dates to daily notes").setDesc("Make dates clickable to open corresponding daily notes").addToggle(o=>o.setValue(this.plugin.settings["link-date-to-daily-note"]).onChange(async c=>{this.plugin.settings["link-date-to-daily-note"]=c,await this.plugin.saveSettings()})),new k.Setting(e).setName("Show relative dates").setDesc('Display dates as "Today", "Tomorrow", "In 3 days", etc.').addToggle(o=>o.setValue(this.plugin.settings["show-relative-date"]).onChange(async c=>{this.plugin.settings["show-relative-date"]=c,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Natural Language Dates"}),new k.Setting(e).setName("Parse natural language dates").setDesc('Automatically convert phrases like "today", "tomorrow", "next Monday", "in 3 days" to dates').addToggle(o=>o.setValue(this.plugin.settings["parse-natural-dates"]).onChange(async c=>{this.plugin.settings["parse-natural-dates"]=c,await this.plugin.saveSettings()})),new k.Setting(e).setName("Parse recurrence patterns").setDesc('Recognize patterns like "daily", "every Monday", "weekly", "every 2 weeks"').addToggle(o=>o.setValue(this.plugin.settings["parse-recurrence"]).onChange(async c=>{this.plugin.settings["parse-recurrence"]=c,await this.plugin.saveSettings()})),new k.Setting(e).setName("Date serialization format").setDesc("How dates are saved in markdown (ISO format recommended for compatibility)").addDropdown(o=>o.addOption("iso","ISO format (2024-01-15)").addOption("natural","Natural language (tomorrow)").setValue(this.plugin.settings["date-serialization-format"]).onChange(async c=>{this.plugin.settings["date-serialization-format"]=c,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Reminders"}),new k.Setting(e).setName("Enable reminders").setDesc("Show notifications when cards are approaching their due dates").addToggle(o=>o.setValue(this.plugin.settings["enable-reminders"]).onChange(async c=>{this.plugin.settings["enable-reminders"]=c,await this.plugin.saveSettings(),this.plugin.restartReminders()})),new k.Setting(e).setName("Default reminder time").setDesc("How long before due date to show reminder (e.g., 30m, 1h, 2h, 1d)").addText(o=>o.setPlaceholder("1h").setValue(this.plugin.settings["reminder-time"]).onChange(async c=>{this.plugin.settings["reminder-time"]=c||Z["reminder-time"],await this.plugin.saveSettings()})),new k.Setting(e).setName("Reminder type").setDesc("How to show reminders").addDropdown(o=>o.addOption("notice","Obsidian notice (in-app)").addOption("system","System notification (desktop)").setValue(this.plugin.settings["reminder-type"]).onChange(async c=>{this.plugin.settings["reminder-type"]=c,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Archive"}),new k.Setting(e).setName("Prepend archive date").setDesc("Add the archive date to the beginning of archived card titles").addToggle(o=>o.setValue(this.plugin.settings["prepend-archive-date"]).onChange(async c=>{this.plugin.settings["prepend-archive-date"]=c,await this.plugin.saveSettings()})),new k.Setting(e).setName("Archive date format").setDesc("Format for prepended archive dates").addText(o=>o.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings["prepend-archive-format"]).onChange(async c=>{this.plugin.settings["prepend-archive-format"]=c||Z["prepend-archive-format"],await this.plugin.saveSettings()})),e.createEl("h2",{text:"Base Task Sync"});let r=this.plugin.settings["base-sync"];if(new k.Setting(e).setName("Enable Base sync").setDesc("Sync cards with Base task files. When enabled, moving cards updates task status fields.").addToggle(o=>o.setValue(r.enabled).onChange(async c=>{this.plugin.settings["base-sync"].enabled=c,await this.plugin.saveSettings(),this.display()})),r.enabled){new k.Setting(e).setName("Tasks folder").setDesc("Folder containing Base task files").addText(c=>c.setPlaceholder("Tasks").setValue(r.tasksFolder).onChange(async d=>{this.plugin.settings["base-sync"].tasksFolder=d||"Tasks",await this.plugin.saveSettings()})),new k.Setting(e).setName("Task query").setDesc('Filter tasks to sync (e.g., "project:MyProject", "status:todo", "tag:work")').addText(c=>c.setPlaceholder("Leave empty for all tasks").setValue(r.query).onChange(async d=>{this.plugin.settings["base-sync"].query=d,await this.plugin.saveSettings()})),new k.Setting(e).setName("Status field").setDesc("Frontmatter field name for task status").addText(c=>c.setPlaceholder("status").setValue(r.statusField).onChange(async d=>{this.plugin.settings["base-sync"].statusField=d||"status",await this.plugin.saveSettings()})),new k.Setting(e).setName("Progress field").setDesc("Frontmatter field name for task progress").addText(c=>c.setPlaceholder("progress").setValue(r.progressField).onChange(async d=>{this.plugin.settings["base-sync"].progressField=d||"progress",await this.plugin.saveSettings()})),new k.Setting(e).setName("Project field").setDesc("Frontmatter field name for task project").addText(c=>c.setPlaceholder("project").setValue(r.projectField).onChange(async d=>{this.plugin.settings["base-sync"].projectField=d||"project",await this.plugin.saveSettings()})),new k.Setting(e).setName("Conflict resolution").setDesc("How to handle conflicts between local cards and remote tasks").addDropdown(c=>c.addOption("local","Keep local (card) values").addOption("remote","Use remote (Base) values").addOption("last-write","Last write wins (most recent modification)").addOption("prompt","Ask me each time").setValue(r.conflictResolution).onChange(async d=>{this.plugin.settings["base-sync"].conflictResolution=d,await this.plugin.saveSettings()})),new k.Setting(e).setName("Auto-sync interval").setDesc("Minutes between auto-syncs (0 = manual only)").addText(c=>c.setPlaceholder("0").setValue(r.syncInterval.toString()).onChange(async d=>{let u=parseInt(d,10);this.plugin.settings["base-sync"].syncInterval=isNaN(u)?0:Math.max(0,u),await this.plugin.saveSettings()})),new k.Setting(e).setName("Create missing tasks").setDesc("Automatically create Base task files for cards without a linked task").addToggle(c=>c.setValue(r.createMissingTasks).onChange(async d=>{this.plugin.settings["base-sync"].createMissingTasks=d,await this.plugin.saveSettings()})),e.createEl("h3",{text:"Lane \u2192 Status Mapping"}),e.createEl("p",{text:"Map lane titles to Base status values. When a card moves to a lane, its status will be updated.",cls:"setting-item-description"});let o=e.createDiv({cls:"kanban-lane-mapping"});for(let[c,d]of Object.entries(r.laneMapping))this.createMappingRow(o,c,d);new k.Setting(e).setName("Add mapping").setDesc("Add a new lane \u2192 status mapping").addButton(c=>c.setButtonText("+ Add mapping").onClick(()=>{this.createMappingRow(o,"","")}))}e.createEl("h2",{text:"About"});let l=e.createDiv({cls:"kanban-settings-about"});l.createEl("p",{text:"Base Kanban is a markdown-backed Kanban board plugin with support for Obsidian Base task metadata."}),l.createEl("p",{text:"Per-board settings can override these global settings. Access board settings from the board menu (three dots in the header) or via the command palette."})}createMappingRow(e,t,n){let s=e.createDiv({cls:"kanban-mapping-row"}),r=s.createEl("input",{type:"text",cls:"kanban-mapping-lane",attr:{placeholder:"Lane title"}});r.value=t,s.createSpan({text:"\u2192",cls:"kanban-mapping-arrow"});let l=s.createEl("input",{type:"text",cls:"kanban-mapping-status",attr:{placeholder:"Status value"}});l.value=n;let o=s.createEl("button",{cls:"kanban-mapping-delete"});o.textContent="\xD7";let c=async()=>{let d=r.value.trim(),u=l.value.trim();t&&t!==d&&delete this.plugin.settings["base-sync"].laneMapping[t],d&&u&&(this.plugin.settings["base-sync"].laneMapping[d]=u),await this.plugin.saveSettings()};r.addEventListener("change",c),l.addEventListener("change",c),o.addEventListener("click",async()=>{let d=r.value.trim();d&&this.plugin.settings["base-sync"].laneMapping[d]&&(delete this.plugin.settings["base-sync"].laneMapping[d],await this.plugin.saveSettings()),s.remove()})}};var bt=class extends L.Plugin{constructor(){super(...arguments);this.kanbanFileModes={};this.reminderIntervalId=null;this.notifiedCards=new Set}async onload(){var e,t;await this.loadSettings(),this.registerView(se,n=>new re(n,this)),this.registerExtensions(["kanban"],se),this.settingsTab=new mt(this.app,this),this.addSettingTab(this.settingsTab),this.addRibbonIcon("columns","Create new Kanban board",()=>{this.createNewKanban()}),this.registerCommands(),this.registerFileMenu(),this.registerMonkeyPatch(),(t=(e=this.app.workspace).registerHoverLinkSource)==null||t.call(e,ee,{display:"Kanban",defaultMod:!0}),this.settings["enable-reminders"]&&this.startReminderCheck(),this.registerEvent(this.app.vault.on("rename",(n,s)=>{this.kanbanFileModes[s]&&(this.kanbanFileModes[n.path]=this.kanbanFileModes[s],delete this.kanbanFileModes[s])})),this.registerEvent(this.app.vault.on("delete",n=>{this.kanbanFileModes[n.path]&&delete this.kanbanFileModes[n.path]}))}onunload(){var e,t;(t=(e=this.app.workspace).unregisterHoverLinkSource)==null||t.call(e,ee),this.stopReminderCheck()}async loadSettings(){this.settings=Object.assign({},Z,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}registerCommands(){this.addCommand({id:"create-new-kanban-board",name:"Create new board",callback:()=>this.createNewKanban()}),this.addCommand({id:"toggle-kanban-view",name:"Toggle between Kanban and markdown mode",checkCallback:e=>{var l;let t=this.app.workspace.getActiveFile();if(!t)return!1;let n=this.app.metadataCache.getFileCache(t),s=(l=n==null?void 0:n.frontmatter)==null?void 0:l[ee];if(e)return!!s;let r=this.app.workspace.getActiveViewOfType(re);if(r)this.kanbanFileModes[t.path]="markdown",this.setMarkdownView(r.leaf);else{let o=this.app.workspace.getActiveViewOfType(L.MarkdownView);o&&(this.kanbanFileModes[t.path]=se,this.setKanbanView(o.leaf))}}}),this.addCommand({id:"archive-completed-cards",name:"Archive completed cards in active board",checkCallback:e=>{let t=this.app.workspace.getActiveViewOfType(re);if(!t)return!1;if(e)return!0;t.archiveCompletedCards()}}),this.addCommand({id:"convert-to-kanban",name:"Convert empty note to Kanban",checkCallback:e=>{var s;let t=this.app.workspace.getActiveViewOfType(L.MarkdownView);if(!t)return!1;let n=((s=t.file)==null?void 0:s.stat.size)===0;if(e)return!!n;n&&t.file&&this.app.vault.modify(t.file,ut).then(()=>{this.setKanbanView(t.leaf)}).catch(r=>console.error("Error converting to kanban:",r))}}),this.addCommand({id:"add-kanban-lane",name:"Add a list",checkCallback:e=>{let t=this.app.workspace.getActiveViewOfType(re);if(!t)return!1;if(e)return!0;t.addLane()}}),this.addCommand({id:"open-board-settings",name:"Open board settings",checkCallback:e=>{var n;let t=this.app.workspace.getActiveViewOfType(re);if(!t)return!1;if(e)return!0;(n=t.openBoardSettings)==null||n.call(t)}}),this.addCommand({id:"create-or-open-card-note",name:"Create or open card note",checkCallback:e=>{let t=this.app.workspace.getActiveViewOfType(re);if(!t)return!1;if(e)return!0;t.createOrOpenCardNote()}}),this.addCommand({id:"sync-with-base",name:"Sync with Base",checkCallback:e=>{let t=this.app.workspace.getActiveViewOfType(re);if(!t)return!1;if(!this.settings["base-sync"].enabled)return e||new L.Notice("Base sync is not enabled. Enable it in plugin settings first."),!1;if(e)return!0;t.manualSync()}})}registerFileMenu(){this.registerEvent(this.app.workspace.on("file-menu",(e,t,n,s)=>{var r;if(n!=="link-context-menu"){if(t instanceof L.TFolder){e.addItem(l=>{l.setSection("action-primary").setTitle("New kanban board").setIcon("columns").onClick(()=>this.createNewKanban(t))});return}if(t instanceof L.TFile&&s){let l=s.view instanceof L.MarkdownView,o=s.view instanceof re,c=this.app.metadataCache.getFileCache(t),d=(r=c==null?void 0:c.frontmatter)==null?void 0:r[ee];l&&d&&e.addItem(u=>{u.setTitle("Open as kanban board").setIcon("columns").setSection("pane").onClick(()=>{this.kanbanFileModes[t.path]=se,this.setKanbanView(s)})}),o&&e.addItem(u=>{u.setTitle("Open as markdown").setIcon("file-text").setSection("pane").onClick(()=>{this.kanbanFileModes[t.path]="markdown",this.setMarkdownView(s)})})}}}))}registerMonkeyPatch(){let e=this;this.register(Ta(L.WorkspaceLeaf.prototype,{detach(t){return function(){var r;let n=(r=this.view)==null?void 0:r.getState(),s=n==null?void 0:n.file;return s&&e.kanbanFileModes[s]&&delete e.kanbanFileModes[s],t.apply(this)}},setViewState(t){return function(n,...s){var l,o;let r=(l=n.state)==null?void 0:l.file;if(n.type==="markdown"&&r&&e.kanbanFileModes[r]!=="markdown"){let c=e.app.metadataCache.getCache(r);if((o=c==null?void 0:c.frontmatter)!=null&&o[ee]){let d={...n,type:se};return e.kanbanFileModes[r]=se,t.apply(this,[d,...s])}}return t.apply(this,[n,...s])}}}))}async setMarkdownView(e,t=!0){await e.setViewState({type:"markdown",state:e.view.getState(),popstate:!0},{focus:t})}async setKanbanView(e){await e.setViewState({type:se,state:e.view.getState(),popstate:!0})}async createNewKanban(e){var s;let t=e||this.app.fileManager.getNewFileParent(((s=this.app.workspace.getActiveFile())==null?void 0:s.path)||""),n=null;try{n=await this.app.fileManager.createNewMarkdownFile(t,"Untitled Kanban")}catch(r){console.warn("Primary file creation failed, using fallback:",r);try{let l=t.path?`${t.path}/`:"",o=`${l}Untitled Kanban.md`,c=1;for(;this.app.vault.getAbstractFileByPath(o);)o=`${l}Untitled Kanban ${c}.md`,c++;n=await this.app.vault.create(o,ut)}catch(l){console.error("Error creating kanban board:",l),new L.Notice("Error creating Kanban board");return}}if(!n){new L.Notice("Error creating Kanban board");return}try{await this.app.vault.modify(n,ut),await this.app.workspace.getLeaf().setViewState({type:se,state:{file:n.path}}),new L.Notice("Created new Kanban board")}catch(r){console.error("Error setting up kanban board:",r),new L.Notice("Error creating Kanban board")}}startReminderCheck(){this.reminderIntervalId===null&&(this.reminderIntervalId=window.setInterval(()=>{this.checkReminders()},60*1e3),this.checkReminders())}stopReminderCheck(){this.reminderIntervalId!==null&&(window.clearInterval(this.reminderIntervalId),this.reminderIntervalId=null)}async checkReminders(){if(!this.settings["enable-reminders"])return;let e=new Date,t=this.app.vault.getMarkdownFiles().filter(n=>{var r;let s=this.app.metadataCache.getFileCache(n);return(r=s==null?void 0:s.frontmatter)==null?void 0:r[ee]});for(let n of t)try{let s=await this.app.vault.read(n),r=ct(s);for(let l of r.lanes)for(let o of l.cards)this.shouldRemind(o,e)&&this.showReminder(o,n.basename,l.title)}catch(s){}}shouldRemind(e,t){if(e.completed||!e.dueDate)return!1;let n=`${e.id}-${e.dueDate}`;if(this.notifiedCards.has(n))return!1;let s=this.parseDueDateTime(e);if(!s)return!1;let r=e.reminderTime||this.settings["reminder-time"]||"1h",l=this.parseReminderOffset(r),o=new Date(s.getTime()-l),c=t>=o&&t<=s;return c&&this.notifiedCards.add(n),c}parseDueDateTime(e){if(!e.dueDate)return null;try{let t=e.dueDate,n=e.dueTime||"09:00",[s,r,l]=t.split("-").map(Number),[o,c]=n.split(":").map(Number);return new Date(s,r-1,l,o,c)}catch(t){return null}}parseReminderOffset(e){let t=e.match(/^(\d+)\s*(m|min|h|hr|d|day)s?$/i);if(!t)return 60*60*1e3;let n=parseInt(t[1],10);switch(t[2].toLowerCase()){case"m":case"min":return n*60*1e3;case"h":case"hr":return n*60*60*1e3;case"d":case"day":return n*24*60*60*1e3;default:return 60*60*1e3}}showReminder(e,t,n){let s=e.title.replace(/\[\[([^\]|]+)(?:\|[^\]]+)?\]\]/g,"$1"),r=e.dueTime?`${e.dueDate} ${e.dueTime}`:e.dueDate,l=`\u{1F4CB} ${t} / ${n}
"${s}"
Due: ${r}`;this.settings["reminder-type"]==="system"&&"Notification"in window?Notification.permission==="granted"?new Notification("Kanban Reminder",{body:l,icon:"columns"}):Notification.permission!=="denied"?Notification.requestPermission().then(o=>{o==="granted"?new Notification("Kanban Reminder",{body:l}):new L.Notice(l,1e4)}):new L.Notice(l,1e4):new L.Notice(l,1e4)}clearNotificationHistory(){this.notifiedCards.clear()}restartReminders(){this.stopReminderCheck(),this.settings["enable-reminders"]&&(this.clearNotificationHistory(),this.startReminderCheck())}};function Ta(i,a){let e=[];for(let t in a){let n=i[t],s=a[t];if(s&&typeof n=="function"){let r=s(n);i[t]=r,e.push(()=>{i[t]=n})}}return()=>{for(let t of e)t()}}
/*! Bundled license information:

sortablejs/modular/sortable.esm.js:
  (**!
   * Sortable 1.15.6
   * @author	RubaXa   <trash@rubaxa.org>
   * @author	owenm    <owen23355@gmail.com>
   * @license MIT
   *)
*/
